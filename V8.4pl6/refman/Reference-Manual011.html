<!DOCTYPE html>
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/node/node.css" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/system/defaults.css" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/system/system.css" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/user/user.css" />
<link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/coq/style.css" />
<link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/coq/coqdoc.css" /><title>Chapter 9  The tactic language</title>
</head>
<body >

<div id="container">

<div id="headertop">
<div id="nav">
  <ul class="links-menu">
    <li><a href="/" class="active">Home</a></li>
    <li><a href="/about-coq" title="More about coq">About Coq</a></li>
    <li><a href="/download">Get Coq</a></li>
    <li><a href="/documentation">Documentation</a></li>
    <li><a href="/community">Community</a></li>
  </ul>
</div>
</div>

<div id="header">
<div id="logoWrapper">
  <div id="logo"><a href="/" title="Home"><img src="/files/barron_logo.png" alt="Home" /></a>
  </div>
  <div id="siteName"><a href="/" title="Home">The Coq Proof Assistant</a>
  </div>
</div>
</div>

<div id="content">

<h1 id="sec446" class="chapter">Chapter 9  The tactic language</h1>
<ul>
<li><a href="Reference-Manual011.html#sec447">9.1  Syntax</a>
</li><li><a href="Reference-Manual011.html#sec448">9.2  Semantics</a>
</li><li><a href="Reference-Manual011.html#sec472">9.3  Tactic toplevel definitions</a>
</li><li><a href="Reference-Manual011.html#sec475">9.4  Debugging <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> tactics</a>
</li></ul>
<p>This chapter gives a compact documentation of Ltac, the tactic
language available in <span style="font-variant:small-caps">Coq</span>. We start by giving the syntax, and next,
we present the informal semantics. If you want to know more regarding
this language and especially about its foundations, you can refer
to [<a href="biblio.html#Del00">41</a>]. Chapter <a href="Reference-Manual012.html#sec476">10</a> is devoted to giving
examples of use of this language on small but also with non-trivial
problems.</p>
<h2 id="sec447" class="section">9.1  Syntax</h2>
<p>The syntax of the tactic language is given Figures <a href="#ltac">9.1</a>
and <a href="#ltac_aux">9.2</a>. See Chapter <a href="Reference-Manual003.html#BNF-syntax">1</a> for a description of
the BNF metasyntax used in these grammar rules. Various already
defined entries will be used in this chapter: entries
<span style="font-style:oblique">natural</span>, <span style="font-style:oblique">integer</span>, <span style="font-style:oblique">ident</span>, <span style="font-style:oblique">qualid</span>, <span style="font-style:oblique">term</span>,
<span style="font-style:oblique">cpattern</span> and <span style="font-style:oblique">atomic_tactic</span> represent respectively the natural and
integer numbers, the authorized identificators and qualified names,
<span style="font-variant:small-caps">Coq</span>’s terms and patterns and all the atomic tactics described in
Chapter <a href="Reference-Manual010.html#sec340">8</a>. The syntax of <span style="font-style:oblique">cpattern</span> is the same as that
of terms, but it is extended with pattern matching metavariables. In
<span style="font-style:oblique">cpattern</span>, a pattern-matching metavariable is represented with the
syntax <span style="font-family:monospace">?id</span> where <span style="font-family:monospace">id</span> is an <span style="font-style:oblique">ident</span>. The notation <span style="font-family:monospace">_</span>
can also be used to denote metavariable whose instance is
irrelevant. In the notation <span style="font-family:monospace">?id</span>, the identifier allows us to
keep instantiations and to make constraints whereas <span style="font-family:monospace">_</span> shows
that we are not interested in what will be matched. On the right hand
side of pattern-matching clauses, the named metavariable are used
without the question mark prefix. There is also a special notation for
second-order pattern-matching problems: in an applicative pattern of
the form <span style="font-family:monospace">@?id id</span><sub>1</sub><span style="font-family:monospace"> …id</span><sub><span style="font-style:italic">n</span></sub>, the variable <span style="font-family:monospace">id</span>
matches any complex expression with (possible) dependencies in the
variables <span style="font-family:monospace">id</span><sub>1</sub><span style="font-family:monospace"> …id</span><sub><span style="font-style:italic">n</span></sub> and returns a functional term of
the form <span style="font-family:monospace">fun id</span><sub>1</sub><span style="font-family:monospace"> …id</span><sub><span style="font-style:italic">n</span></sub><span style="font-family:monospace"> =&gt; </span><span style="font-style:oblique">term</span>.</p><p>The main entry of the grammar is <span style="font-style:oblique">expr</span>. This language is used in
proof mode but it can also be used in toplevel definitions as shown in
Figure <a href="#ltactop">9.3</a>.</p><p><br>
<span style="font-weight:bold">Remarks: </span></p><ol class="enumerate" type=1><li class="li-enumerate">
The infix tacticals “… <span style="font-family:monospace">||</span> …” and “… <span style="font-family:monospace">;</span> …” are associative. </li><li class="li-enumerate">In <span style="font-style:oblique">tacarg</span>, there is an overlap between <span style="font-style:oblique">qualid</span> as a
direct tactic argument and <span style="font-style:oblique">qualid</span> as a particular case of
<span style="font-style:oblique">term</span>. The resolution is done by first looking for a reference of
the tactic language and if it fails, for a reference to a term. To
force the resolution as a reference of the tactic language, use the
form <span style="font-family:monospace">ltac :</span> <span style="font-style:oblique">qualid</span>. To force the resolution as a reference to
a term, use the syntax <span style="font-family:monospace">(</span><span style="font-style:oblique">qualid</span><span style="font-family:monospace">)</span>.</li><li class="li-enumerate">As shown by the figure, tactical <span style="font-family:monospace">||</span> binds more than the
prefix tacticals <span style="font-family:monospace">try</span>, <span style="font-family:monospace">repeat</span>, <span style="font-family:monospace">do</span> and
<span style="font-family:monospace">abstract</span> which themselves bind more than the postfix tactical
“<span style="font-family:monospace">… ;[ … ]</span>” which binds more than “… <span style="font-family:monospace">;</span>
…”.<p>For instance
</p><blockquote class="quote">
<span style="font-family:monospace">try repeat </span><span style="font-style:oblique">tactic</span><sub>1</sub><span style="font-family:monospace"> ||
</span><span style="font-style:oblique">tactic</span><sub>2</sub><span style="font-family:monospace">;</span><span style="font-style:oblique">tactic</span><sub>3</sub><span style="font-family:monospace">;[</span><span style="font-style:oblique">tactic</span><sub>31</sub><span style="font-family:monospace">|…|</span><span style="font-style:oblique">tactic</span><sub>3<span style="font-style:italic">n</span></sub><span style="font-family:monospace">];</span><span style="font-style:oblique">tactic</span><sub>4</sub><span style="font-family:monospace">.</span>
</blockquote><p>
is understood as 
</p><blockquote class="quote">
<span style="font-family:monospace">(try (repeat (</span><span style="font-style:oblique">tactic</span><sub>1</sub><span style="font-family:monospace"> || </span><span style="font-style:oblique">tactic</span><sub>2</sub><span style="font-family:monospace">)));</span> <br>
<span style="font-family:monospace">((</span><span style="font-style:oblique">tactic</span><sub>3</sub><span style="font-family:monospace">;[</span><span style="font-style:oblique">tactic</span><sub>31</sub><span style="font-family:monospace">|…|</span><span style="font-style:oblique">tactic</span><sub>3<span style="font-style:italic">n</span></sub><span style="font-family:monospace">]);</span><span style="font-style:oblique">tactic</span><sub>4</sub><span style="font-family:monospace">).</span>
</blockquote></li></ol><blockquote class="figure"><div class="center"><hr style="width:80%;height:2"></div>
<div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">expr</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">expr</span> <span style="font-family:monospace">;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">expr</span> <span style="font-family:monospace">; [</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>3</sub></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">do</span> <span style="font-style:italic">(</span><span style="font-style:oblique">natural</span> <span style="font-style:italic">|</span> <span style="font-style:oblique">ident</span><span style="font-style:italic">)</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">progress</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">repeat</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">try</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">timeout</span> <span style="font-style:italic">(</span><span style="font-style:oblique">natural</span> <span style="font-style:italic">|</span> <span style="font-style:oblique">ident</span><span style="font-style:italic">)</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>2</sub> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>2</sub></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">tacexpr</span><sub>1</sub> <span style="font-family:monospace">||</span> <span style="font-style:oblique">tacexpr</span><sub>3</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>1</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacexpr</span><sub>1</sub></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">fun</span> <span style="font-style:oblique">name</span>  …  <span style="font-style:oblique">name</span> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">atom</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">let</span> <span style="font-style:oblique">[</span><span style="font-family:monospace">rec</span><span style="font-family:monospace"><span style="font-style:oblique">]</span></span><span style="font-family:monospace"> </span><span style="font-style:oblique">let_clause</span><span style="font-family:monospace"> </span><span style="font-family:monospace">with</span><span style="font-family:monospace"> </span><span style="font-family:monospace">…</span><span style="font-family:monospace"> </span><span style="font-family:monospace">with</span><span style="font-family:monospace"> </span><span style="font-style:oblique">let_clause</span><span style="font-family:monospace"> </span><span style="font-family:monospace">in</span><span style="font-family:monospace">
</span><span style="font-style:oblique">atom</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">match goal with</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">match reverse goal with</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">match</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">with</span> <span style="font-style:oblique">match_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">match_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">lazymatch goal with</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">lazymatch reverse goal with</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">context_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">lazymatch</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">with</span> <span style="font-style:oblique">match_rule</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">match_rule</span> <span style="font-family:monospace">end</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">abstract</span> <span style="font-style:oblique">atom</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">abstract</span> <span style="font-style:oblique">atom</span> <span style="font-family:monospace">using</span> <span style="font-style:oblique">ident</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">first [</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">solve [</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">|</span> … <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">idtac</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">message_token</span>  …  <span style="font-style:oblique">message_token</span><span style="font-style:oblique">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">fail</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">natural</span><span style="font-style:oblique">]</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">message_token</span>  …  <span style="font-style:oblique">message_token</span><span style="font-style:oblique">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">fresh</span>  |  <span style="font-family:monospace">fresh</span> <span style="font-style:oblique">string</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">context</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">term</span> <span style="font-family:monospace">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">eval</span> <span style="font-style:oblique">redexpr</span> <span style="font-family:monospace">in</span> <span style="font-style:oblique">term</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">type of</span> <span style="font-style:oblique">term</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">external</span> <span style="font-style:oblique">string</span> <span style="font-style:oblique">string</span> <span style="font-style:oblique">tacarg</span>  …  <span style="font-style:oblique">tacarg</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">constr :</span> <span style="font-style:oblique">term</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">atomic_tactic</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">qualid</span> <span style="font-style:oblique">tacarg</span>  …  <span style="font-style:oblique">tacarg</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">atom</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">atom</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">qualid</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" >()</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">integer</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">(</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">)</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">message_token</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">string</span>  |  <span style="font-style:oblique">ident</span>  |  <span style="font-style:oblique">integer</span> </td></tr>
</table>
</div>
<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 9.1: Syntax of the tactic language</td></tr>
</table></div>
<a id="ltac"></a>
<div class="center"><hr style="width:80%;height:2"></div></blockquote><blockquote class="figure"><div class="center"><hr style="width:80%;height:2"></div>
<div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">tacarg</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">qualid</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">()</span> </td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">ltac :</span> <span style="font-style:oblique">atom</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">term</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">let_clause</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">ident</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">name</span>  …  <span style="font-style:oblique">name</span><span style="font-style:oblique">]</span> <span style="font-family:monospace">:=</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">context_rule</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">context_hyp</span> <span style="font-family:monospace">,</span> … <span style="font-family:monospace">,</span> <span style="font-style:oblique">context_hyp</span> <span style="font-family:monospace">|-</span><span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">|-</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">_ =&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">context_hyp</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">name</span> <span style="font-family:monospace">:</span> <span style="font-style:oblique">cpattern</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">name</span> <span style="font-family:monospace">:=</span> <span style="font-style:oblique">cpattern</span> <span style="font-style:oblique">[</span><span style="font-family:monospace">:</span> <span style="font-style:oblique">cpattern</span><span style="font-style:oblique">]</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">match_rule</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" > <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">context</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">ident</span><span style="font-style:oblique">]</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">]</span>
<span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">appcontext</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">ident</span><span style="font-style:oblique">]</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">]</span>
<span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">_ =&gt;</span> <span style="font-style:oblique">expr</span></td></tr>
</table>
</div>
<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 9.2: Syntax of the tactic language (continued)</td></tr>
</table></div>
<a id="ltac_aux"></a>
<div class="center"><hr style="width:80%;height:2"></div></blockquote><blockquote class="figure"><div class="center"><hr style="width:80%;height:2"></div>
<div class="center">
<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">top</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">[</span><span style="font-family:monospace">Local</span><span style="font-family:monospace"><span style="font-style:oblique">]</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace">Ltac</span><span style="font-family:monospace"> </span><span style="font-style:oblique">ltac_def</span><span style="font-family:monospace"> </span><span style="font-family:monospace">with</span><span style="font-family:monospace"> </span><span style="font-family:monospace">…</span><span style="font-family:monospace"> </span><span style="font-family:monospace">with</span><span style="font-family:monospace"> </span><span style="font-style:oblique">ltac_def</span><span style="font-family:monospace"> </span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">ltac_def</span></td><td style="text-align:center;white-space:nowrap" >::=</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">ident</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">ident</span>  …  <span style="font-style:oblique">ident</span><span style="font-style:oblique">]</span> <span style="font-family:monospace">:=</span>
<span style="font-style:oblique">expr</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >&nbsp;</td><td style="text-align:center;white-space:nowrap" >|</td><td style="text-align:left;white-space:nowrap" ><span style="font-style:oblique">qualid</span> <span style="font-style:oblique">[</span><span style="font-style:oblique">ident</span>  …  <span style="font-style:oblique">ident</span><span style="font-style:oblique">]</span> <span style="font-family:monospace">::=</span><span style="font-style:oblique">expr</span>
</td></tr>
</table>
</div>
<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 9.3: Tactic toplevel definitions</td></tr>
</table></div>
<a id="ltactop"></a>
<div class="center"><hr style="width:80%;height:2"></div></blockquote>
<h2 id="sec448" class="section">9.2  Semantics</h2>
<p>
<a id="hevea_default719"></a>
</p><p>Tactic expressions can only be applied in the context of a goal. The
evaluation yields either a term, an integer or a tactic. Intermediary
results can be terms or integers but the final result must be a tactic
which is then applied to the current goal.</p><p>There is a special case for <span style="font-family:monospace">match goal</span> expressions of which
the clauses evaluate to tactics. Such expressions can only be used as
end result of a tactic expression (never as argument of a non recursive local
definition or of an application).</p><p>The rest of this section explains the semantics of every construction
of Ltac.</p><h4 id="sec449" class="subsubsection">Sequence<a id="hevea_default720"></a><a id="hevea_tactic177"></a>
<a id="hevea_default721"></a></h4>
<p>A sequence is an expression of the following form:
</p><blockquote class="quote">
<span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">;</span> <span style="font-style:oblique">expr</span><sub>2</sub>
</blockquote><p>
The expressions <span style="font-style:oblique">expr</span><sub>1</sub> and <span style="font-style:oblique">expr</span><sub>2</sub> are evaluated
to <span style="font-style:italic">v</span><sub>1</sub> and <span style="font-style:italic">v</span><sub>2</sub> which have to be tactic values. The tactic <span style="font-style:italic">v</span><sub>1</sub> is
then applied and <span style="font-style:italic">v</span><sub>2</sub> is applied to every subgoal generated by the
application of <span style="font-style:italic">v</span><sub>1</sub>. Sequence is left-associative.</p><h4 id="sec450" class="subsubsection">General sequence<a id="hevea_default722"></a><a id="hevea_tactic178"></a></h4>
<p>
<a id="hevea_default723"></a></p><p>A general sequence has the following form:
</p><blockquote class="quote">
<span style="font-style:oblique">expr</span><sub>0</sub> <span style="font-family:monospace">; [</span> <span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">]</span>
</blockquote><p>
The expressions <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> are evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub>, for <span style="font-style:italic">i</span>=0,...,<span style="font-style:italic">n</span>
and all have to be tactics. The tactic <span style="font-style:italic">v</span><sub>0</sub> is applied and <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> is
applied to the <span style="font-style:italic">i</span>-th generated subgoal by the application of <span style="font-style:italic">v</span><sub>0</sub>,
for =1,...,<span style="font-style:italic">n</span>. It fails if the application of <span style="font-style:italic">v</span><sub>0</sub> does not generate
exactly <span style="font-style:italic">n</span> subgoals.</p><p><br>
<span style="font-weight:bold">Variants: </span></p><ol class="enumerate" type=1><li class="li-enumerate">
If no tactic is given for the <span style="font-style:italic">i</span>-th generated subgoal, it
behaves as if the tactic <span style="font-family:monospace">idtac</span> were given. For instance, <span style="font-family:monospace">split ; [ | auto ]</span> is a shortcut for
<span style="font-family:monospace">split ; [ idtac | auto ]</span>.</li><li class="li-enumerate"><span style="font-style:oblique">expr</span><sub>0</sub> <span style="font-family:monospace">; [</span> <span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> <span style="font-family:monospace">|</span> <span style="font-family:monospace">..</span> <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span>+1+<span style="font-style:italic">j</span></sub> <span style="font-family:monospace">|</span>
... <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">]</span><p>In this variant, <span style="font-family:monospace">idtac</span> is used for the subgoals numbered from
<span style="font-style:italic">i</span>+1 to <span style="font-style:italic">i</span>+<span style="font-style:italic">j</span> (assuming <span style="font-style:italic">n</span> is the number of subgoals).</p><p>Note that <span style="font-family:monospace">..</span> is part of the syntax, while ... is the meta-symbol used
to describe a list of <span style="font-style:oblique">expr</span> of arbitrary length.</p></li><li class="li-enumerate"><span style="font-style:oblique">expr</span><sub>0</sub> <span style="font-family:monospace">; [</span> <span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">..</span> <span style="font-family:monospace">|</span>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span>+1+<span style="font-style:italic">j</span></sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">]</span><p>In this variant, <span style="font-style:oblique">expr</span> is used instead of <span style="font-family:monospace">idtac</span> for the
subgoals numbered from <span style="font-style:italic">i</span>+1 to <span style="font-style:italic">i</span>+<span style="font-style:italic">j</span>.</p></li></ol><h4 id="sec451" class="subsubsection">For loop<a id="hevea_default724"></a><a id="hevea_tactic179"></a>
<a id="hevea_default725"></a></h4>
<p>There is a for loop that repeats a tactic <span style="font-style:oblique">num</span> times:
</p><blockquote class="quote">
<span style="font-family:monospace">do</span> <span style="font-style:oblique">num</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
<span style="font-style:oblique">expr</span> is evaluated to <span style="font-style:italic">v</span>. <span style="font-style:italic">v</span> must be a tactic value. <span style="font-style:italic">v</span> is
applied <span style="font-style:oblique">num</span> times. Supposing <span style="font-style:oblique">num</span>&gt;1, after the first
application of <span style="font-style:italic">v</span>, <span style="font-style:italic">v</span> is applied, at least once, to the generated
subgoals and so on. It fails if the application of <span style="font-style:italic">v</span> fails before
the <span style="font-style:oblique">num</span> applications have been completed.</p><h4 id="sec452" class="subsubsection">Repeat loop<a id="hevea_default726"></a><a id="hevea_tactic180"></a>
<a id="hevea_default727"></a></h4>
<p>We have a repeat loop with:
</p><blockquote class="quote">
<span style="font-family:monospace">repeat</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
<span style="font-style:oblique">expr</span> is evaluated to <span style="font-style:italic">v</span>. If <span style="font-style:italic">v</span> denotes a tactic, this tactic
is applied to the goal. If the application succeeds, the tactic is
applied recursively to all the generated subgoals until it eventually
fails. The recursion stops in a subgoal when the tactic has failed.
The tactic <span style="font-family:monospace">repeat </span><span style="font-style:oblique">expr</span> itself never fails.</p><h4 id="sec453" class="subsubsection">Error catching<a id="hevea_default728"></a><a id="hevea_tactic181"></a>
<a id="hevea_default729"></a></h4>
<p>We can catch the tactic errors with:
</p><blockquote class="quote">
<span style="font-family:monospace">try</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
<span style="font-style:oblique">expr</span> is evaluated to <span style="font-style:italic">v</span>. <span style="font-style:italic">v</span> must be a tactic value. <span style="font-style:italic">v</span> is
applied. If the application of <span style="font-style:italic">v</span> fails, it catches the error and
leaves the goal unchanged. If the level of the exception is positive,
then the exception is re-raised with its level decremented.</p><h4 id="sec454" class="subsubsection">Detecting progress<a id="hevea_default730"></a><a id="hevea_tactic182"></a></h4>
<p>We can check if a tactic made progress with:
</p><blockquote class="quote">
<span style="font-family:monospace">progress</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
<span style="font-style:oblique">expr</span> is evaluated to <span style="font-style:italic">v</span>. <span style="font-style:italic">v</span> must be a tactic value. <span style="font-style:italic">v</span> is
applied. If the application of <span style="font-style:italic">v</span> produced one subgoal equal to the
initial goal (up to syntactical equality), then an error of level 0 is
raised. </p><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">Failed to progress</span><a id="hevea_error130"></a></p><h4 id="sec455" class="subsubsection">Branching<a id="hevea_default731"></a><a id="hevea_tactic183"></a>
<a id="hevea_default732"></a></h4>
<p>We can easily branch with the following structure:
</p><blockquote class="quote">
<span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">||</span> <span style="font-style:oblique">expr</span><sub>2</sub>
</blockquote><p>
<span style="font-style:oblique">expr</span><sub>1</sub> and <span style="font-style:oblique">expr</span><sub>2</sub> are evaluated to <span style="font-style:italic">v</span><sub>1</sub> and
<span style="font-style:italic">v</span><sub>2</sub>. <span style="font-style:italic">v</span><sub>1</sub> and <span style="font-style:italic">v</span><sub>2</sub> must be tactic values. <span style="font-style:italic">v</span><sub>1</sub> is applied and if
it fails to progress then <span style="font-style:italic">v</span><sub>2</sub> is applied. Branching is left-associative.</p><h4 id="sec456" class="subsubsection">First tactic to work<a id="hevea_default733"></a><a id="hevea_tactic184"></a>
<a id="hevea_default734"></a></h4>
<p>We may consider the first tactic to work (i.e. which does not fail) among a
panel of tactics:
</p><blockquote class="quote">
<span style="font-family:monospace">first [</span> <span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">]</span>
</blockquote><p>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> are evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> and <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> must be tactic values, for 
<span style="font-style:italic">i</span>=1,...,<span style="font-style:italic">n</span>. Supposing <span style="font-style:italic">n</span>&gt;1, it applies <span style="font-style:italic">v</span><sub>1</sub>, if it works, it stops else it
tries to apply <span style="font-style:italic">v</span><sub>2</sub> and so on. It fails when there is no applicable tactic.</p><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">No applicable tactic</span><a id="hevea_error131"></a></p><h4 id="sec457" class="subsubsection">Solving<a id="hevea_default735"></a><a id="hevea_tactic185"></a>
<a id="hevea_default736"></a></h4>
<p>We may consider the first to solve (i.e. which generates no subgoal) among a
panel of tactics:
</p><blockquote class="quote">
<span style="font-family:monospace">solve [</span> <span style="font-style:oblique">expr</span><sub>1</sub> <span style="font-family:monospace">|</span> ... <span style="font-family:monospace">|</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">]</span>
</blockquote><p>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> are evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> and <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> must be tactic values, for 
<span style="font-style:italic">i</span>=1,...,<span style="font-style:italic">n</span>. Supposing <span style="font-style:italic">n</span>&gt;1, it applies <span style="font-style:italic">v</span><sub>1</sub>, if it solves, it stops else it
tries to apply <span style="font-style:italic">v</span><sub>2</sub> and so on. It fails if there is no solving tactic.</p><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">Cannot solve the goal</span><a id="hevea_error132"></a></p><h4 id="sec458" class="subsubsection">Identity<a id="hevea_default737"></a><a id="hevea_tactic186"></a>
<a id="hevea_default738"></a></h4>
<p>The constant <span style="font-family:monospace">idtac</span> is the identity tactic: it leaves any goal
unchanged but it appears in the proof script.</p><p><br>
<span style="font-weight:bold">Variant: </span><span style="font-family:monospace">idtac </span><span style="font-style:oblique">message_token</span><span style="font-family:monospace">  </span><span style="font-family:monospace">…</span><span style="font-family:monospace">  </span><span style="font-style:oblique">message_token</span></p><p>This prints the given tokens. Strings and integers are printed
literally. If a (term) variable is given, its contents are printed.</p><h4 id="sec459" class="subsubsection">Failing<a id="hevea_default739"></a><a id="hevea_tactic187"></a>
<a id="hevea_default740"></a></h4>
<p>The tactic <span style="font-family:monospace">fail</span> is the always-failing tactic: it does not solve
any goal. It is useful for defining other tacticals since it can be
catched by <span style="font-family:monospace">try</span> or <span style="font-family:monospace">match goal</span>. </p><p><br>
<span style="font-weight:bold">Variants: </span></p><ol class="enumerate" type=1><li class="li-enumerate">
<span style="font-family:monospace">fail </span><span style="font-style:italic">n</span><br>
The number <span style="font-style:italic">n</span> is the failure level. If no level is specified, it
defaults to 0. The level is used by <span style="font-family:monospace">try</span> and <span style="font-family:monospace">match goal</span>.
If 0, it makes <span style="font-family:monospace">match goal</span> considering the next clause
(backtracking). If non zero, the current <span style="font-family:monospace">match goal</span> block or
<span style="font-family:monospace">try</span> command is aborted and the level is decremented.</li><li class="li-enumerate"><span style="font-family:monospace">fail </span><span style="font-style:oblique">message_token</span><span style="font-family:monospace">  </span><span style="font-family:monospace">…</span><span style="font-family:monospace">  </span><span style="font-style:oblique">message_token</span><br>
The given tokens are used for printing the failure message.</li><li class="li-enumerate"><span style="font-family:monospace">fail </span><span style="font-style:italic">n</span><span style="font-family:monospace"> </span><span style="font-style:oblique">message_token</span><span style="font-family:monospace">  </span><span style="font-family:monospace">…</span><span style="font-family:monospace">  </span><span style="font-style:oblique">message_token</span><br>
This is a combination of the previous variants.
</li></ol><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">Tactic Failure </span><span style="font-family:monospace"><span style="font-style:italic">message</span></span><span style="font-family:monospace"> (level </span><span style="font-style:italic">n</span><span style="font-family:monospace">)</span><a id="hevea_error133"></a>.</p><h4 id="sec460" class="subsubsection">Timeout<a id="hevea_default741"></a><a id="hevea_tactic188"></a>
<a id="hevea_default742"></a></h4>
<p>We can force a tactic to stop if it has not finished after a certain
amount of time:
</p><blockquote class="quote">
<span style="font-family:monospace">timeout</span> <span style="font-style:oblique">num</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
<span style="font-style:oblique">expr</span> is evaluated to <span style="font-style:italic">v</span>. <span style="font-style:italic">v</span> must be a tactic value. <span style="font-style:italic">v</span> is
normally applied, except that it is interrupted after <span style="font-style:oblique">num</span> seconds
if it is still running. In this case the outcome is a failure.</p><p>Warning: For the moment, <span style="font-family:monospace">timeout</span> is based on elapsed time in
seconds, which is very
machine-dependent: a script that works on a quick machine may fail
on a slow one. The converse is even possible if you combine a
<span style="font-family:monospace">timeout</span> with some other tacticals. This tactical is hence
proposed only for convenience during debug or other development
phases, we strongly advise you to not leave any <span style="font-family:monospace">timeout</span> in
final scripts. Note also that this tactical isn’t available on
the native Windows port of Coq.</p><h4 id="sec461" class="subsubsection">Local definitions<a id="hevea_default743"></a>
<a id="hevea_default744"></a>
<a id="hevea_default745"></a>
<a id="hevea_default746"></a></h4>
<p>Local definitions can be done as follows:
</p><blockquote class="quote">
<span style="font-family:monospace">let</span> <span style="font-style:oblique">ident</span><sub>1</sub> <span style="font-family:monospace">:=</span> <span style="font-style:oblique">expr</span><sub>1</sub><br>
<span style="font-family:monospace">with</span> <span style="font-style:oblique">ident</span><sub>2</sub> <span style="font-family:monospace">:=</span> <span style="font-style:oblique">expr</span><sub>2</sub><br>
...<br>
<span style="font-family:monospace">with</span> <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">:=</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">in</span><br>
<span style="font-style:oblique">expr</span>
</blockquote><p>
each <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> is evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub>, then, <span style="font-style:oblique">expr</span> is
evaluated by substituting <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub> to each occurrence of <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">i</span></sub>,
for <span style="font-style:italic">i</span>=1,...,<span style="font-style:italic">n</span>. There is no dependencies between the <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub>
and the <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">i</span></sub>.</p><p>Local definitions can be recursive by using <span style="font-family:monospace">let rec</span> instead of
<span style="font-family:monospace">let</span>. In this latter case, the definitions are evaluated lazily
so that the <span style="font-family:monospace">rec</span> keyword can be used also in non recursive cases
so as to avoid the eager evaluation of local definitions.</p>
<h4 id="sec462" class="subsubsection">Application</h4>
<p>An application is an expression of the following form:
</p><blockquote class="quote">
<span style="font-style:oblique">qualid</span> <span style="font-style:oblique">tacarg</span><sub>1</sub> ... <span style="font-style:oblique">tacarg</span><sub><span style="font-style:italic">n</span></sub>
</blockquote><p>
The reference <span style="font-style:oblique">qualid</span> must be bound to some defined tactic
definition expecting at least <span style="font-style:italic">n</span> arguments. The expressions
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">i</span></sub> are evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">i</span></sub>, for <span style="font-style:italic">i</span>=1,...,<span style="font-style:italic">n</span>.
</p><h4 id="sec463" class="subsubsection">Function construction<a id="hevea_default747"></a>
<a id="hevea_default748"></a></h4>
<p>A parameterized tactic can be built anonymously (without resorting to
local definitions) with:
</p><blockquote class="quote">
<span style="font-family:monospace">fun</span> <span style="font-style:oblique">ident</span><sub>1</sub> ... <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
Indeed, local definitions of functions are a syntactic sugar for
binding a <span style="font-family:monospace">fun</span> tactic to an identifier.</p><h4 id="sec464" class="subsubsection">Pattern matching on terms<a id="hevea_default749"></a>
<a id="hevea_default750"></a></h4>
<p>We can carry out pattern matching on terms with:
</p><blockquote class="quote">
<span style="font-family:monospace">match</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">with</span><br>
   <span style="font-style:oblique">cpattern</span><sub>1</sub> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub>1</sub><br>
 <span style="font-family:monospace">|</span> <span style="font-style:oblique">cpattern</span><sub>2</sub> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub>2</sub><br>
 ...<br>
 <span style="font-family:monospace">|</span> <span style="font-style:oblique">cpattern</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub><br>
 <span style="font-family:monospace">|</span> <span style="font-family:monospace">_</span> <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span>+1</sub><br>
<span style="font-family:monospace">end</span>
</blockquote><p>
The expression <span style="font-style:oblique">expr</span> is evaluated and should yield a term which
is matched against <span style="font-style:oblique">cpattern</span><sub>1</sub>. The matching is non-linear: if a
metavariable occurs more than once, it should match the same
expression every time. It is first-order except on the
variables of the form <span style="font-family:monospace">@?id</span> that occur in head position of an
application. For these variables, the matching is second-order and
returns a functional term.</p><p>If the matching with <span style="font-style:oblique">cpattern</span><sub>1</sub> succeeds, then <span style="font-style:oblique">expr</span><sub>1</sub> is
evaluated into some value by substituting the pattern matching
instantiations to the metavariables. If <span style="font-style:oblique">expr</span><sub>1</sub> evaluates to a
tactic and the <span style="font-family:monospace">match</span> expression is in position to be applied to
a goal (e.g. it is not bound to a variable by a <span style="font-family:monospace">let in</span>), then
this tactic is applied. If the tactic succeeds, the list of resulting
subgoals is the result of the <span style="font-family:monospace">match</span> expression. If
<span style="font-style:oblique">expr</span><sub>1</sub> does not evaluate to a tactic or if the <span style="font-family:monospace">match</span>
expression is not in position to be applied to a goal, then the result
of the evaluation of <span style="font-style:oblique">expr</span><sub>1</sub> is the result of the <span style="font-family:monospace">match</span>
expression.</p><p>If the matching with <span style="font-style:oblique">cpattern</span><sub>1</sub> fails, or if it succeeds but the
evaluation of <span style="font-style:oblique">expr</span><sub>1</sub> fails, or if the evaluation of
<span style="font-style:oblique">expr</span><sub>1</sub> succeeds but returns a tactic in execution position
whose execution fails, then <span style="font-style:oblique">cpattern</span><sub>2</sub> is used and so on. The
pattern _ matches any term and shunts all remaining patterns if
any. If all clauses fail (in particular, there is no pattern _)
then a no-matching-clause error is raised.</p><p><br>
<span style="font-weight:bold">Error messages: </span></p><ol class="enumerate" type=1><li class="li-enumerate"><span style="font-family:monospace">No matching clauses for match</span><a id="hevea_error134"></a><p>No pattern can be used and, in particular, there is no <span style="font-family:monospace">_</span> pattern.</p></li><li class="li-enumerate"><span style="font-family:monospace">Argument of match does not evaluate to a term</span><a id="hevea_error135"></a><p>This happens when <span style="font-style:oblique">expr</span> does not denote a term.</p></li></ol><p><br>
<span style="font-weight:bold">Variants: </span></p><ol class="enumerate" type=1><li class="li-enumerate"><a id="hevea_default751"></a>
<a id="hevea_default752"></a>
Using <span style="font-family:monospace">lazymatch</span> instead of <span style="font-family:monospace">match</span> has an effect if the
right-hand-side of a clause returns a tactic. With <span style="font-family:monospace">match</span>, the
tactic is applied to the current goal (and the next clause is tried if
it fails). With <span style="font-family:monospace">lazymatch</span>, the tactic is directly returned as
the result of the whole <span style="font-family:monospace">lazymatch</span> block without being first
tried to be applied to the goal. Typically, if the <span style="font-family:monospace">lazymatch</span>
block is bound to some variable <span style="font-style:italic">x</span> in a <span style="font-family:monospace">let in</span>, then tactic
expression gets bound to the variable <span style="font-style:italic">x</span>.</li><li class="li-enumerate"><a id="hevea_default753"></a>
There is a special form of patterns to match a subterm against the
pattern:
<blockquote class="quote">
<span style="font-family:monospace">context</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">]</span>
</blockquote>
It matches any term with a subterm matching <span style="font-style:oblique">cpattern</span>. If there is
a match, the optional <span style="font-style:oblique">ident</span> is assigned the “matched context”, i.e.
the initial term where the matched subterm is replaced by a
hole. The example below will show how to use such term contexts.<p>If the evaluation of the right-hand-side of a valid match fails, the
next matching subterm is tried. If no further subterm matches, the
next clause is tried. Matching subterms are considered top-bottom and
from left to right (with respect to the raw printing obtained by
setting option <span style="font-family:monospace">Printing All</span>, see Section <a href="Reference-Manual004.html#sec130">2.9</a>).</p><div class="flushleft"><span style="font-size:small">
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> Ltac f x :=</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   match x with</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">     context f [S ?X] =</span></span><span style="font-size:small"><span style="font-family:monospace">&gt;</span></span><span style="font-size:small"><span style="font-family:monospace"> </span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">     idtac X;                    (* To display the evaluation order *)</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">     assert (p := eq_refl 1 : X=1);    (* To filter the case X=1 *)</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">     let x:= context f[O] in assert (x=O) (* To observe the context *)</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   end.</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">f is defined</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> Goal True.</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">1 subgoal</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  </span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  ============================</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">   True</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> f (3+4).</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">2</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">1</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">2 subgoals</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  </span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  p : 1 = 1</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  ============================</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">   1 + 4 = 0</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">subgoal 2 is:</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic"> True</span></span></span><span style="font-size:small"><br>
</span></div></li><li class="li-enumerate"><a id="hevea_default754"></a>
For historical reasons, <span style="font-family:monospace">context</span> considers <span style="font-style:italic">n</span>-ary applications
such as <span style="font-family:monospace">(f 1 2)</span> as a whole, and not as a sequence of unary
applications <span style="font-family:monospace">((f 1) 2)</span>. Hence <span style="font-family:monospace">context [f ?x]</span> will fail
to find a matching subterm in <span style="font-family:monospace">(f 1 2)</span>: if the pattern is a partial
application, the matched subterms will be necessarily be
applications with exactly the same number of arguments.
Alternatively, one may now use the following variant of <span style="font-family:monospace">context</span>:
<blockquote class="quote">
<span style="font-family:monospace">appcontext</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">]</span>
</blockquote>
The behavior of <span style="font-family:monospace">appcontext</span> is the same as the one of <span style="font-family:monospace">context</span>, except that a matching subterm could be a partial
part of a longer application. For instance, in <span style="font-family:monospace">(f 1 2)</span>,
an <span style="font-family:monospace">appcontext [f ?x]</span> will find the matching subterm <span style="font-family:monospace">(f 1)</span>. </li></ol><h4 id="sec465" class="subsubsection">Pattern matching on goals<a id="hevea_default755"></a>
<a id="hevea_default756"></a>
<a id="hevea_default757"></a>
<a id="hevea_default758"></a></h4>
<p>We can make pattern matching on goals using the following expression:
</p><blockquote class="quote">
<table style="border:0;border-spacing:0" class="cellpadding0"><tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">match goal with</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >  </td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">|</span> <span style="font-style:italic">hyp</span><sub>1,1</sub><span style="font-family:monospace">,</span>...<span style="font-family:monospace">,</span><span style="font-style:italic">hyp</span><sub>1,<span style="font-style:italic">m</span><sub>1</sub></sub>
  <span style="font-family:monospace">|-</span><span style="font-style:oblique">cpattern</span><sub>1</sub><span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub>1</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">|</span> <span style="font-style:italic">hyp</span><sub>2,1</sub><span style="font-family:monospace">,</span>...<span style="font-family:monospace">,</span><span style="font-style:italic">hyp</span><sub>2,<span style="font-style:italic">m</span><sub>2</sub></sub>
  <span style="font-family:monospace">|-</span><span style="font-style:oblique">cpattern</span><sub>2</sub><span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub>2</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >  ...</td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">|</span> <span style="font-style:italic">hyp</span><sub><span style="font-style:italic">n</span>,1</sub><span style="font-family:monospace">,</span>...<span style="font-family:monospace">,</span><span style="font-style:italic">hyp</span><sub><span style="font-style:italic">n</span>,<span style="font-style:italic">m</span><sub><span style="font-style:italic">n</span></sub></sub>
  <span style="font-family:monospace">|-</span><span style="font-style:oblique">cpattern</span><sub><span style="font-style:italic">n</span></sub><span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > </td><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">|_</span>    <span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span>+1</sub></td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">end</span>
</td></tr>
</table>
</blockquote><p>If each hypothesis pattern <span style="font-style:italic">hyp</span><sub>1,<span style="font-style:italic">i</span></sub>, with <span style="font-style:italic">i</span>=1,...,<span style="font-style:italic">m</span><sub>1</sub>
is matched (non-linear first-order unification) by an hypothesis of
the goal and if <span style="font-style:oblique">cpattern</span><sub>1</sub> is matched by the conclusion of the
goal, then <span style="font-style:oblique">expr</span><sub>1</sub> is evaluated to <span style="font-style:italic">v</span><sub>1</sub> by substituting the
pattern matching to the metavariables and the real hypothesis names
bound to the possible hypothesis names occurring in the hypothesis
patterns. If <span style="font-style:italic">v</span><sub>1</sub> is a tactic value, then it is applied to the
goal. If this application fails, then another combination of
hypotheses is tried with the same proof context pattern. If there is
no other combination of hypotheses then the second proof context
pattern is tried and so on. If the next to last proof context pattern
fails then <span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span>+1</sub> is evaluated to <span style="font-style:italic">v</span><sub><span style="font-style:italic">n</span>+1</sub> and <span style="font-style:italic">v</span><sub><span style="font-style:italic">n</span>+1</sub>
is applied. Note also that matching against subterms (using the <span style="font-family:monospace">context</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">cpattern</span> <span style="font-family:monospace">]</span>) is available and may
itself induce extra backtrackings.</p><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">No matching clauses for match goal</span><a id="hevea_error136"></a></p><p>No clause succeeds, i.e. all matching patterns, if any,
fail at the application of the right-hand-side.</p><p><br>
</p><p>It is important to know that each hypothesis of the goal can be
matched by at most one hypothesis pattern. The order of matching is
the following: hypothesis patterns are examined from the right to the
left (i.e. <span style="font-style:italic">hyp</span><sub><span style="font-style:italic">i</span>,<span style="font-style:italic">m</span><sub><span style="font-style:italic">i</span></sub></sub> before <span style="font-style:italic">hyp</span><sub><span style="font-style:italic">i</span>,1</sub>). For each hypothesis
pattern, the goal hypothesis are matched in order (fresher hypothesis
first), but it possible to reverse this order (older first) with
the <span style="font-family:monospace">match reverse goal with</span> variant.</p><p><br>
<span style="font-weight:bold">Variant: </span><a id="hevea_default759"></a>
<a id="hevea_default760"></a>
<a id="hevea_default761"></a>
<a id="hevea_default762"></a>
Using <span style="font-family:monospace">lazymatch</span> instead of <span style="font-family:monospace">match</span> has an effect if the
right-hand-side of a clause returns a tactic. With <span style="font-family:monospace">match</span>, the
tactic is applied to the current goal (and the next clause is tried if
it fails). With <span style="font-family:monospace">lazymatch</span>, the tactic is directly returned as
the result of the whole <span style="font-family:monospace">lazymatch</span> block without being first
tried to be applied to the goal. Typically, if the <span style="font-family:monospace">lazymatch</span>
block is bound to some variable <span style="font-style:italic">x</span> in a <span style="font-family:monospace">let in</span>, then tactic
expression gets bound to the variable <span style="font-style:italic">x</span>.</p><div class="flushleft"><span style="font-size:small">
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> Ltac test_lazy :=</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   lazymatch goal with</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   | _ =</span></span><span style="font-size:small"><span style="font-family:monospace">&gt;</span></span><span style="font-size:small"><span style="font-family:monospace"> idtac "here"; fail </span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   | _ =</span></span><span style="font-size:small"><span style="font-family:monospace">&gt;</span></span><span style="font-size:small"><span style="font-family:monospace"> idtac "wasn’t lazy"; trivial</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   end.</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">test_lazy is defined</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> Ltac test_eager :=</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   match goal with</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   | _ =</span></span><span style="font-size:small"><span style="font-family:monospace">&gt;</span></span><span style="font-size:small"><span style="font-family:monospace"> idtac "here"; fail </span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   | _ =</span></span><span style="font-size:small"><span style="font-family:monospace">&gt;</span></span><span style="font-size:small"><span style="font-family:monospace"> idtac "wasn’t lazy"; trivial</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace">   end.</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">test_eager is defined</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> Goal True.</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">1 subgoal</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  </span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  ============================</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">   True</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> test_lazy || idtac "was lazy".</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">here</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">was lazy</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">1 subgoal</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  </span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">  ============================</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">   True</span></span></span><span style="font-size:small"><br>
<br>
</span><span style="font-size:small"><span style="font-family:monospace">Coq </span></span><span style="font-size:small"><span style="font-family:monospace">&lt;</span></span><span style="font-size:small"><span style="font-family:monospace"> test_eager || idtac "was lazy".</span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">here</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">wasn’t lazy</span></span></span><span style="font-size:small"><br>
</span><span style="font-size:small"><span style="font-family:monospace"><span style="font-style:italic">No more subgoals.</span></span></span><span style="font-size:small"><br>
</span></div><h4 id="sec466" class="subsubsection">Filling a term context<a id="hevea_default763"></a></h4>
<p>The following expression is not a tactic in the sense that it does not
produce subgoals but generates a term to be used in tactic
expressions:
</p><blockquote class="quote">
<span style="font-family:monospace">context</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">[</span> <span style="font-style:oblique">expr</span> <span style="font-family:monospace">]</span>
</blockquote><p>
<span style="font-style:oblique">ident</span> must denote a context variable bound by a <span style="font-family:monospace">context</span>
pattern of a <span style="font-family:monospace">match</span> expression. This expression evaluates
replaces the hole of the value of <span style="font-style:oblique">ident</span> by the value of
<span style="font-style:oblique">expr</span>.</p><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">not a context variable</span><a id="hevea_error137"></a></p><h4 id="sec467" class="subsubsection">Generating fresh hypothesis names<a id="hevea_default764"></a>
<a id="hevea_default765"></a></h4>
<p>Tactics sometimes have to generate new names for hypothesis. Letting
the system decide a name with the <span style="font-family:monospace">intro</span> tactic is not so good
since it is very awkward to retrieve the name the system gave.
The following expression returns an identifier:
</p><blockquote class="quote">
<span style="font-family:monospace">fresh</span> <span style="font-style:oblique">component</span>  …  <span style="font-style:oblique">component</span>
</blockquote><p>
It evaluates to an identifier unbound in the goal. This fresh
identifier is obtained by concatenating the value of the
<span style="font-style:oblique">component</span>’s (each of them is, either an <span style="font-style:oblique">ident</span> which
has to refer to a name, or directly a name denoted by a
<span style="font-style:oblique">string</span>). If the resulting name is already used, it is padded
with a number so that it becomes fresh. If no component is
given, the name is a fresh derivative of the name <span style="font-family:monospace">H</span>.</p><h4 id="sec468" class="subsubsection">Computing in a constr<a id="hevea_default766"></a>
<a id="hevea_default767"></a></h4>
<p>Evaluation of a term can be performed with:
</p><blockquote class="quote">
<span style="font-family:monospace">eval</span> <span style="font-style:oblique">redexpr</span> <span style="font-family:monospace">in</span> <span style="font-style:oblique">term</span>
</blockquote><p>
where <span style="font-style:oblique">redexpr</span> is a reduction tactic among <span style="font-family:monospace">red</span>, <span style="font-family:monospace">hnf</span>, <span style="font-family:monospace">compute</span>, <span style="font-family:monospace">simpl</span>, <span style="font-family:monospace">cbv</span>, <span style="font-family:monospace">lazy</span>, <span style="font-family:monospace">unfold</span>,
<span style="font-family:monospace">fold</span>, <span style="font-family:monospace">pattern</span>.</p>
<h4 id="sec469" class="subsubsection">Type-checking a term</h4>
<p>
<a id="hevea_default768"></a>
<a id="hevea_default769"></a></p><p>The following returns the type of <span style="font-style:oblique">term</span>:</p><blockquote class="quote">
<span style="font-family:monospace">type of</span> <span style="font-style:oblique">term</span>
</blockquote><h4 id="sec470" class="subsubsection">Proving a subgoal as a separate lemma<a id="hevea_default770"></a><a id="hevea_tactic189"></a>
<a id="hevea_default771"></a></h4>
<p>From the outside “<span style="font-family:monospace">abstract </span><span style="font-style:oblique">expr</span>” is the same as
<span style="font-family:monospace">solve </span><span style="font-style:oblique">expr</span>. Internally it saves an auxiliary lemma called 
<span style="font-style:oblique">ident</span><span style="font-family:monospace">_subproof</span><span style="font-style:italic">n</span> where <span style="font-style:oblique">ident</span> is the name of the
current goal and <span style="font-style:italic">n</span> is chosen so that this is a fresh name.</p><p>This tactical is useful with tactics such as <span style="font-family:monospace">omega</span> or
<span style="font-family:monospace">discriminate</span> that generate huge proof terms. With that tool
the user can avoid the explosion at time of the <span style="font-family:monospace">Save</span> command
without having to cut manually the proof in smaller lemmas.</p><p><br>
<span style="font-weight:bold">Variants: </span></p><ol class="enumerate" type=1><li class="li-enumerate">
<span style="font-family:monospace">abstract </span><span style="font-style:oblique">expr</span><span style="font-family:monospace"> using </span><span style="font-style:oblique">ident</span>.<br>
 Give explicitly the name of the auxiliary lemma.
</li></ol><p><br>
<span style="font-weight:bold">Error message: </span><span style="font-family:monospace">Proof is not complete</span><a id="hevea_error138"></a></p><h4 id="sec471" class="subsubsection">Calling an external tactic<a id="hevea_default772"></a></h4>
<p>The tactic <span style="font-family:monospace">external</span> allows to run an executable outside the
<span style="font-variant:small-caps">Coq</span> executable. The communication is done via an XML encoding of
constructions. The syntax of the command is</p><blockquote class="quote">
<span style="font-family:monospace">external</span> "<span style="font-style:oblique">command</span>" "<span style="font-style:oblique">request</span>" <span style="font-style:oblique">tacarg</span>  …  <span style="font-style:oblique">tacarg</span>
</blockquote><p>The string <span style="font-style:oblique">command</span>, to be interpreted in the default
execution path of the operating system, is the name of the external
command. The string <span style="font-style:oblique">request</span> is the name of a request to be
sent to the external command. Finally the list of tactic arguments
have to evaluate to terms. An XML tree of the following form is sent
to the standard input of the external command.
<br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;REQUEST req="</span><span style="font-style:oblique">request</span><span style="font-family:monospace">"&gt;</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >the XML tree of the first argument</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >…</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >the XML tree of the last argument</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;/REQUEST&gt;</span></td></tr>
</table><p>
<br>
</p><p>Conversely, the external command must send on its standard output an
XML tree of the following forms:</p><p><br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;TERM&gt;</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >the XML tree of a term</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;/TERM&gt;</span></td></tr>
</table><p>
<br>
</p><p>or </p><p><br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;CALL uri="</span><span style="font-style:oblique">ltac_qualified_ident</span><span style="font-family:monospace">"&gt;</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >the XML tree of a first argument</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >…</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >the XML tree of a last argument</td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-family:monospace">&lt;/CALL&gt;</span></td></tr>
</table><p><br>
where <span style="font-style:oblique">ltac_qualified_ident</span> is the name of a
defined <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> function and each subsequent XML tree is recursively a
<span style="font-family:monospace">CALL</span> or a <span style="font-family:monospace">TERM</span> node.</p><p>The Document Type Definition (DTD) for terms of the Calculus of
Inductive Constructions is the one developed as part of the MoWGLI
European project. It can be found in the file <span style="font-family:monospace">dev/doc/cic.dtd</span> of
the <span style="font-variant:small-caps">Coq</span> source archive.</p><p>An example of parser for this DTD, written in the Objective Caml -
Camlp4 language, can be found in the file <span style="font-family:monospace">parsing/g_xml.ml4</span> of
the <span style="font-variant:small-caps">Coq</span> source archive.</p><h2 id="sec472" class="section">9.3  Tactic toplevel definitions<a id="hevea_default773"></a><a id="hevea_command251"></a></h2>
<h3 id="sec473" class="subsection">9.3.1  Defining <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> functions</h3>
<p>Basically, <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> toplevel definitions are made as follows:
</p><blockquote class="quote">
<span style="font-family:monospace">Ltac</span> <span style="font-style:oblique">ident</span> <span style="font-style:oblique">ident</span><sub>1</sub> ... <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">:=</span>
<span style="font-style:oblique">expr</span>
</blockquote><p>
This defines a new <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> function that can be used in any tactic
script or new <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> toplevel definition.</p><p><br>
<span style="font-weight:bold">Remark: </span>The preceding definition can equivalently be written:
</p><blockquote class="quote">
<span style="font-family:monospace">Ltac</span> <span style="font-style:oblique">ident</span> <span style="font-family:monospace">:= fun</span> <span style="font-style:oblique">ident</span><sub>1</sub> ... <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub>
<span style="font-family:monospace">=&gt;</span> <span style="font-style:oblique">expr</span>
</blockquote><p>
Recursive and mutual recursive function definitions are also
possible with the syntax:
</p><blockquote class="quote">
<span style="font-family:monospace">Ltac</span> <span style="font-style:oblique">ident</span><sub>1</sub> <span style="font-style:oblique">ident</span><sub>1,1</sub> ...
<span style="font-style:oblique">ident</span><sub>1,<span style="font-style:italic">m</span><sub>1</sub></sub>  <span style="font-family:monospace">:=</span> <span style="font-style:oblique">expr</span><sub>1</sub><br>
<span style="font-family:monospace">with</span> <span style="font-style:oblique">ident</span><sub>2</sub> <span style="font-style:oblique">ident</span><sub>2,1</sub> ... <span style="font-style:oblique">ident</span><sub>2,<span style="font-style:italic">m</span><sub>2</sub></sub>  <span style="font-family:monospace">:=</span>
<span style="font-style:oblique">expr</span><sub>2</sub><br>
...<br>
<span style="font-family:monospace">with</span> <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub> <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span>,1</sub> ... <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span>,<span style="font-style:italic">m</span><sub><span style="font-style:italic">n</span></sub></sub>  <span style="font-family:monospace">:=</span>
<span style="font-style:oblique">expr</span><sub><span style="font-style:italic">n</span></sub>
</blockquote><p>
<br>
It is also possible to <em>redefine</em> an existing user-defined tactic
using the syntax:
</p><blockquote class="quote">
<span style="font-family:monospace">Ltac</span> <span style="font-style:oblique">qualid</span> <span style="font-style:oblique">ident</span><sub>1</sub> ... <span style="font-style:oblique">ident</span><sub><span style="font-style:italic">n</span></sub> <span style="font-family:monospace">::=</span>
<span style="font-style:oblique">expr</span>
</blockquote><p>
A previous definition of <span style="font-style:oblique">qualid</span>must exist in the environment.
The new definition will always be used instead of the old one and
it goes accross module boundaries.</p><p>If preceded by the keyword <span style="font-family:monospace">Local</span> the tactic definition will not
be exported outside the current module.</p><h3 id="sec474" class="subsection">9.3.2  Printing <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> tactics<a id="hevea_default774"></a><a id="hevea_command252"></a></h3>
<p>Defined <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> functions can be displayed using the command</p><blockquote class="quote">
<span style="font-family:monospace">Print Ltac </span><span style="font-style:oblique">qualid</span><span style="font-family:monospace">.</span>
</blockquote><h2 id="sec475" class="section">9.4  Debugging <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> tactics<a id="hevea_default775"></a><a id="hevea_command253"></a>
<a id="hevea_default776"></a><a id="hevea_command254"></a>
<a id="hevea_default777"></a><a id="hevea_command255"></a></h2>
<p>The <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> interpreter comes with a step-by-step debugger. The
debugger can be activated using the command</p><blockquote class="quote">
<span style="font-family:monospace">Set Ltac Debug.</span>
</blockquote><p>and deactivated using the command</p><blockquote class="quote">
<span style="font-family:monospace">Unset Ltac Debug.</span>
</blockquote><p>To know if the debugger is on, use the command <span style="font-family:monospace">Test Ltac Debug</span>.
When the debugger is activated, it stops at every step of the
evaluation of the current <span style="color:red"> </span><span style="color:red"><span style="font-style:italic">L</span></span><sub><span style="font-style:italic">tac</span></sub> expression and it prints information
on what it is doing. The debugger stops, prompting for a command which
can be one of the following:</p><p><br>
</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" >simple newline:</td><td style="text-align:left;white-space:nowrap" >go to the next step</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >h:</td><td style="text-align:left;white-space:nowrap" >get help</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >x:</td><td style="text-align:left;white-space:nowrap" >exit current evaluation</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >s:</td><td style="text-align:left;white-space:nowrap" >continue current evaluation without stopping</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >r <span style="font-style:italic">n</span>:</td><td style="text-align:left;white-space:nowrap" >advance <span style="font-style:italic">n</span> steps further</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >r <span style="font-style:oblique">string</span>:</td><td style="text-align:left;white-space:nowrap" >advance up to the next call to “<span style="font-family:monospace">idtac</span> <span style="font-style:oblique">string</span>”</td></tr>
</table>
<div id="sidebarWrapper">
  <div id="sidebar">
    <div class="block">
      <h2 class="title">Navigation</h2>
      <div class="content">
        <ul class="menu">
          <li class="leaf"><a href="index.html">Cover</a></li>
          <li class="leaf"><a href="toc.html">Table of contents</a></li>
          <li class="leaf">Index
            <ul class="menu">
              <li><a href="general-index.html">General</a></li>
              <li><a href="command-index.html">Commands</a></li>
              <li><a href="tactic-index.html">Tactics</a></li>
              <li><a href="error-index.html">Errors</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

</div>

<div id="footer">
<div id="nav-footer">
  <ul class="links-menu-footer">
    <li><a href="mailto:coq-www_@_inria.fr">webmaster</a></li>
    <li><a href="http://validator.w3.org/">xhtml valid</a></li>
    <li><a href="http://jigsaw.w3.org/css-validator/">CSS valid</a></li>
  </ul>

</div>
</div>

</div>
</body>
</html>
