<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/node/node.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/defaults.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/system.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/user/user.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/style.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/coqdoc.css" />

<title>Standard Library | The Coq Proof Assistant</title>

</head>

<body>

<div id="container">
  <div id="headertop">
    <div id="nav">
      <ul class="links-menu">
        <li><a href="//coq.inria.fr/" class="active">Home</a></li>
        <li><a href="//coq.inria.fr/about-coq" title="More about coq">About Coq</a></li>
        <li><a href="//coq.inria.fr/download">Get Coq</a></li>
        <li><a href="//coq.inria.fr/documentation">Documentation</a></li>
        <li><a href="//coq.inria.fr/community">Community</a></li>
      </ul>
    </div>
  </div>

  <div id="header">
    <div id="logoWrapper">
      <div id="logo"><a href="//coq.inria.fr/" title="Home"><img src="//coq.inria.fr/files/barron_logo.png" alt="Home" /></a>
      </div>
      <div id="siteName"><a href="//coq.inria.fr/" title="Home">The Coq Proof Assistant</a>
      </div>
    </div>
  </div>

  <div id="content">

<h1 class="libtitle">Library Coq.FSets.FMapFacts</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab889"></a><h1 class="section">Finite maps library</h1>

<div class="paragraph"> </div>

 This functor derives additional facts from <span class="inlinecode"><span class="id" title="var">FMapInterface.S</span></span>. These
  facts are mainly the specifications of <span class="inlinecode"><span class="id" title="var">FMapInterface.S</span></span> written using
  different styles: equivalence and boolean equalities.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span> <span class="id" title="var">DecidableType</span> <span class="id" title="var">DecidableTypeEx</span> <span class="id" title="var">OrderedType</span> <span class="id" title="var">Morphisms</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">FMapInterface</span>.<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">Equivalence</span> <span class="id" title="var">_</span>) =&gt; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">congruence</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab890"></a><h1 class="section">Facts about weak maps</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">WFacts_fun</span> (<span class="id" title="var">E</span>:<span class="id" title="var">DecidableType</span>)(<span class="id" title="keyword">Import</span> <span class="id" title="var">M</span>:<span class="id" title="var">WSfun</span> <span class="id" title="var">E</span>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">eq_dec</span> := <span class="id" title="var">E.eq_dec</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> := <span class="id" title="keyword">if</span> <span class="id" title="var">eq_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_bool_alt</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span>, <span class="id" title="var">b</span>=<span class="id" title="var">b'</span> &lt;-&gt; (<span class="id" title="var">b</span>=<span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">b'</span>=<span class="id" title="var">true</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_option_alt</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">o</span> <span class="id" title="var">o'</span>:<span class="id" title="var">option</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;<span class="id" title="var">o</span>=<span class="id" title="var">o'</span> &lt;-&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span>, <span class="id" title="var">o</span>=<span class="id" title="var">Some</span> <span class="id" title="var">e</span> &lt;-&gt; <span class="id" title="var">o'</span>=<span class="id" title="var">Some</span> <span class="id" title="var">e</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MapsTo_fun</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>) <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">e</span> <span class="id" title="var">e'</span>:<span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">e</span>=<span class="id" title="var">e'</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab891"></a><h2 class="section">Specifications written using equivalences</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">IffSpec</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span>: <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>: <span class="id" title="var">key</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">e</span>: <span class="id" title="var">elt</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MapsTo_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_mem_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">false</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_dec</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, { <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> } + { ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> }.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_find_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_find_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">cmp</span>, <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>) &lt;-&gt; <span class="id" title="var">False</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>) &lt;-&gt; <span class="id" title="var">False</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_empty_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> /\ <span class="id" title="var">e</span>=<span class="id" title="var">e'</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_neq_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>)  &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_neq_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>)  &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) &lt;-&gt; ~<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) &lt;-&gt; ~<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> /\ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_neq_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)  &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_neq_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; (<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)  &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">InA</span> (@<span class="id" title="var">eq_key_elt</span> <span class="id" title="var">_</span>) (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>, <span class="id" title="var">InA</span> (@<span class="id" title="var">eq_key_elt</span> <span class="id" title="var">_</span>) (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">a</span>, <span class="id" title="var">b</span> = <span class="id" title="var">f</span> <span class="id" title="var">a</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
Unfortunately, we don't have simple equivalences for <span class="inlinecode"><span class="id" title="var">mapi</span></span>
  and <span class="inlinecode"><span class="id" title="var">MapsTo</span></span>. The only correct one needs compatibility of <span class="inlinecode"><span class="id" title="var">f</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_inv</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> /\ <span class="id" title="var">b</span> = <span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_1bis</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> = <span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>) (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> = <span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>) -&gt;<br/>
&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">a</span>, <span class="id" title="var">b</span> = <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">m</span>).<br/>

<br/>
</div>

<div class="doc">
Things are even worse for <span class="inlinecode"><span class="id" title="var">map2</span></span> : we don't try to state any
 equivalence, see instead boolean results below. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">IffSpec</span>.<br/>

<br/>
</div>

<div class="doc">
Useful tactic for simplifying expressions like <span class="inlinecode"><span class="id" title="var">In</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">(<span class="id" title="var">add</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode">(<span class="id" title="var">remove</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode"><span class="id" title="var">m</span>))</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">map_iff</span> :=<br/>
&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">progress</span> (<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">add_mapsto_iff</span> || <span class="id" title="tactic">rewrite</span> <span class="id" title="var">add_in_iff</span> ||<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">remove_mapsto_iff</span> || <span class="id" title="tactic">rewrite</span> <span class="id" title="var">remove_in_iff</span> ||<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">empty_mapsto_iff</span> || <span class="id" title="tactic">rewrite</span> <span class="id" title="var">empty_in_iff</span> ||<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_mapsto_iff</span> || <span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_in_iff</span> ||<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mapi_in_iff</span>)).<br/>

<br/>
</div>

<div class="doc">
<a id="lab892"></a><h2 class="section">Specifications written using boolean predicates</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">BoolSpec</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_find_b</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>), <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="keyword">if</span> <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span>.<br/>

<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">key</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">e</span> : <span class="id" title="var">elt</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">mem</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>) = <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_a</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">mem</span> <span class="id" title="var">x</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>) = <span class="id" title="var">false</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_eq_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">e</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_neq_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">add_neq_o</span> : <span class="id" title="var">map</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="keyword">if</span> <span class="id" title="var">eq_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">e</span> <span class="id" title="keyword">else</span> <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_eq_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_neq_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;~<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="var">mem</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) = <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> || <span class="id" title="var">mem</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_eq_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">remove_eq_o</span> : <span class="id" title="var">map</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_neq_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">remove_neq_o</span> : <span class="id" title="var">map</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="keyword">if</span> <span class="id" title="var">eq_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">None</span> <span class="id" title="keyword">else</span> <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_eq_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="var">false</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_neq_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="var">mem</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">mem</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) = <span class="id" title="var">negb</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) &amp;&amp; <span class="id" title="var">mem</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span>:<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) = <span class="id" title="var">Datatypes.option_map</span> <span class="id" title="var">f</span> (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span>:<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">mem</span> <span class="id" title="var">x</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) = <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;<span class="id" title="var">mem</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) = <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> = <span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) = <span class="id" title="var">Datatypes.option_map</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_1bis</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">m'</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt'</span>) <span class="id" title="var">x</span><br/>
&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">option</span> <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt'</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt''</span>),<br/>
&nbsp;<span class="id" title="var">f</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) = <span class="id" title="var">f</span> (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_o</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>,<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">findA</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>,<br/>
&nbsp;<span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">existsb</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>)) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">BoolSpec</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Equalities</span>.<br/>

<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
Another characterisation of <span class="inlinecode"><span class="id" title="var">Equal</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>,<br/>
&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> &lt;-&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m2</span>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab893"></a><h1 class="section">Relations between <span class="inlinecode"><span class="id" title="var">Equal</span></span>, <span class="inlinecode"><span class="id" title="var">Equiv</span></span> and <span class="inlinecode"><span class="id" title="var">Equivb</span></span>.</h1>

<div class="paragraph"> </div>

 First, <span class="inlinecode"><span class="id" title="var">Equal</span></span> is <span class="inlinecode"><span class="id" title="var">Equiv</span></span> with Leibniz on elements. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_Equiv</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">Equiv</span> <span class="id" title="var">Logic.eq</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">Equivb</span></span> and <span class="inlinecode"><span class="id" title="var">Equiv</span></span> and equivalent when <span class="inlinecode"><span class="id" title="var">eq_elt</span></span> and <span class="inlinecode"><span class="id" title="var">cmp</span></span>
    are related. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Cmp</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">eq_elt</span> : <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">cmp</span> : <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">bool</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">compat_cmp</span> :=<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">cmp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> = <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">eq_elt</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equiv_Equivb</span> : <span class="id" title="var">compat_cmp</span> -&gt;<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">Equiv</span> <span class="id" title="var">eq_elt</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Cmp</span>.<br/>

<br/>
</div>

<div class="doc">
Composition of the two last results: relation between <span class="inlinecode"><span class="id" title="var">Equal</span></span>
    and <span class="inlinecode"><span class="id" title="var">Equivb</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_Equivb</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">cmp</span>,<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">cmp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> = <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">e</span> = <span class="id" title="var">e'</span>) -&gt;<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>), <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_Equivb_eqdec</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">eq_elt_dec</span> : (<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, { <span class="id" title="var">e</span> = <span class="id" title="var">e'</span> } + { <span class="id" title="var">e</span> &lt;&gt; <span class="id" title="var">e'</span> }),<br/>
&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cmp</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">eq_elt_dec</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>), <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Equalities</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab894"></a><h1 class="section"><span class="inlinecode"><span class="id" title="var">Equal</span></span> is a setoid equality.</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_refl</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>), <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_sym</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">Equal</span> <span class="id" title="var">m'</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_trans</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">Equal</span> <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> -&gt; <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m''</span>.<br/>
 
<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Equal_ST</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>, <span class="id" title="var">Equivalence</span> (@<span class="id" title="var">Equal</span> <span class="id" title="var">elt</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Relation</span> <span class="id" title="var">key</span> <span class="id" title="var">E.eq</span><br/>
&nbsp;<span class="id" title="tactic">reflexivity</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> <span class="id" title="var">E.eq_refl</span><br/>
&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> <span class="id" title="var">E.eq_sym</span><br/>
&nbsp;<span class="id" title="tactic">transitivity</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> <span class="id" title="var">E.eq_trans</span><br/>
&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">KeySetoid</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Relation</span> (<span class="id" title="var">elt</span> : <span class="id" title="keyword">Type</span>) : (<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">Equal</span><br/>
&nbsp;<span class="id" title="tactic">reflexivity</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> (@<span class="id" title="var">Equal_refl</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> (@<span class="id" title="var">Equal_sym</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="tactic">transitivity</span> <span class="id" title="var">proved</span> <span class="id" title="tactic">by</span> (@<span class="id" title="var">Equal_trans</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">EqualSetoid</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">In</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">In_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">MapsTo</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">MapsTo_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">Empty</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Empty_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">is_empty</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">eq</span> <span class="id" title="keyword">as</span> <span class="id" title="var">is_empty_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">mem</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">eq</span> <span class="id" title="keyword">as</span> <span class="id" title="var">mem_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">find</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">eq</span> <span class="id" title="keyword">as</span> <span class="id" title="var">find_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">add</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">add_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">remove</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">E.eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">remove_m</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : (@<span class="id" title="var">map</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span>)<br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">map_m</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">not_find_mapsto_iff</span> := <span class="id" title="var">not_find_in_iff</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">WFacts_fun</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab895"></a><h1 class="section">Same facts for self-contained weak sets and for full maps</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">WFacts</span> (<span class="id" title="var">M</span>:<span class="id" title="var">WS</span>) := <span class="id" title="var">WFacts_fun</span> <span class="id" title="var">M.E</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Facts</span> := <span class="id" title="var">WFacts</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab896"></a><h1 class="section">Additional Properties for weak maps</h1>


<div class="paragraph"> </div>

    Results about <span class="inlinecode"><span class="id" title="tactic">fold</span></span>, <span class="inlinecode"><span class="id" title="var">elements</span></span>, induction principles...

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">WProperties_fun</span> (<span class="id" title="var">E</span>:<span class="id" title="var">DecidableType</span>)(<span class="id" title="var">M</span>:<span class="id" title="var">WSfun</span> <span class="id" title="var">E</span>).<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">F</span>:=<span class="id" title="var">WFacts_fun</span> <span class="id" title="var">E</span> <span class="id" title="var">M</span>.<br/>
&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">M</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Elt</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> (<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>) <span class="id" title="var">m</span> <span class="id" title="var">m'</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span> = <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqke</span> := (@<span class="id" title="var">eq_key_elt</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqk</span> := (@<span class="id" title="var">eq_key</span> <span class="id" title="var">elt</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">eqk_equiv</span> : <span class="id" title="var">Equivalence</span> <span class="id" title="var">eqk</span>.<br/>
 
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">eqke_equiv</span> : <span class="id" title="var">Equivalence</span> <span class="id" title="var">eqke</span>.<br/>

<br/>
</div>

<div class="doc">
Complements about InA, NoDupA and findA 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">InA_eqke_eqk</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">k1</span> <span class="id" title="var">k2</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E.eq</span> <span class="id" title="var">k1</span> <span class="id" title="var">k2</span> -&gt; <span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">k1</span>,<span class="id" title="var">e1</span>) <span class="id" title="var">l</span> -&gt; <span class="id" title="var">InA</span> <span class="id" title="var">eqk</span> (<span class="id" title="var">k2</span>,<span class="id" title="var">e2</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">NoDupA_eqk_eqke</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">NoDupA</span> <span class="id" title="var">eqke</span> <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">findA_rev</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">k</span>, <span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">findA</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">k</span>) <span class="id" title="var">l</span> = <span class="id" title="var">findA</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">k</span>) (<span class="id" title="var">rev</span> <span class="id" title="var">l</span>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab897"></a><h1 class="section">Elements</h1>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_Empty</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">elements</span> <span class="id" title="var">m</span> = <span class="id" title="var">nil</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_empty</span> : <span class="id" title="var">elements</span> (@<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>) = <span class="id" title="var">nil</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab898"></a><h1 class="section">Conversions between maps and association lists.</h1>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">uncurry</span> {<span class="id" title="var">U</span> <span class="id" title="var">V</span> <span class="id" title="var">W</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">U</span> -&gt; <span class="id" title="var">V</span> -&gt; <span class="id" title="var">W</span>) : <span class="id" title="var">U</span>*<span class="id" title="var">V</span> -&gt; <span class="id" title="var">W</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">of_list</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">List.fold_right</span> (<span class="id" title="var">uncurry</span> (@<span class="id" title="var">add</span> <span class="id" title="var">_</span>)) (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">to_list</span> := <span class="id" title="var">elements</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">of_list_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">of_list</span> <span class="id" title="var">l</span>) &lt;-&gt; <span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">k</span>,<span class="id" title="var">e</span>) <span class="id" title="var">l</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">of_list_1b</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">k</span> (<span class="id" title="var">of_list</span> <span class="id" title="var">l</span>) = <span class="id" title="var">findA</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">k</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">of_list_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">equivlistA</span> <span class="id" title="var">eqke</span> <span class="id" title="var">l</span> (<span class="id" title="var">to_list</span> (<span class="id" title="var">of_list</span> <span class="id" title="var">l</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">of_list_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s</span>, <span class="id" title="var">Equal</span> (<span class="id" title="var">of_list</span> (<span class="id" title="var">to_list</span> <span class="id" title="var">s</span>)) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab899"></a><h1 class="section">Fold</h1>

<div class="paragraph"> </div>

 Alternative specification via <span class="inlinecode"><span class="id" title="var">fold_right</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_spec_right</span> <span class="id" title="var">m</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span> = <span class="id" title="var">List.fold_right</span> (<span class="id" title="var">uncurry</span> <span class="id" title="var">f</span>) <span class="id" title="var">i</span> (<span class="id" title="var">rev</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>)).<br/>

<br/>
</div>

<div class="doc">
<a id="lab900"></a><h2 class="section">Induction principles about fold contributed by S. Lescuyer</h2>

<div class="paragraph"> </div>

 In the following lemma, the step hypothesis is deliberately restricted
      to the precise map m we are considering. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_rec</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span> <span class="id" title="var">m'</span> <span class="id" title="var">m''</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m''</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">m</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>).<br/>

<br/>
</div>

<div class="doc">
Same, with <span class="inlinecode"><span class="id" title="var">empty</span></span> and <span class="inlinecode"><span class="id" title="var">add</span></span> instead of <span class="inlinecode"><span class="id" title="var">Empty</span></span> and <span class="inlinecode"><span class="id" title="keyword">Add</span></span>. In this
      case, <span class="inlinecode"><span class="id" title="var">P</span></span> must be compatible with equality of sets 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">fold_rec_bis</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span>, <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">empty</span> <span class="id" title="var">_</span>) <span class="id" title="var">i</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span> <span class="id" title="var">m'</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> (<span class="id" title="var">add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m'</span>) (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">m</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_rec_nodep</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">i</span> -&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">fold_rec_weak</span></span> is a weaker principle than <span class="inlinecode"><span class="id" title="var">fold_rec_bis</span></span> :
      the step hypothesis must here be applicable anywhere.
      At the same time, it looks more like an induction principle,
      and hence can be easier to use. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_rec_weak</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span>, <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span> <span class="id" title="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">empty</span> <span class="id" title="var">_</span>) <span class="id" title="var">i</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span> <span class="id" title="var">m</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">P</span> (<span class="id" title="var">add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_rel</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">R</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>)(<span class="id" title="var">g</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B</span>)(<span class="id" title="var">i</span> : <span class="id" title="var">A</span>)(<span class="id" title="var">j</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">R</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> -&gt; <span class="id" title="var">R</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>) (<span class="id" title="var">g</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span> <span class="id" title="var">j</span>).<br/>

<br/>
</div>

<div class="doc">
From the induction principle on <span class="inlinecode"><span class="id" title="tactic">fold</span></span>, we can deduce some general
      induction principles on maps. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_induction</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_induction_bis</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">empty</span> <span class="id" title="var">_</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="tactic">fold</span></span> can be used to reconstruct the same initial set. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_identity</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>, <span class="id" title="var">Equal</span> (<span class="id" title="tactic">fold</span> (@<span class="id" title="var">add</span> <span class="id" title="var">_</span>) <span class="id" title="var">m</span> (<span class="id" title="var">empty</span> <span class="id" title="var">_</span>)) <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Fold_More</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab901"></a><h2 class="section">Additional properties of fold</h2>

<div class="paragraph"> </div>

 When a function <span class="inlinecode"><span class="id" title="var">f</span></span> is compatible and allows transpositions, we can
      compute <span class="inlinecode"><span class="id" title="tactic">fold</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> in any order. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">eqA</span>:<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="keyword">Prop</span>)(<span class="id" title="var">st</span>:<span class="id" title="var">Equivalence</span> <span class="id" title="var">eqA</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>).<br/>

<br/>
</div>

<div class="doc">
This is more convenient than a <span class="inlinecode"><span class="id" title="var">compat_op</span></span> <span class="inlinecode"><span class="id" title="var">eqke</span></span> <span class="inlinecode">...</span>.
      In fact, every <span class="inlinecode"><span class="id" title="var">compat_op</span></span>, <span class="inlinecode"><span class="id" title="var">compat_bool</span></span>, etc, should
      become a <span class="inlinecode"><span class="id" title="var">Proper</span></span> someday. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">Comp</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eqA</span>==&gt;<span class="id" title="var">eqA</span>) <span class="id" title="var">f</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_init</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>, <span class="id" title="var">eqA</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> -&gt; <span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Empty</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>) <span class="id" title="var">i</span>.<br/>

<br/>
</div>

<div class="doc">
As noticed by P. Casteran, asking for the general <span class="inlinecode"><span class="id" title="var">SetoidList.transpose</span></span>
      here is too restrictive. Think for instance of <span class="inlinecode"><span class="id" title="var">f</span></span> being <span class="inlinecode"><span class="id" title="var">M.add</span></span> :
      in general, <span class="inlinecode"><span class="id" title="var">M.add</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode">(<span class="id" title="var">M.add</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">e'</span></span> <span class="inlinecode"><span class="id" title="var">m</span>)</span> is not equivalent to
      <span class="inlinecode"><span class="id" title="var">M.add</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">e'</span></span> <span class="inlinecode">(<span class="id" title="var">M.add</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">m</span>)</span>. Fortunately, we will never encounter this
      situation during a real <span class="inlinecode"><span class="id" title="tactic">fold</span></span>, since the keys received by this <span class="inlinecode"><span class="id" title="tactic">fold</span></span>
      are unique. Hence we can ask the transposition property to hold only
      for non-equal keys.

<div class="paragraph"> </div>

      This idea could be push slightly further, by asking the transposition
      property to hold only for (non-equal) keys living in the map given to
      <span class="inlinecode"><span class="id" title="tactic">fold</span></span>. Please contact us if you need such a version.

<div class="paragraph"> </div>

      FSets could also benefit from a restricted <span class="inlinecode"><span class="id" title="var">transpose</span></span>, but for this
      case the gain is unclear. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">transpose_neqkey</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">a</span>, ~<span class="id" title="var">E.eq</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">f</span> <span class="id" title="var">k'</span> <span class="id" title="var">e'</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">f</span> <span class="id" title="var">k'</span> <span class="id" title="var">e'</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">Tra</span> : <span class="id" title="var">transpose_neqkey</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_commutes</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">i</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">i</span>)) (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">NoDupA_eqk_eqke</span> <span class="id" title="var">NoDupA_rev</span> <span class="id" title="var">elements_3w</span> : <span class="id" title="var">map</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Equal</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>, <span class="id" title="var">Equal</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Equal2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>, <span class="id" title="var">Equal</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">eqA</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">j</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Add</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">i</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>) (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_add</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">i</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> (<span class="id" title="var">add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) <span class="id" title="var">i</span>) (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Fold_More</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab902"></a><h1 class="section">Cardinal</h1>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_fold</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="tactic">fold</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">S</span>) <span class="id" title="var">m</span> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_Empty</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Empty</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equal_cardinal</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="var">cardinal</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">cardinal</span> <span class="id" title="var">m'</span> = <span class="id" title="var">S</span> (<span class="id" title="var">cardinal</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_inv_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = 0 -&gt; <span class="id" title="var">Empty</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">cardinal_inv_1</span> : <span class="id" title="var">map</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_inv_2</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span>, <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="var">S</span> <span class="id" title="var">n</span> -&gt; { <span class="id" title="var">p</span> : <span class="id" title="var">key</span>*<span class="id" title="var">elt</span> | <span class="id" title="var">MapsTo</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>) <span class="id" title="var">m</span> }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_inv_2b</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> &lt;&gt; 0 -&gt; { <span class="id" title="var">p</span> : <span class="id" title="var">key</span>*<span class="id" title="var">elt</span> | <span class="id" title="var">MapsTo</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>) <span class="id" title="var">m</span> }.<br/>

<br/>
</div>

<div class="doc">
<a id="lab903"></a><h1 class="section">Additional notions over maps</h1>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Disjoint</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span>, ~(<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Partition</span> (<span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Disjoint</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> \/ <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m2</span>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab904"></a><h1 class="section">Emulation of some functions lacking in the interface</h1>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">filter</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="keyword">then</span> <span class="id" title="var">add</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="keyword">else</span> <span class="id" title="var">m</span>) <span class="id" title="var">m</span> (<span class="id" title="var">empty</span> <span class="id" title="var">_</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">for_all</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="keyword">then</span> <span class="id" title="var">b</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span>) <span class="id" title="var">m</span> <span class="id" title="var">true</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">exists_</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">b</span>) <span class="id" title="var">m</span> <span class="id" title="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">partition</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">filter</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>, <span class="id" title="var">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">negb</span> (<span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>)) <span class="id" title="var">m</span>).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">update</span></span> adds to <span class="inlinecode"><span class="id" title="var">m1</span></span> all the bindings of <span class="inlinecode"><span class="id" title="var">m2</span></span>. It can be seen as
     an <span class="inlinecode"><span class="id" title="var">union</span></span> operator which gives priority to its 2nd argument
     in case of binding conflit. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">update</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) := <span class="id" title="tactic">fold</span> (@<span class="id" title="var">add</span> <span class="id" title="var">_</span>) <span class="id" title="var">m2</span> <span class="id" title="var">m1</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">restrict</span></span> keeps from <span class="inlinecode"><span class="id" title="var">m1</span></span> only the bindings whose key is in <span class="inlinecode"><span class="id" title="var">m2</span></span>.
      It can be seen as an <span class="inlinecode"><span class="id" title="var">inter</span></span> operator, with priority to its 1st argument
      in case of binding conflit. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">restrict</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) := <span class="id" title="var">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">mem</span> <span class="id" title="var">k</span> <span class="id" title="var">m2</span>) <span class="id" title="var">m1</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">diff</span></span> erases from <span class="inlinecode"><span class="id" title="var">m1</span></span> all bindings whose key is in <span class="inlinecode"><span class="id" title="var">m2</span></span>. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">diff</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) := <span class="id" title="var">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">negb</span> (<span class="id" title="var">mem</span> <span class="id" title="var">k</span> <span class="id" title="var">m2</span>)) <span class="id" title="var">m1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Specs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">Hf</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eq</span>) <span class="id" title="var">f</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">filter_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">filter</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> = <span class="id" title="var">true</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">for_all_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">for_all</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> &lt;-&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> = <span class="id" title="var">true</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exists_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">p</span>, <span class="id" title="var">MapsTo</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>) <span class="id" title="var">m</span> /\ <span class="id" title="var">f</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>) = <span class="id" title="var">true</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Specs</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Disjoint_alt</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Disjoint</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e'</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">False</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Partition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">Hf</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eq</span>) <span class="id" title="var">f</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_iff_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">m1</span> = <span class="id" title="var">fst</span> (<span class="id" title="var">partition</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> = <span class="id" title="var">true</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_iff_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m2</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">m2</span> = <span class="id" title="var">snd</span> (<span class="id" title="var">partition</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m2</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> = <span class="id" title="var">false</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">partition_Partition</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">partition</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> = (<span class="id" title="var">m1</span>,<span class="id" title="var">m2</span>) -&gt; <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Partition</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_In</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> -&gt; {<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m1</span>}+{<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m2</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Disjoint_sym</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">Disjoint</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">Disjoint</span> <span class="id" title="var">m2</span> <span class="id" title="var">m1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_sym</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m2</span> <span class="id" title="var">m1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_Empty</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Empty</span> <span class="id" title="var">m</span> &lt;-&gt; (<span class="id" title="var">Empty</span> <span class="id" title="var">m1</span> /\ <span class="id" title="var">Empty</span> <span class="id" title="var">m2</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_Add</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> , ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">Partition</span> <span class="id" title="var">m'</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">m3</span>, (<span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m3</span> <span class="id" title="var">m1</span> /\ <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m3</span> <span class="id" title="var">m2</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m3</span> <span class="id" title="var">m2</span> /\ <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m3</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_fold</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">eqA</span>:<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="keyword">Prop</span>)(<span class="id" title="var">st</span>:<span class="id" title="var">Equivalence</span> <span class="id" title="var">eqA</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eqA</span>==&gt;<span class="id" title="var">eqA</span>) <span class="id" title="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">transpose_neqkey</span> <span class="id" title="var">eqA</span> <span class="id" title="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_cardinal</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="var">cardinal</span> <span class="id" title="var">m1</span> + <span class="id" title="var">cardinal</span> <span class="id" title="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Partition_partition</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">Partition</span> <span class="id" title="var">m</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> (<span class="id" title="var">_</span>:<span class="id" title="var">elt</span>) =&gt; <span class="id" title="var">mem</span> <span class="id" title="var">k</span> <span class="id" title="var">m1</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m1</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">partition</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>)) /\ <span class="id" title="var">Equal</span> <span class="id" title="var">m2</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">partition</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">update</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m'</span> \/ (<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_dec</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">update</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m'</span> } + { <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">k</span> (<span class="id" title="var">update</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">diff_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">diff</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">diff_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">k</span> (<span class="id" title="var">diff</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> /\ ~<span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrict_mapsto_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> (<span class="id" title="var">restrict</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">restrict_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">k</span> (<span class="id" title="var">restrict</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>.<br/>

<br/>
</div>

<div class="doc">
specialized versions analyzing only keys (resp. elements) 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">filter_dom</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">filter_range</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">for_all_dom</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">for_all</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">for_all_range</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">for_all</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">exists_dom</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">exists_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">exists_range</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">exists_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">partition_dom</span> (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">partition</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">partition_range</span> (<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">partition</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Elt</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">cardinal</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">eq</span> <span class="id" title="keyword">as</span> <span class="id" title="var">cardinal_m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">Disjoint</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Disjoint_m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">Partition</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Partition_m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">update</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">update_m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">restrict</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">restrict_m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">elt</span> : (@<span class="id" title="var">diff</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">Equal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">diff_m</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">WProperties_fun</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab905"></a><h1 class="section">Same Properties for self-contained weak maps and for full maps</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">WProperties</span> (<span class="id" title="var">M</span>:<span class="id" title="var">WS</span>) := <span class="id" title="var">WProperties_fun</span> <span class="id" title="var">M.E</span> <span class="id" title="var">M</span>.<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Properties</span> := <span class="id" title="var">WProperties</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab906"></a><h1 class="section">Properties specific to maps with ordered keys</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">OrdProperties</span> (<span class="id" title="var">M</span>:<span class="id" title="var">S</span>).<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ME</span> := <span class="id" title="var">OrderedTypeFacts</span> <span class="id" title="var">M.E</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">O</span>:=<span class="id" title="var">KeyOrderedType</span> <span class="id" title="var">M.E</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">P</span>:=<span class="id" title="var">Properties</span> <span class="id" title="var">M</span>.<br/>
&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">F</span>.<br/>
&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">M</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Elt</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqke</span> := (@<span class="id" title="var">eqke</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqk</span> := (@<span class="id" title="var">eqk</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">ltk</span> := (@<span class="id" title="var">ltk</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">cardinal</span> := (@<span class="id" title="var">cardinal</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">Equal</span> := (@<span class="id" title="var">Equal</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="keyword">Add</span> := (@<span class="id" title="keyword">Add</span> <span class="id" title="var">elt</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Above</span> <span class="id" title="var">x</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">E.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Below</span> <span class="id" title="var">x</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">E.lt</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Elements</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sort_equivlistA_eqlistA</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">sort</span> <span class="id" title="var">ltk</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">sort</span> <span class="id" title="var">ltk</span> <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">equivlistA</span> <span class="id" title="var">eqke</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> -&gt; <span class="id" title="var">eqlistA</span> <span class="id" title="var">eqke</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clean_eauto</span> := <span class="id" title="tactic">unfold</span> <span class="id" title="var">O.eqke</span>, <span class="id" title="var">O.ltk</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">gtb</span> (<span class="id" title="var">p</span> <span class="id" title="var">p'</span>:<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E.compare</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">p'</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">leb</span> <span class="id" title="var">p</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">p'</span> =&gt; <span class="id" title="var">negb</span> (<span class="id" title="var">gtb</span> <span class="id" title="var">p</span> <span class="id" title="var">p'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">elements_lt</span> <span class="id" title="var">p</span> <span class="id" title="var">m</span> := <span class="id" title="var">List.filter</span> (<span class="id" title="var">gtb</span> <span class="id" title="var">p</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">elements_ge</span> <span class="id" title="var">p</span> <span class="id" title="var">m</span> := <span class="id" title="var">List.filter</span> (<span class="id" title="var">leb</span> <span class="id" title="var">p</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gtb_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span> <span class="id" title="var">p'</span>, <span class="id" title="var">gtb</span> <span class="id" title="var">p</span> <span class="id" title="var">p'</span> = <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">ltk</span> <span class="id" title="var">p'</span> <span class="id" title="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leb_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span> <span class="id" title="var">p'</span>, <span class="id" title="var">leb</span> <span class="id" title="var">p</span> <span class="id" title="var">p'</span> = <span class="id" title="var">true</span> &lt;-&gt; ~<span class="id" title="var">ltk</span> <span class="id" title="var">p'</span> <span class="id" title="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gtb_compat</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>, <span class="id" title="var">Proper</span> (<span class="id" title="var">eqke</span>==&gt;<span class="id" title="var">eq</span>) (<span class="id" title="var">gtb</span> <span class="id" title="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leb_compat</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>, <span class="id" title="var">Proper</span> (<span class="id" title="var">eqke</span>==&gt;<span class="id" title="var">eq</span>) (<span class="id" title="var">leb</span> <span class="id" title="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">gtb_compat</span> <span class="id" title="var">leb_compat</span> <span class="id" title="var">elements_3</span> : <span class="id" title="var">map</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_split</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span> <span class="id" title="var">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements</span> <span class="id" title="var">m</span> = <span class="id" title="var">elements_lt</span> <span class="id" title="var">p</span> <span class="id" title="var">m</span> ++ <span class="id" title="var">elements_ge</span> <span class="id" title="var">p</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_Add</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqlistA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">elements_lt</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) <span class="id" title="var">m</span> ++ (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>):: <span class="id" title="var">elements_ge</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_Add_Above</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Above</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqlistA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m'</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span> ++ (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)::<span class="id" title="var">nil</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_Add_Below</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Below</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqlistA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m'</span>) ((<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)::<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_Equal_eqlistA</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">eqlistA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Elements</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Min_Max_Elt</span>.<br/>

<br/>
</div>

<div class="doc">
We emulate two <span class="inlinecode"><span class="id" title="var">max_elt</span></span> and <span class="inlinecode"><span class="id" title="var">min_elt</span></span> functions. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">max_elt_aux</span> (<span class="id" title="var">l</span>:<span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>)) := <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)::<span class="id" title="var">nil</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)::<span class="id" title="var">l</span> =&gt; <span class="id" title="var">max_elt_aux</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">max_elt</span> <span class="id" title="var">m</span> := <span class="id" title="var">max_elt_aux</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_elt_Above</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">max_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) -&gt; <span class="id" title="var">Above</span> <span class="id" title="var">x</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_elt_MapsTo</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">max_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_elt_Empty</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">max_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">Empty</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">min_elt</span> <span class="id" title="var">m</span> : <span class="id" title="var">option</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">elements</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)::<span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">min_elt_Below</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">min_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) -&gt; <span class="id" title="var">Below</span> <span class="id" title="var">x</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">min_elt_MapsTo</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">min_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">min_elt_Empty</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">min_elt</span> <span class="id" title="var">m</span> = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">Empty</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Min_Max_Elt</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Induction_Principles</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_induction_max</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">Above</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_induction_min</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">Below</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">m'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">P</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Induction_Principles</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Fold_properties</span>.<br/>

<br/>
</div>

<div class="doc">
The following lemma has already been proved on Weak Maps,
      but with one additional hypothesis (some <span class="inlinecode"><span class="id" title="var">transpose</span></span> fact). 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Equal</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">eqA</span>:<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="keyword">Prop</span>)(<span class="id" title="var">st</span>:<span class="id" title="var">Equivalence</span>  <span class="id" title="var">eqA</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eqA</span>==&gt;<span class="id" title="var">eqA</span>) <span class="id" title="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Equal</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Add_Above</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">eqA</span>:<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="keyword">Prop</span>)(<span class="id" title="var">st</span>:<span class="id" title="var">Equivalence</span> <span class="id" title="var">eqA</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>) (<span class="id" title="var">P</span>:<span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eqA</span>==&gt;<span class="id" title="var">eqA</span>) <span class="id" title="var">f</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Above</span> <span class="id" title="var">x</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>) (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_Add_Below</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">eqA</span>:<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="keyword">Prop</span>)(<span class="id" title="var">st</span>:<span class="id" title="var">Equivalence</span> <span class="id" title="var">eqA</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>) (<span class="id" title="var">P</span>:<span class="id" title="var">Proper</span> (<span class="id" title="var">E.eq</span>==&gt;<span class="id" title="var">eq</span>==&gt;<span class="id" title="var">eqA</span>==&gt;<span class="id" title="var">eqA</span>) <span class="id" title="var">f</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Below</span> <span class="id" title="var">x</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="keyword">Add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqA</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m2</span> <span class="id" title="var">i</span>) (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Fold_properties</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Elt</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">OrdProperties</span>.<br/>
</div>
    <div id="sidebarWrapper">
      <div id="sidebar">
        <div class="block">
          <h2 class="title">Navigation</h2>
          <div class="content">
            <ul class="menu">
              <li class="leaf">Standard Library
                <ul class="menu">
                  <li><a href="index.html">Table of contents</a></li>
                  <li><a href="genindex.html">Index</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="footer">
    <div id="nav-footer">
      <ul class="links-menu-footer">
        <li><a href="mailto:coq-www_@_inria.fr">webmaster</a></li>
        <li><a href="http://validator.w3.org/">xhtml valid</a></li>
        <li><a href="http://jigsaw.w3.org/css-validator/">CSS valid</a></li>
      </ul>
    </div>
  </div>

</div>

</body>
</html>
