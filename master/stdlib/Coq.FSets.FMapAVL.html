<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/node/node.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/defaults.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/system.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/user/user.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/style.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/coqdoc.css" />

<title>Standard Library | The Coq Proof Assistant</title>

</head>

<body>

<div id="container">
  <div id="headertop">
    <div id="nav">
      <ul class="links-menu">
        <li><a href="//coq.inria.fr/" class="active">Home</a></li>
        <li><a href="//coq.inria.fr/about-coq" title="More about coq">About Coq</a></li>
        <li><a href="//coq.inria.fr/download">Get Coq</a></li>
        <li><a href="//coq.inria.fr/documentation">Documentation</a></li>
        <li><a href="//coq.inria.fr/community">Community</a></li>
      </ul>
    </div>
  </div>

  <div id="header">
    <div id="logoWrapper">
      <div id="logo"><a href="//coq.inria.fr/" title="Home"><img src="//coq.inria.fr/files/barron_logo.png" alt="Home" /></a>
      </div>
      <div id="siteName"><a href="//coq.inria.fr/" title="Home">The Coq Proof Assistant</a>
      </div>
    </div>
  </div>

  <div id="content">

<h1 class="libtitle">Library Coq.FSets.FMapAVL</h1>

<div class="code">

<br/>

<br/>
</div>

<div class="doc">
<a name="lab814"></a><h1 class="section">FMapAVL</h1>

<div class="paragraph"> </div>

 This module implements maps using AVL trees.
    It follows the implementation from Ocaml's standard library.

<div class="paragraph"> </div>

    See the comments at the beginning of FSetAVL for more details.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunInd</span> <span class="id" title="var">FMapInterface</span> <span class="id" title="var">FMapList</span> <span class="id" title="var">ZArith</span> <span class="id" title="var">Int</span>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
Notations and helper lemma about pairs 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Notation</span> &quot;s #1" := (<span class="id" title="var">fst</span> <span class="id" title="var">s</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "s '#1'") : <span class="id" title="var">pair_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;s #2" := (<span class="id" title="var">snd</span> <span class="id" title="var">s</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "s '#2'") : <span class="id" title="var">pair_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab815"></a><h1 class="section">The Raw functor</h1>


<div class="paragraph"> </div>

   Functor of pure functions + separate proofs of invariant
   preservation 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Raw</span> (<span class="id" title="keyword">Import</span> <span class="id" title="var">I</span>:<span class="id" title="var">Int</span>)(<span class="id" title="var">X</span>: <span class="id" title="var">OrderedType</span>).<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">pair_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">lazy_bool_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Int_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">key</span> := <span class="id" title="var">X.t</span>.<br/>
<span class="id" title="keyword">Hint Transparent</span> <span class="id" title="var">key</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab816"></a><h1 class="section">Trees</h1>

<div class="paragraph"> </div>

<a name="lab817"></a><h1 class="section">Trees</h1>


<div class="paragraph"> </div>

   The fifth field of <span class="inlinecode"><span class="id" title="var">Node</span></span> is the height of the tree 
</div>
<div class="code">

<br/>
#[<span class="id" title="var">universes</span>(<span class="id" title="var">template</span>)]<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">tree</span> {<span class="id" title="var">elt</span> : <span class="id" title="keyword">Type</span>} :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> : <span class="id" title="var">tree</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> : <span class="id" title="var">tree</span> -&gt; <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">tree</span> -&gt; <span class="id" title="var">int</span> -&gt; <span class="id" title="var">tree</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Elt</span>.<br/>

<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">t</span> := (<span class="id" title="var">tree</span> <span class="id" title="var">elt</span>).<br/>

<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab818"></a><h1 class="section">Basic functions on trees: height and cardinal</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">height</span> (<span class="id" title="var">m</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">int</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span> =&gt; <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cardinal</span> (<span class="id" title="var">m</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; 0%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">r</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">S</span> (<span class="id" title="var">cardinal</span> <span class="id" title="var">l</span> + <span class="id" title="var">cardinal</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab819"></a><h1 class="section">Empty Map</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">empty</span> : <span class="id" title="var">t</span> := <span class="id" title="var">Leaf</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab820"></a><h1 class="section">Emptyness test</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">true</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab821"></a><h1 class="section">Membership</h1>

<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="var">mem</span></span> function is deciding membership. It exploits the <span class="inlinecode"><span class="id" title="var">bst</span></span> property
    to achieve logarithmic complexity. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> <span class="id" title="var">r</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">option</span> <span class="id" title="var">elt</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab822"></a><h1 class="section">Helper functions</h1>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">create</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> creates a node, assuming <span class="inlinecode"><span class="id" title="var">l</span></span> and <span class="inlinecode"><span class="id" title="var">r</span></span>
    to be balanced and <span class="inlinecode">|<span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">r</span>|</span> <span class="inlinecode">&lt;=</span> <span class="inlinecode">2</span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> (<span class="id" title="var">max</span> (<span class="id" title="var">height</span> <span class="id" title="var">l</span>) (<span class="id" title="var">height</span> <span class="id" title="var">r</span>) + 1).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">bal</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> acts as <span class="inlinecode"><span class="id" title="var">create</span></span>, but performs one step of
    rebalancing if necessary, i.e. assumes <span class="inlinecode">|<span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">r</span>|</span> <span class="inlinecode">&lt;=</span> <span class="inlinecode">3</span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">assert_false</span> := <span class="id" title="var">create</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">hl</span> := <span class="id" title="var">height</span> <span class="id" title="var">l</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">hr</span> := <span class="id" title="var">height</span> <span class="id" title="var">r</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">gt_le_dec</span> <span class="id" title="var">hl</span> (<span class="id" title="var">hr</span>+2) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">assert_false</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lr</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">ge_lt_dec</span> (<span class="id" title="var">height</span> <span class="id" title="var">ll</span>) (<span class="id" title="var">height</span> <span class="id" title="var">lr</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">create</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> (<span class="id" title="var">create</span> <span class="id" title="var">lr</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lr</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">assert_false</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">lrl</span> <span class="id" title="var">lrx</span> <span class="id" title="var">lrd</span> <span class="id" title="var">lrr</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">create</span> (<span class="id" title="var">create</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lrl</span>) <span class="id" title="var">lrx</span> <span class="id" title="var">lrd</span> (<span class="id" title="var">create</span> <span class="id" title="var">lrr</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">gt_le_dec</span> <span class="id" title="var">hr</span> (<span class="id" title="var">hl</span>+2) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">assert_false</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">rl</span> <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">ge_lt_dec</span> (<span class="id" title="var">height</span> <span class="id" title="var">rr</span>) (<span class="id" title="var">height</span> <span class="id" title="var">rl</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">create</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">rl</span>) <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">rl</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">assert_false</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">rll</span> <span class="id" title="var">rlx</span> <span class="id" title="var">rld</span> <span class="id" title="var">rlr</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">create</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">rll</span>) <span class="id" title="var">rlx</span> <span class="id" title="var">rld</span> (<span class="id" title="var">create</span> <span class="id" title="var">rlr</span> <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab823"></a><h1 class="section">Insertion</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">m</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">Node</span> <span class="id" title="var">Leaf</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">Leaf</span> 1<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d'</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">bal</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">l</span>) <span class="id" title="var">y</span> <span class="id" title="var">d'</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d'</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab824"></a><h1 class="section">Extraction of minimum binding</h1>


<div class="paragraph"> </div>

  Morally, <span class="inlinecode"><span class="id" title="var">remove_min</span></span> is to be applied to a non-empty tree
  <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Node</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span>. Since we can't deal here with <span class="inlinecode"><span class="id" title="tactic">assert</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span>
  for <span class="inlinecode"><span class="id" title="var">t</span>=<span class="id" title="var">Leaf</span></span>, we pre-unpack <span class="inlinecode"><span class="id" title="var">t</span></span> (and forget about <span class="inlinecode"><span class="id" title="var">h</span></span>).

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> : <span class="id" title="var">t</span>*(<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; (<span class="id" title="var">r</span>,(<span class="id" title="var">x</span>,<span class="id" title="var">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lr</span> <span class="id" title="var">lh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">l'</span>,<span class="id" title="var">m</span>) := <span class="id" title="var">remove_min</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lr</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bal</span> <span class="id" title="var">l'</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>, <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab825"></a><h1 class="section">Merging two trees</h1>


<div class="paragraph"> </div>

  <span class="inlinecode"><span class="id" title="var">merge</span></span> <span class="inlinecode"><span class="id" title="var">t1</span></span> <span class="inlinecode"><span class="id" title="var">t2</span></span> builds the union of <span class="inlinecode"><span class="id" title="var">t1</span></span> and <span class="inlinecode"><span class="id" title="var">t2</span></span> assuming all elements
  of <span class="inlinecode"><span class="id" title="var">t1</span></span> to be smaller than all elements of <span class="inlinecode"><span class="id" title="var">t2</span></span>, and
  <span class="inlinecode">|<span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">t1</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">height</span></span> <span class="inlinecode"><span class="id" title="var">t2</span>|</span> <span class="inlinecode">&lt;=</span> <span class="inlinecode">2</span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">merge</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> :=  <span class="id" title="keyword">match</span> <span class="id" title="var">s1</span>,<span class="id" title="var">s2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">s2</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">s1</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">Node</span> <span class="id" title="var">l2</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">remove_min</span> <span class="id" title="var">l2</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s2'</span>,(<span class="id" title="var">x</span>,<span class="id" title="var">d</span>)) =&gt; <span class="id" title="var">bal</span> <span class="id" title="var">s1</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">s2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab826"></a><h1 class="section">Deletion</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">Leaf</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">bal</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">merge</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab827"></a><h1 class="section">join</h1>


<div class="paragraph"> </div>

    Same as <span class="inlinecode"><span class="id" title="var">bal</span></span> but does not assume anything regarding heights of <span class="inlinecode"><span class="id" title="var">l</span></span>
    and <span class="inlinecode"><span class="id" title="var">r</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">join</span> <span class="id" title="var">l</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">t</span> -&gt; <span class="id" title="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">add</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lr</span> <span class="id" title="var">lh</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fix</span> <span class="id" title="var">join_aux</span> (<span class="id" title="var">r</span>:<span class="id" title="var">t</span>) : <span class="id" title="var">t</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt;  <span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">rl</span> <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span> <span class="id" title="var">rh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">gt_le_dec</span> <span class="id" title="var">lh</span> (<span class="id" title="var">rh</span>+2) <span class="id" title="keyword">then</span> <span class="id" title="var">bal</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> (<span class="id" title="var">join</span> <span class="id" title="var">lr</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">gt_le_dec</span> <span class="id" title="var">rh</span> (<span class="id" title="var">lh</span>+2) <span class="id" title="keyword">then</span> <span class="id" title="var">bal</span> (<span class="id" title="var">join_aux</span> <span class="id" title="var">rl</span>) <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab828"></a><h1 class="section">Splitting</h1>


<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="tactic">split</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> returns a triple <span class="inlinecode">(<span class="id" title="var">l</span>,</span> <span class="inlinecode"><span class="id" title="var">o</span>,</span> <span class="inlinecode"><span class="id" title="var">r</span>)</span> where
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">l</span></span> is the set of elements of <span class="inlinecode"><span class="id" title="var">m</span></span> that are <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">r</span></span> is the set of elements of <span class="inlinecode"><span class="id" title="var">m</span></span> that are <span class="inlinecode">&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">o</span></span> is the result of <span class="inlinecode"><span class="id" title="var">find</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span>.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Record</span> <span class="id" title="var">triple</span> := <span class="id" title="var">mktriple</span> { <span class="id" title="var">t_left</span>:<span class="id" title="var">t</span>; <span class="id" title="var">t_opt</span>:<span class="id" title="var">option</span> <span class="id" title="var">elt</span>; <span class="id" title="var">t_right</span>:<span class="id" title="var">t</span> }.<br/>
<span class="id" title="keyword">Notation</span> &quot;&lt;&lt; l , b , r &gt;&gt;" := (<span class="id" title="var">mktriple</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">r</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">triple</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; &lt;&lt; <span class="id" title="var">Leaf</span>, <span class="id" title="var">None</span>, <span class="id" title="var">Leaf</span> &gt;&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">ll</span>,<span class="id" title="var">o</span>,<span class="id" title="var">rl</span>) := <span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> <span class="id" title="tactic">in</span> &lt;&lt; <span class="id" title="var">ll</span>, <span class="id" title="var">o</span>, <span class="id" title="var">join</span> <span class="id" title="var">rl</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; &lt;&lt; <span class="id" title="var">l</span>, <span class="id" title="var">Some</span> <span class="id" title="var">d</span>, <span class="id" title="var">r</span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">rl</span>,<span class="id" title="var">o</span>,<span class="id" title="var">rr</span>) := <span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> <span class="id" title="tactic">in</span> &lt;&lt; <span class="id" title="var">join</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">d</span> <span class="id" title="var">rl</span>, <span class="id" title="var">o</span>, <span class="id" title="var">rr</span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab829"></a><h1 class="section">Concatenation</h1>


<div class="paragraph"> </div>

   Same as <span class="inlinecode"><span class="id" title="var">merge</span></span> but does not assume anything about heights.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">concat</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m1</span>, <span class="id" title="var">m2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">m2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> , <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">Node</span> <span class="id" title="var">l2</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">m2'</span>,<span class="id" title="var">xd</span>) := <span class="id" title="var">remove_min</span> <span class="id" title="var">l2</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">join</span> <span class="id" title="var">m1</span> <span class="id" title="var">xd</span>#1 <span class="id" title="var">xd</span>#2 <span class="id" title="var">m2'</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab830"></a><h1 class="section">Elements</h1>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">elements_tree_aux</span></span> <span class="inlinecode"><span class="id" title="var">acc</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> catenates the elements of <span class="inlinecode"><span class="id" title="var">t</span></span> in infix
    order to the list <span class="inlinecode"><span class="id" title="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">elements_aux</span> (<span class="id" title="var">acc</span> : <span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>)) <span class="id" title="var">m</span> : <span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">elements_aux</span> ((<span class="id" title="var">x</span>,<span class="id" title="var">d</span>) :: <span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">r</span>) <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
then <span class="inlinecode"><span class="id" title="var">elements</span></span> is an instantiation with an empty <span class="inlinecode"><span class="id" title="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">elements</span> := <span class="id" title="var">elements_aux</span> <span class="id" title="var">nil</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab831"></a><h1 class="section">Fold</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">fold</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> :=<br/>
&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>))<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab832"></a><h1 class="section">Comparison</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">cmp</span> : <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">bool</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab833"></a><h2 class="section">Enumeration of the elements of a tree</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">enumeration</span> :=<br/>
&nbsp;| <span class="id" title="keyword">End</span> : <span class="id" title="var">enumeration</span><br/>
&nbsp;| <span class="id" title="var">More</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">t</span> -&gt; <span class="id" title="var">enumeration</span> -&gt; <span class="id" title="var">enumeration</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">cons</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> adds the elements of tree <span class="inlinecode"><span class="id" title="var">m</span></span> on the head of
    enumeration <span class="inlinecode"><span class="id" title="var">e</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cons</span> <span class="id" title="var">m</span> <span class="id" title="var">e</span> : <span class="id" title="var">enumeration</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt; <span class="id" title="var">cons</span> <span class="id" title="var">l</span> (<span class="id" title="var">More</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span>)<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
One step of comparison of elements 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equal_more</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> (<span class="id" title="var">cont</span>:<span class="id" title="var">enumeration</span>-&gt;<span class="id" title="var">bool</span>) <span class="id" title="var">e2</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;| <span class="id" title="keyword">End</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;| <span class="id" title="var">More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cmp</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> &amp;&amp;&amp; <span class="id" title="var">cont</span> (<span class="id" title="var">cons</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Comparison of left tree, middle element, then right tree 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">equal_cont</span> <span class="id" title="var">m1</span> (<span class="id" title="var">cont</span>:<span class="id" title="var">enumeration</span>-&gt;<span class="id" title="var">bool</span>) <span class="id" title="var">e2</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> =&gt; <span class="id" title="var">cont</span> <span class="id" title="var">e2</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l1</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">r1</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">equal_cont</span> <span class="id" title="var">l1</span> (<span class="id" title="var">equal_more</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> (<span class="id" title="var">equal_cont</span> <span class="id" title="var">r1</span> <span class="id" title="var">cont</span>)) <span class="id" title="var">e2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Initial continuation 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equal_end</span> <span class="id" title="var">e2</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">e2</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">End</span> =&gt; <span class="id" title="var">true</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The complete comparison 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equal</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> := <span class="id" title="var">equal_cont</span> <span class="id" title="var">m1</span> <span class="id" title="var">equal_end</span> (<span class="id" title="var">cons</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">End</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Elt</span>.<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">t</span> := <span class="id" title="var">tree</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;&lt;&lt; l , b , r &gt;&gt;" := (<span class="id" title="var">mktriple</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">r</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9).<br/>
<span class="id" title="keyword">Notation</span> &quot;t #l" := (<span class="id" title="var">t_left</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "t '#l'").<br/>
<span class="id" title="keyword">Notation</span> &quot;t #o" := (<span class="id" title="var">t_opt</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "t '#o'").<br/>
<span class="id" title="keyword">Notation</span> &quot;t #r" := (<span class="id" title="var">t_right</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "t '#r'").<br/>

<br/>
</div>

<div class="doc">
<a name="lab834"></a><h1 class="section">Map</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>   =&gt; <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt; <span class="id" title="var">Node</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">d</span>) (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span>) <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mapi</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt; <span class="id" title="var">Node</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span>) (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span>) <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab835"></a><h1 class="section">Map with removal</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map_option</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span>)(<span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">d'</span> =&gt; <span class="id" title="var">join</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>) <span class="id" title="var">x</span> <span class="id" title="var">d'</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">concat</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>) (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab836"></a><h1 class="section">Optimized map2</h1>


<div class="paragraph"> </div>

  Suggestion by B. Gregoire: a <span class="inlinecode"><span class="id" title="var">map2</span></span> function with specialized
  arguments that allows bypassing some tree traversal. Instead of one
  <span class="inlinecode"><span class="id" title="var">f0</span></span> of type <span class="inlinecode"><span class="id" title="var">key</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">elt</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">elt'</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">elt''</span></span>,
  we ask here for:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">f</span></span> which is a specialisation of <span class="inlinecode"><span class="id" title="var">f0</span></span> when first option isn't <span class="inlinecode"><span class="id" title="var">None</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">mapl</span></span> treats a <span class="inlinecode"><span class="id" title="var">tree</span></span> <span class="inlinecode"><span class="id" title="var">elt</span></span> with <span class="inlinecode"><span class="id" title="var">f0</span></span> when second option is <span class="inlinecode"><span class="id" title="var">None</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">mapr</span></span> treats a <span class="inlinecode"><span class="id" title="var">tree</span></span> <span class="inlinecode"><span class="id" title="var">elt'</span></span> with <span class="inlinecode"><span class="id" title="var">f0</span></span> when first option is <span class="inlinecode"><span class="id" title="var">None</span></span>

</li>
</ul>

<div class="paragraph"> </div>

  The idea is that <span class="inlinecode"><span class="id" title="var">mapl</span></span> and <span class="inlinecode"><span class="id" title="var">mapr</span></span> can be instantaneous (e.g.
  the identity or some constant function).

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map2_opt</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">mapl</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">mapr</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt''</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map2_opt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m1</span>, <span class="id" title="var">m2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">mapr</span> <span class="id" title="var">m2</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">Leaf</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">mapl</span> <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l1</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">r1</span> <span class="id" title="var">h1</span>, <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">l2'</span>,<span class="id" title="var">o2</span>,<span class="id" title="var">r2'</span>) := <span class="id" title="tactic">split</span> <span class="id" title="var">x1</span> <span class="id" title="var">m2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">f</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">o2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">join</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2'</span>) <span class="id" title="var">x1</span> <span class="id" title="var">e</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">concat</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2'</span>) (<span class="id" title="var">map2_opt</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map2_opt</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab837"></a><h1 class="section">Map2</h1>


<div class="paragraph"> </div>

    The <span class="inlinecode"><span class="id" title="var">map2</span></span> function of the Map interface can be implemented
    via <span class="inlinecode"><span class="id" title="var">map2_opt</span></span> and <span class="inlinecode"><span class="id" title="var">map_option</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map2</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">option</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt''</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">map2</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt''</span> :=<br/>
&nbsp;<span class="id" title="var">map2_opt</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span> <span class="id" title="var">o</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) <span class="id" title="var">o</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map_option</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) <span class="id" title="var">None</span>))<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map_option</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">d'</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">None</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d'</span>))).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab838"></a><h1 class="section">Invariants</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Invariants</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab839"></a><h2 class="section">Occurrence in a tree</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">MapsTo</span> (<span class="id" title="var">x</span> : <span class="id" title="var">key</span>)(<span class="id" title="var">e</span> : <span class="id" title="var">elt</span>) : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">MapsRoot</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">MapsLeft</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">MapsRight</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">In</span> (<span class="id" title="var">x</span> : <span class="id" title="var">key</span>) : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">InRoot</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">InLeft</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">InRight</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">In0</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> := <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>:<span class="id" title="var">elt</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab840"></a><h2 class="section">Binary search trees</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">lt_tree</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span>: all elements in <span class="inlinecode"><span class="id" title="var">s</span></span> are smaller than <span class="inlinecode"><span class="id" title="var">x</span></span>
   (resp. greater for <span class="inlinecode"><span class="id" title="var">gt_tree</span></span>) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">bst</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> : <span class="inlinecode"><span class="id" title="var">t</span></span> is a binary search tree 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">bst</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">BSLeaf</span> : <span class="id" title="var">bst</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BSNode</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>, <span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Invariants</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab841"></a><h1 class="section">Correctness proofs, isolated in a sub-module</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Proofs</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">MX</span> := <span class="id" title="var">OrderedTypeFacts</span> <span class="id" title="var">X</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">PX</span> := <span class="id" title="var">KeyOrderedType</span> <span class="id" title="var">X</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">L</span> := <span class="id" title="var">FMapList.Raw</span> <span class="id" title="var">X</span>.<br/>

<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">mem_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">mem</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">find_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">find</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">bal_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">bal</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">add_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">add</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">remove_min_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">remove_min</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">merge_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">merge</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">remove_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">remove</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">concat_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">concat</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">split_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="tactic">split</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">map_option_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">map_option</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Functional Scheme</span> <span class="id" title="var">map2_opt_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">map2_opt</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab842"></a><h1 class="section">Automation and dedicated tactics.</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Hint Constructors</span> <span class="id" title="var">tree</span> <span class="id" title="var">MapsTo</span> <span class="id" title="var">In</span> <span class="id" title="var">bst</span> : <span class="id" title="var">core</span>.<br/>
<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">lt_tree</span> <span class="id" title="var">gt_tree</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "factornode" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) <span class="id" title="var">ident</span>(<span class="id" title="var">x</span>) <span class="id" title="var">ident</span>(<span class="id" title="var">d</span>) <span class="id" title="var">ident</span>(<span class="id" title="var">r</span>) <span class="id" title="var">ident</span>(<span class="id" title="var">h</span>)<br/>
&nbsp;"as" <span class="id" title="var">ident</span>(<span class="id" title="var">s</span>) :=<br/>
&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s</span>:=<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) <span class="id" title="tactic">in</span> *; <span class="id" title="var">clearbody</span> <span class="id" title="var">s</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic for cleaning hypothesis after use of functional induction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">clearf</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : (@<span class="id" title="var">Logic.eq</span> (<span class="id" title="var">Compare</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">clearf</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : (@<span class="id" title="var">Logic.eq</span> (<span class="id" title="var">sumbool</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">clearf</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic to repeat <span class="inlinecode"><span class="id" title="tactic">inversion_clear</span></span> on all hyps of the
    form <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">Node</span></span> <span class="inlinecode">...))</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> (<span class="id" title="var">Node</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> (<span class="id" title="var">Node</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">Node</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>:<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">Node</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_all</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: <span class="id" title="var">f</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">inv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Helper tactic concerning order of elements. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">order</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;| <span class="id" title="var">U</span>: <span class="id" title="var">lt_tree</span> <span class="id" title="var">_</span> ?<span class="id" title="var">s</span>, <span class="id" title="var">V</span>: <span class="id" title="var">In</span> <span class="id" title="var">_</span> ?<span class="id" title="var">s</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">generalize</span> (<span class="id" title="var">U</span> <span class="id" title="var">_</span> <span class="id" title="var">V</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">U</span>; <span class="id" title="var">order</span><br/>
&nbsp;| <span class="id" title="var">U</span>: <span class="id" title="var">gt_tree</span> <span class="id" title="var">_</span> ?<span class="id" title="var">s</span>, <span class="id" title="var">V</span>: <span class="id" title="var">In</span> <span class="id" title="var">_</span> ?<span class="id" title="var">s</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">generalize</span> (<span class="id" title="var">U</span> <span class="id" title="var">_</span> <span class="id" title="var">V</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">U</span>; <span class="id" title="var">order</span><br/>
&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">MX.order</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">intuition_in</span> := <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">intuition</span>; <span class="id" title="var">inv</span> <span class="id" title="var">In</span>; <span class="id" title="var">inv</span> <span class="id" title="var">MapsTo</span>).<br/>

<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">join_tac</span> :=<br/>
&nbsp;<span class="id" title="tactic">intros</span> ?<span class="id" title="var">l</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [| ?<span class="id" title="var">ll</span> <span class="id" title="var">_</span> ?<span class="id" title="var">lx</span> ?<span class="id" title="var">ld</span> ?<span class="id" title="var">lr</span> ?<span class="id" title="var">Hlr</span> ?<span class="id" title="var">lh</span>];<br/>
&nbsp;&nbsp;&nbsp;[ | <span class="id" title="tactic">intros</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">d</span> ?<span class="id" title="var">r</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">r</span> <span class="id" title="keyword">as</span> [| ?<span class="id" title="var">rl</span> ?<span class="id" title="var">Hrl</span> ?<span class="id" title="var">rx</span> ?<span class="id" title="var">rd</span> ?<span class="id" title="var">rr</span> <span class="id" title="var">_</span> ?<span class="id" title="var">rh</span>]; <span class="id" title="tactic">unfold</span> <span class="id" title="var">join</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="tactic">destruct</span> (<span class="id" title="var">gt_le_dec</span> <span class="id" title="var">lh</span> (<span class="id" title="var">rh</span>+2)) <span class="id" title="keyword">as</span> [?<span class="id" title="var">GT</span>|?<span class="id" title="var">LE</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="keyword">context</span> [ <span class="id" title="var">bal</span> ?<span class="id" title="var">u</span> ?<span class="id" title="var">v</span> ?<span class="id" title="var">w</span> ?<span class="id" title="var">z</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">bal</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">w</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">bal</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> (<span class="id" title="var">join</span> <span class="id" title="var">lr</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> (<span class="id" title="var">Node</span> <span class="id" title="var">rl</span> <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span> <span class="id" title="var">rh</span>))); [ | <span class="id" title="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">destruct</span> (<span class="id" title="var">gt_le_dec</span> <span class="id" title="var">rh</span> (<span class="id" title="var">lh</span>+2)) <span class="id" title="keyword">as</span> [?<span class="id" title="var">GT'</span>|?<span class="id" title="var">LE'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="keyword">context</span> [ <span class="id" title="var">bal</span> ?<span class="id" title="var">u</span> ?<span class="id" title="var">v</span> ?<span class="id" title="var">w</span> ?<span class="id" title="var">z</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">bal</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">w</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">bal</span> (<span class="id" title="var">join</span> (<span class="id" title="var">Node</span> <span class="id" title="var">ll</span> <span class="id" title="var">lx</span> <span class="id" title="var">ld</span> <span class="id" title="var">lr</span> <span class="id" title="var">lh</span>) <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">rl</span>) <span class="id" title="var">rx</span> <span class="id" title="var">rd</span> <span class="id" title="var">rr</span>); [ | <span class="id" title="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ] ] ] ]; <span class="id" title="tactic">intros</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Elt</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">m</span> <span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab843"></a><h1 class="section">Basic results about <span class="inlinecode"><span class="id" title="var">MapsTo</span></span>, <span class="inlinecode"><span class="id" title="var">In</span></span>, <span class="inlinecode"><span class="id" title="var">lt_tree</span></span>, <span class="inlinecode"><span class="id" title="var">gt_tree</span></span>, <span class="inlinecode"><span class="id" title="var">height</span></span></h1>

<div class="paragraph"> </div>

 Facts about <span class="inlinecode"><span class="id" title="var">MapsTo</span></span> and <span class="inlinecode"><span class="id" title="var">In</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MapsTo_In</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">MapsTo_In</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_MapsTo</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span>, <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_alt</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span>, <span class="id" title="var">In0</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MapsTo_1</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Hint Immediate</span> <span class="id" title="var">MapsTo_1</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_1</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_node_iff</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
Results about <span class="inlinecode"><span class="id" title="var">lt_tree</span></span> and <span class="inlinecode"><span class="id" title="var">gt_tree</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_leaf</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">elt</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_leaf</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">elt</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_tree_node</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_tree_node</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">lt_leaf</span> <span class="id" title="var">gt_leaf</span> <span class="id" title="var">lt_tree_node</span> <span class="id" title="var">gt_tree_node</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_left</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_right</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_left</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_right</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">lt_left</span> <span class="id" title="var">lt_right</span> <span class="id" title="var">gt_left</span> <span class="id" title="var">gt_right</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_tree_not_in</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>, <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_tree_trans</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">X.lt</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_tree_not_in</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>, <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gt_tree_trans</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">X.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">lt_tree_not_in</span> <span class="id" title="var">lt_tree_trans</span> <span class="id" title="var">gt_tree_not_in</span> <span class="id" title="var">gt_tree_trans</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab844"></a><h1 class="section">Empty map</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">forall</span> (<span class="id" title="var">a</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>) , ~ <span class="id" title="var">MapsTo</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_bst</span> : <span class="id" title="var">bst</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_1</span> : <span class="id" title="var">Empty</span> (<span class="id" title="var">empty</span> <span class="id" title="var">elt</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab845"></a><h1 class="section">Emptyness test</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_empty_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_empty_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> -&gt; <span class="id" title="var">Empty</span> <span class="id" title="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab846"></a><h1 class="section">Membership</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;&gt; <span class="id" title="var">None</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_in_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;&gt; <span class="id" title="var">None</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_find_iff</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">None</span> &lt;-&gt; ~<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span>,<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> &lt;-&gt;<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">d</span>, <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">d</span> &lt;-&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> = <span class="id" title="var">Some</span> <span class="id" title="var">d</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_mapsto_equiv</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> &lt;-&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">d</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">m'</span>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_in_equiv</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab847"></a><h1 class="section">Helper functions</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">create_bst</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>, <span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">create_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">create_in</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>) &lt;-&gt; <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bal_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>, <span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">bal_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bal_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>) &lt;-&gt; <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bal_mapsto</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bal_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">bal</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>) = <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab848"></a><h1 class="section">Insertion</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) &lt;-&gt; <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">add_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, ~<span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt;<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, ~<span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt;<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span> <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">e</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab849"></a><h1 class="section">Extraction of minimum binding</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_min_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#1 \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#1.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_min_mapsto</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;((<span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#1) /\ <span class="id" title="var">e'</span> = (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e'</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#1.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_min_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#1.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">remove_min_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_min_gt_tree</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>,<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">gt_tree</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#1 (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#1.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">remove_min_gt_tree</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_min_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span> <span class="id" title="var">h</span>) =<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#1 <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#2#2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove_min</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">r</span>)#1<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab850"></a><h1 class="section">Merging two trees</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">merge_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">merge</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m1</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">merge_mapsto</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">merge</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m1</span> \/ <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">merge_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span> : <span class="id" title="var">key</span>, <span class="id" title="var">In</span> <span class="id" title="var">y1</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y2</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">merge</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab851"></a><h1 class="section">Deletion</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) &lt;-&gt; ~ <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> /\ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; ~ <span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; ~<span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt;<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab852"></a><h1 class="section">join</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">join</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>) &lt;-&gt; <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>, <span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;<span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">join</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">join_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">bst</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">join</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>) = <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">create</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab853"></a><h1 class="section">split</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_in_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>,<br/>
&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">l</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">X.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_in_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>,<br/>
&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">r</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">X.lt</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_in_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">o</span> = <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">l</span> /\ <span class="id" title="var">bst</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_lt_tree</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">lt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_gt_tree</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">gt_tree</span> <span class="id" title="var">x</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">r</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">split_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> = <span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="tactic">split</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>)#<span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab854"></a><h1 class="section">Concatenation</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">concat_in</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">y</span>,<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">concat</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m1</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">concat_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span>, <span class="id" title="var">In</span> <span class="id" title="var">y1</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y2</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">concat</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">concat_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">concat_find</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span>, <span class="id" title="var">In</span> <span class="id" title="var">y1</span> <span class="id" title="var">m1</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y2</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y1</span> <span class="id" title="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">concat</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Some</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">d</span> | <span class="id" title="var">None</span> =&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab855"></a><h1 class="section">Elements</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqk</span> := (<span class="id" title="var">PX.eqk</span> (<span class="id" title="var">elt</span>:= <span class="id" title="var">elt</span>)).<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">eqke</span> := (<span class="id" title="var">PX.eqke</span> (<span class="id" title="var">elt</span>:= <span class="id" title="var">elt</span>)).<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">ltk</span> := (<span class="id" title="var">PX.ltk</span> (<span class="id" title="var">elt</span>:= <span class="id" title="var">elt</span>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_aux_mapsto</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">acc</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">s</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">s</span> \/ <span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) <span class="id" title="var">acc</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_mapsto</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>) &lt;-&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_in</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">x</span>, <span class="id" title="var">L.PX.In</span> <span class="id" title="var">x</span> (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_aux_sort</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">acc</span>, <span class="id" title="var">bst</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">sort</span> <span class="id" title="var">ltk</span> <span class="id" title="var">acc</span> -&gt;<br/>
&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">y</span>, <span class="id" title="var">InA</span> <span class="id" title="var">eqke</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) <span class="id" title="var">acc</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">X.lt</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;<span class="id" title="var">sort</span> <span class="id" title="var">ltk</span> (<span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">s</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_sort</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>, <span class="id" title="var">bst</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">sort</span> <span class="id" title="var">ltk</span> (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">elements_sort</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_nodup</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>, <span class="id" title="var">bst</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">NoDupA</span> <span class="id" title="var">eqk</span> (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_aux_cardinal</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">acc</span>, (<span class="id" title="var">length</span> <span class="id" title="var">acc</span> + <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span>)%<span class="id" title="var">nat</span> = <span class="id" title="var">length</span> (<span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_cardinal</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>), <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="var">length</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_app</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">acc</span>, <span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">s</span> = <span class="id" title="var">elements</span> <span class="id" title="var">s</span> ++ <span class="id" title="var">acc</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_node</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">t1</span> <span class="id" title="var">t2</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">z</span> <span class="id" title="var">l</span>,<br/>
&nbsp;<span class="id" title="var">elements</span> <span class="id" title="var">t1</span> ++ (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) :: <span class="id" title="var">elements</span> <span class="id" title="var">t2</span> ++ <span class="id" title="var">l</span> =<br/>
&nbsp;<span class="id" title="var">elements</span> (<span class="id" title="var">Node</span> <span class="id" title="var">t1</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">t2</span> <span class="id" title="var">z</span>) ++ <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab856"></a><h1 class="section">Fold</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fold'</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">L.fold</span> <span class="id" title="var">f</span> (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_equiv_aux</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">acc</span>,<br/>
&nbsp;<span class="id" title="var">L.fold</span> <span class="id" title="var">f</span> (<span class="id" title="var">elements_aux</span> <span class="id" title="var">acc</span> <span class="id" title="var">s</span>) <span class="id" title="var">a</span> = <span class="id" title="var">L.fold</span> <span class="id" title="var">f</span> <span class="id" title="var">acc</span> (<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_equiv</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> = <span class="id" title="var">fold'</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_1</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">Hs</span>:<span class="id" title="var">bst</span> <span class="id" title="var">s</span>)(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)(<span class="id" title="var">i</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>),<br/>
&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span> <span class="id" title="var">i</span> = <span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">p</span>#1 <span class="id" title="var">p</span>#2 <span class="id" title="var">a</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>) <span class="id" title="var">i</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab857"></a><h1 class="section">Comparison</h1>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">flatten_e</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> returns the list of elements of the enumeration <span class="inlinecode"><span class="id" title="var">e</span></span>
    i.e. the list of elements actually compared 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">flatten_e</span> (<span class="id" title="var">e</span> : <span class="id" title="var">enumeration</span> <span class="id" title="var">elt</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="keyword">End</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">More</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">t</span> <span class="id" title="var">r</span> =&gt; (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) :: <span class="id" title="var">elements</span> <span class="id" title="var">t</span> ++ <span class="id" title="var">flatten_e</span> <span class="id" title="var">r</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">flatten_e_elements</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">r</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">z</span> <span class="id" title="var">e</span>,<br/>
&nbsp;<span class="id" title="var">elements</span> <span class="id" title="var">l</span> ++ <span class="id" title="var">flatten_e</span> (<span class="id" title="var">More</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">e</span>) =<br/>
&nbsp;<span class="id" title="var">elements</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span> <span class="id" title="var">z</span>) ++ <span class="id" title="var">flatten_e</span> <span class="id" title="var">e</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>) <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">flatten_e</span> (<span class="id" title="var">cons</span> <span class="id" title="var">s</span> <span class="id" title="var">e</span>) = <span class="id" title="var">elements</span> <span class="id" title="var">s</span> ++ <span class="id" title="var">flatten_e</span> <span class="id" title="var">e</span>.<br/>

<br/>
</div>

<div class="doc">
Proof of correction for the comparison 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">cmp</span> : <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">bool</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">IfEq</span> <span class="id" title="var">b</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> := <span class="id" title="var">L.equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> = <span class="id" title="var">b</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_IfEq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">X.eq</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> -&gt; <span class="id" title="var">cmp</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> = <span class="id" title="var">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">IfEq</span> <span class="id" title="var">b</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">IfEq</span> <span class="id" title="var">b</span> ((<span class="id" title="var">x1</span>,<span class="id" title="var">d1</span>)::<span class="id" title="var">l1</span>) ((<span class="id" title="var">x2</span>,<span class="id" title="var">d2</span>)::<span class="id" title="var">l2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_end_IfEq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">e2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">IfEq</span> (<span class="id" title="var">equal_end</span> <span class="id" title="var">e2</span>) <span class="id" title="var">nil</span> (<span class="id" title="var">flatten_e</span> <span class="id" title="var">e2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_more_IfEq</span> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> (<span class="id" title="var">cont</span>:<span class="id" title="var">enumeration</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">bool</span>) <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">IfEq</span> (<span class="id" title="var">cont</span> (<span class="id" title="var">cons</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)) <span class="id" title="var">l</span> (<span class="id" title="var">elements</span> <span class="id" title="var">r2</span> ++ <span class="id" title="var">flatten_e</span> <span class="id" title="var">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">IfEq</span> (<span class="id" title="var">equal_more</span> <span class="id" title="var">cmp</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">cont</span> (<span class="id" title="var">More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)) ((<span class="id" title="var">x1</span>,<span class="id" title="var">d1</span>)::<span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">flatten_e</span> (<span class="id" title="var">More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_cont_IfEq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">cont</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span>, <span class="id" title="var">IfEq</span> (<span class="id" title="var">cont</span> <span class="id" title="var">e</span>) <span class="id" title="var">l</span> (<span class="id" title="var">flatten_e</span> <span class="id" title="var">e</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">IfEq</span> (<span class="id" title="var">equal_cont</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m1</span> <span class="id" title="var">cont</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m1</span> ++ <span class="id" title="var">l</span>) (<span class="id" title="var">flatten_e</span> <span class="id" title="var">e2</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_IfEq</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">IfEq</span> (<span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m1</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m2</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Equivb</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span>, <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e'</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">cmp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> = <span class="id" title="var">true</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equivb_elements</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;<span class="id" title="var">Equivb</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> &lt;-&gt; <span class="id" title="var">L.Equivb</span> <span class="id" title="var">cmp</span> (<span class="id" title="var">elements</span> <span class="id" title="var">s</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">s'</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_Equivb</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">s</span> <span class="id" title="var">s'</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>), <span class="id" title="var">bst</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">s'</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> = <span class="id" title="var">true</span> &lt;-&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Elt</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">e</span>) (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map</span>.<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Mapi</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">elt'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>: <span class="id" title="var">tree</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>) (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Mapi</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map_option</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span>.<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">f_compat</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">d</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> = <span class="id" title="var">f</span> <span class="id" title="var">x'</span> <span class="id" title="var">d</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_option_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>),<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">d</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">m</span> /\ <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_option_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">map_option_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">nonify</span> <span class="id" title="var">e</span> :=<br/>
&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span> (@<span class="id" title="var">None</span> <span class="id" title="var">elt</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;(<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">not_find_iff</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="var">order</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_option_find</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>),<br/>
&nbsp;<span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">map_option</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">Some</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> | <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map_option</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map2_opt</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f0</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">mapl</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">mapr</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">t</span> <span class="id" title="var">elt''</span>.<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">f0_f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">o</span>, <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">d</span> <span class="id" title="var">o</span> = <span class="id" title="var">f0</span> <span class="id" title="var">x</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) <span class="id" title="var">o</span>.<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">mapl_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">mapl</span> <span class="id" title="var">m</span>).<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">mapr_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m'</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">mapr</span> <span class="id" title="var">m'</span>).<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">mapl_f0</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapl</span> <span class="id" title="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Some</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">f0</span> <span class="id" title="var">x</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) <span class="id" title="var">None</span> | <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">mapr_f0</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapr</span> <span class="id" title="var">m'</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Some</span> <span class="id" title="var">d'</span> =&gt; <span class="id" title="var">f0</span> <span class="id" title="var">x</span> <span class="id" title="var">None</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d'</span>) | <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Hypothesis</span> <span class="id" title="var">f0_compat</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">o</span> <span class="id" title="var">o'</span>, <span class="id" title="var">X.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> -&gt; <span class="id" title="var">f0</span> <span class="id" title="var">x</span> <span class="id" title="var">o</span> <span class="id" title="var">o'</span> = <span class="id" title="var">f0</span> <span class="id" title="var">x'</span> <span class="id" title="var">o</span> <span class="id" title="var">o'</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">map2_opt</span> := (<span class="id" title="var">map2_opt</span> <span class="id" title="var">f</span> <span class="id" title="var">mapl</span> <span class="id" title="var">mapr</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_opt_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_opt_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" title="var">bst</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>).<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">map2_opt_bst</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">map2_aux</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">In</span> ?<span class="id" title="var">x</span> <span class="id" title="var">_</span> \/ <span class="id" title="var">In</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H'</span> : <span class="id" title="var">find</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">m</span> = <span class="id" title="var">find</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">m'</span>, <span class="id" title="var">B</span>:<span class="id" title="var">bst</span> ?<span class="id" title="var">m</span>, <span class="id" title="var">B'</span>:<span class="id" title="var">bst</span> ?<span class="id" title="var">m'</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; [ <span class="id" title="var">intuition_in</span>; <span class="id" title="var">order</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;-(<span class="id" title="var">find_in_equiv</span> <span class="id" title="var">B</span> <span class="id" title="var">B'</span> <span class="id" title="var">H'</span>); <span class="id" title="tactic">auto</span> ]<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">nonify</span> <span class="id" title="var">t</span> :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">find</span> ?<span class="id" title="var">y</span> (<span class="id" title="var">map2_opt</span> ?<span class="id" title="var">m</span> ?<span class="id" title="var">m'</span>)) =&gt;<br/>
&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> (@<span class="id" title="var">None</span> <span class="id" title="var">elt''</span>);<br/>
&nbsp;[ | <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">not_find_iff</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">intro</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (@<span class="id" title="var">map2_opt_2</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">y</span>); <span class="id" title="tactic">auto</span>; <span class="id" title="var">order</span> ]<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_opt_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">map2_opt</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) = <span class="id" title="var">f0</span> <span class="id" title="var">y</span> (<span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>) (<span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map2_opt</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Map2</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span> : <span class="id" title="keyword">Type</span>.<br/>
<span class="id" title="keyword">Variable</span> <span class="id" title="var">f</span> : <span class="id" title="var">option</span> <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt'</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">elt''</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_bst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">bst</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">y</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) = <span class="id" title="var">f</span> (<span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span>) (<span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">y</span>, <span class="id" title="var">bst</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">bst</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Map2</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Proofs</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Raw</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab858"></a><h1 class="section">Encapsulation</h1>


<div class="paragraph"> </div>

   Now, in order to really provide a functor implementing <span class="inlinecode"><span class="id" title="var">S</span></span>, we
   need to encapsulate everything into a type of balanced binary search trees. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">IntMake</span> (<span class="id" title="var">I</span>:<span class="id" title="var">Int</span>)(<span class="id" title="var">X</span>: <span class="id" title="var">OrderedType</span>) &lt;: <span class="id" title="var">S</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">E</span> := <span class="id" title="var">X</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">E</span> := <span class="id" title="var">X</span>.<br/>
&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">Raw</span> := <span class="id" title="var">Raw</span> <span class="id" title="var">I</span> <span class="id" title="var">X</span>.<br/>
&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">Raw.Proofs</span>.<br/>

<br/>
&nbsp;#[<span class="id" title="var">universes</span>(<span class="id" title="var">template</span>)]<br/>
&nbsp;<span class="id" title="keyword">Record</span> <span class="id" title="var">bst</span> (<span class="id" title="var">elt</span>:<span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Bst</span> {<span class="id" title="var">this</span> :&gt; <span class="id" title="var">Raw.tree</span> <span class="id" title="var">elt</span>; <span class="id" title="var">is_bst</span> : <span class="id" title="var">Raw.bst</span> <span class="id" title="var">this</span>}.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">t</span> := <span class="id" title="var">bst</span>.<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">key</span> := <span class="id" title="var">E.t</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Elt</span>.<br/>
&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span>: <span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span>.<br/>
&nbsp;<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">key</span>.<br/>
&nbsp;<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">e</span> : <span class="id" title="var">elt</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">empty</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> := <span class="id" title="var">Bst</span> (<span class="id" title="var">empty_bst</span> <span class="id" title="var">elt</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> : <span class="id" title="var">bool</span> := <span class="id" title="var">Raw.is_empty</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> := <span class="id" title="var">Bst</span> (<span class="id" title="var">add_bst</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt</span> := <span class="id" title="var">Bst</span> (<span class="id" title="var">remove_bst</span> <span class="id" title="var">x</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">bool</span> := <span class="id" title="var">Raw.mem</span> <span class="id" title="var">x</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="var">option</span> <span class="id" title="var">elt</span> := <span class="id" title="var">Raw.find</span> <span class="id" title="var">x</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> := <span class="id" title="var">Bst</span> (<span class="id" title="var">map_bst</span> <span class="id" title="var">f</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapi</span> (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>) <span class="id" title="var">m</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Bst</span> (<span class="id" title="var">mapi_bst</span> <span class="id" title="var">f</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> (<span class="id" title="var">m'</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt'</span>) : <span class="id" title="var">t</span> <span class="id" title="var">elt''</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Bst</span> (<span class="id" title="var">map2_bst</span> <span class="id" title="var">f</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m</span>) (<span class="id" title="var">is_bst</span> <span class="id" title="var">m'</span>)).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">elements</span> <span class="id" title="var">m</span> : <span class="id" title="var">list</span> (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) := <span class="id" title="var">Raw.elements</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> := <span class="id" title="var">Raw.cardinal</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="tactic">fold</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>) <span class="id" title="var">m</span> <span class="id" title="var">i</span> := <span class="id" title="var">Raw.fold</span> (<span class="id" title="var">A</span>:=<span class="id" title="var">A</span>) <span class="id" title="var">f</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>) <span class="id" title="var">i</span>.<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">bool</span> := <span class="id" title="var">Raw.equal</span> <span class="id" title="var">cmp</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>) (<span class="id" title="var">this</span> <span class="id" title="var">m'</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> : <span class="id" title="keyword">Prop</span> := <span class="id" title="var">Raw.MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> : <span class="id" title="keyword">Prop</span> := <span class="id" title="var">Raw.In0</span> <span class="id" title="var">x</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> : <span class="id" title="keyword">Prop</span> := <span class="id" title="var">Empty</span> (<span class="id" title="var">this</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">eq_key</span> : (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; <span class="id" title="keyword">Prop</span> := @<span class="id" title="var">PX.eqk</span> <span class="id" title="var">elt</span>.<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">eq_key_elt</span> : (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; <span class="id" title="keyword">Prop</span> := @<span class="id" title="var">PX.eqke</span> <span class="id" title="var">elt</span>.<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">lt_key</span> : (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; (<span class="id" title="var">key</span>*<span class="id" title="var">elt</span>) -&gt; <span class="id" title="keyword">Prop</span> := @<span class="id" title="var">PX.ltk</span> <span class="id" title="var">elt</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MapsTo_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mem_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span>, <span class="id" title="var">mem</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_1</span> : <span class="id" title="var">Empty</span> <span class="id" title="var">empty</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_empty_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">Empty</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span>.<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_empty_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">is_empty</span> <span class="id" title="var">m</span> = <span class="id" title="var">true</span> -&gt; <span class="id" title="var">Empty</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>).<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, ~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>).<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, ~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">add</span> <span class="id" title="var">x</span> <span class="id" title="var">e'</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; ~ <span class="id" title="var">In</span> <span class="id" title="var">y</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, ~ <span class="id" title="var">E.eq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>).<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">remove_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> (<span class="id" title="var">remove</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span>.<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>, <span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> = <span class="id" title="var">Some</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">key</span> -&gt; <span class="id" title="var">elt</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span> = <span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">fst</span> <span class="id" title="var">p</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>) <span class="id" title="var">a</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>) <span class="id" title="var">i</span>.<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">InA</span> <span class="id" title="var">eq_key_elt</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">InA</span> <span class="id" title="var">eq_key_elt</span> (<span class="id" title="var">x</span>,<span class="id" title="var">e</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_3</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">sort</span> <span class="id" title="var">lt_key</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_3w</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">NoDupA</span> <span class="id" title="var">eq_key</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cardinal_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, <span class="id" title="var">cardinal</span> <span class="id" title="var">m</span> = <span class="id" title="var">length</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Equal</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span>, <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m</span> = <span class="id" title="var">find</span> <span class="id" title="var">y</span> <span class="id" title="var">m'</span>.<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Equiv</span> (<span class="id" title="var">eq_elt</span>:<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="keyword">Prop</span>) <span class="id" title="var">m</span> <span class="id" title="var">m'</span> :=<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span>, <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">k</span> <span class="id" title="var">m'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">k</span> <span class="id" title="var">e'</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">eq_elt</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>).<br/>
&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> := <span class="id" title="var">Equiv</span> (<span class="id" title="var">Cmp</span> <span class="id" title="var">cmp</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Equivb_Equivb</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> &lt;-&gt; <span class="id" title="var">Raw.Proofs.Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_1</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">cmp</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> = <span class="id" title="var">true</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equal_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">cmp</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">equal</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> = <span class="id" title="var">true</span> -&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Elt</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt; <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">e</span>) (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>:<span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>), <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">e</span>:<span class="id" title="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>), <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <span class="id" title="var">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>, <span class="id" title="var">E.eq</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> /\ <span class="id" title="var">MapsTo</span> <span class="id" title="var">x</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">e</span>) (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>).<br/>
 &nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mapi_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">key</span>-&gt;<span class="id" title="var">elt</span>-&gt;<span class="id" title="var">elt'</span>), <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">mapi</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">m'</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">option</span> <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt'</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt''</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">x</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) = <span class="id" title="var">f</span> (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span>) (<span class="id" title="var">find</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span>).<br/>

<br/>
&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map2_2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">elt</span> <span class="id" title="var">elt'</span> <span class="id" title="var">elt''</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">m</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt</span>)(<span class="id" title="var">m'</span>: <span class="id" title="var">t</span> <span class="id" title="var">elt'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">x</span>:<span class="id" title="var">key</span>)(<span class="id" title="var">f</span>:<span class="id" title="var">option</span> <span class="id" title="var">elt</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt'</span>-&gt;<span class="id" title="var">option</span> <span class="id" title="var">elt''</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">map2</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">m'</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">IntMake</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">IntMake_ord</span> (<span class="id" title="var">I</span>:<span class="id" title="var">Int</span>)(<span class="id" title="var">X</span>: <span class="id" title="var">OrderedType</span>)(<span class="id" title="var">D</span> : <span class="id" title="var">OrderedType</span>) &lt;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sord</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">Data</span> := <span class="id" title="var">D</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">MapS.E</span> := <span class="id" title="var">X</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">Data</span> := <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">MapS</span> := <span class="id" title="var">IntMake</span>(<span class="id" title="var">I</span>)(<span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">LO</span> := <span class="id" title="var">FMapList.Make_ord</span>(<span class="id" title="var">X</span>)(<span class="id" title="var">D</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">R</span> := <span class="id" title="var">Raw</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">P</span> := <span class="id" title="var">Raw.Proofs</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">t</span> := <span class="id" title="var">MapS.t</span> <span class="id" title="var">D.t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cmp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">D.compare</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="keyword">with</span> <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
One step of comparison of elements 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compare_more</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> (<span class="id" title="var">cont</span>:<span class="id" title="var">R.enumeration</span> <span class="id" title="var">D.t</span> -&gt; <span class="id" title="var">comparison</span>) <span class="id" title="var">e2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">R.End</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">R.More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">X.compare</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">D.compare</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">EQ</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cont</span> (<span class="id" title="var">R.cons</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Lt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Lt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">GT</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Comparison of left tree, middle element, then right tree 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">compare_cont</span> <span class="id" title="var">s1</span> (<span class="id" title="var">cont</span>:<span class="id" title="var">R.enumeration</span> <span class="id" title="var">D.t</span> -&gt; <span class="id" title="var">comparison</span>) <span class="id" title="var">e2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">s1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">R.Leaf</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cont</span> <span class="id" title="var">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">R.Node</span> <span class="id" title="var">l1</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">r1</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compare_cont</span> <span class="id" title="var">l1</span> (<span class="id" title="var">compare_more</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> (<span class="id" title="var">compare_cont</span> <span class="id" title="var">r1</span> <span class="id" title="var">cont</span>)) <span class="id" title="var">e2</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Initial continuation 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compare_end</span> (<span class="id" title="var">e2</span>:<span class="id" title="var">R.enumeration</span> <span class="id" title="var">D.t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e2</span> <span class="id" title="keyword">with</span> <span class="id" title="var">R.End</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Eq</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Lt</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The complete comparison 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compare_pure</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">compare_cont</span> <span class="id" title="var">s1</span> <span class="id" title="var">compare_end</span> (<span class="id" title="var">R.cons</span> <span class="id" title="var">s2</span> (<span class="id" title="var">Raw.End</span> <span class="id" title="var">_</span>)).<br/>

<br/>
</div>

<div class="doc">
Correctness of this comparison 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Cmp</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">LO.eq_list</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Lt</span> =&gt; <span class="id" title="var">LO.lt_list</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Gt</span> =&gt; (<span class="id" title="keyword">fun</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> =&gt; <span class="id" title="var">LO.lt_list</span> <span class="id" title="var">l2</span> <span class="id" title="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_Cmp</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">c</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">X.eq</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> -&gt; <span class="id" title="var">D.eq</span> <span class="id" title="var">d1</span> <span class="id" title="var">d2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Cmp</span> <span class="id" title="var">c</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> -&gt; <span class="id" title="var">Cmp</span> <span class="id" title="var">c</span> ((<span class="id" title="var">x1</span>,<span class="id" title="var">d1</span>)::<span class="id" title="var">l1</span>) ((<span class="id" title="var">x2</span>,<span class="id" title="var">d2</span>)::<span class="id" title="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">cons_Cmp</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compare_end_Cmp</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">e2</span>, <span class="id" title="var">Cmp</span> (<span class="id" title="var">compare_end</span> <span class="id" title="var">e2</span>) <span class="id" title="var">nil</span> (<span class="id" title="var">P.flatten_e</span> <span class="id" title="var">e2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compare_more_Cmp</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">cont</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Cmp</span> (<span class="id" title="var">cont</span> (<span class="id" title="var">R.cons</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)) <span class="id" title="var">l</span> (<span class="id" title="var">R.elements</span> <span class="id" title="var">r2</span> ++ <span class="id" title="var">P.flatten_e</span> <span class="id" title="var">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Cmp</span> (<span class="id" title="var">compare_more</span> <span class="id" title="var">x1</span> <span class="id" title="var">d1</span> <span class="id" title="var">cont</span> (<span class="id" title="var">R.More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)) ((<span class="id" title="var">x1</span>,<span class="id" title="var">d1</span>)::<span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P.flatten_e</span> (<span class="id" title="var">R.More</span> <span class="id" title="var">x2</span> <span class="id" title="var">d2</span> <span class="id" title="var">r2</span> <span class="id" title="var">e2</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compare_cont_Cmp</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s1</span> <span class="id" title="var">cont</span> <span class="id" title="var">e2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span>, <span class="id" title="var">Cmp</span> (<span class="id" title="var">cont</span> <span class="id" title="var">e</span>) <span class="id" title="var">l</span> (<span class="id" title="var">P.flatten_e</span> <span class="id" title="var">e</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Cmp</span> (<span class="id" title="var">compare_cont</span> <span class="id" title="var">s1</span> <span class="id" title="var">cont</span> <span class="id" title="var">e2</span>) (<span class="id" title="var">R.elements</span> <span class="id" title="var">s1</span> ++ <span class="id" title="var">l</span>) (<span class="id" title="var">P.flatten_e</span> <span class="id" title="var">e2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compare_Cmp</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Cmp</span> (<span class="id" title="var">compare_pure</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>) (<span class="id" title="var">R.elements</span> <span class="id" title="var">s1</span>) (<span class="id" title="var">R.elements</span> <span class="id" title="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
The dependent-style <span class="inlinecode"><span class="id" title="var">compare</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">eq</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>) := <span class="id" title="var">LO.eq_list</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m1</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">lt</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>) := <span class="id" title="var">LO.lt_list</span> (<span class="id" title="var">elements</span> <span class="id" title="var">m1</span>) (<span class="id" title="var">elements</span> <span class="id" title="var">m2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compare</span> (<span class="id" title="var">s</span> <span class="id" title="var">s'</span>:<span class="id" title="var">t</span>) : <span class="id" title="var">Compare</span> <span class="id" title="var">lt</span> <span class="id" title="var">eq</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">selements</span> (<span class="id" title="var">m1</span> : <span class="id" title="var">t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">LO.MapS.Build_slist</span> (<span class="id" title="var">P.elements_sort</span> (<span class="id" title="var">is_bst</span> <span class="id" title="var">m1</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">seq</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>) := <span class="id" title="var">LO.eq</span> (<span class="id" title="var">selements</span> <span class="id" title="var">m1</span>) (<span class="id" title="var">selements</span> <span class="id" title="var">m2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">slt</span> (<span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>) := <span class="id" title="var">LO.lt</span> (<span class="id" title="var">selements</span> <span class="id" title="var">m1</span>) (<span class="id" title="var">selements</span> <span class="id" title="var">m2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_seq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">eq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> &lt;-&gt; <span class="id" title="var">seq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_slt</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>, <span class="id" title="var">lt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> &lt;-&gt; <span class="id" title="var">slt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_1</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> <span class="id" title="var">m'</span> : <span class="id" title="var">t</span>), <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">eq</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_2</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>, <span class="id" title="var">eq</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> -&gt; <span class="id" title="var">Equivb</span> <span class="id" title="var">cmp</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_refl</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> : <span class="id" title="var">t</span>, <span class="id" title="var">eq</span> <span class="id" title="var">m</span> <span class="id" title="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_sym</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>, <span class="id" title="var">eq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">eq</span> <span class="id" title="var">m2</span> <span class="id" title="var">m1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_trans</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">m3</span> : <span class="id" title="var">t</span>, <span class="id" title="var">eq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">eq</span> <span class="id" title="var">m2</span> <span class="id" title="var">m3</span> -&gt; <span class="id" title="var">eq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_trans</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">m3</span> : <span class="id" title="var">t</span>, <span class="id" title="var">lt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; <span class="id" title="var">lt</span> <span class="id" title="var">m2</span> <span class="id" title="var">m3</span> -&gt; <span class="id" title="var">lt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lt_not_eq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">t</span>, <span class="id" title="var">lt</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> -&gt; ~ <span class="id" title="var">eq</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">IntMake_ord</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Make</span> (<span class="id" title="var">X</span>: <span class="id" title="var">OrderedType</span>) &lt;: <span class="id" title="var">S</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">E</span> := <span class="id" title="var">X</span><br/>
&nbsp;:=<span class="id" title="var">IntMake</span>(<span class="id" title="var">Z_as_Int</span>)(<span class="id" title="var">X</span>).<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Make_ord</span> (<span class="id" title="var">X</span>: <span class="id" title="var">OrderedType</span>)(<span class="id" title="var">D</span>: <span class="id" title="var">OrderedType</span>)<br/>
&nbsp;&lt;: <span class="id" title="var">Sord</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">Data</span> := <span class="id" title="var">D</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="keyword">Module</span> <span class="id" title="var">MapS.E</span> := <span class="id" title="var">X</span><br/>
&nbsp;:=<span class="id" title="var">IntMake_ord</span>(<span class="id" title="var">Z_as_Int</span>)(<span class="id" title="var">X</span>)(<span class="id" title="var">D</span>).<br/>

<br/>
</div>
    <div id="sidebarWrapper">
      <div id="sidebar">
        <div class="block">
          <h2 class="title">Navigation</h2>
          <div class="content">
            <ul class="menu">
              <li class="leaf">Standard Library
                <ul class="menu">
                  <li><a href="index.html">Table of contents</a></li>
                  <li><a href="genindex.html">Index</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="footer">
    <div id="nav-footer">
      <ul class="links-menu-footer">
        <li><a href="mailto:coq-www_@_inria.fr">webmaster</a></li>
        <li><a href="http://validator.w3.org/">xhtml valid</a></li>
        <li><a href="http://jigsaw.w3.org/css-validator/">CSS valid</a></li>
      </ul>
    </div>
  </div>

</div>

</body>
</html>
