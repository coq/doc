<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/node/node.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/defaults.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/system/system.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/modules/user/user.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/style.css" />
<link type="text/css" rel="stylesheet" media="all" href="//coq.inria.fr/sites/all/themes/coq/coqdoc.css" />

<title>Standard Library | The Coq Proof Assistant</title>

</head>

<body>

<div id="container">
  <div id="headertop">
    <div id="nav">
      <ul class="links-menu">
        <li><a href="//coq.inria.fr/" class="active">Home</a></li>
        <li><a href="//coq.inria.fr/about-coq" title="More about coq">About Coq</a></li>
        <li><a href="//coq.inria.fr/download">Get Coq</a></li>
        <li><a href="//coq.inria.fr/documentation">Documentation</a></li>
        <li><a href="//coq.inria.fr/community">Community</a></li>
      </ul>
    </div>
  </div>

  <div id="header">
    <div id="logoWrapper">
      <div id="logo"><a href="//coq.inria.fr/" title="Home"><img src="//coq.inria.fr/files/barron_logo.png" alt="Home" /></a>
      </div>
      <div id="siteName"><a href="//coq.inria.fr/" title="Home">The Coq Proof Assistant</a>
      </div>
    </div>
  </div>

  <div id="content">

<h1 class="libtitle">Library Coq.Numbers.Cyclic.Int31.Int31</h1>

<div class="code">

<br/>
</div>

<div class="doc">
This library has been deprecated since Coq version 8.10. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">NaryFunctions</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Wf_nat</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">DoubleType</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a id="lab395"></a><h1 class="section">31-bit integers</h1>

<div class="paragraph"> </div>

 This file contains basic definitions of a 31-bit integer
  arithmetic. In fact it is more general than that. The only reason
  for this use of 31 is the underlying mechanism for hardware-efficient
  computations by A. Spiwack. Apart from this, a switch to, say,
  63-bit integers is now just a matter of replacing every occurrences
  of 31 by 63. This is actually made possible by the use of
  dependently-typed n-ary constructions for the inductive type
  <span class="inlinecode"><span class="id" title="var">int31</span></span>, its constructor <span class="inlinecode"><span class="id" title="var">I31</span></span> and any pattern matching on it.
  If you modify this file, please preserve this genericity.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">size</span> := 31%<span class="id" title="var">nat</span>.<br/>

<br/>
</div>

<div class="doc">
Digits 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">digits</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">D0</span> | <span class="id" title="var">D1</span>.<br/>

<br/>
</div>

<div class="doc">
The type of 31-bit integers 
<div class="paragraph"> </div>

 The type <span class="inlinecode"><span class="id" title="var">int31</span></span> has a unique constructor <span class="inlinecode"><span class="id" title="var">I31</span></span> that expects
   31 arguments of type <span class="inlinecode"><span class="id" title="var">digits</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">digits31</span> <span class="id" title="var">t</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">nfun</span> <span class="id" title="var">digits</span> <span class="id" title="var">size</span> <span class="id" title="var">t</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">int31</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">I31</span> : <span class="id" title="var">digits31</span> <span class="id" title="var">int31</span>.<br/>

<br/>
<span class="id" title="keyword">Scheme</span> <span class="id" title="var">int31_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">int31</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Scheme</span> <span class="id" title="var">int31_rec</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">int31</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Set</span>.<br/>
<span class="id" title="keyword">Scheme</span> <span class="id" title="var">int31_rect</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">int31</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Type</span>.<br/>

<br/>
<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">int31_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">int31</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab396"></a><h1 class="section">Constants</h1>

<div class="paragraph"> </div>

 Zero is <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D0</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="keyword">On</span> : <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">napply_cst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">D0</span> <span class="id" title="var">size</span> <span class="id" title="var">I31</span>.<br/>

<br/>
</div>

<div class="doc">
One is <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode"><span class="id" title="var">D1</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">In</span> : <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">napply_cst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">D0</span> (<span class="id" title="var">size</span>-1) <span class="id" title="var">I31</span>) <span class="id" title="var">D1</span>.<br/>

<br/>
</div>

<div class="doc">
The biggest integer is <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D1</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D1</span></span>, corresponding to <span class="inlinecode">(2^<span class="id" title="var">size</span>)-1</span> 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Tn</span> : <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">napply_cst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">D1</span> <span class="id" title="var">size</span> <span class="id" title="var">I31</span>.<br/>

<br/>
</div>

<div class="doc">
Two is <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode"><span class="id" title="var">D1</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Twon</span> : <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">napply_cst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">D0</span> (<span class="id" title="var">size</span>-2) <span class="id" title="var">I31</span>) <span class="id" title="var">D1</span> <span class="id" title="var">D0</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab397"></a><h1 class="section">Bits manipulation</h1>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">sneakr</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> shifts <span class="inlinecode"><span class="id" title="var">x</span></span> to the right by one bit.
   Rightmost digit is lost while leftmost digit becomes <span class="inlinecode"><span class="id" title="var">b</span></span>.
   Pseudo-code is
    <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">dN</span>)</span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">d</span>(<span class="id" title="var">N</span>-1)</span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"></span>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sneakr</span> : <span class="id" title="var">digits</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">int31_rect</span> <span class="id" title="var">_</span> (<span class="id" title="var">napply_except_last</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">size</span>-1) (<span class="id" title="var">I31</span> <span class="id" title="var">b</span>)).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">sneakl</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> shifts <span class="inlinecode"><span class="id" title="var">x</span></span> to the left by one bit.
   Leftmost digit is lost while rightmost digit becomes <span class="inlinecode"><span class="id" title="var">b</span></span>.
   Pseudo-code is
    <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">dN</span>)</span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">d1</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">dN</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"></span>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sneakl</span> : <span class="id" title="var">digits</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">int31_rect</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">napply_then_last</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">b</span> (<span class="id" title="var">size</span>-1) <span class="id" title="var">I31</span>).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">shiftl</span></span>, <span class="inlinecode"><span class="id" title="var">shiftr</span></span>, <span class="inlinecode"><span class="id" title="var">twice</span></span> and <span class="inlinecode"><span class="id" title="var">twice_plus_one</span></span> are direct
    consequences of <span class="inlinecode"><span class="id" title="var">sneakl</span></span> and <span class="inlinecode"><span class="id" title="var">sneakr</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">shiftl</span> := <span class="id" title="var">sneakl</span> <span class="id" title="var">D0</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">shiftr</span> := <span class="id" title="var">sneakr</span> <span class="id" title="var">D0</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">twice</span> := <span class="id" title="var">sneakl</span> <span class="id" title="var">D0</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">twice_plus_one</span> := <span class="id" title="var">sneakl</span> <span class="id" title="var">D1</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">firstl</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> returns the leftmost digit of number <span class="inlinecode"><span class="id" title="var">x</span></span>.
    Pseudo-code is <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">dN</span>)</span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">firstl</span> : <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">digits</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="var">int31_rect</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">napply_discard</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span> (<span class="id" title="var">size</span>-1)).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">firstr</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> returns the rightmost digit of number <span class="inlinecode"><span class="id" title="var">x</span></span>.
    Pseudo-code is <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">d0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">dN</span>)</span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">dN</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">firstr</span> : <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">digits</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="var">int31_rect</span> <span class="id" title="var">_</span> (<span class="id" title="var">napply_discard</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">d</span>=&gt;<span class="id" title="var">d</span>) (<span class="id" title="var">size</span>-1)).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">iszero</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> is true iff <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D0</span></span>. Pseudo-code is
    <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">I31</span></span> <span class="inlinecode"><span class="id" title="var">D0</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">D0</span>)</span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode">|</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iszero</span> : <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">bool</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">f</span> <span class="id" title="var">d</span> <span class="id" title="var">b</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">d</span> <span class="id" title="keyword">with</span> <span class="id" title="var">D0</span> =&gt; <span class="id" title="var">b</span> | <span class="id" title="var">D1</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span><br/>
&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">int31_rect</span> <span class="id" title="var">_</span> (<span class="id" title="var">nfold_bis</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span> <span class="id" title="var">true</span> <span class="id" title="var">size</span>).<br/>

<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">base</span></span> is <span class="inlinecode">2^31</span>, obtained via iterations of <span class="inlinecode"><span class="id" title="var">Z.double</span></span>.
   It can also be seen as the smallest b &gt; 0 s.t. phi_inv b = 0
   (see below) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">base</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="var">iter_nat</span> <span class="id" title="var">size</span> <span class="id" title="var">Z</span> <span class="id" title="var">Z.double</span> 1%<span class="id" title="var">Z</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab398"></a><h1 class="section">Recursors</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">recl_aux</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>)(<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">case0</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">caserec</span>:<span class="id" title="var">digits</span>-&gt;<span class="id" title="var">int31</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>)<br/>
&nbsp;(<span class="id" title="var">i</span>:<span class="id" title="var">int31</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">O</span> =&gt; <span class="id" title="var">case0</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">next</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">iszero</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">si</span> := <span class="id" title="var">shiftl</span> <span class="id" title="var">i</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">caserec</span> (<span class="id" title="var">firstl</span> <span class="id" title="var">i</span>) <span class="id" title="var">si</span> (<span class="id" title="var">recl_aux</span> <span class="id" title="var">next</span> <span class="id" title="var">A</span> <span class="id" title="var">case0</span> <span class="id" title="var">caserec</span> <span class="id" title="var">si</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">recr_aux</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>)(<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>)(<span class="id" title="var">case0</span>:<span class="id" title="var">A</span>)(<span class="id" title="var">caserec</span>:<span class="id" title="var">digits</span>-&gt;<span class="id" title="var">int31</span>-&gt;<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>)<br/>
&nbsp;(<span class="id" title="var">i</span>:<span class="id" title="var">int31</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">O</span> =&gt; <span class="id" title="var">case0</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">next</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">iszero</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">si</span> := <span class="id" title="var">shiftr</span> <span class="id" title="var">i</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">caserec</span> (<span class="id" title="var">firstr</span> <span class="id" title="var">i</span>) <span class="id" title="var">si</span> (<span class="id" title="var">recr_aux</span> <span class="id" title="var">next</span> <span class="id" title="var">A</span> <span class="id" title="var">case0</span> <span class="id" title="var">caserec</span> <span class="id" title="var">si</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">recl</span> := <span class="id" title="var">recl_aux</span> <span class="id" title="var">size</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">recr</span> := <span class="id" title="var">recr_aux</span> <span class="id" title="var">size</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab399"></a><h1 class="section">Conversions</h1>

<div class="paragraph"> </div>

 From int31 to Z, we simply iterates <span class="inlinecode"><span class="id" title="var">Z.double</span></span> or <span class="inlinecode"><span class="id" title="var">Z.succ_double</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phi</span> : <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">Z</span> :=<br/>
&nbsp;<span class="id" title="var">recr</span> <span class="id" title="var">Z</span> (0%<span class="id" title="var">Z</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span> <span class="id" title="var">D0</span> =&gt; <span class="id" title="var">Z.double</span> | <span class="id" title="var">D1</span> =&gt; <span class="id" title="var">Z.succ_double</span> <span class="id" title="keyword">end</span>).<br/>

<br/>
</div>

<div class="doc">
From positive to int31. An abstract definition could be :
      <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="var">phi_inv</span></span> <span class="inlinecode">(2<span class="id" title="var">n</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">2*(<span class="id" title="var">phi_inv</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> <span class="inlinecode">/\</span>
        <span class="inlinecode"><span class="id" title="var">phi_inv</span></span> <span class="inlinecode">2<span class="id" title="var">n</span>+1</span> <span class="inlinecode">=</span> <span class="inlinecode">2*(<span class="id" title="var">phi_inv</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode"></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">phi_inv_positive</span> <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xI</span> <span class="id" title="var">q</span> =&gt; <span class="id" title="var">twice_plus_one</span> (<span class="id" title="var">phi_inv_positive</span> <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xO</span> <span class="id" title="var">q</span> =&gt; <span class="id" title="var">twice</span> (<span class="id" title="var">phi_inv_positive</span> <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xH</span> =&gt; <span class="id" title="var">In</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The negative part : 2-complement  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">complement_negative</span> <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xI</span> <span class="id" title="var">q</span> =&gt; <span class="id" title="var">twice</span> (<span class="id" title="var">complement_negative</span> <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xO</span> <span class="id" title="var">q</span> =&gt; <span class="id" title="var">twice_plus_one</span> (<span class="id" title="var">complement_negative</span> <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xH</span> =&gt; <span class="id" title="var">twice</span> <span class="id" title="var">Tn</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A simple incrementation function 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">incr</span> : <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> :=<br/>
&nbsp;<span class="id" title="var">recr</span> <span class="id" title="var">int31</span> <span class="id" title="var">In</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">si</span> <span class="id" title="keyword">rec</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D0</span> =&gt; <span class="id" title="var">sneakl</span> <span class="id" title="var">D1</span> <span class="id" title="var">si</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D1</span> =&gt; <span class="id" title="var">sneakl</span> <span class="id" title="var">D0</span> <span class="id" title="keyword">rec</span> <span class="id" title="keyword">end</span>).<br/>

<br/>
</div>

<div class="doc">
We can now define the conversion from Z to int31. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phi_inv</span> : <span class="id" title="var">Z</span> -&gt; <span class="id" title="var">int31</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt;<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;| <span class="id" title="var">Z0</span> =&gt; <span class="id" title="keyword">On</span><br/>
&nbsp;| <span class="id" title="var">Zpos</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">phi_inv_positive</span> <span class="id" title="var">p</span><br/>
&nbsp;| <span class="id" title="var">Zneg</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">incr</span> (<span class="id" title="var">complement_negative</span> <span class="id" title="var">p</span>)<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">phi_inv_nonneg</span></span> returns <span class="inlinecode"><span class="id" title="var">None</span></span> if the <span class="inlinecode"><span class="id" title="var">Z</span></span> is negative; this matches the old behavior of parsing int31 numerals 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phi_inv_nonneg</span> : <span class="id" title="var">Z</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">int31</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt;<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;| <span class="id" title="var">Zneg</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">phi_inv</span> <span class="id" title="var">n</span>)<br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">phi_inv2</span></span> is similar to <span class="inlinecode"><span class="id" title="var">phi_inv</span></span> but returns a double word
    <span class="inlinecode"><span class="id" title="var">zn2z</span></span> <span class="inlinecode"><span class="id" title="var">int31</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phi_inv2</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Z0</span> =&gt; <span class="id" title="var">W0</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">WW</span> (<span class="id" title="var">phi_inv</span> (<span class="id" title="var">n</span>/<span class="id" title="var">base</span>)%<span class="id" title="var">Z</span>) (<span class="id" title="var">phi_inv</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">phi2</span></span> is similar to <span class="inlinecode"><span class="id" title="var">phi</span></span> but takes a double word (two args) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">phi2</span> <span class="id" title="var">nh</span> <span class="id" title="var">nl</span> :=<br/>
&nbsp;&nbsp;((<span class="id" title="var">phi</span> <span class="id" title="var">nh</span>)*<span class="id" title="var">base</span>+(<span class="id" title="var">phi</span> <span class="id" title="var">nl</span>))%<span class="id" title="var">Z</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab400"></a><h1 class="section">Addition</h1>

<div class="paragraph"> </div>

 Addition modulo <span class="inlinecode">2^31</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) := <span class="id" title="var">phi_inv</span> ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)+(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Notation</span> &quot;n + m" := (<span class="id" title="var">add31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Addition with carry (the result is thus exact) 
</div>
<div class="code">

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add31c</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">npm</span> := <span class="id" title="var">n</span>+<span class="id" title="var">m</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">phi</span> <span class="id" title="var">npm</span> ?= (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)+(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>))%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">C0</span> <span class="id" title="var">npm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C1</span> <span class="id" title="var">npm</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;n '+c' m" := (<span class="id" title="var">add31c</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
 Addition plus one with carry (the result is thus exact) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add31carryc</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">npmpone_exact</span> := ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)+(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)+1)%<span class="id" title="var">Z</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">npmpone</span> := <span class="id" title="var">phi_inv</span> <span class="id" title="var">npmpone_exact</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">phi</span> <span class="id" title="var">npmpone</span> ?= <span class="id" title="var">npmpone_exact</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">C0</span> <span class="id" title="var">npmpone</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C1</span> <span class="id" title="var">npmpone</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab401"></a><h1 class="section">Subtraction</h1>

<div class="paragraph"> </div>

 Subtraction modulo <span class="inlinecode">2^31</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sub31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) := <span class="id" title="var">phi_inv</span> ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)-(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Notation</span> &quot;n - m" := (<span class="id" title="var">sub31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Subtraction with carry (thus exact) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sub31c</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">nmm</span> := <span class="id" title="var">n</span>-<span class="id" title="var">m</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">phi</span> <span class="id" title="var">nmm</span> ?= (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)-(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>))%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">C0</span> <span class="id" title="var">nmm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C1</span> <span class="id" title="var">nmm</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;n '-c' m" := (<span class="id" title="var">sub31c</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
subtraction minus one with carry (thus exact) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sub31carryc</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">nmmmone_exact</span> := ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)-(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)-1)%<span class="id" title="var">Z</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">nmmmone</span> := <span class="id" title="var">phi_inv</span> <span class="id" title="var">nmmmone_exact</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">phi</span> <span class="id" title="var">nmmmone</span> ?= <span class="id" title="var">nmmmone_exact</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">C0</span> <span class="id" title="var">nmmmone</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C1</span> <span class="id" title="var">nmmmone</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Opposite 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">opp31</span> <span class="id" title="var">x</span> := <span class="id" title="keyword">On</span> - <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;- x" := (<span class="id" title="var">opp31</span> <span class="id" title="var">x</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Multiplication 
<div class="paragraph"> </div>

 multiplication modulo <span class="inlinecode">2^31</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mul31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) := <span class="id" title="var">phi_inv</span> ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)*(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Notation</span> &quot;n * m" := (<span class="id" title="var">mul31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
multiplication with double word result (thus exact) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mul31c</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) := <span class="id" title="var">phi_inv2</span> ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)*(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Notation</span> &quot;n '*c' m" := (<span class="id" title="var">mul31c</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab402"></a><h1 class="section">Division</h1>

<div class="paragraph"> </div>

 Division of a double size word modulo <span class="inlinecode">2^31</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">div3121</span> (<span class="id" title="var">nh</span> <span class="id" title="var">nl</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">q</span>,<span class="id" title="var">r</span>) := <span class="id" title="var">Z.div_eucl</span> (<span class="id" title="var">phi2</span> <span class="id" title="var">nh</span> <span class="id" title="var">nl</span>) (<span class="id" title="var">phi</span> <span class="id" title="var">m</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">phi_inv</span> <span class="id" title="var">q</span>, <span class="id" title="var">phi_inv</span> <span class="id" title="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
Division modulo <span class="inlinecode">2^31</span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">div31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">q</span>,<span class="id" title="var">r</span>) := <span class="id" title="var">Z.div_eucl</span> (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>) (<span class="id" title="var">phi</span> <span class="id" title="var">m</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">phi_inv</span> <span class="id" title="var">q</span>, <span class="id" title="var">phi_inv</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;n / m" := (<span class="id" title="var">div31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab403"></a><h1 class="section">Unsigned comparison</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">compare31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) := ((<span class="id" title="var">phi</span> <span class="id" title="var">n</span>)?=(<span class="id" title="var">phi</span> <span class="id" title="var">m</span>))%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;n ?= m" := (<span class="id" title="var">compare31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">int31_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eqb31</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">int31</span>) :=<br/>
&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> ?= <span class="id" title="var">m</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">true</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Computing the <span class="inlinecode"><span class="id" title="var">i</span></span>-th iterate of a function:
    <span class="inlinecode"><span class="id" title="var">iter_int31</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">f</span>^<span class="id" title="var">i</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iter_int31</span> <span class="id" title="var">i</span> <span class="id" title="var">A</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">recr</span> (<span class="id" title="var">A</span>-&gt;<span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">si</span> <span class="id" title="keyword">rec</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D0</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="keyword">rec</span> (<span class="id" title="keyword">rec</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D1</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="keyword">rec</span> (<span class="id" title="keyword">rec</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span>.<br/>

<br/>
</div>

<div class="doc">
Combining the <span class="inlinecode">(31-<span class="id" title="var">p</span>)</span> low bits of <span class="inlinecode"><span class="id" title="var">i</span></span> above the <span class="inlinecode"><span class="id" title="var">p</span></span> high bits of <span class="inlinecode"><span class="id" title="var">j</span></span>:
    <span class="inlinecode"><span class="id" title="var">addmuldiv31</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">i</span>*2^<span class="id" title="var">p</span>+<span class="id" title="var">j</span>/2^(31-<span class="id" title="var">p</span>)</span>  (modulo <span class="inlinecode">2^31</span>) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">addmuldiv31</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> :=<br/>
&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">res</span>, <span class="id" title="var">_</span> ) :=<br/>
&nbsp;<span class="id" title="var">iter_int31</span> <span class="id" title="var">p</span> (<span class="id" title="var">int31</span>*<span class="id" title="var">int31</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">ij</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">i</span>,<span class="id" title="var">j</span>) := <span class="id" title="var">ij</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">sneakl</span> (<span class="id" title="var">firstl</span> <span class="id" title="var">j</span>) <span class="id" title="var">i</span>, <span class="id" title="var">shiftl</span> <span class="id" title="var">j</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span>,<span class="id" title="var">j</span>)<br/>
&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;<span class="id" title="var">res</span>.<br/>

<br/>
</div>

<div class="doc">
Bitwise operations 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">lor31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> := <span class="id" title="var">phi_inv</span> (<span class="id" title="var">Z.lor</span> (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>) (<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">land31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> := <span class="id" title="var">phi_inv</span> (<span class="id" title="var">Z.land</span> (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>) (<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">lxor31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> := <span class="id" title="var">phi_inv</span> (<span class="id" title="var">Z.lxor</span> (<span class="id" title="var">phi</span> <span class="id" title="var">n</span>) (<span class="id" title="var">phi</span> <span class="id" title="var">m</span>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">lnot31</span> <span class="id" title="var">n</span> := <span class="id" title="var">lxor31</span> <span class="id" title="var">Tn</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ldiff31</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> := <span class="id" title="var">land31</span> <span class="id" title="var">n</span> (<span class="id" title="var">lnot31</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">euler</span> (<span class="id" title="var">guard</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span>:<span class="id" title="var">int31</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">guard</span>} :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">guard</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> =&gt; <span class="id" title="var">In</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">j</span> ?= <span class="id" title="keyword">On</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">euler</span> <span class="id" title="var">p</span> <span class="id" title="var">j</span> (<span class="id" title="keyword">let</span> (<span class="id" title="var">_</span>, <span class="id" title="var">r</span> ) := <span class="id" title="var">i</span>/<span class="id" title="var">j</span> <span class="id" title="tactic">in</span> <span class="id" title="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">gcd31</span> (<span class="id" title="var">i</span> <span class="id" title="var">j</span>:<span class="id" title="var">int31</span>) := <span class="id" title="var">euler</span> (2*<span class="id" title="var">size</span>)%<span class="id" title="var">nat</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>.<br/>

<br/>
</div>

<div class="doc">
Square root functions using newton iteration
    we use a very naive upper-bound on the iteration
    2^31 instead of the usual 31.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sqrt31_step</span> (<span class="id" title="keyword">rec</span>: <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span>: <span class="id" title="var">int31</span>)  :=<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">lazy</span> <span class="id" title="keyword">delta</span> [<span class="id" title="var">Twon</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">quo</span>,<span class="id" title="var">_</span>) := <span class="id" title="var">i</span>/<span class="id" title="var">j</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">quo</span> ?= <span class="id" title="var">j</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Lt</span> =&gt; <span class="id" title="keyword">rec</span> <span class="id" title="var">i</span> (<span class="id" title="var">fst</span> ((<span class="id" title="var">j</span> + <span class="id" title="var">quo</span>)/<span class="id" title="var">Twon</span>))<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt;  <span class="id" title="var">j</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">iter31_sqrt</span> (<span class="id" title="var">n</span>: <span class="id" title="var">nat</span>) (<span class="id" title="keyword">rec</span>: <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">i</span> <span class="id" title="var">j</span>: <span class="id" title="var">int31</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">n</span>} : <span class="id" title="var">int31</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">sqrt31_step</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O</span> =&gt;  <span class="id" title="keyword">rec</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; (<span class="id" title="var">iter31_sqrt</span> <span class="id" title="var">n</span> (<span class="id" title="var">iter31_sqrt</span> <span class="id" title="var">n</span> <span class="id" title="keyword">rec</span>))<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) <span class="id" title="var">i</span> <span class="id" title="var">j</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sqrt31</span> <span class="id" title="var">i</span> :=<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">lazy</span> <span class="id" title="keyword">delta</span> [<span class="id" title="keyword">On</span> <span class="id" title="var">In</span> <span class="id" title="var">Twon</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">compare31</span> <span class="id" title="var">In</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gt</span> =&gt; <span class="id" title="keyword">On</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">In</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Lt</span> =&gt; <span class="id" title="var">iter31_sqrt</span> 31 (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> =&gt; <span class="id" title="var">j</span>) <span class="id" title="var">i</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">i</span>/<span class="id" title="var">Twon</span>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">v30</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">addmuldiv31</span> (<span class="id" title="var">phi_inv</span> (<span class="id" title="var">Z.of_nat</span> <span class="id" title="var">size</span> - 1)) <span class="id" title="var">In</span> <span class="id" title="keyword">On</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sqrt312_step</span> (<span class="id" title="keyword">rec</span>: <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">j</span>: <span class="id" title="var">int31</span>)  :=<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">lazy</span> <span class="id" title="keyword">delta</span> [<span class="id" title="var">Twon</span> <span class="id" title="var">v30</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ih</span> ?= <span class="id" title="var">j</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Eq</span> =&gt; <span class="id" title="var">j</span> | <span class="id" title="var">Gt</span> =&gt; <span class="id" title="var">j</span> | <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">quo</span>,<span class="id" title="var">_</span>) := <span class="id" title="var">div3121</span> <span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">j</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">quo</span> ?= <span class="id" title="var">j</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Lt</span> =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">m</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">j</span> +<span class="id" title="var">c</span> <span class="id" title="var">quo</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C0</span> <span class="id" title="var">m1</span> =&gt; <span class="id" title="var">fst</span> (<span class="id" title="var">m1</span>/<span class="id" title="var">Twon</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">C1</span> <span class="id" title="var">m1</span> =&gt; <span class="id" title="var">fst</span> (<span class="id" title="var">m1</span>/<span class="id" title="var">Twon</span>) + <span class="id" title="var">v30</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt;  <span class="id" title="var">j</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">iter312_sqrt</span> (<span class="id" title="var">n</span>: <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">rec</span>: <span class="id" title="var">int31</span>  -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span> -&gt; <span class="id" title="var">int31</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">j</span>: <span class="id" title="var">int31</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">n</span>} : <span class="id" title="var">int31</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">sqrt312_step</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O</span> =&gt;  <span class="id" title="keyword">rec</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; (<span class="id" title="var">iter312_sqrt</span> <span class="id" title="var">n</span> (<span class="id" title="var">iter312_sqrt</span> <span class="id" title="var">n</span> <span class="id" title="keyword">rec</span>))<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) <span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">j</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sqrt312</span> <span class="id" title="var">ih</span> <span class="id" title="var">il</span> :=<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">lazy</span> <span class="id" title="keyword">delta</span> [<span class="id" title="keyword">On</span> <span class="id" title="var">In</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">s</span> := <span class="id" title="var">iter312_sqrt</span> 31 (<span class="id" title="keyword">fun</span> <span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">j</span> =&gt; <span class="id" title="var">j</span>) <span class="id" title="var">ih</span> <span class="id" title="var">il</span> <span class="id" title="var">Tn</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">s</span> *<span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">W0</span> =&gt; (<span class="id" title="keyword">On</span>, <span class="id" title="var">C0</span> <span class="id" title="keyword">On</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">WW</span> <span class="id" title="var">ih1</span> <span class="id" title="var">il1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">il</span> -<span class="id" title="var">c</span> <span class="id" title="var">il1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C0</span> <span class="id" title="var">il2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ih</span> ?= <span class="id" title="var">ih1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gt</span> =&gt; (<span class="id" title="var">s</span>, <span class="id" title="var">C1</span> <span class="id" title="var">il2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>  =&gt; (<span class="id" title="var">s</span>, <span class="id" title="var">C0</span> <span class="id" title="var">il2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">C1</span> <span class="id" title="var">il2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">ih</span> - <span class="id" title="var">In</span>) ?= <span class="id" title="var">ih1</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Gt</span> =&gt; (<span class="id" title="var">s</span>, <span class="id" title="var">C1</span> <span class="id" title="var">il2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>  =&gt; (<span class="id" title="var">s</span>, <span class="id" title="var">C0</span> <span class="id" title="var">il2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">p2i</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span> : (<span class="id" title="var">N</span>*<span class="id" title="var">int31</span>)%<span class="id" title="keyword">type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> =&gt; (<span class="id" title="var">Npos</span> <span class="id" title="var">p</span>, <span class="id" title="keyword">On</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xO</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">r</span>,<span class="id" title="var">i</span>) := <span class="id" title="var">p2i</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">r</span>, <span class="id" title="var">Twon</span>*<span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xI</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">r</span>,<span class="id" title="var">i</span>) := <span class="id" title="var">p2i</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">r</span>, <span class="id" title="var">Twon</span>*<span class="id" title="var">i</span>+<span class="id" title="var">In</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">xH</span> =&gt; (<span class="id" title="var">N0</span>, <span class="id" title="var">In</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">positive_to_int31</span> (<span class="id" title="var">p</span>:<span class="id" title="var">positive</span>) := <span class="id" title="var">p2i</span> <span class="id" title="var">size</span> <span class="id" title="var">p</span>.<br/>

<br/>
</div>

<div class="doc">
Constant 31 converted into type int31.
    It is used as default answer for numbers of zeros
    in <span class="inlinecode"><span class="id" title="var">head0</span></span> and <span class="inlinecode"><span class="id" title="var">tail0</span></span> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">T31</span> : <span class="id" title="var">int31</span> := <span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">phi_inv</span> (<span class="id" title="var">Z.of_nat</span> <span class="id" title="var">size</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">head031</span> (<span class="id" title="var">i</span>:<span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">recl</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">T31</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">si</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D0</span> =&gt; <span class="id" title="keyword">rec</span> (<span class="id" title="var">add31</span> <span class="id" title="var">n</span> <span class="id" title="var">In</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D1</span> =&gt; <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> <span class="id" title="keyword">On</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">tail031</span> (<span class="id" title="var">i</span>:<span class="id" title="var">int31</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">recr</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">T31</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">si</span> <span class="id" title="keyword">rec</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D0</span> =&gt; <span class="id" title="keyword">rec</span> (<span class="id" title="var">add31</span> <span class="id" title="var">n</span> <span class="id" title="var">In</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">D1</span> =&gt; <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> <span class="id" title="keyword">On</span>.<br/>

<br/>
</div>
    <div id="sidebarWrapper">
      <div id="sidebar">
        <div class="block">
          <h2 class="title">Navigation</h2>
          <div class="content">
            <ul class="menu">
              <li class="leaf">Standard Library
                <ul class="menu">
                  <li><a href="index.html">Table of contents</a></li>
                  <li><a href="genindex.html">Index</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="footer">
    <div id="nav-footer">
      <ul class="links-menu-footer">
        <li><a href="mailto:coq-www_@_inria.fr">webmaster</a></li>
        <li><a href="http://validator.w3.org/">xhtml valid</a></li>
        <li><a href="http://jigsaw.w3.org/css-validator/">CSS valid</a></li>
      </ul>
    </div>
  </div>

</div>

</body>
</html>
