<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Declare (rocq-runtime.Declare)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">rocq-runtime</a> &#x00BB; Declare</nav><header class="odoc-preamble"><h1>Module <code><span>Declare</span></code></h1><p>This module provides the functions to declare new variables, parameters, constants and inductive types in the global environment. It also updates some accessory tables such as <code>Nametab</code> (name resolution), <code>Impargs</code>, and <code>Notations</code>.</p></header><nav class="odoc-toc"><ul><li><a href="#one-go,-non-interactive-declaration-api">One-go, non-interactive declaration API</a></li><li><a href="#declaration-of-interactive-constants">Declaration of interactive constants</a></li><li><a href="#low-level,-internal-api,-avoid-using-unless-you-have-special-needs">low-level, internal API, avoid using unless you have special needs</a></li><li><a href="#program-mode-api">Program mode API</a></li><li><a href="#"></a></li><li><a href="#_2"></a><ul><li><a href="#for-internal-support,-do-not-use">For internal support, do not use</a></li></ul></li></ul></nav><div class="odoc-content"><p>We provide three main entry points:</p><ul><li>one-go functions, that will register a constant in one go, suited for non-interactive definitions where the term is given.</li></ul><ul><li>two-phase <code>start/save</code> functions which will create an interactive proof, allow its modification using tactics, and saving when complete.</li></ul><ul><li>program mode API, that allow to declare a constant with holes, to be fullfilled later.</li></ul><p>Note that the API in this file is still in a state of flux, don't hesitate to contact the maintainers if you have any question.</p><p>Additionally, this file does contain some low-level functions, marked as such; these functions are unstable and should not be used unless you already know what they are doing.</p><div class="odoc-spec"><div class="spec module" id="module-Hook" class="anchored"><a href="#module-Hook" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Hook/index.html">Hook</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Declaration hooks, to be run when a constant is saved. Use with care, as imperative effects may become not supported in the future.</p></div></div><h3 id="one-go,-non-interactive-declaration-api"><a href="#one-go,-non-interactive-declaration-api" class="anchor"></a>One-go, non-interactive declaration API</h3><div class="odoc-spec"><div class="spec module" id="module-CInfo" class="anchored"><a href="#module-CInfo" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="CInfo/index.html">CInfo</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Information for a single top-level named constant</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Info" class="anchored"><a href="#module-Info" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Info/index.html">Info</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Information for a declaration, interactive or not, includes parameters shared by mutual constants</p></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_definition" class="anchored"><a href="#val-declare_definition" class="anchor"></a><code><span><span class="keyword">val</span> declare_definition : <span>info:<a href="Info/index.html#type-t">Info.t</a> <span class="arrow">&#45;&gt;</span></span> <span>cinfo:<span><span><a href="../EConstr/index.html#type-t">EConstr.t</a> option</span> <a href="CInfo/index.html#type-t">CInfo.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>opaque:bool <span class="arrow">&#45;&gt;</span></span> <span>body:<a href="../EConstr/index.html#type-t">EConstr.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?using:<a href="../Vernacexpr/index.html#type-section_subset_expr">Vernacexpr.section_subset_expr</a> <span class="arrow">&#45;&gt;</span></span>
<span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a></span></code></div><div class="spec-doc"><p>Declares a non-interactive constant; <code>body</code> and <code>types</code> will be normalized w.r.t. the passed <code>evar_map</code> <code>sigma</code>. Universes should be handled properly, including minimization and restriction. Note that <code>sigma</code> is checked for unresolved evars, thus you should be careful not to submit open terms</p></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_mutual_definitions" class="anchored"><a href="#val-declare_mutual_definitions" class="anchor"></a><code><span><span class="keyword">val</span> declare_mutual_definitions : <span>info:<a href="Info/index.html#type-t">Info.t</a> <span class="arrow">&#45;&gt;</span></span> <span>cinfo:<span><span><a href="../Constr/index.html#type-t">Constr.t</a> <a href="CInfo/index.html#type-t">CInfo.t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>opaque:bool <span class="arrow">&#45;&gt;</span></span> <span>uctx:<a href="../UState/index.html#type-t">UState.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>bodies:<span><a href="../Constr/index.html#type-t">Constr.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>possible_guard:<span>(<a href="../Pretyping/index.html#type-possible_guard">Pretyping.possible_guard</a> * <span><a href="../Sorts/index.html#type-relevance">Sorts.relevance</a> list</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>?using:<a href="../Vernacexpr/index.html#type-section_subset_expr">Vernacexpr.section_subset_expr</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> list</span></span></code></div></div><h3 id="declaration-of-interactive-constants"><a href="#declaration-of-interactive-constants" class="anchor"></a>Declaration of interactive constants</h3><div class="odoc-spec"><div class="spec module" id="module-OblState" class="anchored"><a href="#module-OblState" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="OblState/index.html">OblState</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>save</code> / <code>save_admitted</code> can update obligations state, so we need to expose the state here</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Proof" class="anchored"><a href="#module-Proof" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Proof/index.html">Proof</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Declare.Proof.t</code> Construction of constants using interactive proofs.</p></div></div><h3 id="low-level,-internal-api,-avoid-using-unless-you-have-special-needs"><a href="#low-level,-internal-api,-avoid-using-unless-you-have-special-needs" class="anchor"></a>low-level, internal API, avoid using unless you have special needs</h3><div class="odoc-spec"><div class="spec type" id="type-proof_entry" class="anchored"><a href="#type-proof_entry" class="anchor"></a><code><span><span class="keyword">type</span> proof_entry</span></code></div><div class="spec-doc"><p>Proof entries represent a proof that has been finished, but still not registered with the kernel.</p><p>XXX: This is an internal, low-level API and could become scheduled for removal from the public API, use higher-level declare APIs instead</p></div></div><div class="odoc-spec"><div class="spec type" id="type-parameter_entry" class="anchored"><a href="#type-parameter_entry" class="anchor"></a><code><span><span class="keyword">type</span> parameter_entry</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-primitive_entry" class="anchored"><a href="#type-primitive_entry" class="anchor"></a><code><span><span class="keyword">type</span> primitive_entry</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-symbol_entry" class="anchored"><a href="#type-symbol_entry" class="anchor"></a><code><span><span class="keyword">type</span> symbol_entry</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-definition_entry" class="anchored"><a href="#val-definition_entry" class="anchor"></a><code><span><span class="keyword">val</span> definition_entry : <span>?opaque:bool <span class="arrow">&#45;&gt;</span></span> <span>?using:<a href="../Names/Id/Set/index.html#type-t">Names.Id.Set.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?inline:bool <span class="arrow">&#45;&gt;</span></span> <span>?types:<a href="../Constr/index.html#type-types">Constr.types</a> <span class="arrow">&#45;&gt;</span></span> <span>?univs:<a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a> <span class="arrow">&#45;&gt;</span></span>
<span><a href="../Constr/index.html#type-constr">Constr.constr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-proof_entry">proof_entry</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-parameter_entry" class="anchored"><a href="#val-parameter_entry" class="anchor"></a><code><span><span class="keyword">val</span> parameter_entry : <span>?inline:int <span class="arrow">&#45;&gt;</span></span> <span>?univs:<a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-constr">Constr.constr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-parameter_entry">parameter_entry</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-primitive_entry" class="anchored"><a href="#val-primitive_entry" class="anchor"></a><code><span><span class="keyword">val</span> primitive_entry : <span>?types:<span>(<a href="../Constr/index.html#type-types">Constr.types</a> * <a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../CPrimitives/index.html#type-op_or_type">CPrimitives.op_or_type</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-primitive_entry">primitive_entry</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-symbol_entry" class="anchored"><a href="#val-symbol_entry" class="anchor"></a><code><span><span class="keyword">val</span> symbol_entry : <span>?univs:<a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a> <span class="arrow">&#45;&gt;</span></span> <span>unfold_fix:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-types">Constr.types</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-symbol_entry">symbol_entry</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_entry" class="anchored"><a href="#val-declare_entry" class="anchor"></a><code><span><span class="keyword">val</span> declare_entry : <span>?loc:<a href="../Loc/index.html#type-t">Loc.t</a> <span class="arrow">&#45;&gt;</span></span> <span>name:<a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?scope:<a href="../Locality/index.html#type-definition_scope">Locality.definition_scope</a> <span class="arrow">&#45;&gt;</span></span> <span>kind:<a href="../Decls/index.html#type-logical_kind">Decls.logical_kind</a> <span class="arrow">&#45;&gt;</span></span> <span>?user_warns:<span><a href="../Globnames/index.html#type-extended_global_reference">Globnames.extended_global_reference</a> <a href="../UserWarn/index.html#type-with_qf">UserWarn.with_qf</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?hook:<a href="Hook/index.html#type-t">Hook.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>impargs:<a href="../Impargs/index.html#type-manual_implicits">Impargs.manual_implicits</a> <span class="arrow">&#45;&gt;</span></span> <span>uctx:<a href="../UState/index.html#type-t">UState.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-proof_entry">proof_entry</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a></span></code></div><div class="spec-doc"><p>XXX: This is an internal, low-level API and could become scheduled for removal from the public API, use higher-level declare APIs instead</p></div></div><div class="odoc-spec"><div class="spec type" id="type-variable_declaration" class="anchored"><a href="#type-variable_declaration" class="anchor"></a><code><span><span class="keyword">type</span> variable_declaration</span><span> = </span></code><table><tr id="type-variable_declaration.SectionLocalDef" class="anchored"><td class="def variant constructor"><a href="#type-variable_declaration.SectionLocalDef" class="anchor"></a><code><span>| </span><span><span class="constructor">SectionLocalDef</span> <span class="keyword">of</span> </span><span>{</span></code><table><tr id="type-variable_declaration.clearbody" class="anchored"><td class="def record field"><a href="#type-variable_declaration.clearbody" class="anchor"></a><code><span>clearbody : bool;</span></code></td></tr><tr id="type-variable_declaration.entry" class="anchored"><td class="def record field"><a href="#type-variable_declaration.entry" class="anchor"></a><code><span>entry : <a href="#type-proof_entry">proof_entry</a>;</span></code></td></tr></table><code><span>}</span></code></td></tr><tr id="type-variable_declaration.SectionLocalAssum" class="anchored"><td class="def variant constructor"><a href="#type-variable_declaration.SectionLocalAssum" class="anchor"></a><code><span>| </span><span><span class="constructor">SectionLocalAssum</span> <span class="keyword">of</span> </span><span>{</span></code><table><tr id="type-variable_declaration.typ" class="anchored"><td class="def record field"><a href="#type-variable_declaration.typ" class="anchor"></a><code><span>typ : <a href="../Constr/index.html#type-types">Constr.types</a>;</span></code></td></tr><tr id="type-variable_declaration.impl" class="anchored"><td class="def record field"><a href="#type-variable_declaration.impl" class="anchor"></a><code><span>impl : <a href="../Glob_term/index.html#type-binding_kind">Glob_term.binding_kind</a>;</span></code></td></tr><tr id="type-variable_declaration.univs" class="anchored"><td class="def record field"><a href="#type-variable_declaration.univs" class="anchor"></a><code><span>univs : <a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a>;</span></code></td></tr></table><code><span>}</span></code></td></tr></table></div><div class="spec-doc"><p>Declaration of section variables and local definitions</p></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_variable" class="anchored"><a href="#val-declare_variable" class="anchor"></a><code><span><span class="keyword">val</span> declare_variable : <span>name:<a href="../Names/index.html#type-variable">Names.variable</a> <span class="arrow">&#45;&gt;</span></span> <span>kind:<a href="../Decls/index.html#type-logical_kind">Decls.logical_kind</a> <span class="arrow">&#45;&gt;</span></span> <span>typing_flags:<span><a href="../Declarations/index.html#type-typing_flags">Declarations.typing_flags</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-variable_declaration">variable_declaration</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Declaration of local constructions (Variable/Hypothesis/Local)</p></div></div><div class="odoc-spec"><div class="spec type" id="type-constant_entry" class="anchored"><a href="#type-constant_entry" class="anchor"></a><code><span><span class="keyword">type</span> constant_entry</span><span> = </span></code><table><tr id="type-constant_entry.DefinitionEntry" class="anchored"><td class="def variant constructor"><a href="#type-constant_entry.DefinitionEntry" class="anchor"></a><code><span>| </span><span><span class="constructor">DefinitionEntry</span> <span class="keyword">of</span> <a href="#type-proof_entry">proof_entry</a></span></code></td></tr><tr id="type-constant_entry.ParameterEntry" class="anchored"><td class="def variant constructor"><a href="#type-constant_entry.ParameterEntry" class="anchor"></a><code><span>| </span><span><span class="constructor">ParameterEntry</span> <span class="keyword">of</span> <a href="#type-parameter_entry">parameter_entry</a></span></code></td></tr><tr id="type-constant_entry.PrimitiveEntry" class="anchored"><td class="def variant constructor"><a href="#type-constant_entry.PrimitiveEntry" class="anchor"></a><code><span>| </span><span><span class="constructor">PrimitiveEntry</span> <span class="keyword">of</span> <a href="#type-primitive_entry">primitive_entry</a></span></code></td></tr><tr id="type-constant_entry.SymbolEntry" class="anchored"><td class="def variant constructor"><a href="#type-constant_entry.SymbolEntry" class="anchor"></a><code><span>| </span><span><span class="constructor">SymbolEntry</span> <span class="keyword">of</span> <a href="#type-symbol_entry">symbol_entry</a></span></code></td></tr></table></div><div class="spec-doc"><p>Declaration of global constructions i.e. Definition/Theorem/Axiom/Parameter/...</p><p>XXX: This is an internal, low-level API and could become scheduled for removal from the public API, use higher-level declare APIs instead</p></div></div><div class="odoc-spec"><div class="spec value" id="val-prepare_parameter" class="anchored"><a href="#val-prepare_parameter" class="anchor"></a><code><span><span class="keyword">val</span> prepare_parameter : <span>poly:bool <span class="arrow">&#45;&gt;</span></span> <span>udecl:<a href="../UState/index.html#type-universe_decl">UState.universe_decl</a> <span class="arrow">&#45;&gt;</span></span> <span>types:<a href="../EConstr/index.html#type-types">EConstr.types</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> * <a href="#type-parameter_entry">parameter_entry</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_constant" class="anchored"><a href="#val-declare_constant" class="anchor"></a><code><span><span class="keyword">val</span> declare_constant : <span>?loc:<a href="../Loc/index.html#type-t">Loc.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?local:<a href="../Locality/index.html#type-import_status">Locality.import_status</a> <span class="arrow">&#45;&gt;</span></span> <span>name:<a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>kind:<a href="../Decls/index.html#type-logical_kind">Decls.logical_kind</a> <span class="arrow">&#45;&gt;</span></span> <span>?typing_flags:<a href="../Declarations/index.html#type-typing_flags">Declarations.typing_flags</a> <span class="arrow">&#45;&gt;</span></span>
<span>?user_warns:<span><a href="../Globnames/index.html#type-extended_global_reference">Globnames.extended_global_reference</a> <a href="../UserWarn/index.html#type-with_qf">UserWarn.with_qf</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constant_entry">constant_entry</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/Constant/index.html#type-t">Names.Constant.t</a></span></code></div><div class="spec-doc"><p><code>declare_constant id cd</code> declares a global declaration (constant/parameter) with name <code>id</code> in the current section; it returns the full path of the declaration</p><p>XXX: This is an internal, low-level API and could become scheduled for removal from the public API, use higher-level declare APIs instead</p></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_definition_full" class="anchored"><a href="#val-declare_definition_full" class="anchor"></a><code><span><span class="keyword">val</span> declare_definition_full : <span>info:<a href="Info/index.html#type-t">Info.t</a> <span class="arrow">&#45;&gt;</span></span> <span>cinfo:<span><span><a href="../EConstr/index.html#type-t">EConstr.t</a> option</span> <a href="CInfo/index.html#type-t">CInfo.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>opaque:bool <span class="arrow">&#45;&gt;</span></span> <span>body:<a href="../EConstr/index.html#type-t">EConstr.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>?using:<a href="../Vernacexpr/index.html#type-section_subset_expr">Vernacexpr.section_subset_expr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> * <a href="../Univ/ContextSet/index.html#type-t">Univ.ContextSet.t</a></span></code></div><div class="spec-doc"><p>Like <code>declare_definition</code> but also returns the universes and universe constraints added to the global environment</p></div></div><p>Declaration messages, for internal use</p><div class="odoc-spec"><div class="spec value" id="val-definition_message" class="anchored"><a href="#val-definition_message" class="anchor"></a><code><span><span class="keyword">val</span> definition_message : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>XXX: Scheduled for removal from public API, do not use</p></div></div><div class="odoc-spec"><div class="spec value" id="val-assumption_message" class="anchored"><a href="#val-assumption_message" class="anchor"></a><code><span><span class="keyword">val</span> assumption_message : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fixpoint_message" class="anchored"><a href="#val-fixpoint_message" class="anchor"></a><code><span><span class="keyword">val</span> fixpoint_message : <span><span><span>int array</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-check_exists" class="anchored"><a href="#val-check_exists" class="anchor"></a><code><span><span class="keyword">val</span> check_exists : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-build_by_tactic" class="anchored"><a href="#val-build_by_tactic" class="anchor"></a><code><span><span class="keyword">val</span> build_by_tactic : <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span> <span>uctx:<a href="../UState/index.html#type-t">UState.t</a> <span class="arrow">&#45;&gt;</span></span> <span>poly:bool <span class="arrow">&#45;&gt;</span></span> <span>typ:<a href="../EConstr/index.html#type-types">EConstr.types</a> <span class="arrow">&#45;&gt;</span></span>
<span><span>unit <a href="../Proofview/index.html#type-tactic">Proofview.tactic</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Constr/index.html#type-constr">Constr.constr</a> * <span><a href="../Constr/index.html#type-types">Constr.types</a> option</span> * <a href="../UState/index.html#type-named_universes_entry">UState.named_universes_entry</a> * bool * <a href="../UState/index.html#type-t">UState.t</a></span></code></div><div class="spec-doc"><p>Semantics of this function is a bit dubious, use with care</p></div></div><h3 id="program-mode-api"><a href="#program-mode-api" class="anchor"></a>Program mode API</h3><p>Coq's Program mode support. This mode extends declarations of constants and fixpoints with <code>Program Definition</code> and <code>Program
   Fixpoint</code> to support incremental construction of terms using delayed proofs, called &quot;obligations&quot;</p><p>The mode also provides facilities for managing and auto-solving sets of obligations.</p><p>The basic code flow of programs/obligations is as follows:</p><ul><li><code>add_definition</code> / <code>add_mutual_definitions</code> are called from the respective <code>Program</code> vernacular command interpretation; at this point the only extra work we do is to prepare the new definition <code>d</code> using <code>RetrieveObl</code>, which consists in turning unsolved evars into obligations. <code>d</code> is not sent to the kernel yet, as it is not complete and cannot be typchecked, but saved in a special data-structure. Auto-solving of obligations is tried at this stage (see below)</li></ul><ul><li><code>next_obligation</code> will retrieve the next obligation (<code>RetrieveObl</code> sorts them by topological order) and will try to solve it. When all obligations are solved, the original constant <code>d</code> is grounded and sent to the kernel for addition to the global environment. Auto-solving of obligations is also triggered on obligation completion.</li></ul><h3 id=""><a href="#" class="anchor"></a></h3><p>Solving of obligations: Solved obligations are stored as regular global declarations in the global environment, usually with name <code>constant_obligation_number</code> where <code>constant</code> is the original <code>constant</code> and <code>number</code> is the corresponding (internal) number.</p><p>Solving an obligation can trigger a bit of a complex cascaded callback path; closing an obligation can indeed allow all other obligations to be closed, which in turn may trigged the declaration of the original constant. Care must be taken, as this can modify <code>Global.env</code> in arbitrarily ways. Current code takes some care to refresh the <code>env</code> in the proper boundaries, but the invariants remain delicate.</p><h3 id="_2"><a href="#_2" class="anchor"></a></h3><p>Saving of obligations: as open obligations use the regular proof mode, a `Qed` will call `Lemmas.save_lemma` first. For this reason obligations code is split in two: this file, <code>Obligations</code>, taking care of the top-level vernac commands, and <code>Declare</code>, which is called by `Lemmas` to close an obligation proof and eventually to declare the top-level <code>Program</code>ed constant.</p><div class="odoc-spec"><div class="spec module" id="module-Obls" class="anchored"><a href="#module-Obls" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Obls/index.html">Obls</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_local_constant" class="anchored"><a href="#val-is_local_constant" class="anchor"></a><code><span><span class="keyword">val</span> is_local_constant : <span><a href="../Names/Constant/index.html#type-t">Names.Constant.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h6 id="for-internal-support,-do-not-use"><a href="#for-internal-support,-do-not-use" class="anchor"></a>For internal support, do not use</h6><div class="odoc-spec"><div class="spec module" id="module-Internal" class="anchored"><a href="#module-Internal" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Internal/index.html">Internal</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>