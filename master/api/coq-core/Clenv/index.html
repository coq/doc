<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Clenv (coq-core.Clenv)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">coq-core</a> &#x00BB; Clenv</nav><header class="odoc-preamble"><h1>Module <code><span>Clenv</span></code></h1><p>This file defines clausenv, which is a deprecated way to handle open terms in the proof engine. Most of the API here is legacy except for the evar-based clauses.</p></header><nav class="odoc-toc"><ul><li><a href="#the-type-of-constructions-clausale-environments.">The Type of Constructions clausale environments.</a></li><li><a href="#linking-of-clenvs">linking of clenvs</a></li><li><a href="#unification-with-clenvs">Unification with clenvs</a></li><li><a href="#bindings">Bindings</a></li><li><a href="#clenv-tactics">Clenv tactics</a></li><li><a href="#evar-based-clauses">Evar-based clauses</a></li></ul></nav><div class="odoc-content"><h6 id="the-type-of-constructions-clausale-environments."><a href="#the-type-of-constructions-clausale-environments." class="anchor"></a>The Type of Constructions clausale environments.</h6><div class="odoc-spec"><div class="spec type" id="type-clausenv" class="anchored"><a href="#type-clausenv" class="anchor"></a><code><span><span class="keyword">type</span> clausenv</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_evd" class="anchored"><a href="#val-clenv_evd" class="anchor"></a><code><span><span class="keyword">val</span> clenv_evd : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Evd/index.html#type-evar_map">Evd.evar_map</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_templtyp" class="anchored"><a href="#val-clenv_templtyp" class="anchor"></a><code><span><span class="keyword">val</span> clenv_templtyp : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <a href="../Evd/index.html#type-freelisted">Evd.freelisted</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-update_clenv_evd" class="anchored"><a href="#val-update_clenv_evd" class="anchor"></a><code><span><span class="keyword">val</span> update_clenv_evd : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_convert_val" class="anchored"><a href="#val-clenv_convert_val" class="anchor"></a><code><span><span class="keyword">val</span> clenv_convert_val : 
  <span><span>( <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Evd/index.html#type-econstr">Evd.econstr</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Evd/index.html#type-econstr">Evd.econstr</a> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_refresh" class="anchored"><a href="#val-clenv_refresh" class="anchor"></a><code><span><span class="keyword">val</span> clenv_refresh : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Univ/ContextSet/index.html#type-t">Univ.ContextSet.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_arguments" class="anchored"><a href="#val-clenv_arguments" class="anchor"></a><code><span><span class="keyword">val</span> clenv_arguments : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_value" class="anchored"><a href="#val-clenv_value" class="anchor"></a><code><span><span class="keyword">val</span> clenv_value : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <a href="../EConstr/index.html#type-constr">EConstr.constr</a></span></code></div><div class="spec-doc"><p>subject of clenv (instantiated)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_type" class="anchored"><a href="#val-clenv_type" class="anchor"></a><code><span><span class="keyword">val</span> clenv_type : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <a href="../EConstr/index.html#type-types">EConstr.types</a></span></code></div><div class="spec-doc"><p>type of clenv (instantiated)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_meta_type" class="anchored"><a href="#val-clenv_meta_type" class="anchor"></a><code><span><span class="keyword">val</span> clenv_meta_type : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> <span class="arrow">&#45;&gt;</span></span> <a href="../EConstr/index.html#type-types">EConstr.types</a></span></code></div><div class="spec-doc"><p>type of a meta in clenv context</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_clenv_from" class="anchored"><a href="#val-mk_clenv_from" class="anchor"></a><code><span><span class="keyword">val</span> mk_clenv_from : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../EConstr/index.html#type-constr">EConstr.constr</a> * <a href="../EConstr/index.html#type-types">EConstr.types</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_clenv_from_n" class="anchored"><a href="#val-mk_clenv_from_n" class="anchor"></a><code><span><span class="keyword">val</span> mk_clenv_from_n : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../EConstr/index.html#type-constr">EConstr.constr</a> * <a href="../EConstr/index.html#type-types">EConstr.types</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><h6 id="linking-of-clenvs"><a href="#linking-of-clenvs" class="anchor"></a>linking of clenvs</h6><div class="odoc-spec"><div class="spec value" id="val-clenv_instantiate" class="anchored"><a href="#val-clenv_instantiate" class="anchor"></a><code><span><span class="keyword">val</span> clenv_instantiate : 
  <span>?flags:<a href="../Unification/index.html#type-unify_flags">Unification.unify_flags</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../EConstr/index.html#type-constr">EConstr.constr</a> * <a href="../EConstr/index.html#type-types">EConstr.types</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><h6 id="unification-with-clenvs"><a href="#unification-with-clenvs" class="anchor"></a>Unification with clenvs</h6><div class="odoc-spec"><div class="spec value" id="val-clenv_unify" class="anchored"><a href="#val-clenv_unify" class="anchor"></a><code><span><span class="keyword">val</span> clenv_unify : 
  <span>?flags:<a href="../Unification/index.html#type-unify_flags">Unification.unify_flags</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-conv_pb">Evd.conv_pb</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div><div class="spec-doc"><p>Unifies two terms in a clenv. The boolean is <code>allow_K</code> (see <code>Unification</code>)</p></div></div><h6 id="bindings"><a href="#bindings" class="anchor"></a>Bindings</h6><div class="odoc-spec"><div class="spec value" id="val-clenv_independent" class="anchored"><a href="#val-clenv_independent" class="anchor"></a><code><span><span class="keyword">val</span> clenv_independent : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> list</span></span></code></div><div class="spec-doc"><p>bindings where the key is the position in the template of the clenv (dependent or not). Positions can be negative meaning to start from the rightmost argument of the template.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_missing" class="anchored"><a href="#val-clenv_missing" class="anchor"></a><code><span><span class="keyword">val</span> clenv_missing : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_unify_meta_types" class="anchored"><a href="#val-clenv_unify_meta_types" class="anchor"></a><code><span><span class="keyword">val</span> clenv_unify_meta_types : 
  <span>?flags:<a href="../Unification/index.html#type-unify_flags">Unification.unify_flags</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><p>start with a clenv to refine with a given term with bindings</p><div class="odoc-spec"><div class="spec value" id="val-make_clenv_binding_apply" class="anchored"><a href="#val-make_clenv_binding_apply" class="anchor"></a><code><span><span class="keyword">val</span> make_clenv_binding_apply : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../EConstr/index.html#type-constr">EConstr.constr</a> * <a href="../EConstr/index.html#type-constr">EConstr.constr</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <a href="../Tactypes/index.html#type-bindings">Tactypes.bindings</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div><div class="spec-doc"><p>the arity of the lemma is fixed the optional int tells how many prods of the lemma have to be used use all of them if None</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_clenv_binding" class="anchored"><a href="#val-make_clenv_binding" class="anchor"></a><code><span><span class="keyword">val</span> make_clenv_binding : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../EConstr/index.html#type-constr">EConstr.constr</a> * <a href="../EConstr/index.html#type-constr">EConstr.constr</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <a href="../Tactypes/index.html#type-bindings">Tactypes.bindings</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_push_prod" class="anchored"><a href="#val-clenv_push_prod" class="anchor"></a><code><span><span class="keyword">val</span> clenv_push_prod : 
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Constr/index.html#type-metavariable">Constr.metavariable</a> * bool * <a href="#type-clausenv">clausenv</a>)</span> option</span></span></code></div><div class="spec-doc"><p>if the clause is a product, add an extra meta for this product</p></div></div><h6 id="clenv-tactics"><a href="#clenv-tactics" class="anchor"></a>Clenv tactics</h6><div class="odoc-spec"><div class="spec value" id="val-unify" class="anchored"><a href="#val-unify" class="anchor"></a><code><span><span class="keyword">val</span> unify : 
  <span>?flags:<a href="../Unification/index.html#type-unify_flags">Unification.unify_flags</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../Proofview/index.html#type-tactic">Proofview.tactic</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-res_pf" class="anchored"><a href="#val-res_pf" class="anchor"></a><code><span><span class="keyword">val</span> res_pf : 
  <span>?with_evars:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?with_classes:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?flags:<a href="../Unification/index.html#type-unify_flags">Unification.unify_flags</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../Proofview/index.html#type-tactic">Proofview.tactic</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clenv_pose_dependent_evars" class="anchored"><a href="#val-clenv_pose_dependent_evars" class="anchor"></a><code><span><span class="keyword">val</span> clenv_pose_dependent_evars : <span>?with_evars:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-clausenv">clausenv</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pr_clenv" class="anchored"><a href="#val-pr_clenv" class="anchor"></a><code><span><span class="keyword">val</span> pr_clenv : <span><a href="#type-clausenv">clausenv</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Pp/index.html#type-t">Pp.t</a></span></code></div><div class="spec-doc"><p>Pretty-print (debug only)</p></div></div><h6 id="evar-based-clauses"><a href="#evar-based-clauses" class="anchor"></a>Evar-based clauses</h6><p>The following code is an adaptation of the <code>make_clenv_*</code> functions above, except that it uses evars instead of metas, and naturally fits in the new refinement monad. It should eventually replace all uses of the aforementioned functions.</p><p>A clause is constructed as follows: assume a type <code>t := forall (x1 : A1) ...
    (xn : An), T</code>, we instantiate all the <code>xi</code> with a fresh evar <code>ei</code> and return <code>T(xi := ei)</code> together with the <code>ei</code> enriched with a bit of additional data. This is the simple part done by <code>make_evar_clause</code>.</p><p>The problem lies in the fact we want to solve such holes with some <code>constr bindings</code>. This entails some subtleties, because the provided terms may only be well-typed up to a coercion, which we can only infer if we have enough typing information. The meta machinery could insert coercions through tricky instantiation delays. The only solution we have now is to delay the tentative resolution of clauses by providing the <code>solve_evar_clause</code> function, to be called at a smart enough time.</p><div class="odoc-spec"><div class="spec type" id="type-hole" class="anchored"><a href="#type-hole" class="anchor"></a><code><span><span class="keyword">type</span> hole</span><span> = </span><span>{</span></code><table><tr id="type-hole.hole_evar" class="anchored"><td class="def record field"><a href="#type-hole.hole_evar" class="anchor"></a><code><span>hole_evar : <a href="../EConstr/index.html#type-constr">EConstr.constr</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The hole itself. Guaranteed to be an evar.</p><span class="comment-delim">*)</span></td></tr><tr id="type-hole.hole_type" class="anchored"><td class="def record field"><a href="#type-hole.hole_type" class="anchor"></a><code><span>hole_type : <a href="../EConstr/index.html#type-types">EConstr.types</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Type of the hole in the current environment.</p><span class="comment-delim">*)</span></td></tr><tr id="type-hole.hole_deps" class="anchored"><td class="def record field"><a href="#type-hole.hole_deps" class="anchor"></a><code><span>hole_deps : bool;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Whether the remainder of the clause was dependent in the hole. Note that because let binders are substituted, it does not mean that it actually appears somewhere in the returned clause.</p><span class="comment-delim">*)</span></td></tr><tr id="type-hole.hole_name" class="anchored"><td class="def record field"><a href="#type-hole.hole_name" class="anchor"></a><code><span>hole_name : <a href="../Names/Name/index.html#type-t">Names.Name.t</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Name of the hole coming from its binder.</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-clause" class="anchored"><a href="#type-clause" class="anchor"></a><code><span><span class="keyword">type</span> clause</span><span> = </span><span>{</span></code><table><tr id="type-clause.cl_holes" class="anchored"><td class="def record field"><a href="#type-clause.cl_holes" class="anchor"></a><code><span>cl_holes : <span><a href="#type-hole">hole</a> list</span>;</span></code></td></tr><tr id="type-clause.cl_concl" class="anchored"><td class="def record field"><a href="#type-clause.cl_concl" class="anchor"></a><code><span>cl_concl : <a href="../EConstr/index.html#type-types">EConstr.types</a>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_evar_clause" class="anchored"><a href="#val-make_evar_clause" class="anchor"></a><code><span><span class="keyword">val</span> make_evar_clause : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?len:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../EConstr/index.html#type-types">EConstr.types</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> * <a href="#type-clause">clause</a></span></code></div><div class="spec-doc"><p>An evar version of <a href="#val-make_clenv_binding"><code>make_clenv_binding</code></a>. Given a type <code>t</code>, <code>evar_environments env sigma ~len t bl</code> tries to eliminate at most <code>len</code> products of the type <code>t</code> by filling it with evars. It returns the resulting type together with the list of holes generated. Assumes that <code>t</code> is well-typed in the environment.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-solve_evar_clause" class="anchored"><a href="#val-solve_evar_clause" class="anchor"></a><code><span><span class="keyword">val</span> solve_evar_clause : 
  <span><a href="../Environ/index.html#type-env">Environ.env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Evd/index.html#type-evar_map">Evd.evar_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-clause">clause</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../EConstr/index.html#type-constr">EConstr.constr</a> <a href="../Tactypes/index.html#type-bindings">Tactypes.bindings</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Evd/index.html#type-evar_map">Evd.evar_map</a></span></code></div><div class="spec-doc"><p><code>solve_evar_clause env sigma hyps cl bl</code> tries to solve the holes contained in <code>cl</code> according to the <code>bl</code> argument. Assumes that <code>bl</code> are well-typed in the environment. The boolean <code>hyps</code> is a compatibility flag that allows to consider arguments to be dependent only when they appear in hypotheses and not in the conclusion. This boolean is only used when <code>bl</code> is of the form <code>ImplicitBindings _</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Internal" class="anchored"><a href="#module-Internal" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal/index.html">Internal</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>