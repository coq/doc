<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lib (coq-core.Lib)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">coq-core</a> &#x00BB; Lib</nav><h1>Module <code>Lib</code></h1><nav class="toc"><ul><li><a href="#...">...</a></li><li><a href="#...">...</a></li><li><a href="#functions-relative-to-current-path">Functions relative to current path</a></li><li><a href="#compilation-units">Compilation units</a></li><li><a href="#discharge:-decrease-the-section-level-if-in-the-current-section">Discharge: decrease the section level if in the current section</a></li></ul></nav></header><aside><p>Lib: record of operations, backtrack, low-level sections</p></aside><aside><p>This module provides a general mechanism to keep a trace of all operations and to backtrack (undo) those operations. It provides also the section mechanism (at a low level; discharge is not known at this step).</p></aside><dl><dt class="spec type" id="type-is_type"><a href="#type-is_type" class="anchor"></a><code><span class="keyword">type</span> is_type</code><code> = bool</code></dt><dt class="spec type" id="type-export_flag"><a href="#type-export_flag" class="anchor"></a><code><span class="keyword">type</span> export_flag</code><code> = </code><table class="variant"><tr id="type-export_flag.Export" class="anchored"><td class="def constructor"><a href="#type-export_flag.Export" class="anchor"></a><code>| </code><code><span class="constructor">Export</span></code></td></tr><tr id="type-export_flag.Import" class="anchored"><td class="def constructor"><a href="#type-export_flag.Import" class="anchor"></a><code>| </code><code><span class="constructor">Import</span></code></td></tr></table></dt><dt class="spec type" id="type-export"><a href="#type-export" class="anchor"></a><code><span class="keyword">type</span> export</code><code> = <span><span>(<a href="index.html#type-export_flag">export_flag</a> * <a href="../Libobject/index.html#type-open_filter">Libobject.open_filter</a>)</span> option</span></code></dt></dl><dl><dt class="spec value" id="val-make_oname"><a href="#val-make_oname" class="anchor"></a><code><span class="keyword">val</span> make_oname : <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> <span>&#45;&gt;</span> <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> <a href="../Libobject/index.html#type-object_name">Libobject.object_name</a></code></dt><dt class="spec value" id="val-make_foname"><a href="#val-make_foname" class="anchor"></a><code><span class="keyword">val</span> make_foname : <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> <a href="../Libobject/index.html#type-object_name">Libobject.object_name</a></code></dt><dt class="spec value" id="val-oname_prefix"><a href="#val-oname_prefix" class="anchor"></a><code><span class="keyword">val</span> oname_prefix : <a href="../Libobject/index.html#type-object_name">Libobject.object_name</a> <span>&#45;&gt;</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></code></dt></dl><dl><dt class="spec type" id="type-node"><a href="#type-node" class="anchor"></a><code><span class="keyword">type</span> <span>'summary node</span></code><code> = </code><table class="variant"><tr id="type-node.CompilingLibrary" class="anchored"><td class="def constructor"><a href="#type-node.CompilingLibrary" class="anchor"></a><code>| </code><code><span class="constructor">CompilingLibrary</span> <span class="keyword">of</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></code></td></tr><tr id="type-node.OpenedModule" class="anchored"><td class="def constructor"><a href="#type-node.OpenedModule" class="anchor"></a><code>| </code><code><span class="constructor">OpenedModule</span> <span class="keyword">of</span> <a href="index.html#type-is_type">is_type</a> * <a href="index.html#type-export">export</a> * <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span class="type-var">'summary</span></code></td></tr><tr id="type-node.OpenedSection" class="anchored"><td class="def constructor"><a href="#type-node.OpenedSection" class="anchor"></a><code>| </code><code><span class="constructor">OpenedSection</span> <span class="keyword">of</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span class="type-var">'summary</span></code></td></tr></table></dt></dl><dl><dt class="spec value" id="val-node_prefix"><a href="#val-node_prefix" class="anchor"></a><code><span class="keyword">val</span> node_prefix : <span><span class="type-var">'summary</span> <a href="index.html#type-node">node</a></span> <span>&#45;&gt;</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></code></dt><dd><p>Extract the <code>object_prefix</code> component. Note that it is the prefix of the objects *inside* this node, eg in <code>Module M.</code> we have <code>OpenedModule</code> with prefix containing <code>M</code>.</p></dd></dl><dl><dt class="spec type" id="type-library_segment"><a href="#type-library_segment" class="anchor"></a><code><span class="keyword">type</span> <span>'summary library_segment</span></code><code> = <span><span>(<span><span class="type-var">'summary</span> <a href="index.html#type-node">node</a></span> * <span><a href="../Libobject/index.html#type-t">Libobject.t</a> list</span>)</span> list</span></code></dt></dl><section><header><h6 id="..."><a href="#..." class="anchor"></a>...</h6></header><aside><p>Adding operations (which call the <code>cache</code> method, and getting the current list of operations (most recent ones coming first).</p></aside><dl><dt class="spec value" id="val-add_leaf"><a href="#val-add_leaf" class="anchor"></a><code><span class="keyword">val</span> add_leaf : <a href="../Libobject/index.html#type-obj">Libobject.obj</a> <span>&#45;&gt;</span> unit</code></dt></dl></section><section><header><h6 id="..."><a href="#..." class="anchor"></a>...</h6></header><aside><p>The function <code>contents</code> gives access to the current entire segment</p></aside><dl><dt class="spec value" id="val-contents"><a href="#val-contents" class="anchor"></a><code><span class="keyword">val</span> contents : unit <span>&#45;&gt;</span> <span><a href="../Summary/Interp/index.html#type-frozen">Summary.Interp.frozen</a> <a href="index.html#type-library_segment">library_segment</a></span></code></dt></dl></section><section><header><h6 id="functions-relative-to-current-path"><a href="#functions-relative-to-current-path" class="anchor"></a>Functions relative to current path</h6></header><dl><dt class="spec value" id="val-prefix"><a href="#val-prefix" class="anchor"></a><code><span class="keyword">val</span> prefix : unit <span>&#45;&gt;</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></code></dt><dd><p>User-side names</p><p><code>cwd()</code> is <code>(prefix()).obj_dir</code> <code>current_mp()</code> is <code>(prefix()).obj_mp</code></p><p>Inside a library A.B module M section S, we have</p><ul><li>library_dp = A.B</li><li>cwd = A.B.M.S</li><li>cwd_except_section = A.B.M</li><li>current_dirpath true = M.S</li><li>current_dirpath false = S</li><li>current_mp = MPdot(MPfile A.B, M)</li></ul><p>make_path (resp make_path_except_section) uses cwd (resp cwd_except_section) make_kn uses current_mp</p></dd></dl><dl><dt class="spec value" id="val-cwd"><a href="#val-cwd" class="anchor"></a><code><span class="keyword">val</span> cwd : unit <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></code></dt><dt class="spec value" id="val-cwd_except_section"><a href="#val-cwd_except_section" class="anchor"></a><code><span class="keyword">val</span> cwd_except_section : unit <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></code></dt><dt class="spec value" id="val-current_dirpath"><a href="#val-current_dirpath" class="anchor"></a><code><span class="keyword">val</span> current_dirpath : bool <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></code></dt><dt class="spec value" id="val-make_path"><a href="#val-make_path" class="anchor"></a><code><span class="keyword">val</span> make_path : <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> <a href="../Libnames/index.html#type-full_path">Libnames.full_path</a></code></dt><dt class="spec value" id="val-make_path_except_section"><a href="#val-make_path_except_section" class="anchor"></a><code><span class="keyword">val</span> make_path_except_section : <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> <a href="../Libnames/index.html#type-full_path">Libnames.full_path</a></code></dt><dt class="spec value" id="val-current_mp"><a href="#val-current_mp" class="anchor"></a><code><span class="keyword">val</span> current_mp : unit <span>&#45;&gt;</span> <a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a></code></dt><dd><p>Kernel-side names</p></dd></dl><dl><dt class="spec value" id="val-make_kn"><a href="#val-make_kn" class="anchor"></a><code><span class="keyword">val</span> make_kn : <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> <a href="../Names/KerName/index.html#type-t">Names.KerName.t</a></code></dt><dt class="spec value" id="val-sections_are_opened"><a href="#val-sections_are_opened" class="anchor"></a><code><span class="keyword">val</span> sections_are_opened : unit <span>&#45;&gt;</span> bool</code></dt><dd><p>Are we inside an opened section</p></dd></dl><dl><dt class="spec value" id="val-sections_depth"><a href="#val-sections_depth" class="anchor"></a><code><span class="keyword">val</span> sections_depth : unit <span>&#45;&gt;</span> int</code></dt><dt class="spec value" id="val-is_module_or_modtype"><a href="#val-is_module_or_modtype" class="anchor"></a><code><span class="keyword">val</span> is_module_or_modtype : unit <span>&#45;&gt;</span> bool</code></dt><dd><p>Are we inside an opened module type</p></dd></dl><dl><dt class="spec value" id="val-is_modtype"><a href="#val-is_modtype" class="anchor"></a><code><span class="keyword">val</span> is_modtype : unit <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-is_modtype_strict"><a href="#val-is_modtype_strict" class="anchor"></a><code><span class="keyword">val</span> is_modtype_strict : unit <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-is_module"><a href="#val-is_module" class="anchor"></a><code><span class="keyword">val</span> is_module : unit <span>&#45;&gt;</span> bool</code></dt></dl><dl><dt class="spec module-type" id="module-type-StagedLibS"><a href="#module-type-StagedLibS" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-StagedLibS/index.html">StagedLibS</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The <code>StagedLibS</code> abstraction describes operations and traversal for Lib at a given stage.</p></dd></dl><aside><p>We provide two instances of <code>StagedLibS</code>, corresponding to the Synterp and Interp stages.</p></aside><div class="spec module" id="module-Synterp"><a href="#module-Synterp" class="anchor"></a><code><span class="keyword">module</span> <a href="Synterp/index.html">Synterp</a> : <a href="index.html#module-type-StagedLibS">StagedLibS</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-StagedLibS/index.html#type-summary">summary</a> = <a href="../Summary/Synterp/index.html#type-frozen">Summary.Synterp.frozen</a></code></div><div class="spec module" id="module-Interp"><a href="#module-Interp" class="anchor"></a><code><span class="keyword">module</span> <a href="Interp/index.html">Interp</a> : <a href="index.html#module-type-StagedLibS">StagedLibS</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-StagedLibS/index.html#type-summary">summary</a> = <a href="../Summary/Interp/index.html#type-frozen">Summary.Interp.frozen</a></code></div></section><section><header><h6 id="compilation-units"><a href="#compilation-units" class="anchor"></a>Compilation units</h6></header><dl><dt class="spec value" id="val-start_compilation"><a href="#val-start_compilation" class="anchor"></a><code><span class="keyword">val</span> start_compilation : <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> <span>&#45;&gt;</span> <a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-end_compilation"><a href="#val-end_compilation" class="anchor"></a><code><span class="keyword">val</span> end_compilation : <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> <span>&#45;&gt;</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span><a href="../Library_info/index.html#type-t">Library_info.t</a> list</span> * <a href="Interp/index.html#type-classified_objects">Interp.classified_objects</a> * <a href="Synterp/index.html#type-classified_objects">Synterp.classified_objects</a></code></dt><dd><p>Finalize the compilation of a library and return respectively the library prefix, the regular objects, and the syntax-related objects.</p></dd></dl><dl><dt class="spec value" id="val-library_dp"><a href="#val-library_dp" class="anchor"></a><code><span class="keyword">val</span> library_dp : unit <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></code></dt><dd><p>The function <code>library_dp</code> returns the <code>DirPath.t</code> of the current compiling library (or <code>default_library</code>)</p></dd></dl><dl><dt class="spec value" id="val-split_modpath"><a href="#val-split_modpath" class="anchor"></a><code><span class="keyword">val</span> split_modpath : <a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a> <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> * <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> list</span></code></dt><dd><p>Extract the library part of a name even if in a section</p></dd></dl><dl><dt class="spec value" id="val-library_part"><a href="#val-library_part" class="anchor"></a><code><span class="keyword">val</span> library_part : <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span>&#45;&gt;</span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></code></dt><dt class="spec value" id="val-section_segment_of_constant"><a href="#val-section_segment_of_constant" class="anchor"></a><code><span class="keyword">val</span> section_segment_of_constant : <a href="../Names/Constant/index.html#type-t">Names.Constant.t</a> <span>&#45;&gt;</span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></code></dt><dd><h6 id="section-management-for-discharge"><a href="#section-management-for-discharge" class="anchor"></a>Section management for discharge</h6></dd></dl><dl><dt class="spec value" id="val-section_segment_of_inductive"><a href="#val-section_segment_of_inductive" class="anchor"></a><code><span class="keyword">val</span> section_segment_of_inductive : <a href="../Names/MutInd/index.html#type-t">Names.MutInd.t</a> <span>&#45;&gt;</span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></code></dt><dt class="spec value" id="val-section_segment_of_reference"><a href="#val-section_segment_of_reference" class="anchor"></a><code><span class="keyword">val</span> section_segment_of_reference : <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span>&#45;&gt;</span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></code></dt><dt class="spec value" id="val-section_instance"><a href="#val-section_instance" class="anchor"></a><code><span class="keyword">val</span> section_instance : <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span>&#45;&gt;</span> <span><a href="../Constr/index.html#type-t">Constr.t</a> array</span></code></dt><dt class="spec value" id="val-is_in_section"><a href="#val-is_in_section" class="anchor"></a><code><span class="keyword">val</span> is_in_section : <a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span>&#45;&gt;</span> bool</code></dt></dl></section><section><header><h6 id="discharge:-decrease-the-section-level-if-in-the-current-section"><a href="#discharge:-decrease-the-section-level-if-in-the-current-section" class="anchor"></a>Discharge: decrease the section level if in the current section</h6></header><dl><dt class="spec value" id="val-discharge_proj_repr"><a href="#val-discharge_proj_repr" class="anchor"></a><code><span class="keyword">val</span> discharge_proj_repr : <a href="../Names/Projection/Repr/index.html#type-t">Names.Projection.Repr.t</a> <span>&#45;&gt;</span> <a href="../Names/Projection/Repr/index.html#type-t">Names.Projection.Repr.t</a></code></dt></dl><aside><p>Compatibility layer</p></aside><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : unit <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-open_section"><a href="#val-open_section" class="anchor"></a><code><span class="keyword">val</span> open_section : <a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-close_section"><a href="#val-close_section" class="anchor"></a><code><span class="keyword">val</span> close_section : unit <span>&#45;&gt;</span> unit</code></dt></dl></section></div></body></html>