<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lib (coq-core.Lib)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">coq-core</a> &#x00BB; Lib</nav><header class="odoc-preamble"><h1>Module <code><span>Lib</span></code></h1><p>Lib: record of operations, backtrack, low-level sections</p></header><nav class="odoc-toc"><ul><li><a href="#...">...</a></li><li><a href="#..._2">...</a></li><li><a href="#functions-relative-to-current-path">Functions relative to current path</a></li><li><a href="#compilation-units">Compilation units</a></li><li><a href="#discharge:-decrease-the-section-level-if-in-the-current-section">Discharge: decrease the section level if in the current section</a></li></ul></nav><div class="odoc-content"><p>This module provides a general mechanism to keep a trace of all operations and to backtrack (undo) those operations. It provides also the section mechanism (at a low level; discharge is not known at this step).</p><div class="odoc-spec"><div class="spec type" id="type-is_type" class="anchored"><a href="#type-is_type" class="anchor"></a><code><span><span class="keyword">type</span> is_type</span><span> = bool</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-export_flag" class="anchored"><a href="#type-export_flag" class="anchor"></a><code><span><span class="keyword">type</span> export_flag</span><span> = </span></code><table><tr id="type-export_flag.Export" class="anchored"><td class="def variant constructor"><a href="#type-export_flag.Export" class="anchor"></a><code><span>| </span><span><span class="constructor">Export</span></span></code></td></tr><tr id="type-export_flag.Import" class="anchored"><td class="def variant constructor"><a href="#type-export_flag.Import" class="anchor"></a><code><span>| </span><span><span class="constructor">Import</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-export" class="anchored"><a href="#type-export" class="anchor"></a><code><span><span class="keyword">type</span> export</span><span> = <span><span>(<a href="#type-export_flag">export_flag</a> * <a href="../Libobject/index.html#type-open_filter">Libobject.open_filter</a>)</span> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_oname" class="anchored"><a href="#val-make_oname" class="anchor"></a><code><span><span class="keyword">val</span> make_oname : <span><a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Libobject/index.html#type-object_name">Libobject.object_name</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_foname" class="anchored"><a href="#val-make_foname" class="anchor"></a><code><span><span class="keyword">val</span> make_foname : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Libobject/index.html#type-object_name">Libobject.object_name</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-oname_prefix" class="anchored"><a href="#val-oname_prefix" class="anchor"></a><code><span><span class="keyword">val</span> oname_prefix : <span><a href="../Libobject/index.html#type-object_name">Libobject.object_name</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-node" class="anchored"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> <span>'summary node</span></span><span> = </span></code><table><tr id="type-node.CompilingLibrary" class="anchored"><td class="def variant constructor"><a href="#type-node.CompilingLibrary" class="anchor"></a><code><span>| </span><span><span class="constructor">CompilingLibrary</span> <span class="keyword">of</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></span></code></td></tr><tr id="type-node.OpenedModule" class="anchored"><td class="def variant constructor"><a href="#type-node.OpenedModule" class="anchor"></a><code><span>| </span><span><span class="constructor">OpenedModule</span> <span class="keyword">of</span> <a href="#type-is_type">is_type</a> * <a href="#type-export">export</a> * <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span class="type-var">'summary</span></span></code></td></tr><tr id="type-node.OpenedSection" class="anchored"><td class="def variant constructor"><a href="#type-node.OpenedSection" class="anchor"></a><code><span>| </span><span><span class="constructor">OpenedSection</span> <span class="keyword">of</span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span class="type-var">'summary</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-node_prefix" class="anchored"><a href="#val-node_prefix" class="anchor"></a><code><span><span class="keyword">val</span> node_prefix : <span><span><span class="type-var">'summary</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></span></code></div><div class="spec-doc"><p>Extract the <code>object_prefix</code> component. Note that it is the prefix of the objects *inside* this node, eg in <code>Module M.</code> we have <code>OpenedModule</code> with prefix containing <code>M</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-library_segment" class="anchored"><a href="#type-library_segment" class="anchor"></a><code><span><span class="keyword">type</span> <span>'summary library_segment</span></span><span> = <span><span>(<span><span class="type-var">'summary</span> <a href="#type-node">node</a></span> * <span><a href="../Libobject/index.html#type-t">Libobject.t</a> list</span>)</span> list</span></span></code></div></div><h6 id="..."><a href="#..." class="anchor"></a>...</h6><p>Adding operations (which call the <code>cache</code> method, and getting the current list of operations (most recent ones coming first).</p><div class="odoc-spec"><div class="spec value" id="val-add_leaf" class="anchored"><a href="#val-add_leaf" class="anchor"></a><code><span><span class="keyword">val</span> add_leaf : <span><a href="../Libobject/index.html#type-obj">Libobject.obj</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h6 id="..._2"><a href="#..._2" class="anchor"></a>...</h6><p>The function <code>contents</code> gives access to the current entire segment</p><div class="odoc-spec"><div class="spec value" id="val-contents" class="anchored"><a href="#val-contents" class="anchor"></a><code><span><span class="keyword">val</span> contents : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../Summary/Interp/index.html#type-frozen">Summary.Interp.frozen</a> <a href="#type-library_segment">library_segment</a></span></span></code></div></div><h6 id="functions-relative-to-current-path"><a href="#functions-relative-to-current-path" class="anchor"></a>Functions relative to current path</h6><div class="odoc-spec"><div class="spec value" id="val-prefix" class="anchored"><a href="#val-prefix" class="anchor"></a><code><span><span class="keyword">val</span> prefix : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a></span></code></div><div class="spec-doc"><p>User-side names</p><p><code>cwd()</code> is <code>(prefix()).obj_dir</code> <code>current_mp()</code> is <code>(prefix()).obj_mp</code></p><p>Inside a library A.B module M section S, we have</p><ul><li>library_dp = A.B</li><li>cwd = A.B.M.S</li><li>cwd_except_section = A.B.M</li><li>current_dirpath true = M.S</li><li>current_dirpath false = S</li><li>current_mp = MPdot(MPfile A.B, M)</li></ul><p>make_path (resp make_path_except_section) uses cwd (resp cwd_except_section) make_kn uses current_mp</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cwd" class="anchored"><a href="#val-cwd" class="anchor"></a><code><span><span class="keyword">val</span> cwd : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cwd_except_section" class="anchored"><a href="#val-cwd_except_section" class="anchor"></a><code><span><span class="keyword">val</span> cwd_except_section : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-current_dirpath" class="anchored"><a href="#val-current_dirpath" class="anchor"></a><code><span><span class="keyword">val</span> current_dirpath : <span>bool <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_path" class="anchored"><a href="#val-make_path" class="anchor"></a><code><span><span class="keyword">val</span> make_path : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Libnames/index.html#type-full_path">Libnames.full_path</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_path_except_section" class="anchored"><a href="#val-make_path_except_section" class="anchor"></a><code><span><span class="keyword">val</span> make_path_except_section : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Libnames/index.html#type-full_path">Libnames.full_path</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-current_mp" class="anchored"><a href="#val-current_mp" class="anchor"></a><code><span><span class="keyword">val</span> current_mp : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a></span></code></div><div class="spec-doc"><p>Kernel-side names</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_kn" class="anchored"><a href="#val-make_kn" class="anchor"></a><code><span><span class="keyword">val</span> make_kn : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/KerName/index.html#type-t">Names.KerName.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-sections_are_opened" class="anchored"><a href="#val-sections_are_opened" class="anchor"></a><code><span><span class="keyword">val</span> sections_are_opened : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Are we inside an opened section</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sections_depth" class="anchored"><a href="#val-sections_depth" class="anchor"></a><code><span><span class="keyword">val</span> sections_depth : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_module_or_modtype" class="anchored"><a href="#val-is_module_or_modtype" class="anchor"></a><code><span><span class="keyword">val</span> is_module_or_modtype : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Are we inside an opened module type</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_modtype" class="anchored"><a href="#val-is_modtype" class="anchor"></a><code><span><span class="keyword">val</span> is_modtype : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_modtype_strict" class="anchored"><a href="#val-is_modtype_strict" class="anchor"></a><code><span><span class="keyword">val</span> is_modtype_strict : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_module" class="anchored"><a href="#val-is_module" class="anchor"></a><code><span><span class="keyword">val</span> is_module : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-StagedLibS" class="anchored"><a href="#module-type-StagedLibS" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-StagedLibS/index.html">StagedLibS</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <code>StagedLibS</code> abstraction describes operations and traversal for Lib at a given stage.</p></div></div><p>We provide two instances of <code>StagedLibS</code>, corresponding to the Synterp and Interp stages.</p><div class="odoc-spec"><div class="spec module" id="module-Synterp" class="anchored"><a href="#module-Synterp" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Synterp/index.html">Synterp</a></span><span> : <a href="module-type-StagedLibS/index.html">StagedLibS</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-StagedLibS/index.html#type-summary">summary</a> = <a href="../Summary/Synterp/index.html#type-frozen">Summary.Synterp.frozen</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Interp" class="anchored"><a href="#module-Interp" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Interp/index.html">Interp</a></span><span> : <a href="module-type-StagedLibS/index.html">StagedLibS</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-StagedLibS/index.html#type-summary">summary</a> = <a href="../Summary/Interp/index.html#type-frozen">Summary.Interp.frozen</a></span></span></code></div></div><h6 id="compilation-units"><a href="#compilation-units" class="anchor"></a>Compilation units</h6><div class="odoc-spec"><div class="spec value" id="val-start_compilation" class="anchored"><a href="#val-start_compilation" class="anchor"></a><code><span><span class="keyword">val</span> start_compilation : <span><a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-end_compilation" class="anchored"><a href="#val-end_compilation" class="anchor"></a><code><span><span class="keyword">val</span> end_compilation : <span><a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <a href="../Library_info/index.html#type-t">Library_info.t</a> * <a href="Interp/index.html#type-classified_objects">Interp.classified_objects</a> * <a href="Synterp/index.html#type-classified_objects">Synterp.classified_objects</a></span></code></div><div class="spec-doc"><p>Finalize the compilation of a library and return respectively the library prefix, the regular objects, and the syntax-related objects.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-library_dp" class="anchored"><a href="#val-library_dp" class="anchor"></a><code><span><span class="keyword">val</span> library_dp : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></span></code></div><div class="spec-doc"><p>The function <code>library_dp</code> returns the <code>DirPath.t</code> of the current compiling library (or <code>default_library</code>)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-split_modpath" class="anchored"><a href="#val-split_modpath" class="anchor"></a><code><span><span class="keyword">val</span> split_modpath : <span><a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a> * <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> list</span></span></code></div><div class="spec-doc"><p>Extract the library part of a name even if in a section</p></div></div><div class="odoc-spec"><div class="spec value" id="val-library_part" class="anchored"><a href="#val-library_part" class="anchor"></a><code><span><span class="keyword">val</span> library_part : <span><a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/DirPath/index.html#type-t">Names.DirPath.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-section_segment_of_constant" class="anchored"><a href="#val-section_segment_of_constant" class="anchor"></a><code><span><span class="keyword">val</span> section_segment_of_constant : <span><a href="../Names/Constant/index.html#type-t">Names.Constant.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></span></code></div><div class="spec-doc"><p>Section management for discharge</p></div></div><div class="odoc-spec"><div class="spec value" id="val-section_segment_of_inductive" class="anchored"><a href="#val-section_segment_of_inductive" class="anchor"></a><code><span><span class="keyword">val</span> section_segment_of_inductive : <span><a href="../Names/MutInd/index.html#type-t">Names.MutInd.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-section_segment_of_reference" class="anchored"><a href="#val-section_segment_of_reference" class="anchor"></a><code><span><span class="keyword">val</span> section_segment_of_reference : <span><a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Cooking/index.html#type-cooking_info">Cooking.cooking_info</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-section_instance" class="anchored"><a href="#val-section_instance" class="anchor"></a><code><span><span class="keyword">val</span> section_instance : <span><a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Constr/index.html#type-t">Constr.t</a> array</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_in_section" class="anchored"><a href="#val-is_in_section" class="anchor"></a><code><span><span class="keyword">val</span> is_in_section : <span><a href="../Names/GlobRef/index.html#type-t">Names.GlobRef.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h6 id="discharge:-decrease-the-section-level-if-in-the-current-section"><a href="#discharge:-decrease-the-section-level-if-in-the-current-section" class="anchor"></a>Discharge: decrease the section level if in the current section</h6><div class="odoc-spec"><div class="spec value" id="val-discharge_proj_repr" class="anchored"><a href="#val-discharge_proj_repr" class="anchor"></a><code><span><span class="keyword">val</span> discharge_proj_repr : <span><a href="../Names/Projection/Repr/index.html#type-t">Names.Projection.Repr.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Names/Projection/Repr/index.html#type-t">Names.Projection.Repr.t</a></span></code></div></div><p>Compatibility layer</p><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_section" class="anchored"><a href="#val-open_section" class="anchor"></a><code><span><span class="keyword">val</span> open_section : <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-close_section" class="anchored"><a href="#val-close_section" class="anchor"></a><code><span><span class="keyword">val</span> close_section : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>