<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>CProfile (coq-core.CProfile)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">coq-core</a> &#x00BB; CProfile</nav><h1>Module <code>CProfile</code></h1><h6 id="this-program-is-a-small-time-and-allocation-profiler-for-objective-caml"><a href="#this-program-is-a-small-time-and-allocation-profiler-for-objective-caml" class="anchor"></a>This program is a small time and allocation profiler for Objective Caml</h6></header><aside><p>Adapted from Christophe Raffalli</p></aside><aside><p>To use it, link it with the program you want to profile.</p><p>To trace a function &quot;f&quot; you first need to get a key for it by using :</p><p>let fkey = declare_profile &quot;f&quot;;;</p><p>(the string is used to print the profile information). Warning: this function does a side effect. Choose the ident you want instead &quot;fkey&quot;.</p><p>Then if the function has ONE argument add the following just after the definition of &quot;f&quot; or just after the declare_profile if this one follows the definition of f.</p><p>let f = profile1 fkey f;;</p><p>If f has two arguments do the same with profile2, idem with 3, ... For more arguments than provided in this module, make a new copy of function profile and adapt for the needed arity.</p><p>If you want to profile two mutually recursive functions, you had better to rename them :</p><p>let fkey = declare_profile &quot;f&quot;;; let gkey = declare_profile &quot;g&quot;;; let f' = .... f' ... g' and g' = .... f' .... g' ;;</p><p>let f = profile fkey f';; let g = profile gkey g';;</p><p>Before the program quits, you should call &quot;print_profile ();;&quot;. It produces a result of the following kind:</p><p>Function name Own time Total time Own alloc Tot. alloc Calls f 0.28 0.47 116 116 5 4 h 0.19 0.19 0 0 4 0 g 0.00 0.00 0 0 0 0 others 0.00 0.47 392 508 9 Est. overhead/total 0.00 0.47 2752 3260</p><ul><li>The first column is the name of the function.</li><li>The third column give the time (utime + stime) spent inside the function.</li><li>The second column give the time spend inside the function minus the time spend in other profiled functions called by it</li><li>The 4th and 5th columns give the same for allocated words</li><li>The 6th and 7th columns give the number of calls to the function and the number of calls to profiled functions inside the scope of the current function</li></ul><p>Remarks:</p><ul><li>If a function has a polymorphic type, you need to supply it with at least one argument as in &quot;let f a = profile1 fkey f a;;&quot; (instead of &quot;let f = profile1 fkey f;;&quot;) in order to get generalization of the type.</li><li>Each line of the form &quot;let f a = profile1 fkey f a;;&quot; in your code counts for 5 words and each line of the form &quot;let f = profile1 fkey f;;&quot; counts for 6 words (a word is 4 or 8 bytes according to the architecture); this is counted for &quot;others&quot;.</li><li>Time fields for functions doing a little job is usually non pertinent.</li></ul><p>i</p></aside><dl><dt class="spec type" id="type-profile_key"><a href="#type-profile_key" class="anchor"></a><code><span class="keyword">type</span> profile_key</code></dt></dl><dl><dt class="spec value" id="val-set_recording"><a href="#val-set_recording" class="anchor"></a><code><span class="keyword">val</span> set_recording : string <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-print_profile"><a href="#val-print_profile" class="anchor"></a><code><span class="keyword">val</span> print_profile : unit <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-reset_profile"><a href="#val-reset_profile" class="anchor"></a><code><span class="keyword">val</span> reset_profile : unit <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-init_profile"><a href="#val-init_profile" class="anchor"></a><code><span class="keyword">val</span> init_profile : unit <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-declare_profile"><a href="#val-declare_profile" class="anchor"></a><code><span class="keyword">val</span> declare_profile : string <span>&#45;&gt;</span> <a href="index.html#type-profile_key">profile_key</a></code></dt><dt class="spec value" id="val-profile1"><a href="#val-profile1" class="anchor"></a><code><span class="keyword">val</span> profile1 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dt class="spec value" id="val-profile2"><a href="#val-profile2" class="anchor"></a><code><span class="keyword">val</span> profile2 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span></code></dt><dt class="spec value" id="val-profile3"><a href="#val-profile3" class="anchor"></a><code><span class="keyword">val</span> profile3 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span></code></dt><dt class="spec value" id="val-profile4"><a href="#val-profile4" class="anchor"></a><code><span class="keyword">val</span> profile4 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span></code></dt><dt class="spec value" id="val-profile5"><a href="#val-profile5" class="anchor"></a><code><span class="keyword">val</span> profile5 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span></code></dt><dt class="spec value" id="val-profile6"><a href="#val-profile6" class="anchor"></a><code><span class="keyword">val</span> profile6 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span></code></dt><dt class="spec value" id="val-profile7"><a href="#val-profile7" class="anchor"></a><code><span class="keyword">val</span> profile7 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span> <span>&#45;&gt;</span> <span class="type-var">'h</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span> <span>&#45;&gt;</span> <span class="type-var">'h</span></code></dt><dt class="spec value" id="val-profile8"><a href="#val-profile8" class="anchor"></a><code><span class="keyword">val</span> profile8 : <a href="index.html#type-profile_key">profile_key</a> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span> <span>&#45;&gt;</span> <span class="type-var">'h</span> <span>&#45;&gt;</span> <span class="type-var">'i</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span> <span>&#45;&gt;</span> <span class="type-var">'e</span> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'g</span> <span>&#45;&gt;</span> <span class="type-var">'h</span> <span>&#45;&gt;</span> <span class="type-var">'i</span></code></dt></dl><aside><p>Some utilities to compute the logical and physical sizes and depth of ML objects</p></aside><dl><dt class="spec value" id="val-print_logical_stats"><a href="#val-print_logical_stats" class="anchor"></a><code><span class="keyword">val</span> print_logical_stats : <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Print logical size (in words) and depth of its argument This function does not disturb the heap</p></dd></dl><dl><dt class="spec value" id="val-print_stats"><a href="#val-print_stats" class="anchor"></a><code><span class="keyword">val</span> print_stats : <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Print physical size, logical size (in words) and depth of its argument This function allocates itself a lot (the same order of magnitude as the physical size of its argument)</p></dd></dl></div></body></html>