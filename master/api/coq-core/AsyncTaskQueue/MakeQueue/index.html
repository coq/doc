<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>MakeQueue (coq-core.AsyncTaskQueue.MakeQueue)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">coq-core</a> &#x00BB; <a href="../index.html">AsyncTaskQueue</a> &#x00BB; MakeQueue</nav><header class="odoc-preamble"><h1>Module <code><span>AsyncTaskQueue.MakeQueue</span></code></h1><p>Client-side functor. <code>MakeQueue T</code> creates a task queue for task <code>T</code></p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter" id="argument-1-T" class="anchored"><a href="#argument-1-T" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-T/index.html">T</a></span><span> : <a href="../module-type-Task/index.html">Task</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec type" id="type-queue" class="anchored"><a href="#type-queue" class="anchor"></a><code><span><span class="keyword">type</span> queue</span></code></div><div class="spec-doc"><p><code>queue</code> is the abstract queue type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../CoqworkmgrApi/index.html#type-priority">CoqworkmgrApi.priority</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-queue">queue</a></span></code></div><div class="spec-doc"><p><code>create n pri</code> will initialize the queue with <code>n</code> workers having priority <code>pri</code>. If <code>n</code> is 0, the queue won't spawn any process, working in a lazy local manner. <code>not imposed by the this API</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-destroy" class="anchored"><a href="#val-destroy" class="anchor"></a><code><span><span class="keyword">val</span> destroy : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>destroy q</code> Deallocates <code>q</code>, cancelling all pending tasks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-n_workers" class="anchored"><a href="#val-n_workers" class="anchor"></a><code><span><span class="keyword">val</span> n_workers : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>n_workers q</code> returns the number of workers of <code>q</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-enqueue_task" class="anchored"><a href="#val-enqueue_task" class="anchor"></a><code><span><span class="keyword">val</span> enqueue_task : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-T/index.html#type-task">T.task</a> <span class="arrow">&#45;&gt;</span></span> <span>cancel_switch:<a href="../index.html#type-cancel_switch">cancel_switch</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>enqueue_task q t ~cancel_switch</code> schedules <code>t</code> for execution in <code>q</code>. <code>cancel_switch</code> can be flipped to true to cancel the task.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-join" class="anchored"><a href="#val-join" class="anchor"></a><code><span><span class="keyword">val</span> join : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>join q</code> blocks until the task queue is empty</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cancel_all" class="anchored"><a href="#val-cancel_all" class="anchor"></a><code><span><span class="keyword">val</span> cancel_all : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>cancel_all q</code> Cancels all tasks</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cancel_worker" class="anchored"><a href="#val-cancel_worker" class="anchor"></a><code><span><span class="keyword">val</span> cancel_worker : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../WorkerPool/index.html#type-worker_id">WorkerPool.worker_id</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>cancel_worker q wid</code> cancels a particular worker <code>wid</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_order" class="anchored"><a href="#val-set_order" class="anchor"></a><code><span><span class="keyword">val</span> set_order : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="argument-1-T/index.html#type-task">T.task</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-T/index.html#type-task">T.task</a> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_order q cmp</code> reorders <code>q</code> using ordering <code>cmp</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-broadcast" class="anchored"><a href="#val-broadcast" class="anchor"></a><code><span><span class="keyword">val</span> broadcast : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>broadcast q</code></p><p>This is nasty. Workers can be picky, e.g. pick tasks only when they are &quot;on screen&quot;. Of course the screen is scrolled, and that changes the potential choice of workers to pick up a task or not.</p><p>This function wakes up the workers (the managers) that give a look (again) to the tasks in the queue.</p><p>The STM calls it when the perspective (as in PIDE) changes.</p><p>A problem here is that why task_match has access to the competence data in order to decide if the task is palatable to the worker or not... such data is local to the worker (manager). The perspective is global, so it does not quite fit this picture. This API to make all managers reconsider the tasks in the queue is the best I could came up with.</p><p>This API is crucial to Coqoon (or any other UI that invokes Stm.finish eagerly but wants the workers to &quot;focus&quot; on the visible part of the document).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-snapshot" class="anchored"><a href="#val-snapshot" class="anchor"></a><code><span><span class="keyword">val</span> snapshot : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-T/index.html#type-task">T.task</a> list</span></span></code></div><div class="spec-doc"><p><code>snapshot q</code> Takes a snapshot (non destructive but waits until all workers are enqueued)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clear" class="anchored"><a href="#val-clear" class="anchor"></a><code><span><span class="keyword">val</span> clear : <span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>clear q</code> Clears <code>q</code>, only if the worker prool is empty</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_n_workers" class="anchored"><a href="#val-with_n_workers" class="anchor"></a><code><span><span class="keyword">val</span> with_n_workers : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../CoqworkmgrApi/index.html#type-priority">CoqworkmgrApi.priority</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-queue">queue</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_n_workers n pri f</code> creates a queue, runs the function, destroys the queue. The user should call join</p></div></div></div></body></html>