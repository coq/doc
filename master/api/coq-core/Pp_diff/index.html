<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Pp_diff (coq-core.Pp_diff)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">coq-core</a> &#x00BB; Pp_diff</nav><h1>Module <code>Pp_diff</code></h1><p>Computes the differences between 2 Pp's and adds additional tags to a Pp to highlight them. Strings are split into tokens using the Coq lexer, then the lists of tokens are diffed using the Myers algorithm. A fixup routine, shorten_diff_span, shortens the span of the diff result in some cases.</p><p>Highlights use 4 tags to specify the color and underline/strikeout. These are &quot;diffs.added&quot;, &quot;diffs.removed&quot;, &quot;diffs.added.bg&quot; and &quot;diffs.removed.bg&quot;. The first two are for added or removed text; the last two are for unmodified parts of a modified item. Diffs that span multiple strings in the Pp are tagged with &quot;start.diff.*&quot; and &quot;end.diff.*&quot;, but only on the first and last strings of the span.</p><p>If the inputs are not acceptable to the lexer, break the strings into lists of tokens and call diff_strs, then add_diff_tags with a Pp.t that matches the input lists of strings. Tokens that the lexer doesn't return exactly as they appeared in the input will raise an exception in add_diff_tags (e.g. comments and quoted strings). Fixing that requires tweaking the lexer.</p><p>Limitations/Possible enhancements:</p><ul><li>Make diff_pp immune to unlexable strings by adding a flag to the lexer.</li></ul></header><dl><dt class="spec value" id="val-diff_pp"><a href="#val-diff_pp" class="anchor"></a><code><span class="keyword">val</span> diff_pp : <span>?&#8288;tokenize_string:<span>(string <span>&#45;&gt;</span> <span>string list</span>)</span></span> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> * <a href="../Pp/index.html#type-t">Pp.t</a></code></dt><dd><p>Compute the diff between two Pp.t structures and return versions of each with diffs highlighted as (old, new)</p></dd></dl><dl><dt class="spec value" id="val-diff_pp_combined"><a href="#val-diff_pp_combined" class="anchor"></a><code><span class="keyword">val</span> diff_pp_combined : <span>?&#8288;tokenize_string:<span>(string <span>&#45;&gt;</span> <span>string list</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;show_removed:bool</span> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a></code></dt><dd><p>Compute the diff between two Pp.t structures and return a highlighted Pp.t. If <code>show_removed</code> is true, show separate lines for removals and additions, otherwise only show additions</p></dd></dl><dl><dt class="spec exception" id="exception-Diff_Failure"><a href="#exception-Diff_Failure" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Diff_Failure</span> <span class="keyword">of</span> string</code></dt><dd><p>Raised if the diff fails</p></dd></dl><div class="spec module" id="module-StringDiff"><a href="#module-StringDiff" class="anchor"></a><code><span class="keyword">module</span> <a href="StringDiff/index.html">StringDiff</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-diff_type"><a href="#type-diff_type" class="anchor"></a><code><span class="keyword">type</span> diff_type</code> = <code>[ </code><table class="variant"><tr id="type-diff_type.Removed" class="anchored"><td class="def constructor"><a href="#type-diff_type.Removed" class="anchor"></a><code>| </code><code>`Removed</code></td></tr><tr id="type-diff_type.Added" class="anchored"><td class="def constructor"><a href="#type-diff_type.Added" class="anchor"></a><code>| </code><code>`Added</code></td></tr><tr id="type-diff_type.Common" class="anchored"><td class="def constructor"><a href="#type-diff_type.Common" class="anchor"></a><code>| </code><code>`Common</code></td></tr></table><code> ]</code></dt><dt class="spec type" id="type-diff_list"><a href="#type-diff_list" class="anchor"></a><code><span class="keyword">type</span> diff_list</code><code> = <span><span><a href="StringDiff/index.html#type-elem">StringDiff.elem</a> <a href="../Diff2/index.html#type-edit">Diff2.edit</a></span> list</span></code></dt></dl><dl><dt class="spec value" id="val-diff_str"><a href="#val-diff_str" class="anchor"></a><code><span class="keyword">val</span> diff_str : <span>?&#8288;tokenize_string:<span>(string <span>&#45;&gt;</span> <span>string list</span>)</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="StringDiff/index.html#type-elem">StringDiff.elem</a> <a href="../Diff2/index.html#type-edit">Diff2.edit</a></span> list</span></code></dt><dd><p>Compute the difference between 2 strings in terms of tokens, using the lexer to identify tokens.</p><p>If the strings are not lexable, this routine will raise Diff_Failure. (I expect to modify the lexer soon so this won't happen.)</p><p>Therefore you should catch any exceptions. The workaround for now is for the caller to tokenize the strings itself and then call diff_strs.</p></dd></dl><dl><dt class="spec value" id="val-diff_strs"><a href="#val-diff_strs" class="anchor"></a><code><span class="keyword">val</span> diff_strs : <a href="StringDiff/index.html#type-t">StringDiff.t</a> <span>&#45;&gt;</span> <a href="StringDiff/index.html#type-t">StringDiff.t</a> <span>&#45;&gt;</span> <span><span><a href="StringDiff/index.html#type-elem">StringDiff.elem</a> <a href="../Diff2/index.html#type-edit">Diff2.edit</a></span> list</span></code></dt><dd><p>Compute the differences between 2 lists of strings, treating the strings in the lists as indivisible units.</p></dd></dl><dl><dt class="spec value" id="val-add_diff_tags"><a href="#val-add_diff_tags" class="anchor"></a><code><span class="keyword">val</span> add_diff_tags : <a href="index.html#type-diff_type">diff_type</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <span><span><a href="StringDiff/index.html#type-elem">StringDiff.elem</a> <a href="../Diff2/index.html#type-edit">Diff2.edit</a></span> list</span> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a></code></dt><dd><p>Generate a new Pp that adds tags marking diffs to a Pp structure: which: either `Added or `Removed, indicates which type of diffs to add pp: the original structure. For `Added, must be the new pp passed to diff_pp For `Removed, must be the old pp passed to diff_pp. Passing the wrong one will likely raise Diff_Failure. diffs: the diff list returned by diff_pp</p><p>Diffs of single strings in the Pp are tagged with &quot;diff.added&quot; or &quot;diff.removed&quot;. Diffs that span multiple strings in the Pp are tagged with &quot;start.diff.*&quot; or &quot;end.diff.*&quot;, but only on the first and last strings of the span.</p><p>Ppcmd_strings will be split into multiple Ppcmd_strings if a diff starts or ends in the middle of the string. Whitespace just before or just after a diff will not be part of the highlight.</p><p>Preexisting tags in pp may contain only a single Ppcmd_string. Those tags will be placed inside the diff tags to ensure proper nesting of tags within spans of &quot;start.diff.*&quot; ... &quot;end.diff.*&quot;.</p><p>Under some &quot;impossible&quot; conditions, this routine may raise Diff_Failure. If you want to make your call especially bulletproof, catch this exception, print a user-visible message, then recall this routine with the first argument set to None, which will skip the diff.</p></dd></dl><dl><dt class="spec value" id="val-has_changes"><a href="#val-has_changes" class="anchor"></a><code><span class="keyword">val</span> has_changes : <a href="index.html#type-diff_list">diff_list</a> <span>&#45;&gt;</span> bool * bool</code></dt><dd><p>Returns a boolean pair (added, removed) for <code>diffs</code> where a true value indicates that something was added/removed in the diffs.</p></dd></dl><dl><dt class="spec value" id="val-get_dinfo"><a href="#val-get_dinfo" class="anchor"></a><code><span class="keyword">val</span> get_dinfo : <span><a href="StringDiff/index.html#type-elem">StringDiff.elem</a> <a href="../Diff2/index.html#type-edit">Diff2.edit</a></span> <span>&#45;&gt;</span> <a href="index.html#type-diff_type">diff_type</a> * string</code></dt><dt class="spec value" id="val-wrap_in_bg"><a href="#val-wrap_in_bg" class="anchor"></a><code><span class="keyword">val</span> wrap_in_bg : string <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a> <span>&#45;&gt;</span> <a href="../Pp/index.html#type-t">Pp.t</a></code></dt><dd><p>Returns a modified <code>pp</code> with the background highlighted with &quot;start.&lt;diff_tag&gt;.bg&quot; and &quot;end.&lt;diff_tag&gt;.bg&quot; tags at the beginning and end of the returned Pp.t</p></dd></dl><dl><dt class="spec value" id="val-string_of_diffs"><a href="#val-string_of_diffs" class="anchor"></a><code><span class="keyword">val</span> string_of_diffs : <a href="index.html#type-diff_list">diff_list</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Displays the diffs to a printable format for debugging</p></dd></dl></div></body></html>