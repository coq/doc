<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Libobject (coq-core.Libobject)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">coq-core</a> &#x00BB; Libobject</nav><header class="odoc-preamble"><h1>Module <code><span>Libobject</span></code></h1><p><code>Libobject</code> declares persistent objects, given with methods:</p><p>* a caching function specifying how to add the object in the current scope; called when the object is added and after the end of the containing sections. If the object wishes to register its visibility in the Nametab, it should do so for all possible suffixes.</p><p>* a loading function, specifying what to do when the module containing the object is loaded; called at Require and after the end of the containing modules. If the object wishes to register its visibility in the Nametab, it should do so for all suffixes no shorter than the &quot;int&quot; argument</p><p>* an opening function, specifying what to do when the module containing the object is opened; called when the containing modules are Imported. Objects which should only have an effect when the nearest containing module is imported (and not when the modules containing the nearest module are imported) must check that the &quot;int&quot; argument is <code>1</code>. If the object wishes to register its visibility in the Nametab, it should do so for the suffix of the length the &quot;int&quot; argument</p><p>* a classification function, specifying what to do with the object, when the current module (containing the object) is ended; The possibilities are: Dispose - the object is dropped at the end of the module. Substitute - the object is kept at the end of the module. When the module is cloned (Include, module aliases) or when it's a module type which is getting instantiated (eg if module type <code>T</code> is used for a functor argument <code>X : T</code> or <code>Declare Module X : T</code>), the substitution function is called on the object to update the module name. Keep - the object is kept at the end of the module. When the module is cloned the object is not cloned with it. This means that Keep objects in a module type or functor are dropped. Escape - like Keep, but also escapes module types, functors and opaque modules. Monomorphic universes and universe constraints behave like this. Anticipate - this is for objects that have to be explicitly managed by the <code>end_module</code> function (currently only Require).</p><p>* a substitution function, performing the substitution; this function should be declared for substitutive objects only (see above). NB: the substitution might be delayed instead of happening at module creation, so this function should _not_ depend on the current environment</p><p>* a discharge function, that is called at section closing time to collect the data necessary to rebuild the discharged form of the non volatile objects. If it returns <code>None</code> the object is dropped. It is called in the state inside the section at its end, before it is reset. Notably the global environment contains the section data and the non-discharged globals.</p><p>* a rebuild function, that is applied after section closing to rebuild the non volatile content of a section from the data collected by the discharge function It is called in the state after the end of the section with any previous objects already present. Notably the global environment contains the discharged globals.</p><p>Any type defined as a persistent object must be pure (e.g. no references) and marshallable by the OCaml Marshal module (e.g. no closures).</p></header><nav class="odoc-toc"><ul><li><a href="#...">...</a></li><li><a href="#debug">Debug</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-substitutivity" class="anchored"><a href="#type-substitutivity" class="anchor"></a><code><span><span class="keyword">type</span> substitutivity</span><span> = </span></code><table><tr id="type-substitutivity.Dispose" class="anchored"><td class="def variant constructor"><a href="#type-substitutivity.Dispose" class="anchor"></a><code><span>| </span><span><span class="constructor">Dispose</span></span></code></td></tr><tr id="type-substitutivity.Substitute" class="anchored"><td class="def variant constructor"><a href="#type-substitutivity.Substitute" class="anchor"></a><code><span>| </span><span><span class="constructor">Substitute</span></span></code></td></tr><tr id="type-substitutivity.Keep" class="anchored"><td class="def variant constructor"><a href="#type-substitutivity.Keep" class="anchor"></a><code><span>| </span><span><span class="constructor">Keep</span></span></code></td></tr><tr id="type-substitutivity.Escape" class="anchored"><td class="def variant constructor"><a href="#type-substitutivity.Escape" class="anchor"></a><code><span>| </span><span><span class="constructor">Escape</span></span></code></td></tr><tr id="type-substitutivity.Anticipate" class="anchored"><td class="def variant constructor"><a href="#type-substitutivity.Anticipate" class="anchor"></a><code><span>| </span><span><span class="constructor">Anticipate</span></span></code></td></tr></table></div></div><p>Both names are passed to objects: a &quot;semantic&quot; <code>kernel_name</code>, which can be substituted and a &quot;syntactic&quot; <code>full_path</code> which can be printed</p><div class="odoc-spec"><div class="spec type" id="type-object_name" class="anchored"><a href="#type-object_name" class="anchor"></a><code><span><span class="keyword">type</span> object_name</span><span> = <a href="../Libnames/index.html#type-full_path">Libnames.full_path</a> * <a href="../Names/KerName/index.html#type-t">Names.KerName.t</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-open_filter" class="anchored"><a href="#type-open_filter" class="anchor"></a><code><span><span class="keyword">type</span> open_filter</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-object_declaration" class="anchored"><a href="#type-object_declaration" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b, 'discharged) object_declaration</span></span><span> = </span><span>{</span></code><table><tr id="type-object_declaration.object_name" class="anchored"><td class="def record field"><a href="#type-object_declaration.object_name" class="anchor"></a><code><span>object_name : string;</span></code></td></tr><tr id="type-object_declaration.object_stage" class="anchored"><td class="def record field"><a href="#type-object_declaration.object_stage" class="anchor"></a><code><span>object_stage : <a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a>;</span></code></td></tr><tr id="type-object_declaration.cache_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.cache_function" class="anchor"></a><code><span>cache_function : <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td></tr><tr id="type-object_declaration.load_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.load_function" class="anchor"></a><code><span>load_function : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td></tr><tr id="type-object_declaration.open_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.open_function" class="anchor"></a><code><span>open_function : <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td></tr><tr id="type-object_declaration.classify_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.classify_function" class="anchor"></a><code><span>classify_function : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-substitutivity">substitutivity</a>;</span></code></td></tr><tr id="type-object_declaration.subst_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.subst_function" class="anchor"></a><code><span>subst_function : <span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>;</span></code></td></tr><tr id="type-object_declaration.discharge_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.discharge_function" class="anchor"></a><code><span>discharge_function : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'discharged</span> option</span>;</span></code></td></tr><tr id="type-object_declaration.rebuild_function" class="anchored"><td class="def record field"><a href="#type-object_declaration.rebuild_function" class="anchor"></a><code><span>rebuild_function : <span><span class="type-var">'discharged</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-unfiltered" class="anchored"><a href="#val-unfiltered" class="anchor"></a><code><span><span class="keyword">val</span> unfiltered : <a href="#type-open_filter">open_filter</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_filter" class="anchored"><a href="#val-make_filter" class="anchor"></a><code><span><span class="keyword">val</span> make_filter : <span>finite:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span>string <a href="../CAst/index.html#type-t">CAst.t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-open_filter">open_filter</a></span></code></div><div class="spec-doc"><p>Anomaly when the list is empty.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-category" class="anchored"><a href="#type-category" class="anchor"></a><code><span><span class="keyword">type</span> category</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create_category" class="anchored"><a href="#val-create_category" class="anchor"></a><code><span><span class="keyword">val</span> create_category : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-category">category</a></span></code></div><div class="spec-doc"><p>Anomaly if called more than once for a given string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-in_filter" class="anchored"><a href="#val-in_filter" class="anchor"></a><code><span><span class="keyword">val</span> in_filter : <span>cat:<span><a href="#type-category">category</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>On <code>cat:None</code>, returns whether the filter allows opening uncategorized objects.</p><p>On <code>cat:(Some category)</code>, returns whether the filter allows opening objects in the given <code>category</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-simple_open" class="anchored"><a href="#val-simple_open" class="anchor"></a><code><span><span class="keyword">val</span> simple_open : <span>?cat:<a href="#type-category">category</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'i</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'i</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Combinator for making objects with simple category-based open behaviour. When <code>cat:None</code>, can be opened by Unfiltered, but also by Filtered with a negative set.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-filter_eq" class="anchored"><a href="#val-filter_eq" class="anchor"></a><code><span><span class="keyword">val</span> filter_eq : <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-filter_and" class="anchored"><a href="#val-filter_and" class="anchor"></a><code><span><span class="keyword">val</span> filter_and : <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> option</span></span></code></div><div class="spec-doc"><p>Returns <code>None</code> when the intersection is empty.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-filter_or" class="anchored"><a href="#val-filter_or" class="anchor"></a><code><span><span class="keyword">val</span> filter_or : <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-open_filter">open_filter</a></span></code></div></div><p>The default object has empty methods. Object creators are advised to use the construction <code>{(default_object &quot;MY_OBJECT&quot;) with
      cache_function = ...
   }</code> and specify only these functions which are not empty/meaningless</p><p>The classify_function must be specified.</p><div class="odoc-spec"><div class="spec value" id="val-default_object" class="anchored"><a href="#val-default_object" class="anchor"></a><code><span><span class="keyword">val</span> default_object : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-ident_subst_function" class="anchored"><a href="#val-ident_subst_function" class="anchor"></a><code><span><span class="keyword">val</span> ident_subst_function : <span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>the identity substitution function</p></div></div><h6 id="..."><a href="#..." class="anchor"></a>...</h6><p>Given an object declaration, the function <code>declare_object_full</code> will hand back two functions, the &quot;injection&quot; and &quot;projection&quot; functions for dynamically typed library-objects.</p><div class="odoc-spec"><div class="spec module" id="module-Dyn" class="anchored"><a href="#module-Dyn" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Dyn/index.html">Dyn</a></span><span> : <a href="../Dyn/module-type-S/index.html">Dyn.S</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-obj" class="anchored"><a href="#type-obj" class="anchor"></a><code><span><span class="keyword">type</span> obj</span><span> = <a href="Dyn/index.html#type-t">Dyn.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-ExportObj" class="anchored"><a href="#module-ExportObj" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="ExportObj/index.html">ExportObj</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-algebraic_objects" class="anchored"><a href="#type-algebraic_objects" class="anchor"></a><code><span><span class="keyword">type</span> algebraic_objects</span><span> = </span></code><table><tr id="type-algebraic_objects.Objs" class="anchored"><td class="def variant constructor"><a href="#type-algebraic_objects.Objs" class="anchor"></a><code><span>| </span><span><span class="constructor">Objs</span> <span class="keyword">of</span> <span><a href="#type-t">t</a> list</span></span></code></td></tr><tr id="type-algebraic_objects.Ref" class="anchored"><td class="def variant constructor"><a href="#type-algebraic_objects.Ref" class="anchor"></a><code><span>| </span><span><span class="constructor">Ref</span> <span class="keyword">of</span> <a href="../Names/ModPath/index.html#type-t">Names.ModPath.t</a> * <a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">and</span> t</span><span> = </span></code><table><tr id="type-t.ModuleObject" class="anchored"><td class="def variant constructor"><a href="#type-t.ModuleObject" class="anchor"></a><code><span>| </span><span><span class="constructor">ModuleObject</span> <span class="keyword">of</span> <a href="../Names/Id/index.html#type-t">Names.Id.t</a> * <a href="#type-substitutive_objects">substitutive_objects</a></span></code></td></tr><tr id="type-t.ModuleTypeObject" class="anchored"><td class="def variant constructor"><a href="#type-t.ModuleTypeObject" class="anchor"></a><code><span>| </span><span><span class="constructor">ModuleTypeObject</span> <span class="keyword">of</span> <a href="../Names/Id/index.html#type-t">Names.Id.t</a> * <a href="#type-substitutive_objects">substitutive_objects</a></span></code></td></tr><tr id="type-t.IncludeObject" class="anchored"><td class="def variant constructor"><a href="#type-t.IncludeObject" class="anchor"></a><code><span>| </span><span><span class="constructor">IncludeObject</span> <span class="keyword">of</span> <a href="#type-algebraic_objects">algebraic_objects</a></span></code></td></tr><tr id="type-t.KeepObject" class="anchored"><td class="def variant constructor"><a href="#type-t.KeepObject" class="anchor"></a><code><span>| </span><span><span class="constructor">KeepObject</span> <span class="keyword">of</span> <a href="../Names/Id/index.html#type-t">Names.Id.t</a> * <span><a href="#type-t">t</a> list</span></span></code></td></tr><tr id="type-t.EscapeObject" class="anchored"><td class="def variant constructor"><a href="#type-t.EscapeObject" class="anchor"></a><code><span>| </span><span><span class="constructor">EscapeObject</span> <span class="keyword">of</span> <a href="../Names/Id/index.html#type-t">Names.Id.t</a> * <span><a href="#type-t">t</a> list</span></span></code></td></tr><tr id="type-t.ExportObject" class="anchored"><td class="def variant constructor"><a href="#type-t.ExportObject" class="anchor"></a><code><span>| </span><span><span class="constructor">ExportObject</span> <span class="keyword">of</span> <a href="ExportObj/index.html#type-t">ExportObj.t</a></span></code></td></tr><tr id="type-t.AtomicObject" class="anchored"><td class="def variant constructor"><a href="#type-t.AtomicObject" class="anchor"></a><code><span>| </span><span><span class="constructor">AtomicObject</span> <span class="keyword">of</span> <a href="#type-obj">obj</a></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-substitutive_objects" class="anchored"><a href="#type-substitutive_objects" class="anchor"></a><code><span><span class="keyword">and</span> substitutive_objects</span><span> = <span><a href="../Names/MBId/index.html#type-t">Names.MBId.t</a> list</span> * <a href="#type-algebraic_objects">algebraic_objects</a></span></code></div></div><p>Object declaration and names: if you need the current prefix (typically to interact with the nametab), you need to have it passed to you.</p><ul><li><code>declare_named_object_gen</code> passes the raw prefix which you can manipulate as you wish.</li></ul><ul><li><code>declare_named_object_full</code> and <code>declare_named_object</code> provide the convenience of packaging it with the provided <code>Id.t</code> into a <code>object_name</code>.</li></ul><ul><li><code>declare_object</code> and <code>declare_object_full</code> ignore the prefix for you.</li></ul><div class="odoc-spec"><div class="spec value" id="val-declare_object" class="anchored"><a href="#val-declare_object" class="anchor"></a><code><span><span class="keyword">val</span> declare_object : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">_</span>)</span> <a href="#type-object_declaration">object_declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-obj">obj</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_object_full" class="anchored"><a href="#val-declare_object_full" class="anchor"></a><code><span><span class="keyword">val</span> declare_object_full : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">_</span>)</span> <a href="#type-object_declaration">object_declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="Dyn/index.html#type-tag">Dyn.tag</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_named_object_full" class="anchored"><a href="#val-declare_named_object_full" class="anchor"></a><code><span><span class="keyword">val</span> declare_named_object_full : <span><span><span>(<span class="type-var">'a</span>, <a href="#type-object_name">object_name</a> * <span class="type-var">'a</span>, <span class="type-var">_</span>)</span> <a href="#type-object_declaration">object_declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Names/Id/index.html#type-t">Names.Id.t</a> * <span class="type-var">'a</span>)</span> <a href="Dyn/index.html#type-tag">Dyn.tag</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_named_object" class="anchored"><a href="#val-declare_named_object" class="anchor"></a><code><span><span class="keyword">val</span> declare_named_object : <span><span><span>(<span class="type-var">'a</span>, <a href="#type-object_name">object_name</a> * <span class="type-var">'a</span>, <span class="type-var">_</span>)</span> <a href="#type-object_declaration">object_declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Names/Id/index.html#type-t">Names.Id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-obj">obj</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-declare_named_object_gen" class="anchored"><a href="#val-declare_named_object_gen" class="anchor"></a><code><span><span class="keyword">val</span> declare_named_object_gen : <span><span><span>(<span class="type-var">'a</span>, <a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <span class="type-var">'a</span>, <span class="type-var">_</span>)</span> <a href="#type-object_declaration">object_declaration</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-obj">obj</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cache_object" class="anchored"><a href="#val-cache_object" class="anchor"></a><code><span><span class="keyword">val</span> cache_object : <span><span>(<a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <a href="#type-obj">obj</a>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-load_object" class="anchored"><a href="#val-load_object" class="anchor"></a><code><span><span class="keyword">val</span> load_object : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <a href="#type-obj">obj</a>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_object" class="anchored"><a href="#val-open_object" class="anchor"></a><code><span><span class="keyword">val</span> open_object : <span><a href="#type-open_filter">open_filter</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Nametab/index.html#type-object_prefix">Nametab.object_prefix</a> * <a href="#type-obj">obj</a>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-subst_object" class="anchored"><a href="#val-subst_object" class="anchor"></a><code><span><span class="keyword">val</span> subst_object : <span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <a href="#type-obj">obj</a>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-obj">obj</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-classify_object" class="anchored"><a href="#val-classify_object" class="anchor"></a><code><span><span class="keyword">val</span> classify_object : <span><a href="#type-obj">obj</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-substitutivity">substitutivity</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-object_stage" class="anchored"><a href="#val-object_stage" class="anchor"></a><code><span><span class="keyword">val</span> object_stage : <span><a href="#type-obj">obj</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-discharged_obj" class="anchored"><a href="#type-discharged_obj" class="anchor"></a><code><span><span class="keyword">type</span> discharged_obj</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-discharge_object" class="anchored"><a href="#val-discharge_object" class="anchor"></a><code><span><span class="keyword">val</span> discharge_object : <span><a href="#type-obj">obj</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-discharged_obj">discharged_obj</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-rebuild_object" class="anchored"><a href="#val-rebuild_object" class="anchor"></a><code><span><span class="keyword">val</span> rebuild_object : <span><a href="#type-discharged_obj">discharged_obj</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-obj">obj</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-locality" class="anchored"><a href="#type-locality" class="anchor"></a><code><span><span class="keyword">type</span> locality</span><span> = </span></code><table><tr id="type-locality.Local" class="anchored"><td class="def variant constructor"><a href="#type-locality.Local" class="anchor"></a><code><span>| </span><span><span class="constructor">Local</span></span></code></td></tr><tr id="type-locality.Export" class="anchored"><td class="def variant constructor"><a href="#type-locality.Export" class="anchor"></a><code><span>| </span><span><span class="constructor">Export</span></span></code></td></tr><tr id="type-locality.SuperGlobal" class="anchored"><td class="def variant constructor"><a href="#type-locality.SuperGlobal" class="anchor"></a><code><span>| </span><span><span class="constructor">SuperGlobal</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-object_with_locality" class="anchored"><a href="#val-object_with_locality" class="anchor"></a><code><span><span class="keyword">val</span> object_with_locality : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?cat:<a href="#type-category">category</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>subst:<span><span>(<span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span>discharge:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-locality">locality</a> * <span class="type-var">'a</span>, <a href="#type-locality">locality</a> * <span class="type-var">'a</span>, <a href="#type-locality">locality</a> * <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div><div class="spec-doc"><p>Object with semi-static scoping: the scoping depends on the given <code>locality</code> not the rest of the object.</p><p>It is up to the caller of <code>add_leaf</code> to produce sensible errors if a value which cannot be discharged is given with non Local locality.</p><p>If <code>subst</code> is <code>None</code> non <code>Local</code> values are <code>Keep</code>, otherwise <code>Substitute</code>.</p><p><code>Export</code> values are only imported with shallow imports (depth = 1).</p><p><code>cat</code> only matters when importing, ie only for <code>Export</code> values.</p></div></div><p>Higher-level API for objects with fixed scope.</p><ul><li>Local means that the object cannot be imported from outside.</li><li>Global means that it can be imported (by importing the module that contains the object).</li><li>Superglobal means that the object survives to closing a module, and is imported when the file which contains it is Required (even without Import).</li><li>With the nodischarge variants, the object does not survive section closing. With the normal variants, it does.</li></ul><p>We recommend to avoid declaring superglobal objects and using the nodischarge variants.</p><div class="odoc-spec"><div class="spec value" id="val-local_object" class="anchored"><a href="#val-local_object" class="anchor"></a><code><span><span class="keyword">val</span> local_object : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>discharge:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-local_object_nodischarge" class="anchored"><a href="#val-local_object_nodischarge" class="anchor"></a><code><span><span class="keyword">val</span> local_object_nodischarge : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-global_object" class="anchored"><a href="#val-global_object" class="anchor"></a><code><span><span class="keyword">val</span> global_object : <span>?cat:<a href="#type-category">category</a> <span class="arrow">&#45;&gt;</span></span> <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>subst:<span><span>(<span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span>discharge:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-global_object_nodischarge" class="anchored"><a href="#val-global_object_nodischarge" class="anchor"></a><code><span><span class="keyword">val</span> global_object_nodischarge : <span>?cat:<a href="#type-category">category</a> <span class="arrow">&#45;&gt;</span></span> <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>subst:<span><span>(<span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-superglobal_object" class="anchored"><a href="#val-superglobal_object" class="anchor"></a><code><span><span class="keyword">val</span> superglobal_object : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>subst:<span><span>(<span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span>discharge:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-superglobal_object_nodischarge" class="anchored"><a href="#val-superglobal_object_nodischarge" class="anchor"></a><code><span><span class="keyword">val</span> superglobal_object_nodischarge : <span>?stage:<a href="../Summary/Stage/index.html#type-t">Summary.Stage.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>cache:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>subst:<span><span>(<span><span>(<a href="../Mod_subst/index.html#type-substitution">Mod_subst.substitution</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-object_declaration">object_declaration</a></span></span></code></div></div><h6 id="debug"><a href="#debug" class="anchor"></a>Debug</h6><div class="odoc-spec"><div class="spec value" id="val-dump" class="anchored"><a href="#val-dump" class="anchor"></a><code><span><span class="keyword">val</span> dump : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(int * string)</span> list</span></span></code></div></div></div></body></html>