<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Coq (coqide.Coq)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">coqide</a> &#x00BB; Coq</nav><h1>Module <code>Coq</code></h1><p>Coq : Interaction with the Coq toplevel</p><nav class="toc"><ul><li><a href="#general-structures">General structures</a></li><li><a href="#coqtop-process-management">Coqtop process management</a></li><li><a href="#task-processing">Task processing</a></li><li><a href="#atomic-calls-to-coqtop">Atomic calls to coqtop</a></li><li><a href="#miscellaneous">Miscellaneous</a></li></ul></nav></header><section><header><h4 id="general-structures"><a href="#general-structures" class="anchor"></a>General structures</h4></header><dl><dt class="spec type" id="type-coqtop"><a href="#type-coqtop" class="anchor"></a><code><span class="keyword">type </span>coqtop</code></dt><dd><p>The structure describing a coqtop sub-process .</p><p>Liveness management of coqtop is automatic. Whenever a coqtop dies abruptly, this module is responsible for relaunching the whole process. The reset handler set through <code>set_reset_handler</code> will be called after such an abrupt failure. It is also called when explicitly requesting coqtop to reset.</p></dd></dl><dl><dt class="spec type" id="type-task"><a href="#type-task" class="anchor"></a><code><span class="keyword">type </span>'a task</code></dt><dd><p>Coqtop tasks.</p><p>A task is a group of sequential calls to be performed on a coqtop process, that ultimately return some content.</p><p>If a task is already sent to coqtop, it is considered busy (<code>is_computing</code> will answer <code>true</code>), and any other task submission will be rejected by <code>try_grab</code>.</p><p>Any exception occurring within the task will trigger a coqtop reset.</p><p>Beware, because of the GTK scheduler, you never know when a task will actually be executed. If you need to sequentialize imperative actions, you should do so using the monadic primitives.</p></dd></dl><dl><dt class="spec value" id="val-return"><a href="#val-return" class="anchor"></a><code><span class="keyword">val </span>return : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-task">task</a></code></dt><dd><p>Monadic return of values as tasks.</p></dd></dl><dl><dt class="spec value" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span class="keyword">val </span>bind : <span class="type-var">'a</span> <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-task">task</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-task">task</a></code></dt><dd><p>Monadic binding of tasks</p></dd></dl><dl><dt class="spec value" id="val-lift"><a href="#val-lift" class="anchor"></a><code><span class="keyword">val </span>lift : (unit <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-task">task</a></code></dt><dd><p>Return the imperative computation waiting to be processed.</p></dd></dl><dl><dt class="spec value" id="val-seq"><a href="#val-seq" class="anchor"></a><code><span class="keyword">val </span>seq : unit <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-task">task</a></code></dt><dd><p>Sequential composition</p></dd></dl></section><section><header><h4 id="coqtop-process-management"><a href="#coqtop-process-management" class="anchor"></a>Coqtop process management</h4></header><dl><dt class="spec type" id="type-reset_kind"><a href="#type-reset_kind" class="anchor"></a><code><span class="keyword">type </span>reset_kind</code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-reset_kind.Planned" class="anchored"><td class="def constructor"><a href="#type-reset_kind.Planned" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Planned</span></code></td></tr><tr id="type-reset_kind.Unexpected" class="anchored"><td class="def constructor"><a href="#type-reset_kind.Unexpected" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Unexpected</span></code></td><td class="doc"><p>A reset may occur accidentally or voluntarily, so we discriminate between these.</p></td></tr></table></dt></dl><dl><dt class="spec value" id="val-is_computing"><a href="#val-is_computing" class="anchor"></a><code><span class="keyword">val </span>is_computing : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Check if coqtop is computing, i.e. already has a current task</p></dd></dl><dl><dt class="spec value" id="val-spawn_coqtop"><a href="#val-spawn_coqtop" class="anchor"></a><code><span class="keyword">val </span>spawn_coqtop : string list <span>&#45;&gt;</span> <a href="index.html#type-coqtop">coqtop</a></code></dt><dd><p>Create a coqtop process with some command-line arguments.</p></dd></dl><dl><dt class="spec value" id="val-set_reset_handler"><a href="#val-set_reset_handler" class="anchor"></a><code><span class="keyword">val </span>set_reset_handler : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> unit <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Register a handler called when a coqtop dies (badly or on purpose)</p></dd></dl><dl><dt class="spec value" id="val-set_feedback_handler"><a href="#val-set_feedback_handler" class="anchor"></a><code><span class="keyword">val </span>set_feedback_handler : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> (<a href="../../coq/Feedback/index.html#type-feedback">Feedback.feedback</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p>Register a handler called when coqtop sends a feedback message</p></dd></dl><dl><dt class="spec value" id="val-init_coqtop"><a href="#val-init_coqtop" class="anchor"></a><code><span class="keyword">val </span>init_coqtop : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> unit <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Finish initializing a freshly spawned coqtop, by running a first task on it. The task should run its inner continuation at the end.</p></dd></dl><dl><dt class="spec value" id="val-break_coqtop"><a href="#val-break_coqtop" class="anchor"></a><code><span class="keyword">val </span>break_coqtop : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> unit</code></dt><dd><p>Interrupt the current computation of coqtop or the worker if coqtop it not running.</p></dd></dl><dl><dt class="spec value" id="val-close_coqtop"><a href="#val-close_coqtop" class="anchor"></a><code><span class="keyword">val </span>close_coqtop : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Close coqtop. Subsequent requests will be discarded. Hook ignored.</p></dd></dl><dl><dt class="spec value" id="val-reset_coqtop"><a href="#val-reset_coqtop" class="anchor"></a><code><span class="keyword">val </span>reset_coqtop : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Reset coqtop. Pending requests will be discarded. The reset handler of coqtop will be called with <code>Planned</code> as first argument</p></dd></dl><dl><dt class="spec value" id="val-get_arguments"><a href="#val-get_arguments" class="anchor"></a><code><span class="keyword">val </span>get_arguments : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> string list</code></dt><dd><p>Get the current arguments used by coqtop.</p></dd></dl><dl><dt class="spec value" id="val-set_arguments"><a href="#val-set_arguments" class="anchor"></a><code><span class="keyword">val </span>set_arguments : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> unit</code></dt><dd><p>Set process arguments. This also forces a planned reset.</p></dd></dl><dl><dt class="spec value" id="val-gio_channel_of_descr_socket"><a href="#val-gio_channel_of_descr_socket" class="anchor"></a><code><span class="keyword">val </span>gio_channel_of_descr_socket : (Unix.file_descr <span>&#45;&gt;</span> Glib.Io.channel) Stdlib.ref</code></dt><dd><p>In win32, sockets are not like regular files</p></dd></dl></section><section><header><h4 id="task-processing"><a href="#task-processing" class="anchor"></a>Task processing</h4></header><dl><dt class="spec value" id="val-try_grab"><a href="#val-try_grab" class="anchor"></a><code><span class="keyword">val </span>try_grab : <a href="index.html#type-coqtop">coqtop</a> <span>&#45;&gt;</span> unit <a href="index.html#type-task">task</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p>Try to schedule a task on a coqtop. If coqtop is available, the task callback is run (asynchronously), otherwise the <code>(unit-&gt;unit)</code> callback is triggered.</p><ul><li>If coqtop ever dies during the computation, this function restarts coqtop and calls the restart hook with the fresh coqtop.</li><li>If the argument function raises an exception, a coqtop reset occurs.</li><li>The task may be discarded if a <code>close_coqtop</code> or <code>reset_coqtop</code> occurs before its completion.</li><li>The task callback should run its inner continuation at the end.</li></ul></dd></dl></section><section><header><h4 id="atomic-calls-to-coqtop"><a href="#atomic-calls-to-coqtop" class="anchor"></a>Atomic calls to coqtop</h4></header><aside><p>These atomic calls can be combined to form arbitrary multi-call tasks. They correspond to the protocol calls (cf <code>Serialize</code> for more details). Note that each call is asynchronous: it will return immediately, but the inner callback will be executed later to handle the call answer when this answer is available. Except for interp, we use the default logger for any call.</p></aside><dl><dt class="spec type" id="type-query"><a href="#type-query" class="anchor"></a><code><span class="keyword">type </span>'a query</code><code><span class="keyword"> = </span><span class="type-var">'a</span> <a href="../../coqide-server/Interface/index.html#type-value">Interface.value</a> <a href="index.html#type-task">task</a></code></dt><dd><p>A type abbreviation for coqtop specific answers</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val </span>add : <a href="../../coqide-server/Interface/index.html#type-add_sty">Interface.add_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-add_rty">Interface.add_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-edit_at"><a href="#val-edit_at" class="anchor"></a><code><span class="keyword">val </span>edit_at : <a href="../../coqide-server/Interface/index.html#type-edit_at_sty">Interface.edit_at_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-edit_at_rty">Interface.edit_at_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-query"><a href="#val-query" class="anchor"></a><code><span class="keyword">val </span>query : <a href="../../coqide-server/Interface/index.html#type-query_sty">Interface.query_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-query_rty">Interface.query_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val </span>status : <a href="../../coqide-server/Interface/index.html#type-status_sty">Interface.status_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-status_rty">Interface.status_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-goals"><a href="#val-goals" class="anchor"></a><code><span class="keyword">val </span>goals : <a href="../../coqide-server/Interface/index.html#type-goals_sty">Interface.goals_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-goals_rty">Interface.goals_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-evars"><a href="#val-evars" class="anchor"></a><code><span class="keyword">val </span>evars : <a href="../../coqide-server/Interface/index.html#type-evars_sty">Interface.evars_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-evars_rty">Interface.evars_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-hints"><a href="#val-hints" class="anchor"></a><code><span class="keyword">val </span>hints : <a href="../../coqide-server/Interface/index.html#type-hints_sty">Interface.hints_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-hints_rty">Interface.hints_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-mkcases"><a href="#val-mkcases" class="anchor"></a><code><span class="keyword">val </span>mkcases : <a href="../../coqide-server/Interface/index.html#type-mkcases_sty">Interface.mkcases_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-mkcases_rty">Interface.mkcases_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-search"><a href="#val-search" class="anchor"></a><code><span class="keyword">val </span>search : <a href="../../coqide-server/Interface/index.html#type-search_sty">Interface.search_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-search_rty">Interface.search_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val </span>init : <a href="../../coqide-server/Interface/index.html#type-init_sty">Interface.init_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-init_rty">Interface.init_rty</a> <a href="index.html#type-query">query</a></code></dt><dt class="spec value" id="val-stop_worker"><a href="#val-stop_worker" class="anchor"></a><code><span class="keyword">val </span>stop_worker : <a href="../../coqide-server/Interface/index.html#type-stop_worker_sty">Interface.stop_worker_sty</a> <span>&#45;&gt;</span> <a href="../../coqide-server/Interface/index.html#type-stop_worker_rty">Interface.stop_worker_rty</a> <a href="index.html#type-query">query</a></code></dt></dl><aside><p>A specialized version of <code>raw_interp</code> dedicated to set/unset options.</p></aside><div class="spec module" id="module-PrintOpt"><a href="#module-PrintOpt" class="anchor"></a><code><span class="keyword">module </span><a href="PrintOpt/index.html">PrintOpt</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h4 id="miscellaneous"><a href="#miscellaneous" class="anchor"></a>Miscellaneous</h4></header><dl><dt class="spec value" id="val-short_version"><a href="#val-short_version" class="anchor"></a><code><span class="keyword">val </span>short_version : unit <span>&#45;&gt;</span> string</code></dt><dd><p>Return a short phrase identifying coqtop version and date of compilation, as given by the <code>configure</code> script.</p></dd></dl><dl><dt class="spec value" id="val-version"><a href="#val-version" class="anchor"></a><code><span class="keyword">val </span>version : unit <span>&#45;&gt;</span> string</code></dt><dd><p>More verbose description, including details about libraries and architecture.</p></dd></dl><dl><dt class="spec value" id="val-filter_coq_opts"><a href="#val-filter_coq_opts" class="anchor"></a><code><span class="keyword">val </span>filter_coq_opts : string list <span>&#45;&gt;</span> string list</code></dt><dd><p>* Launch a test coqtop processes, ask for a correct coqtop if it fails.</p><dl><dt>returns</dt><dd><p>the list of arguments that coqtop did not understand (the files probably ..). This command may terminate coqide in case of trouble.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-check_connection"><a href="#val-check_connection" class="anchor"></a><code><span class="keyword">val </span>check_connection : string list <span>&#45;&gt;</span> unit</code></dt><dd><p>Launch a coqtop with the user args in order to be sure that it works, checking in particular that Prelude.vo is found. This command may terminate coqide in case of trouble</p></dd></dl><dl><dt class="spec value" id="val-interrupter"><a href="#val-interrupter" class="anchor"></a><code><span class="keyword">val </span>interrupter : (int <span>&#45;&gt;</span> unit) Stdlib.ref</code></dt><dt class="spec value" id="val-save_all"><a href="#val-save_all" class="anchor"></a><code><span class="keyword">val </span>save_all : (unit <span>&#45;&gt;</span> unit) Stdlib.ref</code></dt><dt class="spec value" id="val-ideslave_coqtop_flags"><a href="#val-ideslave_coqtop_flags" class="anchor"></a><code><span class="keyword">val </span>ideslave_coqtop_flags : string option Stdlib.ref</code></dt></dl></section></div></body></html>