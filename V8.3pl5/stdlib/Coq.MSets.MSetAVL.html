<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Standard Library | The Coq Proof Assistant</title>

<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<style type="text/css" media="all">@import "/modules/node/node.css";</style>

<style type="text/css" media="all">@import "/modules/system/defaults.css";</style>
<style type="text/css" media="all">@import "/modules/system/system.css";</style>
<style type="text/css" media="all">@import "/modules/user/user.css";</style>

<style type="text/css" media="all">@import "/sites/all/themes/coq/style.css";</style>
<style type="text/css" media="all">@import "/sites/all/themes/coq/coqdoc.css";</style>

</head>

<body>

<div id="container">
<div id="headertop">
<div id="nav">
  <ul class="links-menu">
    <li><a href="http://coq.inria.fr/" class="active">Home</a></li>
    
    <li><a href="http://coq.inria.fr/about-coq" title="More about coq">About Coq</a></li>    
    <li><a href="http://coq.inria.fr/download">Get Coq</a></li>
    <li><a href="http://coq.inria.fr/documentation">Documentation</a></li>
    <li><a href="http://coq.inria.fr/community">Community</a></li>
  </ul>
</div>
</div>

<div id="header">

<div id="logoWrapper">

<div id="logo"><a href="http://coq.inria.fr/" title="Home"><img src="/files/barron_logo.png" alt="Home" /></a>
</div>
<div id="siteName"><a href="http://coq.inria.fr/" title="Home">The Coq Proof Assistant</a>
</div>

</div>
</div>

<div id="content">

<h1 class="libtitle">Library Coq.MSets.MSetAVL</h1>

<div class="code">

<br/>

<br/>
</div>

<div class="doc">
<a name="lab477"></a><h1 class="section">MSetAVL : Implementation of MSetInterface via AVL trees</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
This module implements finite sets using AVL trees.
    It follows the implementation from Ocaml's standard library,

<br/> <br/>
    All operations given here expect and produce well-balanced trees
    (in the ocaml sense: heigths of subtrees shouldn't differ by more
    than 2), and hence has low complexities (e.g. add is logarithmic
    in the size of the set). But proving these balancing preservations
    is in fact not necessary for ensuring correct operational behavior
    and hence fulfilling the MSet interface. As a consequence,
    balancing results are not part of this file anymore, they can
    now be found in <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span>.

<br/> <br/>
    Four operations (<span class="inlinecode"><span class="id" type="var">union</span></span>, <span class="inlinecode"><span class="id" type="var">subset</span></span>, <span class="inlinecode"><span class="id" type="var">compare</span></span> and <span class="inlinecode"><span class="id" type="var">equal</span></span>) have
    been slightly adapted in order to have only structural recursive
    calls. The precise ocaml versions of these operations have also
    been formalized (thanks to Function+measure), see <span class="inlinecode"><span class="id" type="var">ocaml_union</span></span>,
    <span class="inlinecode"><span class="id" type="var">ocaml_subset</span></span>, <span class="inlinecode"><span class="id" type="var">ocaml_compare</span></span> and <span class="inlinecode"><span class="id" type="var">ocaml_equal</span></span> in
    <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span>. The structural variants compute faster in Coq,
    whereas the other variants produce nicer and/or (slightly) faster
    code after extraction.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="Coq.MSets.MSetInterface.html#"><span class="id" type="library">MSetInterface</span></a> <a class="idref" href="Coq.ZArith.ZArith.html#"><span class="id" type="library">ZArith</span></a> <a class="idref" href="Coq.ZArith.Int.html#"><span class="id" type="library">Int</span></a>.<br/>

<br/>
<span class="id" type="keyword">Local</span><span class="id" type="keyword">Local</span>
<br/>
</div>

<div class="doc">
<a name="lab478"></a><h1 class="section">Ops : the pure functions</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <a name="Ops"><span class="id" type="module">Ops</span></a> (<span class="id" type="keyword">Import</span> <span class="id" type="var">I</span>:<a class="idref" href="Coq.ZArith.Int.html#"><span class="id" type="module">Int</span></a>)(<span class="id" type="var">X</span>:<a class="idref" href="Coq.Structures.Orders.html#"><span class="id" type="module">OrderedType</span></a>) &lt;: <a class="idref" href="Coq.MSets.MSetInterface.html#"><span class="id" type="module">WOps</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">X</span></a>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">Int_scope</span>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">lazy_bool_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.elt"><span class="id" type="definition">elt</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#X.t"><span class="id" type="axiom">X.t</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab479"></a><h2 class="section">Trees</h2>


<br/> <br/>
   The fourth field of <span class="inlinecode"><span class="id" type="var">Node</span></span> is the height of the tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Ops.tree"><span class="id" type="inductive">tree</span></a> :=<br/>
&nbsp;&nbsp;| <a name="Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#tree"><span class="id" type="inductive">tree</span></a><br/>
&nbsp;&nbsp;| <a name="Ops.Node"><span class="id" type="constructor">Node</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#tree"><span class="id" type="inductive">tree</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#X.t"><span class="id" type="axiom">X.t</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#tree"><span class="id" type="inductive">tree</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#I.int"><span class="id" type="axiom">int</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#tree"><span class="id" type="inductive">tree</span></a>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.t"><span class="id" type="definition">t</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.tree"><span class="id" type="inductive">tree</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab480"></a><h2 class="section">Basic functions on trees: height and cardinal</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.height"><span class="id" type="definition">height</span></a> (<span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <a class="idref" href="Coq.MSets.MSetAVL.html#I.int"><span class="id" type="axiom">int</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; 0<br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">h</span> =&gt; <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.cardinal"><span class="id" type="definition">cardinal</span></a> (<span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <a class="idref" href="Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; 0%<span class="id" type="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">_</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#cardinal"><span class="id" type="definition">cardinal</span></a> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Peano.html#:nat_scope:x_'+'_x"><span class="id" type="notation">+</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#cardinal"><span class="id" type="definition">cardinal</span></a> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab481"></a><h2 class="section">Empty Set</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.empty"><span class="id" type="definition">empty</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab482"></a><h2 class="section">Emptyness test</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.is_empty"><span class="id" type="definition">is_empty</span></a> <span class="id" type="var">s</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a> | <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab483"></a><h2 class="section">Membership</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" type="var">mem</span></span> function is deciding membership. It exploits the
    binary search tree invariant to achieve logarithmic complexity. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab484"></a><h2 class="section">Singleton set</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.singleton"><span class="id" type="definition">singleton</span></a> <span class="id" type="var">x</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">x</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> 1.<br/>

<br/>
</div>

<div class="doc">
<a name="lab485"></a><h2 class="section">Helper functions</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span></span> creates a node, assuming <span class="inlinecode"><span class="id" type="var">l</span></span> and <span class="inlinecode"><span class="id" type="var">r</span></span>
    to be balanced and <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">l</span> - <span class="id" type="var">height</span> <span class="id" type="var">r</span>| &lt;= 2</span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#I.max"><span class="id" type="axiom">max</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">l</span>) (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">r</span>) <a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a> 1).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span></span> acts as <span class="inlinecode"><span class="id" type="var">create</span></span>, but performs one step of
    rebalancing if necessary, i.e. assumes <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">l</span> - <span class="id" type="var">height</span> <span class="id" type="var">r</span>| &lt;= 3</span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.assert_false"><span class="id" type="definition">assert_false</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">hl</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">hr</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">r</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">hl</span> (<span class="id" type="var">hr</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.ge_lt_dec"><span class="id" type="axiom">ge_lt_dec</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">ll</span>) (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">lr</span>) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">lr</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">lrl</span> <span class="id" type="var">lrx</span> <span class="id" type="var">lrr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lrl</span>) <span class="id" type="var">lrx</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">lrr</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">hr</span> (<span class="id" type="var">hl</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">r</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.ge_lt_dec"><span class="id" type="axiom">ge_lt_dec</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">rr</span>) (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">rl</span>) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rl</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rll</span> <span class="id" type="var">rlx</span> <span class="id" type="var">rlr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">rll</span>) <span class="id" type="var">rlx</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">rlr</span> <span class="id" type="var">rx</span> <span class="id" type="var">rr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab486"></a><h2 class="section">Insertion</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">x</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> 1<br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span>) <span class="id" type="var">y</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab487"></a><h2 class="section">Join</h2>


<br/> <br/>
    Same as <span class="inlinecode"><span class="id" type="var">bal</span></span> but does not assume anything regarding heights
    of <span class="inlinecode"><span class="id" type="var">l</span></span> and <span class="inlinecode"><span class="id" type="var">r</span></span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">l</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.add"><span class="id" type="definition">add</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span> =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">fix</span> <span class="id" type="var">join_aux</span> (<span class="id" type="var">r</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> := <span class="id" type="keyword">match</span> <span class="id" type="var">r</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt;  <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rr</span> <span class="id" type="var">rh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">lh</span> (<span class="id" type="var">rh</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#join"><span class="id" type="definition">join</span></a> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <a class="idref" href="Coq.MSets.MSetAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">rh</span> (<span class="id" type="var">lh</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> (<span class="id" type="var">join_aux</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab488"></a><h2 class="section">Extraction of minimum element</h2>


<br/> <br/>
  Morally, <span class="inlinecode"><span class="id" type="var">remove_min</span></span> is to be applied to a non-empty tree
  <span class="inlinecode"><span class="id" type="var">t</span> = <span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span></span>. Since we can't deal here with <span class="inlinecode"><span class="id" type="tactic">assert</span> <span class="id" type="var">false</span></span>
  for <span class="inlinecode"><span class="id" type="var">t</span>=<span class="id" type="var">Leaf</span></span>, we pre-unpack <span class="inlinecode"><span class="id" type="var">t</span></span> (and forget about <span class="inlinecode"><span class="id" type="var">h</span></span>).

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><span class="id" type="var">r</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a><span class="id" type="var">x</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l'</span>,<span class="id" type="var">m</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l'</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a> <span class="id" type="var">m</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab489"></a><h2 class="section">Merging two trees</h2>


<br/> <br/>
  <span class="inlinecode"><span class="id" type="var">merge</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span></span> builds the union of <span class="inlinecode"><span class="id" type="var">t1</span></span> and <span class="inlinecode"><span class="id" type="var">t2</span></span> assuming all elements
  of <span class="inlinecode"><span class="id" type="var">t1</span></span> to be smaller than all elements of <span class="inlinecode"><span class="id" type="var">t2</span></span>, and
  <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">t1</span> - <span class="id" type="var">height</span> <span class="id" type="var">t2</span>| &lt;= 2</span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.merge"><span class="id" type="definition">merge</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=  <span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>,<span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">s1</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">s2'</span>,<span class="id" type="var">m</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">m</span> <span class="id" type="var">s2'</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab490"></a><h2 class="section">Deletion</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span>) <span class="id" type="var">y</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.merge"><span class="id" type="definition">merge</span></a> <span class="id" type="var">l</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span>  <span class="id" type="var">y</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab491"></a><h2 class="section">Minimum element</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.min_elt"><span class="id" type="definition">min_elt</span></a> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">y</span> <span class="id" type="var">_</span>  <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">y</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#min_elt"><span class="id" type="definition">min_elt</span></a> <span class="id" type="var">l</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab492"></a><h2 class="section">Maximum element</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.max_elt"><span class="id" type="definition">max_elt</span></a> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">y</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>  <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">y</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#max_elt"><span class="id" type="definition">max_elt</span></a> <span class="id" type="var">r</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab493"></a><h2 class="section">Any element</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.choose"><span class="id" type="definition">choose</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.min_elt"><span class="id" type="definition">min_elt</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab494"></a><h2 class="section">Concatenation</h2>


<br/> <br/>
    Same as <span class="inlinecode"><span class="id" type="var">merge</span></span> but does not assume anything about heights.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.concat"><span class="id" type="definition">concat</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>, <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">s1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">s2'</span>,<span class="id" type="var">m</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">m</span> <span class="id" type="var">s2'</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab495"></a><h2 class="section">Splitting</h2>


<br/> <br/>
    <span class="inlinecode"><span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span></span> returns a triple <span class="inlinecode">(<span class="id" type="var">l</span>, <span class="id" type="var">present</span>, <span class="id" type="var">r</span>)</span> where
<ul>
<li> <span class="inlinecode"><span class="id" type="var">l</span></span> is the set of elements of <span class="inlinecode"><span class="id" type="var">s</span></span> that are <span class="inlinecode">&lt; <span class="id" type="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">r</span></span> is the set of elements of <span class="inlinecode"><span class="id" type="var">s</span></span> that are <span class="inlinecode">&gt; <span class="id" type="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">present</span></span> is <span class="inlinecode"><span class="id" type="var">true</span></span> if and only if <span class="inlinecode"><span class="id" type="var">s</span></span> contains  <span class="inlinecode"><span class="id" type="var">x</span></span>.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Record</span> <a name="Ops.triple"><span class="id" type="record">triple</span></a> := <a name="Ops.mktriple"><span class="id" type="constructor">mktriple</span></a> { <a name="Ops.t_left"><span class="id" type="projection">t_left</span></a>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>; <a name="Ops.t_in"><span class="id" type="projection">t_in</span></a>:<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>; <a name="Ops.t_right"><span class="id" type="projection">t_right</span></a>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> }.<br/>
<span class="id" type="var">Notation </span><a name="Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">"</span></a>&lt;&lt; l , b , r &gt;&gt;" := (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.mktriple"><span class="id" type="constructor">mktriple</span></a> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9).<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.triple"><span class="id" type="record">triple</span></a> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">ll</span>,<span class="id" type="var">b</span>,<span class="id" type="var">rl</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <span class="id" type="var">ll</span><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">b</span><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <span class="id" type="var">l</span><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">r</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">rl</span>,<span class="id" type="var">b</span>,<span class="id" type="var">rr</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">rl</span><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">b</span><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">rr</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab496"></a><h2 class="section">Intersection</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.inter"><span class="id" type="definition">inter</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>, <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>, <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l2'</span>,<span class="id" type="var">pres</span>,<span class="id" type="var">r2'</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">pres</span> <span class="id" type="keyword">then</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#inter"><span class="id" type="definition">inter</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="var">x1</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#inter"><span class="id" type="definition">inter</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.concat"><span class="id" type="definition">concat</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#inter"><span class="id" type="definition">inter</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) (<a class="idref" href="Coq.MSets.MSetAVL.html#inter"><span class="id" type="definition">inter</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab497"></a><h2 class="section">Difference</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.diff"><span class="id" type="definition">diff</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>, <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">s1</span><br/>
&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>, <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l2'</span>,<span class="id" type="var">pres</span>,<span class="id" type="var">r2'</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">pres</span> <span class="id" type="keyword">then</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.concat"><span class="id" type="definition">concat</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#diff"><span class="id" type="definition">diff</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) (<a class="idref" href="Coq.MSets.MSetAVL.html#diff"><span class="id" type="definition">diff</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#diff"><span class="id" type="definition">diff</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="var">x1</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#diff"><span class="id" type="definition">diff</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab498"></a><h2 class="section">Union</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
In ocaml, heights of <span class="inlinecode"><span class="id" type="var">s1</span></span> and <span class="inlinecode"><span class="id" type="var">s2</span></span> are compared each time in order
   to recursively perform the split on the smaller set.
   Unfortunately, this leads to a non-structural algorithm. The
   following code is a simplification of the ocaml version: no
   comparison of heights. It might be slightly slower, but
   experimentally all the tests I've made in ocaml have shown this
   potential slowdown to be non-significant. Anyway, the exact code
   of ocaml has also been formalized thanks to Function+measure, see
   <span class="inlinecode"><span class="id" type="var">ocaml_union</span></span> in <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.union"><span class="id" type="definition">union</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>, <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">s1</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>, <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l2'</span>,<span class="id" type="var">_</span>,<span class="id" type="var">r2'</span>) := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.join"><span class="id" type="definition">join</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#union"><span class="id" type="definition">union</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="var">x1</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#union"><span class="id" type="definition">union</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab499"></a><h2 class="section">Elements</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">elements_tree_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">t</span></span> catenates the elements of <span class="inlinecode"><span class="id" type="var">t</span></span> in infix
    order to the list <span class="inlinecode"><span class="id" type="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.elements_aux"><span class="id" type="definition">elements_aux</span></a> (<span class="id" type="var">acc</span> : <a class="idref" href="Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#X.t"><span class="id" type="axiom">X.t</span></a>) (<span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <a class="idref" href="Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#X.t"><span class="id" type="axiom">X.t</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#elements_aux"><span class="id" type="definition">elements_aux</span></a> (<span class="id" type="var">x</span> <a class="idref" href="Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#elements_aux"><span class="id" type="definition">elements_aux</span></a> <span class="id" type="var">acc</span> <span class="id" type="var">r</span>) <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
then <span class="inlinecode"><span class="id" type="var">elements</span></span> is an instanciation with an empty <span class="inlinecode"><span class="id" type="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.elements"><span class="id" type="definition">elements</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elements_aux"><span class="id" type="definition">elements_aux</span></a> <a class="idref" href="Coq.Init.Datatypes.html#nil"><span class="id" type="constructor">nil</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab500"></a><h2 class="section">Filter</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.filter_acc"><span class="id" type="definition">filter_acc</span></a> (<span class="id" type="var">f</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">acc</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#filter_acc"><span class="id" type="definition">filter_acc</span></a> <span class="id" type="var">f</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#filter_acc"><span class="id" type="definition">filter_acc</span></a> <span class="id" type="var">f</span> (<span class="id" type="keyword">if</span> <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="keyword">then</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">acc</span> <span class="id" type="keyword">else</span> <span class="id" type="var">acc</span>) <span class="id" type="var">l</span>) <span class="id" type="var">r</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.filter"><span class="id" type="definition">filter</span></a> <span class="id" type="var">f</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.filter_acc"><span class="id" type="definition">filter_acc</span></a> <span class="id" type="var">f</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab501"></a><h2 class="section">Partition</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.partition_acc"><span class="id" type="definition">partition_acc</span></a> (<span class="id" type="var">f</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>)(<span class="id" type="var">acc</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>)(<span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">acct</span>,<span class="id" type="var">accf</span>) := <span class="id" type="var">acc</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#partition_acc"><span class="id" type="definition">partition_acc</span></a> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Coq.MSets.MSetAVL.html#partition_acc"><span class="id" type="definition">partition_acc</span></a> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">if</span> <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="keyword">then</span> <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">acct</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a> <span class="id" type="var">accf</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a> <span class="id" type="keyword">else</span> <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><span class="id" type="var">acct</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">accf</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a>) <span class="id" type="var">l</span>) <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.partition"><span class="id" type="definition">partition</span></a> <span class="id" type="var">f</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.partition_acc"><span class="id" type="definition">partition_acc</span></a> <span class="id" type="var">f</span> <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a><a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab502"></a><h2 class="section"><span class="inlinecode"><span class="id" type="var">for_all</span></span> and <span class="inlinecode"><span class="id" type="var">exists</span></span></h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.for_all"><span class="id" type="definition">for_all</span></a> (<span class="id" type="var">f</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#for_all"><span class="id" type="definition">for_all</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#for_all"><span class="id" type="definition">for_all</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.exists_"><span class="id" type="definition">exists_</span></a> (<span class="id" type="var">f</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'|||'_x"><span class="id" type="notation">|||</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#exists_"><span class="id" type="definition">exists_</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'|||'_x"><span class="id" type="notation">|||</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#exists_"><span class="id" type="definition">exists_</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab503"></a><h2 class="section">Fold</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.fold"><span class="id" type="definition">fold</span></a> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>)(<span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>) : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> :=<br/>
&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#fold"><span class="id" type="definition">fold</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span> (<span class="id" type="var">f</span> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#fold"><span class="id" type="definition">fold</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span>))<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Implicit Arguments</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.fold"><span class="id" type="definition">fold</span></a> [<span class="id" type="var">A</span>].<br/>

<br/>
</div>

<div class="doc">
<a name="lab504"></a><h2 class="section">Subset</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
In ocaml, recursive calls are made on "half-trees" such as
   (Node l1 x1 Leaf _) and (Node Leaf x1 r1 _). Instead of these
   non-structural calls, we propose here two specialized functions for
   these situations. This version should be almost as efficient as
   the one of ocaml (closures as arguments may slow things a bit),
   it is simply less compact. The exact ocaml version has also been
   formalized (thanks to Function+measure), see <span class="inlinecode"><span class="id" type="var">ocaml_subset</span></span> in
   <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span>.
 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.subsetl"><span class="id" type="definition">subsetl</span></a> (<span class="id" type="var">subset_l1</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> : <a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <span class="id" type="var">subset_l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#subsetl"><span class="id" type="definition">subsetl</span></a> <span class="id" type="var">subset_l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">r2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <span class="id" type="var">subset_l1</span> <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.subsetr"><span class="id" type="definition">subsetr</span></a> (<span class="id" type="var">subset_r1</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> : <a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <span class="id" type="var">subset_r1</span> <span class="id" type="var">r2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">l2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <span class="id" type="var">subset_r1</span> <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#subsetr"><span class="id" type="definition">subsetr</span></a> <span class="id" type="var">subset_r1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a> := <span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>, <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.subsetl"><span class="id" type="definition">subsetl</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">l1</span>) <span class="id" type="var">x1</span> <span class="id" type="var">l2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.subsetr"><span class="id" type="definition">subsetr</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">r1</span>) <span class="id" type="var">x1</span> <span class="id" type="var">r2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#subset"><span class="id" type="definition">subset</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab505"></a><h2 class="section">A new comparison algorithm suggested by Xavier Leroy</h2>


<br/> <br/>
    Transformation in C.P.S. suggested by Benjamin Grégoire.
    The original ocaml code (with non-structural recursive calls)
    has also been formalized (thanks to Function+measure), see
    <span class="inlinecode"><span class="id" type="var">ocaml_compare</span></span> in <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span>. The following code with
    continuations computes dramatically faster in Coq, and
    should be almost as efficient after extraction.

</div>
<div class="code">

<br/>
</div>

<div class="doc">
Enumeration of the elements of a tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Ops.enumeration"><span class="id" type="inductive">enumeration</span></a> :=<br/>
&nbsp;| <span class="id" type="keyword">End</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a><br/>
&nbsp;| <a name="Ops.More"><span class="id" type="constructor">More</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.elt"><span class="id" type="definition">elt</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.t"><span class="id" type="definition">t</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">cons</span> <span class="id" type="var">t</span> <span class="id" type="var">e</span></span> adds the elements of tree <span class="inlinecode"><span class="id" type="var">t</span></span> on the head of
    enumeration <span class="inlinecode"><span class="id" type="var">e</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">s</span> <span class="id" type="var">e</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.enumeration"><span class="id" type="inductive">enumeration</span></a> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">e</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">l</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.More"><span class="id" type="constructor">More</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span>)<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
One step of comparison of elements 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.compare_more"><span class="id" type="definition">compare_more</span></a> <span class="id" type="var">x1</span> (<span class="id" type="var">cont</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.enumeration"><span class="id" type="inductive">enumeration</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#comparison"><span class="id" type="inductive">comparison</span></a>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="keyword">End</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a><br/>
&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.More"><span class="id" type="constructor">More</span></a> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <span class="id" type="var">cont</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Comparison of left tree, middle element, then right tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Ops.compare_cont"><span class="id" type="definition">compare_cont</span></a> <span class="id" type="var">s1</span> (<span class="id" type="var">cont</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.enumeration"><span class="id" type="inductive">enumeration</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#comparison"><span class="id" type="inductive">comparison</span></a>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">cont</span> <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#compare_cont"><span class="id" type="definition">compare_cont</span></a> <span class="id" type="var">l1</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.compare_more"><span class="id" type="definition">compare_more</span></a> <span class="id" type="var">x1</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#compare_cont"><span class="id" type="definition">compare_cont</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">cont</span>)) <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Initial continuation 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.compare_end"><span class="id" type="definition">compare_end</span></a> <span class="id" type="var">e2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">End</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> | <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The complete comparison 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.compare"><span class="id" type="definition">compare</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.compare_cont"><span class="id" type="definition">compare_cont</span></a> <span class="id" type="var">s1</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.compare_end"><span class="id" type="definition">compare_end</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#Ops.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">s2</span> <span class="id" type="keyword">End</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab506"></a><h2 class="section">Equality test</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Ops.equal"><span class="id" type="definition">equal</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#Ops.compare"><span class="id" type="definition">compare</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Eq"><span class="id" type="constructor">Eq</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">Ops</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab507"></a><h1 class="section">MakeRaw</h1>


<br/> <br/>
   Functor of pure functions + a posteriori proofs of invariant
   preservation 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <a name="MakeRaw"><span class="id" type="module">MakeRaw</span></a> (<span class="id" type="keyword">Import</span> <span class="id" type="var">I</span>:<a class="idref" href="Coq.ZArith.Int.html#"><span class="id" type="module">Int</span></a>)(<span class="id" type="var">X</span>:<a class="idref" href="Coq.Structures.Orders.html#"><span class="id" type="module">OrderedType</span></a>) &lt;: <a class="idref" href="Coq.MSets.MSetInterface.html#"><span class="id" type="module">RawSets</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">X</span></a>.<br/>
<span class="id" type="keyword">Include</span> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">Ops</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">I</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">X</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab508"></a><h1 class="section">Invariants</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab509"></a><h2 class="section">Occurrence in a tree</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="MakeRaw.InT"><span class="id" type="inductive">InT</span></a> (<span class="id" type="var">x</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>) : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="MakeRaw.IsRoot"><span class="id" type="constructor">IsRoot</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="MakeRaw.InLeft"><span class="id" type="constructor">InLeft</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="MakeRaw.InRight"><span class="id" type="constructor">InRight</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.In"><span class="id" type="definition">In</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab510"></a><h2 class="section">Some shortcuts</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.Equal"><span class="id" type="definition">Equal</span></a> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">a</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'<->'_x"><span class="id" type="notation">&lt;-&gt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">a</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.Subset"><span class="id" type="definition">Subset</span></a> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">a</span> <span class="id" type="var">s</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">a</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.Empty"><span class="id" type="definition">Empty</span></a> <span class="id" type="var">s</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>, <a class="idref" href="Coq.Init.Logic.html#:type_scope:'~'_x"><span class="id" type="notation">~</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">a</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.For_all"><span class="id" type="definition">For_all</span></a> (<span class="id" type="var">P</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">s</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">x</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.Exists"><span class="id" type="definition">Exists</span></a> (<span class="id" type="var">P</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">s</span> := <a class="idref" href="Coq.Init.Logic.html#:type_scope:'exists'_x_','_x"><span class="id" type="notation">exists</span></a> <span class="id" type="var">x</span><a class="idref" href="Coq.Init.Logic.html#:type_scope:'exists'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">/\</span></a> <span class="id" type="var">P</span> <span class="id" type="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab511"></a><h2 class="section">Binary search trees</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span></span>: all elements in <span class="inlinecode"><span class="id" type="var">s</span></span> are smaller than <span class="inlinecode"><span class="id" type="var">x</span></span>
   (resp. greater for <span class="inlinecode"><span class="id" type="var">gt_tree</span></span>) 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">bst</span> <span class="id" type="var">t</span></span> : <span class="inlinecode"><span class="id" type="var">t</span></span> is a binary search tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="MakeRaw.bst"><span class="id" type="inductive">bst</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="MakeRaw.BSLeaf"><span class="id" type="constructor">BSLeaf</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#bst"><span class="id" type="inductive">bst</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;&nbsp;| <a name="MakeRaw.BSNode"><span class="id" type="constructor">BSNode</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#bst"><span class="id" type="inductive">bst</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">bst</span></span> is the (decidable) invariant our trees will have to satisfy. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="MakeRaw.IsOk"><span class="id" type="definition">IsOk</span></a> := <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.bst"><span class="id" type="inductive">bst</span></a>.<br/>

<br/>
<span class="id" type="keyword">Class</span> <a name="MakeRaw.Ok"><span class="id" type="record">Ok</span></a> (<span class="id" type="var">s</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.t"><span class="id" type="definition">t</span></a>) : <span class="id" type="keyword">Prop</span> := <a name="MakeRaw.ok"><span class="id" type="projection">ok</span></a> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <a name="MakeRaw.bst_Ok"><span class="id" type="instance">bst_Ok</span></a> <span class="id" type="var">s</span> (<span class="id" type="var">Hs</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">s</span>) : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> <span class="id" type="var">s</span> := { <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.ok"><span class="id" type="definition">ok</span></a> := <span class="id" type="var">Hs</span> }.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="MakeRaw.ltb_tree"><span class="id" type="definition">ltb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Gt"><span class="id" type="constructor">Gt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#ltb_tree"><span class="id" type="definition">ltb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Datatypes.html#:bool_scope:x_'&&'_x"><span class="id" type="notation">&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#ltb_tree"><span class="id" type="definition">ltb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="MakeRaw.gtb_tree"><span class="id" type="definition">gtb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.MSets.MSetAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Lt"><span class="id" type="constructor">Lt</span></a> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#gtb_tree"><span class="id" type="definition">gtb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Datatypes.html#:bool_scope:x_'&&'_x"><span class="id" type="notation">&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#gtb_tree"><span class="id" type="definition">gtb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="MakeRaw.isok"><span class="id" type="definition">isok</span></a> <span class="id" type="var">s</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#isok"><span class="id" type="definition">isok</span></a> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Datatypes.html#:bool_scope:x_'&&'_x"><span class="id" type="notation">&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#isok"><span class="id" type="definition">isok</span></a> <span class="id" type="var">r</span> <a class="idref" href="Coq.Init.Datatypes.html#:bool_scope:x_'&&'_x"><span class="id" type="notation">&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.ltb_tree"><span class="id" type="definition">ltb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Datatypes.html#:bool_scope:x_'&&'_x"><span class="id" type="notation">&amp;&amp;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gtb_tree"><span class="id" type="definition">gtb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab512"></a><h1 class="section">Correctness proofs</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <a name="MakeRaw.MX"><span class="id" type="module">MX</span></a> := <a class="idref" href="Coq.Structures.OrdersFacts.html#"><span class="id" type="module">OrderedTypeFacts</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#"><span class="id" type="module">X</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab513"></a><h1 class="section">Automation and dedicated tactics</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Scheme</span> <span class="id" type="var">tree_ind</span> := <span class="id" type="keyword">Induction</span> <span class="id" type="keyword">for</span> <span class="id" type="var">tree</span> <span class="id" type="keyword">Sort</span> <span class="id" type="keyword">Prop</span>.<br/>

<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.MX.eq_refl"><span class="id" type="definition">MX.eq_refl</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.MX.eq_trans"><span class="id" type="definition">MX.eq_trans</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.MX.lt_trans"><span class="id" type="definition">MX.lt_trans</span></a> @<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.ok"><span class="id" type="definition">ok</span></a>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Immediate</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.MX.eq_sym"><span class="id" type="definition">MX.eq_sym</span></a>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.In"><span class="id" type="definition">In</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">InT</span> <span class="id" type="var">bst</span>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "factornode" <span class="id" type="var">ident</span>(<span class="id" type="var">l</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">x</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">r</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">h</span>)<br/>
&nbsp;"as" <span class="id" type="var">ident</span>(<span class="id" type="var">s</span>) :=<br/>
&nbsp;<span class="id" type="tactic">set</span> (<span class="id" type="var">s</span>:=<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>.<br/>

<br/>
</div>

<div class="doc">
Automatic treatment of <span class="inlinecode"><span class="id" type="var">Ok</span></span> hypothesis 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">inv_ok</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">H</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv_ok</span><br/>
&nbsp;| <span class="id" type="var">H</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv_ok</span><br/>
&nbsp;| <span class="id" type="var">H</span>:<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.bst"><span class="id" type="inductive">bst</span></a> ?<span class="id" type="var">x</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="var">change</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> <span class="id" type="var">x</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv_ok</span><br/>
&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic to repeat <span class="inlinecode"><span class="id" type="tactic">inversion_clear</span></span> on all hyps of the
    form <span class="inlinecode">(<span class="id" type="var">f</span> (<span class="id" type="var">Node</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>))</span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">is_tree_constr</span> <span class="id" type="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">c</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">fail</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">invtree</span> <span class="id" type="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="var">is_tree_constr</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">invtree</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="var">is_tree_constr</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">invtree</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="var">is_tree_constr</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">invtree</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">inv</span> := <span class="id" type="var">inv_ok</span>; <span class="id" type="var">invtree</span> <span class="id" type="var">InT</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">intuition_in</span> := <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">progress</span> (<span class="id" type="tactic">intuition</span>; <span class="id" type="var">inv</span>).<br/>

<br/>
</div>

<div class="doc">
Helper tactic concerning order of elements. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">order</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">U</span>: <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span>, <span class="id" type="var">V</span>: <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">U</span> <span class="id" type="var">_</span> <span class="id" type="var">V</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">U</span>; <span class="id" type="var">order</span><br/>
&nbsp;| <span class="id" type="var">U</span>: <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span>, <span class="id" type="var">V</span>: <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">U</span> <span class="id" type="var">_</span> <span class="id" type="var">V</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">U</span>; <span class="id" type="var">order</span><br/>
&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">MX.order</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">isok</span></span> is indeed a decision procedure for <span class="inlinecode"><span class="id" type="var">Ok</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.ltb_tree_iff"><span class="id" type="lemma">ltb_tree_iff</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'<->'_x"><span class="id" type="notation">&lt;-&gt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.ltb_tree"><span class="id" type="definition">ltb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.gtb_tree_iff"><span class="id" type="lemma">gtb_tree_iff</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'<->'_x"><span class="id" type="notation">&lt;-&gt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gtb_tree"><span class="id" type="definition">gtb_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.isok_iff"><span class="id" type="lemma">isok_iff</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'<->'_x"><span class="id" type="notation">&lt;-&gt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.isok"><span class="id" type="definition">isok</span></a> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <a name="MakeRaw.isok_Ok"><span class="id" type="instance">isok_Ok</span></a> <span class="id" type="var">s</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.isok"><span class="id" type="definition">isok</span></a> <span class="id" type="var">s</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Ok"><span class="id" type="class">Ok</span></a> <span class="id" type="var">s</span> | 10.<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab514"></a><h1 class="section">Basic results about <span class="inlinecode"><span class="id" type="var">In</span></span>, <span class="inlinecode"><span class="id" type="var">lt_tree</span></span>, <span class="inlinecode"><span class="id" type="var">gt_tree</span></span>, <span class="inlinecode"><span class="id" type="var">height</span></span></h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">In</span></span> is compatible with <span class="inlinecode"><span class="id" type="var">X.eq</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.In_1"><span class="id" type="lemma">In_1</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Immediate</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.In_1"><span class="id" type="lemma">In_1</span></a>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <a name="MakeRaw.In_compat"><span class="id" type="instance">In_compat</span></a> : <a class="idref" href="Coq.Classes.Morphisms.html#Proper"><span class="id" type="class">Proper</span></a> (<a class="idref" href="Coq.MSets.MSetAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a><a class="idref" href="Coq.Classes.Morphisms.html#ProperNotations.:signature_scope:x_'==>'_x"><span class="id" type="notation">==&gt;</span></a><a class="idref" href="Coq.Init.Logic.html#eq"><span class="id" type="inductive">eq</span></a><a class="idref" href="Coq.Classes.Morphisms.html#ProperNotations.:signature_scope:x_'==>'_x"><span class="id" type="notation">==&gt;</span></a><a class="idref" href="Coq.Init.Logic.html#iff"><span class="id" type="definition">iff</span></a>) <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.In_node_iff"><span class="id" type="lemma">In_node_iff</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'<->'_x"><span class="id" type="notation">&lt;-&gt;</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">\/</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span> <a class="idref" href="Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">\/</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
Results about <span class="inlinecode"><span class="id" type="var">lt_tree</span></span> and <span class="inlinecode"><span class="id" type="var">gt_tree</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.lt_leaf"><span class="id" type="lemma">lt_leaf</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.gt_leaf"><span class="id" type="lemma">gt_leaf</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Leaf"><span class="id" type="constructor">Leaf</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.lt_tree_node"><span class="id" type="lemma">lt_tree_node</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>) (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a>) (<span class="id" type="var">h</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#I.int"><span class="id" type="axiom">int</span></a>),<br/>
&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.gt_tree_node"><span class="id" type="lemma">gt_tree_node</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>) (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a>) (<span class="id" type="var">h</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#I.int"><span class="id" type="axiom">int</span></a>),<br/>
&nbsp;<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_leaf"><span class="id" type="lemma">lt_leaf</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_leaf"><span class="id" type="lemma">gt_leaf</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree_node"><span class="id" type="lemma">lt_tree_node</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree_node"><span class="id" type="lemma">gt_tree_node</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.lt_tree_not_in"><span class="id" type="lemma">lt_tree_not_in</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">x</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>) (<span class="id" type="var">t</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a>), <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> -&gt; <a class="idref" href="Coq.Init.Logic.html#:type_scope:'~'_x"><span class="id" type="notation">~</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.lt_tree_trans"><span class="id" type="lemma">lt_tree_trans</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">y</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.gt_tree_not_in"><span class="id" type="lemma">gt_tree_not_in</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">x</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.elt"><span class="id" type="definition">elt</span></a>) (<span class="id" type="var">t</span> : <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.tree"><span class="id" type="inductive">tree</span></a>), <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> -&gt; <a class="idref" href="Coq.Init.Logic.html#:type_scope:'~'_x"><span class="id" type="notation">~</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.InT"><span class="id" type="inductive">InT</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="MakeRaw.gt_tree_trans"><span class="id" type="lemma">gt_tree_trans</span></a> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> -&gt; <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">y</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree_not_in"><span class="id" type="lemma">lt_tree_not_in</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.lt_tree_trans"><span class="id" type="lemma">lt_tree_trans</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree_not_in"><span class="id" type="lemma">gt_tree_not_in</span></a> <a class="idref" href="Coq.MSets.MSetAVL.html#MakeRaw.gt_tree_trans"><span class="id" type="lemma">gt_tree_trans</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab515"></a><h1 class="section">Inductions principles for some of the set operators</h1>

</div>
<div class="code">

<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">induct</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> :=<br/>
&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [|<span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">x'</span> <span class="id" type="var">r</span> <span class="id" type="var">IHr</span> <span class="id" type="var">h</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>;<br/>
&nbsp;[|<span class="id" type="var">elim_compare</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">inv</span>].<br/>

<br/>
</div>

<div class="doc">
<a name="lab516"></a><h1 class="section">Notations and helper lemma about pairs and triples</h1>

</div>
<div class="code">

<br/>
<span class="id" type="var">Notation </span>"s #1" := (<span class="id" type="var">fst</span> <span class="id" type="var">s</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "s '#1'") : <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="var">Notation </span>"s #2" := (<span class="id" type="var">snd</span> <span class="id" type="var">s</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "s '#2'") : <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="var">Notation </span>"t #l" := (<span class="id" type="var">t_left</span> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#l'") : <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="var">Notation </span>"t #b" := (<span class="id" type="var">t_in</span> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#b'") : <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="var">Notation </span>"t #r" := (<span class="id" type="var">t_right</span> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#r'") : <span class="id" type="var">pair_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Local</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">pair_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab517"></a><h1 class="section">Empty set</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">empty_spec</span> : <span class="id" type="var">Empty</span> <span class="id" type="var">empty</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">empty_ok</span> : <span class="id" type="var">Ok</span> <span class="id" type="var">empty</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab518"></a><h1 class="section">Emptyness test</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_empty_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">is_empty</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab519"></a><h1 class="section">Membership</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>}, <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab520"></a><h1 class="section">Singleton set</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">singleton_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">singleton</span> <span class="id" type="var">x</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">singleton_ok</span> <span class="id" type="var">x</span> : <span class="id" type="var">Ok</span> (<span class="id" type="var">singleton</span> <span class="id" type="var">x</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab521"></a><h1 class="section">Helper functions</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">create_spec</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,  <span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">create_ok</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">l</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">r</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>) :<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bal_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">bal_ok</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">l</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">r</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>) :<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab522"></a><h1 class="section">Insertion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_spec'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span>.<br/>
 
<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">add_ok</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">Int_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab523"></a><h1 class="section">Join</h1>

</div>
<div class="code">

<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">join_tac</span> :=<br/>
&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [| <span class="id" type="var">ll</span> <span class="id" type="var">_</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="var">Hlr</span> <span class="id" type="var">lh</span>];<br/>
&nbsp;&nbsp;&nbsp;[ | <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">r</span> <span class="id" type="keyword">as</span> [| <span class="id" type="var">rl</span> <span class="id" type="var">Hrl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rr</span> <span class="id" type="var">_</span> <span class="id" type="var">rh</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">join</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" type="tactic">destruct</span> (<span class="id" type="var">gt_le_dec</span> <span class="id" type="var">lh</span> (<span class="id" type="var">rh</span>+2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> |- <span class="id" type="var">context</span> <span class="id" type="var">b</span> [ <span class="id" type="var">bal</span> ?<span class="id" type="var">a</span> ?<span class="id" type="var">b</span> ?<span class="id" type="var">c</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> (<span class="id" type="var">bal</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> (<span class="id" type="var">bal</span> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> (<span class="id" type="var">join</span> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rr</span> <span class="id" type="var">rh</span>))); [ | <span class="id" type="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="tactic">destruct</span> (<span class="id" type="var">gt_le_dec</span> <span class="id" type="var">rh</span> (<span class="id" type="var">lh</span>+2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> |- <span class="id" type="var">context</span> <span class="id" type="var">b</span> [ <span class="id" type="var">bal</span> ?<span class="id" type="var">a</span> ?<span class="id" type="var">b</span> ?<span class="id" type="var">c</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> (<span class="id" type="var">bal</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> (<span class="id" type="var">bal</span> (<span class="id" type="var">join</span> (<span class="id" type="var">Node</span> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span>) <span class="id" type="var">x</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rr</span>); [ | <span class="id" type="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ] ] ] ]; <span class="id" type="tactic">intros</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">join_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">join</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">join_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">l</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">r</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">join</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab524"></a><h1 class="section">Extraction of minimum element</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)#2 \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)#1.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">remove_min_ok</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">h</span> `(<span class="id" type="var">Ok</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)#1.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_gt_tree</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> `{<span class="id" type="var">Ok</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)},<br/>
&nbsp;<span class="id" type="var">gt_tree</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)#2 (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)#1.<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">remove_min_gt_tree</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab525"></a><h1 class="section">Merging two trees</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">merge</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">merge_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="keyword">forall</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>)<br/>
&nbsp;`(<span class="id" type="keyword">forall</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> : <span class="id" type="var">elt</span>, <span class="id" type="var">InT</span> <span class="id" type="var">y1</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y2</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">merge</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab526"></a><h1 class="section">Deletion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> /\ ~ <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">remove_ok</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab527"></a><h1 class="section">Minimum element</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">min_elt_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span>, <span class="id" type="var">min_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">min_elt_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;<span class="id" type="var">min_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; ~ <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">min_elt_spec3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">min_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab528"></a><h1 class="section">Maximum element</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">max_elt_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span>, <span class="id" type="var">max_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">max_elt_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;<span class="id" type="var">max_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; ~ <span class="id" type="var">X.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">max_elt_spec3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">max_elt</span> <span class="id" type="var">s</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab529"></a><h1 class="section">Any element</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">choose_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span>, <span class="id" type="var">choose</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">choose_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">choose</span> <span class="id" type="var">s</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">choose_spec3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s'</span>},<br/>
&nbsp;&nbsp;<span class="id" type="var">choose</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">choose</span> <span class="id" type="var">s'</span> = <span class="id" type="var">Some</span> <span class="id" type="var">x'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Equal</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab530"></a><h1 class="section">Concatenation</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">concat_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">concat</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">concat_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="keyword">forall</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>)<br/>
&nbsp;`(<span class="id" type="keyword">forall</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> : <span class="id" type="var">elt</span>, <span class="id" type="var">InT</span> <span class="id" type="var">y1</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y2</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">concat</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab531"></a><h1 class="section">Splitting</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">r</span> &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">X.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_spec3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>},<br/>
&nbsp;((<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">b</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>}, <span class="id" type="var">Ok</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">l</span> /\ <span class="id" type="var">Ok</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">split_ok1</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">l</span>.<br/>
 
<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">split_ok2</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">r</span>.<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab532"></a><h1 class="section">Intersection</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">destruct_split</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">H</span> : <span class="id" type="tactic">split</span> ?<span class="id" type="var">x</span> ?<span class="id" type="var">s</span> = &lt;&lt; ?<span class="id" type="var">u</span>, ?<span class="id" type="var">v</span>, ?<span class="id" type="var">w</span> &gt;&gt; |- <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> ((<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">l</span> = <span class="id" type="var">u</span>) <span class="id" type="tactic">by</span> (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> ((<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">b</span> = <span class="id" type="var">v</span>) <span class="id" type="tactic">by</span> (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> ((<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>)#<span class="id" type="var">r</span> = <span class="id" type="var">w</span>) <span class="id" type="tactic">by</span> (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">u</span> <span class="id" type="var">w</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_spec_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) /\ (<span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> /\ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> /\ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>).<br/>
 
<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">inter_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab533"></a><h1 class="section">Difference</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">diff_spec_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) /\ (<span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> /\ ~<span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">diff_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> /\ ~<span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>).<br/>
 
<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">diff_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab534"></a><h1 class="section">Union</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">y</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">y</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s1</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">union_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="keyword">forall</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>), <span class="id" type="var">Ok</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab535"></a><h1 class="section">Elements</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_spec1'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">x</span>,<br/>
&nbsp;<span class="id" type="var">InA</span> <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> \/ <span class="id" type="var">InA</span> <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span>, <span class="id" type="var">InA</span> <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_spec2'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>}, <span class="id" type="var">sort</span> <span class="id" type="var">X.lt</span> <span class="id" type="var">acc</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">elt</span>, <span class="id" type="var">InA</span> <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span> -&gt; <span class="id" type="var">InT</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">sort</span> <span class="id" type="var">X.lt</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>), <span class="id" type="var">sort</span> <span class="id" type="var">X.lt</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">elements_spec2</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_spec2w</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>), <span class="id" type="var">NoDupA</span> <span class="id" type="var">X.eq</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_aux_cardinal</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span>, (<span class="id" type="var">length</span> <span class="id" type="var">acc</span> + <span class="id" type="var">cardinal</span> <span class="id" type="var">s</span>)%<span class="id" type="var">nat</span> = <span class="id" type="var">length</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_cardinal</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> : <span class="id" type="var">tree</span>, <span class="id" type="var">cardinal</span> <span class="id" type="var">s</span> = <span class="id" type="var">length</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">cardinal_spec</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span>)(<span class="id" type="var">Hs</span>:<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) := <span class="id" type="var">elements_cardinal</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span>, <span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span> = <span class="id" type="var">elements</span> <span class="id" type="var">s</span> ++ <span class="id" type="var">acc</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_node</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">acc</span>,<br/>
&nbsp;<span class="id" type="var">elements</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">x</span> :: <span class="id" type="var">elements</span> <span class="id" type="var">r</span> ++ <span class="id" type="var">acc</span> =<br/>
&nbsp;<span class="id" type="var">elements</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) ++ <span class="id" type="var">acc</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab536"></a><h1 class="section">Filter</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_spec'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">x</span> (<span class="id" type="var">filter_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span> \/ <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">true</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">filter_ok'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">acc</span>),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">filter_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">x</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">InT</span> <span class="id" type="var">x</span> (<span class="id" type="var">filter</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">true</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">filter_ok</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">filter</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab537"></a><h1 class="section">Partition</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">partition_spec1'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">elt</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">x</span> (<span class="id" type="var">partition_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>)#1 &lt;-&gt;<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span>#1 \/ <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">true</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">partition_spec2'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">elt</span>,<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">x</span> (<span class="id" type="var">partition_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>)#2 &lt;-&gt;<br/>
&nbsp;<span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span>#2 \/ <span class="id" type="var">InT</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">false</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">partition_spec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;<span class="id" type="var">Equal</span> (<span class="id" type="var">partition</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>)#1 (<span class="id" type="var">filter</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">partition_spec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span>,<br/>
&nbsp;<span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;<span class="id" type="var">Equal</span> (<span class="id" type="var">partition</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>)#2 (<span class="id" type="var">filter</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">f</span> <span class="id" type="var">x</span>)) <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">partition_ok1'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">acc</span>#1),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">partition_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>)#1.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">partition_ok2'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">acc</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">acc</span>#2),<br/>
&nbsp;<span class="id" type="var">Ok</span> (<span class="id" type="var">partition_acc</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>)#2.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">partition_ok1</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">partition</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>)#1.<br/>
 
<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">partition_ok2</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> `(<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>) : <span class="id" type="var">Ok</span> (<span class="id" type="var">partition</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span>)#2.<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab538"></a><h1 class="section"><span class="inlinecode"><span class="id" type="var">for_all</span></span> and <span class="inlinecode"><span class="id" type="var">exists</span></span></h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">for_all_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span>, <span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">for_all</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">For_all</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">true</span>) <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">exists_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span>, <span class="id" type="var">Proper</span> (<span class="id" type="var">X.eq</span>==&gt;<span class="id" type="var">eq</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">exists_</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> = <span class="id" type="var">true</span>) <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab539"></a><h1 class="section">Fold</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_spec'</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">s</span> : <span class="id" type="var">tree</span>) (<span class="id" type="var">i</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">acc</span> : <span class="id" type="var">list</span> <span class="id" type="var">elt</span>),<br/>
&nbsp;<span class="id" type="var">fold_left</span> (<span class="id" type="var">flip</span> <span class="id" type="var">f</span>) (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>) <span class="id" type="var">i</span> = <span class="id" type="var">fold_left</span> (<span class="id" type="var">flip</span> <span class="id" type="var">f</span>) <span class="id" type="var">acc</span> (<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">i</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_spec</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span>) (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">i</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">i</span> = <span class="id" type="var">fold_left</span> (<span class="id" type="var">flip</span> <span class="id" type="var">f</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) <span class="id" type="var">i</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab540"></a><h1 class="section">Subset</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subsetl_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">subset_l1</span> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">h1</span> <span class="id" type="var">s2</span><br/>
&nbsp;`{<span class="id" type="var">Ok</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">Leaf</span> <span class="id" type="var">h1</span>), <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s</span>}, (<span class="id" type="var">subset_l1</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Subset</span> <span class="id" type="var">l1</span> <span class="id" type="var">s</span>)) -&gt;<br/>
&nbsp;(<span class="id" type="var">subsetl</span> <span class="id" type="var">subset_l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Subset</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">Leaf</span> <span class="id" type="var">h1</span>) <span class="id" type="var">s2</span> ).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subsetr_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">subset_r1</span> <span class="id" type="var">r1</span> <span class="id" type="var">x1</span> <span class="id" type="var">h1</span> <span class="id" type="var">s2</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">Node</span> <span class="id" type="var">Leaf</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>) -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">s2</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">bst</span> <span class="id" type="var">s</span> -&gt; (<span class="id" type="var">subset_r1</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Subset</span> <span class="id" type="var">r1</span> <span class="id" type="var">s</span>)) -&gt;<br/>
&nbsp;(<span class="id" type="var">subsetr</span> <span class="id" type="var">subset_r1</span> <span class="id" type="var">x1</span> <span class="id" type="var">s2</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Subset</span> (<span class="id" type="var">Node</span> <span class="id" type="var">Leaf</span> <span class="id" type="var">x1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>) <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;(<span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab541"></a><h1 class="section">Comparison</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab542"></a><h2 class="section">Relations <span class="inlinecode"><span class="id" type="var">eq</span></span> and <span class="inlinecode"><span class="id" type="var">lt</span></span> over trees</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">L</span> := <span class="id" type="var">MakeListOrdering</span> <span class="id" type="var">X</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq</span> := <span class="id" type="var">Equal</span>.<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_equiv</span> : <span class="id" type="var">Equivalence</span> <span class="id" type="var">eq</span>.<br/>
 
<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_Leq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">eq</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> &lt;-&gt; <span class="id" type="var">L.eq</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s'</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">lt</span> (<span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="var">t</span>) : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">s1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s1'</span> /\ <span class="id" type="var">Ok</span> <span class="id" type="var">s2'</span> /\ <span class="id" type="var">eq</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> /\ <span class="id" type="var">eq</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span><br/>
&nbsp;&nbsp;&nbsp;/\ <span class="id" type="var">L.lt</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s1'</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s2'</span>).<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">lt_strorder</span> : <span class="id" type="var">StrictOrder</span> <span class="id" type="var">lt</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">lt_compat</span> : <span class="id" type="var">Proper</span> (<span class="id" type="var">eq</span>==&gt;<span class="id" type="var">eq</span>==&gt;<span class="id" type="var">iff</span>) <span class="id" type="var">lt</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab543"></a><h1 class="section">Proof of the comparison algorithm</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span></span> returns the list of elements of <span class="inlinecode"><span class="id" type="var">e</span></span> i.e. the list
    of elements actually compared 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">flatten_e</span> (<span class="id" type="var">e</span> : <span class="id" type="var">enumeration</span>) : <span class="id" type="var">list</span> <span class="id" type="var">elt</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="keyword">End</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">More</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> =&gt; <span class="id" type="var">x</span> :: <span class="id" type="var">elements</span> <span class="id" type="var">t</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">r</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_e_elements</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">e</span>,<br/>
&nbsp;<span class="id" type="var">elements</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">flatten_e</span> (<span class="id" type="var">More</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span>) = <span class="id" type="var">elements</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">flatten_e</span> (<span class="id" type="var">cons</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>) = <span class="id" type="var">elements</span> <span class="id" type="var">s</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>.<br/>

<br/>
</div>

<div class="doc">
Correctness of this comparison 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Cmp</span> <span class="id" type="var">c</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> := <span class="id" type="var">CompSpec</span> <span class="id" type="var">L.eq</span> <span class="id" type="var">L.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">c</span>.<br/>

<br/>
<span class="id" type="keyword">Local</span>&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">Cmp</span> <span class="id" type="var">flip</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_end_Cmp</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e2</span>, <span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_end</span> <span class="id" type="var">e2</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_more_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x1</span> <span class="id" type="var">cont</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">cont</span> (<span class="id" type="var">cons</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) <span class="id" type="var">l</span> (<span class="id" type="var">elements</span> <span class="id" type="var">r2</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_more</span> <span class="id" type="var">x1</span> <span class="id" type="var">cont</span> (<span class="id" type="var">More</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) (<span class="id" type="var">x1</span>::<span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">flatten_e</span> (<span class="id" type="var">More</span> <span class="id" type="var">x2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_cont_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">Cmp</span> (<span class="id" type="var">cont</span> <span class="id" type="var">e</span>) <span class="id" type="var">l</span> (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>)) -&gt;<br/>
&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_cont</span> <span class="id" type="var">s1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>,<br/>
&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;<span class="id" type="var">CompSpec</span> <span class="id" type="var">eq</span> <span class="id" type="var">lt</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> (<span class="id" type="var">compare</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab544"></a><h1 class="section">Equality test</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_spec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> `{<span class="id" type="var">Ok</span> <span class="id" type="var">s1</span>, <span class="id" type="var">Ok</span> <span class="id" type="var">s2</span>},<br/>
&nbsp;<span class="id" type="var">equal</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">eq</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">MakeRaw</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab545"></a><h1 class="section">Encapsulation</h1>


<br/> <br/>
   Now, in order to really provide a functor implementing <span class="inlinecode"><span class="id" type="var">S</span></span>, we
   need to encapsulate everything into a type of binary search trees.
   They also happen to be well-balanced, but this has no influence
   on the correctness of operations, so we won't state this here,
   see <span class="inlinecode"><span class="id" type="var">MSetFullAVL</span></span> if you need more than just the MSet interface.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">IntMake</span> (<span class="id" type="var">I</span>:<span class="id" type="var">Int</span>)(<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">E</span> := <span class="id" type="var">X</span>.<br/>
&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">Raw</span> := <span class="id" type="var">MakeRaw</span> <span class="id" type="var">I</span> <span class="id" type="var">X</span>.<br/>
&nbsp;<span class="id" type="keyword">Include</span> <span class="id" type="var">Raw2Sets</span> <span class="id" type="var">X</span> <span class="id" type="var">Raw</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">IntMake</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">E</span> := <span class="id" type="var">X</span><br/>
&nbsp;:=<span class="id" type="var">IntMake</span>(<span class="id" type="var">Z_as_Int</span>)(<span class="id" type="var">X</span>).<br/>
</div>
<div id="sidebarWrapper">
<div id="sidebar">

<div class="block">
<h2 class="title">Navigation</h2>
<div class="content">

<ul class="menu">

<li class="leaf">Standard Library
  <ul class="menu">
  <li><a href="index.html">Table of contents</a></li>
  <li><a href="genindex.html">Index</a></li>
  </ul>
</li>

</ul>

</div>
</div>

</div>
</div>


</div>

<div id="footer">
<div id="nav-footer">
  <ul class="links-menu-footer">
    <li><a href="mailto:www-coq_@_lix.polytechnique.fr">webmaster</a></li>
    <li><a href="http://validator.w3.org/check?uri=referer">xhtml valid</a></li>
    <li><a href="http://jigsaw.w3.org/css-validator/check/referer">CSS valid</a></li>
  </ul>

</div>
</div>

</div>

</body>
</html>

