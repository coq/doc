<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Standard Library | The Coq Proof Assistant</title>

<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<style type="text/css" media="all">@import "/modules/node/node.css";</style>

<style type="text/css" media="all">@import "/modules/system/defaults.css";</style>
<style type="text/css" media="all">@import "/modules/system/system.css";</style>
<style type="text/css" media="all">@import "/modules/user/user.css";</style>

<style type="text/css" media="all">@import "/sites/all/themes/coq/style.css";</style>
<style type="text/css" media="all">@import "/sites/all/themes/coq/coqdoc.css";</style>

</head>

<body>

<div id="container">
<div id="headertop">
<div id="nav">
  <ul class="links-menu">
    <li><a href="http://coq.inria.fr/" class="active">Home</a></li>
    
    <li><a href="http://coq.inria.fr/about-coq" title="More about coq">About Coq</a></li>    
    <li><a href="http://coq.inria.fr/download">Get Coq</a></li>
    <li><a href="http://coq.inria.fr/documentation">Documentation</a></li>
    <li><a href="http://coq.inria.fr/community">Community</a></li>
  </ul>
</div>
</div>

<div id="header">

<div id="logoWrapper">

<div id="logo"><a href="http://coq.inria.fr/" title="Home"><img src="/files/barron_logo.png" alt="Home" /></a>
</div>
<div id="siteName"><a href="http://coq.inria.fr/" title="Home">The Coq Proof Assistant</a>
</div>

</div>
</div>

<div id="content">

<h1 class="libtitle">Library Coq.FSets.FMapAVL</h1>

<div class="code">

<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab323"></a><h1 class="section">FMapAVL</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
This module implements maps using AVL trees.
    It follows the implementation from Ocaml's standard library.

<br/> <br/>
    See the comments at the beginning of FSetAVL for more details.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="Coq.FSets.FMapInterface.html#"><span class="id" type="library">FMapInterface</span></a> <a class="idref" href="Coq.FSets.FMapList.html#"><span class="id" type="library">FMapList</span></a> <a class="idref" href="Coq.ZArith.ZArith.html#"><span class="id" type="library">ZArith</span></a> <a class="idref" href="Coq.ZArith.Int.html#"><span class="id" type="library">Int</span></a>.<br/>

<br/>

<br/>
</div>

<div class="doc">
Notations and helper lemma about pairs 
</div>
<div class="code">

<br/>
<span class="id" type="var">Notation </span><a name=":pair_scope:x_'#1'"><span class="id" type="notation">"</span></a>s #1" := (<a class="idref" href="Coq.Init.Datatypes.html#fst"><span class="id" type="definition">fst</span></a> <span class="id" type="var">s</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "s '#1'") : <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="var">Notation </span><a name=":pair_scope:x_'#2'"><span class="id" type="notation">"</span></a>s #2" := (<a class="idref" href="Coq.Init.Datatypes.html#snd"><span class="id" type="definition">snd</span></a> <span class="id" type="var">s</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "s '#2'") : <span class="id" type="var">pair_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab324"></a><h1 class="section">The Raw functor</h1>


<br/> <br/>
   Functor of pure functions + separate proofs of invariant
   preservation 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <a name="Raw"><span class="id" type="module">Raw</span></a> (<span class="id" type="keyword">Import</span> <span class="id" type="var">I</span>:<a class="idref" href="Coq.ZArith.Int.html#"><span class="id" type="module">Int</span></a>)(<span class="id" type="var">X</span>: <a class="idref" href="Coq.Structures.OrderedType.html#"><span class="id" type="module">OrderedType</span></a>).<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Local</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">pair_scope</span>.<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Local</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">lazy_bool_scope</span>.<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Local</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">Int_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.key"><span class="id" type="definition">key</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#X.t"><span class="id" type="axiom">X.t</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab325"></a><h1 class="section">Trees</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Section</span> <a name="Raw.Elt"><span class="id" type="section">Elt</span></a>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Elt.elt"><span class="id" type="variable">elt</span></a> : <span class="id" type="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab326"></a><h1 class="section">Trees</h1>


<br/> <br/>
   The fifth field of <span class="inlinecode"><span class="id" type="var">Node</span></span> is the height of the tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Raw.tree"><span class="id" type="inductive">tree</span></a> :=<br/>
&nbsp;&nbsp;| <a name="Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#tree"><span class="id" type="inductive">tree</span></a><br/>
&nbsp;&nbsp;| <a name="Raw.Node"><span class="id" type="constructor">Node</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#tree"><span class="id" type="inductive">tree</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#tree"><span class="id" type="inductive">tree</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#I.int"><span class="id" type="axiom">int</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#tree"><span class="id" type="inductive">tree</span></a>.<br/>

<br/>
<span class="id" type="var">Notation </span><a name="Raw.t"><span class="id" type="abbreviation">t</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.tree"><span class="id" type="inductive">tree</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab327"></a><h1 class="section">Basic functions on trees: height and cardinal</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.height"><span class="id" type="definition">height</span></a> (<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a>) : <a class="idref" href="Coq.FSets.FMapAVL.html#I.int"><span class="id" type="axiom">int</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; 0<br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">h</span> =&gt; <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.cardinal"><span class="id" type="definition">cardinal</span></a> (<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a>) : <a class="idref" href="Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; 0%<span class="id" type="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#cardinal"><span class="id" type="definition">cardinal</span></a> <span class="id" type="var">l</span> <a class="idref" href="Coq.Init.Peano.html#:nat_scope:x_'+'_x"><span class="id" type="notation">+</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#cardinal"><span class="id" type="definition">cardinal</span></a> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab328"></a><h1 class="section">Empty Map</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.empty"><span class="id" type="definition">empty</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab329"></a><h1 class="section">Emptyness test</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.is_empty"><span class="id" type="definition">is_empty</span></a> <span class="id" type="var">m</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a> | <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab330"></a><h1 class="section">Membership</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" type="var">mem</span></span> function is deciding membership. It exploits the <span class="inlinecode"><span class="id" type="var">bst</span></span> property
    to achieve logarithmic complexity. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">_</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#LT"><span class="id" type="constructor">LT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#GT"><span class="id" type="constructor">GT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#mem"><span class="id" type="definition">mem</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.find"><span class="id" type="definition">find</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#LT"><span class="id" type="constructor">LT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#find"><span class="id" type="definition">find</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#GT"><span class="id" type="constructor">GT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#find"><span class="id" type="definition">find</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab331"></a><h1 class="section">Helper functions</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span></span> creates a node, assuming <span class="inlinecode"><span class="id" type="var">l</span></span> and <span class="inlinecode"><span class="id" type="var">r</span></span>
    to be balanced and <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">l</span> - <span class="id" type="var">height</span> <span class="id" type="var">r</span>| &lt;= 2</span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#I.max"><span class="id" type="axiom">max</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">l</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">r</span>) <a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a> 1).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span></span> acts as <span class="inlinecode"><span class="id" type="var">create</span></span>, but performs one step of
    rebalancing if necessary, i.e. assumes <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">l</span> - <span class="id" type="var">height</span> <span class="id" type="var">r</span>| &lt;= 3</span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.assert_false"><span class="id" type="definition">assert_false</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">hl</span> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">hr</span> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">r</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">hl</span> (<span class="id" type="var">hr</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.ge_lt_dec"><span class="id" type="axiom">ge_lt_dec</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">ll</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">lr</span>) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">lr</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">lrl</span> <span class="id" type="var">lrx</span> <span class="id" type="var">lrd</span> <span class="id" type="var">lrr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lrl</span>) <span class="id" type="var">lrx</span> <span class="id" type="var">lrd</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">lrr</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">hr</span> (<span class="id" type="var">hl</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">r</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.ge_lt_dec"><span class="id" type="axiom">ge_lt_dec</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">rr</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.height"><span class="id" type="definition">height</span></a> <span class="id" type="var">rl</span>) <span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rl</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.assert_false"><span class="id" type="definition">assert_false</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rll</span> <span class="id" type="var">rlx</span> <span class="id" type="var">rld</span> <span class="id" type="var">rlr</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">rll</span>) <span class="id" type="var">rlx</span> <span class="id" type="var">rld</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">rlr</span> <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab332"></a><h1 class="section">Insertion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">m</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> 1<br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d'</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#LT"><span class="id" type="constructor">LT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">l</span>) <span class="id" type="var">y</span> <span class="id" type="var">d'</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#GT"><span class="id" type="constructor">GT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d'</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab333"></a><h1 class="section">Extraction of minimum binding</h1>


<br/> <br/>
  Morally, <span class="inlinecode"><span class="id" type="var">remove_min</span></span> is to be applied to a non-empty tree
  <span class="inlinecode"><span class="id" type="var">t</span> = <span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span></span>. Since we can't deal here with <span class="inlinecode"><span class="id" type="tactic">assert</span> <span class="id" type="var">false</span></span>
  for <span class="inlinecode"><span class="id" type="var">t</span>=<span class="id" type="var">Leaf</span></span>, we pre-unpack <span class="inlinecode"><span class="id" type="var">t</span></span> (and forget about <span class="inlinecode"><span class="id" type="var">h</span></span>).

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*(</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">)</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><span class="id" type="var">r</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,(</span></a><span class="id" type="var">x</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a><span class="id" type="var">d</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l'</span>,<span class="id" type="var">m</span>) := <a class="idref" href="Coq.FSets.FMapAVL.html#remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l'</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a> <span class="id" type="var">m</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab334"></a><h1 class="section">Merging two trees</h1>


<br/> <br/>
  <span class="inlinecode"><span class="id" type="var">merge</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span></span> builds the union of <span class="inlinecode"><span class="id" type="var">t1</span></span> and <span class="inlinecode"><span class="id" type="var">t2</span></span> assuming all elements
  of <span class="inlinecode"><span class="id" type="var">t1</span></span> to be smaller than all elements of <span class="inlinecode"><span class="id" type="var">t2</span></span>, and
  <span class="inlinecode">|<span class="id" type="var">height</span> <span class="id" type="var">t1</span> - <span class="id" type="var">height</span> <span class="id" type="var">t2</span>| &lt;= 2</span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.merge"><span class="id" type="definition">merge</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=  <span class="id" type="keyword">match</span> <span class="id" type="var">s1</span>,<span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">s2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">s1</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">h2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><span class="id" type="var">s2'</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,(</span></a><span class="id" type="var">x</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a><span class="id" type="var">d</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">))</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">s1</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">s2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab335"></a><h1 class="section">Deletion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#LT"><span class="id" type="constructor">LT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span>) <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.merge"><span class="id" type="definition">merge</span></a> <span class="id" type="var">l</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#GT"><span class="id" type="constructor">GT</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#remove"><span class="id" type="definition">remove</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab336"></a><h1 class="section">join</h1>


<br/> <br/>
    Same as <span class="inlinecode"><span class="id" type="var">bal</span></span> but does not assume anything regarding heights of <span class="inlinecode"><span class="id" type="var">l</span></span>
    and <span class="inlinecode"><span class="id" type="var">r</span></span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">l</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.add"><span class="id" type="definition">add</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span> =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">fix</span> <span class="id" type="var">join_aux</span> (<span class="id" type="var">r</span>:<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a>) : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> := <span class="id" type="keyword">match</span> <span class="id" type="var">r</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt;  <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.add"><span class="id" type="definition">add</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span> <span class="id" type="var">rh</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">lh</span> (<span class="id" type="var">rh</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#join"><span class="id" type="definition">join</span></a> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <a class="idref" href="Coq.FSets.FMapAVL.html#I.gt_le_dec"><span class="id" type="axiom">gt_le_dec</span></a> <span class="id" type="var">rh</span> (<span class="id" type="var">lh</span><a class="idref" href="Coq.ZArith.Int.html#Int.:Int_scope:x_'+'_x"><span class="id" type="notation">+</span></a>2) <span class="id" type="keyword">then</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.bal"><span class="id" type="definition">bal</span></a> (<span class="id" type="var">join_aux</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.create"><span class="id" type="definition">create</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab337"></a><h1 class="section">Splitting</h1>


<br/> <br/>
    <span class="inlinecode"><span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span></span> returns a triple <span class="inlinecode">(<span class="id" type="var">l</span>, <span class="id" type="var">o</span>, <span class="id" type="var">r</span>)</span> where
<ul>
<li> <span class="inlinecode"><span class="id" type="var">l</span></span> is the set of elements of <span class="inlinecode"><span class="id" type="var">m</span></span> that are <span class="inlinecode">&lt; <span class="id" type="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">r</span></span> is the set of elements of <span class="inlinecode"><span class="id" type="var">m</span></span> that are <span class="inlinecode">&gt; <span class="id" type="var">x</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">o</span></span> is the result of <span class="inlinecode"><span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span></span>.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Record</span> <a name="Raw.triple"><span class="id" type="record">triple</span></a> := <a name="Raw.mktriple"><span class="id" type="constructor">mktriple</span></a> { <a name="Raw.t_left"><span class="id" type="projection">t_left</span></a>:<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a>; <a name="Raw.t_opt"><span class="id" type="projection">t_opt</span></a>:<a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a>; <a name="Raw.t_right"><span class="id" type="projection">t_right</span></a>:<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> }.<br/>
<span class="id" type="var">Notation </span><a name="Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">"</span></a>&lt;&lt; l , b , r &gt;&gt;" := (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.mktriple"><span class="id" type="constructor">mktriple</span></a> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9).<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.triple"><span class="id" type="record">triple</span></a> := <span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#LT"><span class="id" type="constructor">LT</span></a> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">ll</span>,<span class="id" type="var">o</span>,<span class="id" type="var">rl</span>) := <a class="idref" href="Coq.FSets.FMapAVL.html#split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <span class="id" type="var">ll</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">o</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">rl</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <span class="id" type="var">l</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">r</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#GT"><span class="id" type="constructor">GT</span></a> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">rl</span>,<span class="id" type="var">o</span>,<span class="id" type="var">rr</span>) := <a class="idref" href="Coq.FSets.FMapAVL.html#split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> <span class="id" type="keyword">in</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&lt;&lt;</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">d</span> <span class="id" type="var">rl</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">o</span><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">,</span></a> <span class="id" type="var">rr</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab338"></a><h1 class="section">Concatenation</h1>


<br/> <br/>
   Same as <span class="inlinecode"><span class="id" type="var">merge</span></span> but does not assume anything about heights.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.concat"><span class="id" type="definition">concat</span></a> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m1</span>, <span class="id" type="var">m2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">m2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> , <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">m2'</span>,<span class="id" type="var">xd</span>) := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.remove_min"><span class="id" type="definition">remove_min</span></a> <span class="id" type="var">l2</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.join"><span class="id" type="definition">join</span></a> <span class="id" type="var">m1</span> <span class="id" type="var">xd</span><a class="idref" href="Coq.FSets.FMapAVL.html#:pair_scope:x_'#1'"><span class="id" type="notation">#1</span></a> <span class="id" type="var">xd</span><a class="idref" href="Coq.FSets.FMapAVL.html#:pair_scope:x_'#2'"><span class="id" type="notation">#2</span></a> <span class="id" type="var">m2'</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab339"></a><h1 class="section">Elements</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">elements_tree_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">t</span></span> catenates the elements of <span class="inlinecode"><span class="id" type="var">t</span></span> in infix
    order to the list <span class="inlinecode"><span class="id" type="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.elements_aux"><span class="id" type="definition">elements_aux</span></a> (<span class="id" type="var">acc</span> : <a class="idref" href="Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a>)) <span class="id" type="var">m</span> : <a class="idref" href="Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a><a class="idref" href="Coq.Init.Datatypes.html#:type_scope:x_'*'_x"><span class="id" type="notation">*</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#elements_aux"><span class="id" type="definition">elements_aux</span></a> (<a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">(</span></a><span class="id" type="var">x</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">,</span></a><span class="id" type="var">d</span><a class="idref" href="Coq.Init.Datatypes.html#:core_scope:'('_x_','_x_','_'..'_','_x_')'"><span class="id" type="notation">)</span></a> <a class="idref" href="Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#elements_aux"><span class="id" type="definition">elements_aux</span></a> <span class="id" type="var">acc</span> <span class="id" type="var">r</span>) <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
then <span class="inlinecode"><span class="id" type="var">elements</span></span> is an instanciation with an empty <span class="inlinecode"><span class="id" type="var">acc</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.elements"><span class="id" type="definition">elements</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.elements_aux"><span class="id" type="definition">elements_aux</span></a> <a class="idref" href="Coq.Init.Datatypes.html#nil"><span class="id" type="constructor">nil</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab340"></a><h1 class="section">Fold</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.fold"><span class="id" type="definition">fold</span></a> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a>) : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> :=<br/>
&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#fold"><span class="id" type="definition">fold</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span> (<span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#fold"><span class="id" type="definition">fold</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span>))<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab341"></a><h1 class="section">Comparison</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Elt.cmp"><span class="id" type="variable">cmp</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a>-&gt;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab342"></a><h2 class="section">Enumeration of the elements of a tree</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Raw.enumeration"><span class="id" type="inductive">enumeration</span></a> :=<br/>
&nbsp;| <span class="id" type="keyword">End</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a><br/>
&nbsp;| <a name="Raw.More"><span class="id" type="constructor">More</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#enumeration"><span class="id" type="inductive">enumeration</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">cons</span> <span class="id" type="var">m</span> <span class="id" type="var">e</span></span> adds the elements of tree <span class="inlinecode"><span class="id" type="var">m</span></span> on the head of
    enumeration <span class="inlinecode"><span class="id" type="var">e</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">m</span> <span class="id" type="var">e</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.enumeration"><span class="id" type="inductive">enumeration</span></a> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">e</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">l</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.More"><span class="id" type="constructor">More</span></a> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span>)<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
One step of comparison of elements 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.equal_more"><span class="id" type="definition">equal_more</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> (<span class="id" type="var">cont</span>:<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.enumeration"><span class="id" type="inductive">enumeration</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="keyword">End</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.More"><span class="id" type="constructor">More</span></a> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#X.compare"><span class="id" type="axiom">X.compare</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Structures.OrderedType.html#EQ"><span class="id" type="constructor">EQ</span></a> <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt.cmp"><span class="id" type="variable">cmp</span></a> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> <a class="idref" href="Coq.Bool.Bool.html#:lazy_bool_scope:x_'&&&'_x"><span class="id" type="notation">&amp;&amp;&amp;</span></a> <span class="id" type="var">cont</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Comparison of left tree, middle element, then right tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.equal_cont"><span class="id" type="definition">equal_cont</span></a> <span class="id" type="var">m1</span> (<span class="id" type="var">cont</span>:<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.enumeration"><span class="id" type="inductive">enumeration</span></a>-&gt;<a class="idref" href="Coq.Init.Datatypes.html#bool"><span class="id" type="inductive">bool</span></a>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <span class="id" type="var">cont</span> <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">r1</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#equal_cont"><span class="id" type="definition">equal_cont</span></a> <span class="id" type="var">l1</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.equal_more"><span class="id" type="definition">equal_more</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#equal_cont"><span class="id" type="definition">equal_cont</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">cont</span>)) <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Initial continuation 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.equal_end"><span class="id" type="definition">equal_end</span></a> <span class="id" type="var">e2</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">End</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#true"><span class="id" type="constructor">true</span></a> | <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.Init.Datatypes.html#false"><span class="id" type="constructor">false</span></a> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The complete comparison 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.equal"><span class="id" type="definition">equal</span></a> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.equal_cont"><span class="id" type="definition">equal_cont</span></a> <span class="id" type="var">m1</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.equal_end"><span class="id" type="definition">equal_end</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.cons"><span class="id" type="definition">cons</span></a> <span class="id" type="var">m2</span> <span class="id" type="keyword">End</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Elt"><span class="id" type="section">Elt</span></a>.<br/>
<span class="id" type="var">Notation </span><a name="Raw.t"><span class="id" type="abbreviation">t</span></a> := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.tree"><span class="id" type="inductive">tree</span></a>.<br/>
<span class="id" type="var">Notation </span><a name="Raw.::'<<'_x_','_x_','_x_'>>'"><span class="id" type="notation">"</span></a>&lt;&lt; l , b , r &gt;&gt;" := (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.mktriple"><span class="id" type="constructor">mktriple</span></a> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9).<br/>
<span class="id" type="var">Notation </span><a name="Raw.::x_'#l'"><span class="id" type="notation">"</span></a>t #l" := (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t_left"><span class="id" type="projection">t_left</span></a> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#l'").<br/>
<span class="id" type="var">Notation </span><a name="Raw.::x_'#o'"><span class="id" type="notation">"</span></a>t #o" := (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t_opt"><span class="id" type="projection">t_opt</span></a> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#o'").<br/>
<span class="id" type="var">Notation </span><a name="Raw.::x_'#r'"><span class="id" type="notation">"</span></a>t #r" := (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t_right"><span class="id" type="projection">t_right</span></a> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 9, <span class="id" type="var">format</span> "t '#r'").<br/>

<br/>
</div>

<div class="doc">
<a name="lab343"></a><h1 class="section">Map</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.map"><span class="id" type="definition">map</span></a> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>)(<span class="id" type="var">f</span> : <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">elt'</span>)(<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt</span>) : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>   =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#map"><span class="id" type="definition">map</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">d</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#map"><span class="id" type="definition">map</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span>) <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.mapi"><span class="id" type="definition">mapi</span></a> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>)(<span class="id" type="var">f</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">elt'</span>)(<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt</span>) : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>   =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#mapi"><span class="id" type="definition">mapi</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#mapi"><span class="id" type="definition">mapi</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span>) <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab344"></a><h1 class="section">Map with removal</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.map_option"><span class="id" type="definition">map_option</span></a> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>)(<span class="id" type="var">f</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <span class="id" type="var">elt</span> -&gt; <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <span class="id" type="var">elt'</span>)(<span class="id" type="var">m</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt</span>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <span class="id" type="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d'</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.join"><span class="id" type="definition">join</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#map_option"><span class="id" type="definition">map_option</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">x</span> <span class="id" type="var">d'</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#map_option"><span class="id" type="definition">map_option</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.concat"><span class="id" type="definition">concat</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#map_option"><span class="id" type="definition">map_option</span></a> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#map_option"><span class="id" type="definition">map_option</span></a> <span class="id" type="var">f</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab345"></a><h1 class="section">Optimized map2</h1>


<br/> <br/>
  Suggestion by B. Gregoire: a <span class="inlinecode"><span class="id" type="var">map2</span></span> function with specialized
  arguments allowing to bypass some tree traversal. Instead of one
  <span class="inlinecode"><span class="id" type="var">f0</span></span> of type <span class="inlinecode"><span class="id" type="var">key</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt'</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt''</span></span>,
  we ask here for:
<ul>
<li> <span class="inlinecode"><span class="id" type="var">f</span></span> which is a specialisation of <span class="inlinecode"><span class="id" type="var">f0</span></span> when first option isn't <span class="inlinecode"><span class="id" type="var">None</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">mapl</span></span> treats a <span class="inlinecode"><span class="id" type="var">tree</span> <span class="id" type="var">elt</span></span> with <span class="inlinecode"><span class="id" type="var">f0</span></span> when second option is <span class="inlinecode"><span class="id" type="var">None</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">mapr</span></span> treats a <span class="inlinecode"><span class="id" type="var">tree</span> <span class="id" type="var">elt'</span></span> with <span class="inlinecode"><span class="id" type="var">f0</span></span> when first option is <span class="inlinecode"><span class="id" type="var">None</span></span>

</li>
</ul>
  The idea is that <span class="inlinecode"><span class="id" type="var">mapl</span></span> and <span class="inlinecode"><span class="id" type="var">mapr</span></span> can be instantaneous (e.g.
  the identity or some constant function).

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Section</span> <a name="Raw.Map2_opt"><span class="id" type="section">Map2_opt</span></a>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2_opt.elt"><span class="id" type="variable">elt</span></a> <a name="Raw.Map2_opt.elt'"><span class="id" type="variable">elt'</span></a> <a name="Raw.Map2_opt.elt''"><span class="id" type="variable">elt''</span></a> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2_opt.f"><span class="id" type="variable">f</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt'"><span class="id" type="variable">elt'</span></a> -&gt; <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt''"><span class="id" type="variable">elt''</span></a>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2_opt.mapl"><span class="id" type="variable">mapl</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt''"><span class="id" type="variable">elt''</span></a>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2_opt.mapr"><span class="id" type="variable">mapr</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt'"><span class="id" type="variable">elt'</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.elt''"><span class="id" type="variable">elt''</span></a>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="Raw.map2_opt"><span class="id" type="definition">map2_opt</span></a> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">m1</span>, <span class="id" type="var">m2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a>, <span class="id" type="var">_</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.mapr"><span class="id" type="variable">mapr</span></a> <span class="id" type="var">m2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.mapl"><span class="id" type="variable">mapl</span></a> <span class="id" type="var">m1</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">r1</span> <span class="id" type="var">h1</span>, <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l2'</span>,<span class="id" type="var">o2</span>,<span class="id" type="var">r2'</span>) := <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.split"><span class="id" type="definition">split</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">m2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt.f"><span class="id" type="variable">f</span></a> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">o2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">e</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.join"><span class="id" type="definition">join</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#map2_opt"><span class="id" type="definition">map2_opt</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="var">x1</span> <span class="id" type="var">e</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#map2_opt"><span class="id" type="definition">map2_opt</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.concat"><span class="id" type="definition">concat</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#map2_opt"><span class="id" type="definition">map2_opt</span></a> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) (<a class="idref" href="Coq.FSets.FMapAVL.html#map2_opt"><span class="id" type="definition">map2_opt</span></a> <span class="id" type="var">r1</span> <span class="id" type="var">r2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2_opt"><span class="id" type="section">Map2_opt</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab346"></a><h1 class="section">Map2</h1>


<br/> <br/>
    The <span class="inlinecode"><span class="id" type="var">map2</span></span> function of the Map interface can be implemented
    via <span class="inlinecode"><span class="id" type="var">map2_opt</span></span> and <span class="inlinecode"><span class="id" type="var">map_option</span></span>.

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Section</span> <a name="Raw.Map2"><span class="id" type="section">Map2</span></a>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2.elt"><span class="id" type="variable">elt</span></a> <a name="Raw.Map2.elt'"><span class="id" type="variable">elt'</span></a> <a name="Raw.Map2.elt''"><span class="id" type="variable">elt''</span></a> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Map2.f"><span class="id" type="variable">f</span></a> : <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt'"><span class="id" type="variable">elt'</span></a> -&gt; <a class="idref" href="Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt''"><span class="id" type="variable">elt''</span></a>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.map2"><span class="id" type="definition">map2</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt"><span class="id" type="variable">elt</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt'"><span class="id" type="variable">elt'</span></a> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.elt''"><span class="id" type="variable">elt''</span></a> :=<br/>
&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.map2_opt"><span class="id" type="definition">map2_opt</span></a><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">d</span> <span class="id" type="var">o</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.f"><span class="id" type="variable">f</span></a> (<a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d</span>) <span class="id" type="var">o</span>)<br/>
&nbsp;&nbsp;&nbsp;(<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.map_option"><span class="id" type="definition">map_option</span></a> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">d</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.f"><span class="id" type="variable">f</span></a> (<a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d</span>) <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a>))<br/>
&nbsp;&nbsp;&nbsp;(<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.map_option"><span class="id" type="definition">map_option</span></a> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">d'</span> =&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2.f"><span class="id" type="variable">f</span></a> <a class="idref" href="Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a> (<a class="idref" href="Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <span class="id" type="var">d'</span>))).<br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Map2"><span class="id" type="section">Map2</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab347"></a><h1 class="section">Invariants</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Section</span> <a name="Raw.Invariants"><span class="id" type="section">Invariants</span></a>.<br/>
<span class="id" type="keyword">Variable</span> <a name="Raw.Invariants.elt"><span class="id" type="variable">elt</span></a> : <span class="id" type="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab348"></a><h2 class="section">Occurrence in a tree</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Raw.MapsTo"><span class="id" type="inductive">MapsTo</span></a> (<span class="id" type="var">x</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a>)(<span class="id" type="var">e</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants.elt"><span class="id" type="variable">elt</span></a>) : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants.elt"><span class="id" type="variable">elt</span></a> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="Raw.MapsRoot"><span class="id" type="constructor">MapsRoot</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">x</span> <span class="id" type="var">e</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="Raw.MapsLeft"><span class="id" type="constructor">MapsLeft</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">x</span> <span class="id" type="var">e</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="Raw.MapsRight"><span class="id" type="constructor">MapsRight</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">x</span> <span class="id" type="var">e</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Raw.In"><span class="id" type="inductive">In</span></a> (<span class="id" type="var">x</span> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.key"><span class="id" type="definition">key</span></a>) : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants.elt"><span class="id" type="variable">elt</span></a> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="Raw.InRoot"><span class="id" type="constructor">InRoot</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#X.eq"><span class="id" type="axiom">X.eq</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="Raw.InLeft"><span class="id" type="constructor">InLeft</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>)<br/>
&nbsp;&nbsp;| <a name="Raw.InRight"><span class="id" type="constructor">InRight</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.In0"><span class="id" type="definition">In0</span></a> <span class="id" type="var">k</span> <span class="id" type="var">m</span> := <a class="idref" href="Coq.Init.Logic.html#:type_scope:'exists'_x_':'_x_','_x"><span class="id" type="notation">exists</span></a> <span class="id" type="var">e</span><a class="idref" href="Coq.Init.Logic.html#:type_scope:'exists'_x_':'_x_','_x"><span class="id" type="notation">:</span></a><a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants.elt"><span class="id" type="variable">elt</span></a><a class="idref" href="Coq.Init.Logic.html#:type_scope:'exists'_x_':'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.MapsTo"><span class="id" type="inductive">MapsTo</span></a> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab349"></a><h2 class="section">Binary search trees</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span></span>: all elements in <span class="inlinecode"><span class="id" type="var">s</span></span> are smaller than <span class="inlinecode"><span class="id" type="var">x</span></span>
   (resp. greater for <span class="inlinecode"><span class="id" type="var">gt_tree</span></span>) 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">y</span> <span class="id" type="var">m</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span>.<br/>
<span class="id" type="keyword">Definition</span> <a name="Raw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">m</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.In"><span class="id" type="inductive">In</span></a> <span class="id" type="var">y</span> <span class="id" type="var">m</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#X.lt"><span class="id" type="axiom">X.lt</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">bst</span> <span class="id" type="var">t</span></span> : <span class="inlinecode"><span class="id" type="var">t</span></span> is a binary search tree 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="Raw.bst"><span class="id" type="inductive">bst</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.t"><span class="id" type="abbreviation">t</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants.elt"><span class="id" type="variable">elt</span></a> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="Raw.BSLeaf"><span class="id" type="constructor">BSLeaf</span></a> : <a class="idref" href="Coq.FSets.FMapAVL.html#bst"><span class="id" type="inductive">bst</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Leaf"><span class="id" type="constructor">Leaf</span></a> <span class="id" type="var">_</span>)<br/>
&nbsp;&nbsp;| <a name="Raw.BSNode"><span class="id" type="constructor">BSNode</span></a> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>, <a class="idref" href="Coq.FSets.FMapAVL.html#bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#bst"><span class="id" type="inductive">bst</span></a> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.lt_tree"><span class="id" type="definition">lt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.gt_tree"><span class="id" type="definition">gt_tree</span></a> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <a class="idref" href="Coq.FSets.FMapAVL.html#bst"><span class="id" type="inductive">bst</span></a> (<a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Node"><span class="id" type="constructor">Node</span></a> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Coq.FSets.FMapAVL.html#Raw.Invariants"><span class="id" type="section">Invariants</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab350"></a><h1 class="section">Correctness proofs, isolated in a sub-module</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <a name="Raw.Proofs"><span class="id" type="module">Proofs</span></a>.<br/>
&nbsp;<span class="id" type="keyword">Module</span> <a name="Raw.Proofs.MX"><span class="id" type="module">MX</span></a> := <a class="idref" href="Coq.Structures.OrderedType.html#"><span class="id" type="module">OrderedTypeFacts</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#"><span class="id" type="module">X</span></a>.<br/>
&nbsp;<span class="id" type="keyword">Module</span> <a name="Raw.Proofs.PX"><span class="id" type="module">PX</span></a> := <a class="idref" href="Coq.Structures.OrderedType.html#"><span class="id" type="module">KeyOrderedType</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#"><span class="id" type="module">X</span></a>.<br/>
&nbsp;<span class="id" type="keyword">Module</span> <a name="Raw.Proofs.L"><span class="id" type="module">L</span></a> := <a class="idref" href="Coq.FSets.FMapList.html#"><span class="id" type="module">FMapList.Raw</span></a> <a class="idref" href="Coq.FSets.FMapAVL.html#"><span class="id" type="module">X</span></a>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab351"></a><h1 class="section">Automation and dedicated tactics.</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">tree</span> <span class="id" type="var">MapsTo</span> <span class="id" type="var">In</span> <span class="id" type="var">bst</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">lt_tree</span> <span class="id" type="var">gt_tree</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "factornode" <span class="id" type="var">ident</span>(<span class="id" type="var">l</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">x</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">d</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">r</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">h</span>)<br/>
&nbsp;"as" <span class="id" type="var">ident</span>(<span class="id" type="var">s</span>) :=<br/>
&nbsp;<span class="id" type="tactic">set</span> (<span class="id" type="var">s</span>:=<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic for cleaning hypothesis after use of functional induction. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">clearf</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">H</span> : (@<span class="id" type="var">Logic.eq</span> (<span class="id" type="var">Compare</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">clearf</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">H</span> : (@<span class="id" type="var">Logic.eq</span> (<span class="id" type="var">sumbool</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">clearf</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic to repeat <span class="inlinecode"><span class="id" type="tactic">inversion_clear</span></span> on all hyps of the
    form <span class="inlinecode">(<span class="id" type="var">f</span> (<span class="id" type="var">Node</span> ...))</span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">inv</span> <span class="id" type="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> (<span class="id" type="var">Node</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> (<span class="id" type="var">Node</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Node</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>:<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Node</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">inv_all</span> <span class="id" type="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>: <span class="id" type="var">f</span> <span class="id" type="var">_</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>: <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>: <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span>: <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>; <span class="id" type="var">inv</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">idtac</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Helper tactic concerning order of elements. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">order</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">U</span>: <span class="id" type="var">lt_tree</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span>, <span class="id" type="var">V</span>: <span class="id" type="var">In</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">U</span> <span class="id" type="var">_</span> <span class="id" type="var">V</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">U</span>; <span class="id" type="var">order</span><br/>
&nbsp;| <span class="id" type="var">U</span>: <span class="id" type="var">gt_tree</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span>, <span class="id" type="var">V</span>: <span class="id" type="var">In</span> <span class="id" type="var">_</span> ?<span class="id" type="var">s</span> |- <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">U</span> <span class="id" type="var">_</span> <span class="id" type="var">V</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">U</span>; <span class="id" type="var">order</span><br/>
&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">MX.order</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">intuition_in</span> := <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">progress</span> (<span class="id" type="tactic">intuition</span>; <span class="id" type="var">inv</span> <span class="id" type="var">In</span>; <span class="id" type="var">inv</span> <span class="id" type="var">MapsTo</span>).<br/>

<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">join_tac</span> :=<br/>
&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [| <span class="id" type="var">ll</span> <span class="id" type="var">_</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="var">Hlr</span> <span class="id" type="var">lh</span>];<br/>
&nbsp;&nbsp;&nbsp;[ | <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">r</span> <span class="id" type="keyword">as</span> [| <span class="id" type="var">rl</span> <span class="id" type="var">Hrl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span> <span class="id" type="var">_</span> <span class="id" type="var">rh</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">join</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" type="tactic">destruct</span> (<span class="id" type="var">gt_le_dec</span> <span class="id" type="var">lh</span> (<span class="id" type="var">rh</span>+2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> |- <span class="id" type="var">context</span> [ <span class="id" type="var">bal</span> ?<span class="id" type="var">u</span> ?<span class="id" type="var">v</span> ?<span class="id" type="var">w</span> ?<span class="id" type="var">z</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> (<span class="id" type="var">bal</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">w</span> <span class="id" type="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> (<span class="id" type="var">bal</span> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> (<span class="id" type="var">join</span> <span class="id" type="var">lr</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> (<span class="id" type="var">Node</span> <span class="id" type="var">rl</span> <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span> <span class="id" type="var">rh</span>))); [ | <span class="id" type="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="tactic">destruct</span> (<span class="id" type="var">gt_le_dec</span> <span class="id" type="var">rh</span> (<span class="id" type="var">lh</span>+2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> |- <span class="id" type="var">context</span> [ <span class="id" type="var">bal</span> ?<span class="id" type="var">u</span> ?<span class="id" type="var">v</span> ?<span class="id" type="var">w</span> ?<span class="id" type="var">z</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> (<span class="id" type="var">bal</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">w</span> <span class="id" type="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> (<span class="id" type="var">bal</span> (<span class="id" type="var">join</span> (<span class="id" type="var">Node</span> <span class="id" type="var">ll</span> <span class="id" type="var">lx</span> <span class="id" type="var">ld</span> <span class="id" type="var">lr</span> <span class="id" type="var">lh</span>) <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">rl</span>) <span class="id" type="var">rx</span> <span class="id" type="var">rd</span> <span class="id" type="var">rr</span>); [ | <span class="id" type="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ] ] ] ]; <span class="id" type="tactic">intros</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Elt</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span>:<span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Types</span> <span class="id" type="var">m</span> <span class="id" type="var">r</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab352"></a><h1 class="section">Basic results about <span class="inlinecode"><span class="id" type="var">MapsTo</span></span>, <span class="inlinecode"><span class="id" type="var">In</span></span>, <span class="inlinecode"><span class="id" type="var">lt_tree</span></span>, <span class="inlinecode"><span class="id" type="var">gt_tree</span></span>, <span class="inlinecode"><span class="id" type="var">height</span></span></h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
Facts about <span class="inlinecode"><span class="id" type="var">MapsTo</span></span> and <span class="inlinecode"><span class="id" type="var">In</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">MapsTo_In</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">MapsTo_In</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">In_MapsTo</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span>, <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">e</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">In_alt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span>, <span class="id" type="var">In0</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">MapsTo_1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Immediate</span> <span class="id" type="var">MapsTo_1</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">In_1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">In_node_iff</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
</div>

<div class="doc">
Results about <span class="inlinecode"><span class="id" type="var">lt_tree</span></span> and <span class="inlinecode"><span class="id" type="var">gt_tree</span></span> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_leaf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">elt</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_leaf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Leaf</span> <span class="id" type="var">elt</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_tree_node</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_tree_node</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">lt_leaf</span> <span class="id" type="var">gt_leaf</span> <span class="id" type="var">lt_tree_node</span> <span class="id" type="var">gt_tree_node</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_left</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_right</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_left</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_right</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">lt_left</span> <span class="id" type="var">lt_right</span> <span class="id" type="var">gt_left</span> <span class="id" type="var">gt_right</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_tree_not_in</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; ~ <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_tree_trans</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">X.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_tree_not_in</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; ~ <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">gt_tree_trans</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">lt_tree_not_in</span> <span class="id" type="var">lt_tree_trans</span> <span class="id" type="var">gt_tree_not_in</span> <span class="id" type="var">gt_tree_trans</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab353"></a><h1 class="section">Empty map</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Empty</span> <span class="id" type="var">m</span> := <span class="id" type="keyword">forall</span> (<span class="id" type="var">a</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">e</span>:<span class="id" type="var">elt</span>) , ~ <span class="id" type="var">MapsTo</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">empty_bst</span> : <span class="id" type="var">bst</span> (<span class="id" type="var">empty</span> <span class="id" type="var">elt</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">empty_1</span> : <span class="id" type="var">Empty</span> (<span class="id" type="var">empty</span> <span class="id" type="var">elt</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab354"></a><h1 class="section">Emptyness test</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_empty_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Empty</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">is_empty</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_empty_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">is_empty</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab355"></a><h1 class="section">Membership</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">e</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">e</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_iff</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">e</span> &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> &lt;&gt; <span class="id" type="var">None</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_in_iff</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> &lt;&gt; <span class="id" type="var">None</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">not_find_iff</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">None</span> &lt;-&gt; ~<span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">x</span>,<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> &lt;-&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">d</span>, <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">d</span> &lt;-&gt; <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> = <span class="id" type="var">Some</span> <span class="id" type="var">d</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_mapsto_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> &lt;-&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">d</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">m'</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_in_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab356"></a><h1 class="section">Helper functions</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">create_bst</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>, <span class="id" type="var">bst</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">create_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">create_in</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bal_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>, <span class="id" type="var">bst</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;<span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">bal_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bal_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bal_mapsto</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bal_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">bal</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>) = <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab357"></a><h1 class="section">Insertion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>,<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">add_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, ~<span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e'</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, ~<span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e'</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">X.compare</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> <span class="id" type="keyword">with</span> <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">e</span> | <span class="id" type="var">_</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab358"></a><h1 class="section">Extraction of minimum binding</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#1 \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#1.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_mapsto</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;((<span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#1) /\ <span class="id" type="var">e'</span> = (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e'</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#1.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#1.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">remove_min_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_gt_tree</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">gt_tree</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#1 (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#1.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">remove_min_gt_tree</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_min_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span> <span class="id" type="var">h</span>) =<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">X.compare</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#1 <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#2#2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">GT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove_min</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">r</span>)#1<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab359"></a><h1 class="section">Merging two trees</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">merge</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>) &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m1</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_mapsto</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">merge</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>) &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m1</span> \/ <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> : <span class="id" type="var">key</span>, <span class="id" type="var">In</span> <span class="id" type="var">y1</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y2</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">merge</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab360"></a><h1 class="section">Deletion</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>) &lt;-&gt; ~ <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; ~ <span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; ~<span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab361"></a><h1 class="section">join</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">join_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">join</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>) &lt;-&gt; <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">join_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>, <span class="id" type="var">bst</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;<span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">join</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">join_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">join_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">bst</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">r</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">join</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>) = <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">create</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab362"></a><h1 class="section">split</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_in_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>,<br/>
&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> /\ <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_in_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>,<br/>
&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">r</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> /\ <span class="id" type="var">X.lt</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_in_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;(<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">o</span> = <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">l</span> /\ <span class="id" type="var">bst</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_lt_tree</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">lt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_gt_tree</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">gt_tree</span> <span class="id" type="var">x</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">r</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> = <span class="id" type="keyword">match</span> <span class="id" type="var">X.compare</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">GT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="tactic">split</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>)#<span class="id" type="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab363"></a><h1 class="section">Concatenation</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">concat_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">concat</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>) &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m1</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m2</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">concat_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>, <span class="id" type="var">In</span> <span class="id" type="var">y1</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y2</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">concat</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">concat_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">concat_find</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m2</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>, <span class="id" type="var">In</span> <span class="id" type="var">y1</span> <span class="id" type="var">m1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y2</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">concat</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>) =<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Some</span> <span class="id" type="var">d</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">d</span> | <span class="id" type="var">None</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m1</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab364"></a><h1 class="section">Elements</h1>

</div>
<div class="code">

<br/>
<span class="id" type="var">Notation </span><span class="id" type="var">eqk</span> := (<span class="id" type="var">PX.eqk</span> (<span class="id" type="var">elt</span>:= <span class="id" type="var">elt</span>)).<br/>
<span class="id" type="var">Notation </span><span class="id" type="var">eqke</span> := (<span class="id" type="var">PX.eqke</span> (<span class="id" type="var">elt</span>:= <span class="id" type="var">elt</span>)).<br/>
<span class="id" type="var">Notation </span><span class="id" type="var">ltk</span> := (<span class="id" type="var">PX.ltk</span> (<span class="id" type="var">elt</span>:= <span class="id" type="var">elt</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_aux_mapsto</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">acc</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>,<br/>
&nbsp;<span class="id" type="var">InA</span> <span class="id" type="var">eqke</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> \/ <span class="id" type="var">InA</span> <span class="id" type="var">eqke</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) <span class="id" type="var">acc</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_mapsto</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">InA</span> <span class="id" type="var">eqke</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_in</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">x</span>, <span class="id" type="var">L.PX.In</span> <span class="id" type="var">x</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_aux_sort</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">acc</span>, <span class="id" type="var">bst</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">sort</span> <span class="id" type="var">ltk</span> <span class="id" type="var">acc</span> -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">y</span>, <span class="id" type="var">InA</span> <span class="id" type="var">eqke</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) <span class="id" type="var">acc</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">X.lt</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">sort</span> <span class="id" type="var">ltk</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_sort</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>, <span class="id" type="var">bst</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">sort</span> <span class="id" type="var">ltk</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">elements_sort</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_nodup</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>, <span class="id" type="var">bst</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">NoDupA</span> <span class="id" type="var">eqk</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_aux_cardinal</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">acc</span>, (<span class="id" type="var">length</span> <span class="id" type="var">acc</span> + <span class="id" type="var">cardinal</span> <span class="id" type="var">m</span>)%<span class="id" type="var">nat</span> = <span class="id" type="var">length</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_cardinal</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>), <span class="id" type="var">cardinal</span> <span class="id" type="var">m</span> = <span class="id" type="var">length</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">acc</span>, <span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span> = <span class="id" type="var">elements</span> <span class="id" type="var">s</span> ++ <span class="id" type="var">acc</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_node</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">z</span> <span class="id" type="var">l</span>,<br/>
&nbsp;<span class="id" type="var">elements</span> <span class="id" type="var">t1</span> ++ (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) :: <span class="id" type="var">elements</span> <span class="id" type="var">t2</span> ++ <span class="id" type="var">l</span> =<br/>
&nbsp;<span class="id" type="var">elements</span> (<span class="id" type="var">Node</span> <span class="id" type="var">t1</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">t2</span> <span class="id" type="var">z</span>) ++ <span class="id" type="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab365"></a><h1 class="section">Fold</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">fold'</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>)(<span class="id" type="var">s</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">L.fold</span> <span class="id" type="var">f</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_equiv_aux</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">s</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) <span class="id" type="var">acc</span>,<br/>
&nbsp;<span class="id" type="var">L.fold</span> <span class="id" type="var">f</span> (<span class="id" type="var">elements_aux</span> <span class="id" type="var">acc</span> <span class="id" type="var">s</span>) <span class="id" type="var">a</span> = <span class="id" type="var">L.fold</span> <span class="id" type="var">f</span> <span class="id" type="var">acc</span> (<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">a</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_equiv</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">s</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">a</span> = <span class="id" type="var">fold'</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">a</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">Hs</span>:<span class="id" type="var">bst</span> <span class="id" type="var">s</span>)(<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>)(<span class="id" type="var">i</span>:<span class="id" type="var">A</span>)(<span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">i</span> = <span class="id" type="var">fold_left</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">p</span>#1 <span class="id" type="var">p</span>#2 <span class="id" type="var">a</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) <span class="id" type="var">i</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab366"></a><h1 class="section">Comparison</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span></span> returns the list of elements of the enumeration <span class="inlinecode"><span class="id" type="var">e</span></span>
    i.e. the list of elements actually compared 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">flatten_e</span> (<span class="id" type="var">e</span> : <span class="id" type="var">enumeration</span> <span class="id" type="var">elt</span>) : <span class="id" type="var">list</span> (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) := <span class="id" type="keyword">match</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="keyword">End</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">More</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> =&gt; (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) :: <span class="id" type="var">elements</span> <span class="id" type="var">t</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">r</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flatten_e_elements</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">r</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">z</span> <span class="id" type="var">e</span>,<br/>
&nbsp;<span class="id" type="var">elements</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">flatten_e</span> (<span class="id" type="var">More</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">e</span>) =<br/>
&nbsp;<span class="id" type="var">elements</span> (<span class="id" type="var">Node</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">r</span> <span class="id" type="var">z</span>) ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>) <span class="id" type="var">e</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">flatten_e</span> (<span class="id" type="var">cons</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>) = <span class="id" type="var">elements</span> <span class="id" type="var">s</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>.<br/>

<br/>
</div>

<div class="doc">
Proof of correction for the comparison 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">cmp</span> : <span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">bool</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">IfEq</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> := <span class="id" type="var">L.equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">b</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_IfEq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">X.eq</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> -&gt; <span class="id" type="var">cmp</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> = <span class="id" type="var">true</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">IfEq</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IfEq</span> <span class="id" type="var">b</span> ((<span class="id" type="var">x1</span>,<span class="id" type="var">d1</span>)::<span class="id" type="var">l1</span>) ((<span class="id" type="var">x2</span>,<span class="id" type="var">d2</span>)::<span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_end_IfEq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">IfEq</span> (<span class="id" type="var">equal_end</span> <span class="id" type="var">e2</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_more_IfEq</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> (<span class="id" type="var">cont</span>:<span class="id" type="var">enumeration</span> <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">IfEq</span> (<span class="id" type="var">cont</span> (<span class="id" type="var">cons</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) <span class="id" type="var">l</span> (<span class="id" type="var">elements</span> <span class="id" type="var">r2</span> ++ <span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IfEq</span> (<span class="id" type="var">equal_more</span> <span class="id" type="var">cmp</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">cont</span> (<span class="id" type="var">More</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) ((<span class="id" type="var">x1</span>,<span class="id" type="var">d1</span>)::<span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">flatten_e</span> (<span class="id" type="var">More</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_cont_IfEq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">IfEq</span> (<span class="id" type="var">cont</span> <span class="id" type="var">e</span>) <span class="id" type="var">l</span> (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">IfEq</span> (<span class="id" type="var">equal_cont</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_IfEq</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m1</span> <span class="id" type="var">m2</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">IfEq</span> (<span class="id" type="var">equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m1</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m2</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Equivb</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> :=<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span>, <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m'</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e'</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">cmp</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> = <span class="id" type="var">true</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Equivb_elements</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>,<br/>
&nbsp;<span class="id" type="var">Equivb</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> &lt;-&gt; <span class="id" type="var">L.Equivb</span> <span class="id" type="var">cmp</span> (<span class="id" type="var">elements</span> <span class="id" type="var">s</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">s'</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_Equivb</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">s'</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>), <span class="id" type="var">bst</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">s'</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> = <span class="id" type="var">true</span> &lt;-&gt; <span class="id" type="var">Equivb</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Elt</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Map</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f</span> : <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">elt'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">e</span>:<span class="id" type="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">e</span>) (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Map</span>.<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Mapi</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">elt'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>: <span class="id" type="var">tree</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">e</span>:<span class="id" type="var">elt</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">y</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> /\ <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>) (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Mapi</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Map_option</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt'</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">f_compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span> <span class="id" type="var">d</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> = <span class="id" type="var">f</span> <span class="id" type="var">x'</span> <span class="id" type="var">d</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_option_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>),<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">map_option</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">d</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">m</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_option_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">map_option</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">map_option_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">nonify</span> <span class="id" type="var">e</span> :=<br/>
&nbsp;<span class="id" type="tactic">replace</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">None</span> <span class="id" type="var">elt</span>) <span class="id" type="tactic">by</span><br/>
&nbsp;&nbsp;(<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">not_find_iff</span>; <span class="id" type="tactic">auto</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="var">order</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_option_find</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>),<br/>
&nbsp;<span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> (<span class="id" type="var">map_option</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">Some</span> <span class="id" type="var">d</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> | <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Map_option</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Map2_opt</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> <span class="id" type="var">elt''</span> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f0</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt'</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt''</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt'</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt''</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">mapl</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">t</span> <span class="id" type="var">elt''</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">mapr</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt'</span> -&gt; <span class="id" type="var">t</span> <span class="id" type="var">elt''</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">f0_f</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">o</span>, <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">d</span> <span class="id" type="var">o</span> = <span class="id" type="var">f0</span> <span class="id" type="var">x</span> (<span class="id" type="var">Some</span> <span class="id" type="var">d</span>) <span class="id" type="var">o</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">mapl_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">mapl</span> <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">mapr_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m'</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">mapr</span> <span class="id" type="var">m'</span>).<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">mapl_f0</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> (<span class="id" type="var">mapl</span> <span class="id" type="var">m</span>) =<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Some</span> <span class="id" type="var">d</span> =&gt; <span class="id" type="var">f0</span> <span class="id" type="var">x</span> (<span class="id" type="var">Some</span> <span class="id" type="var">d</span>) <span class="id" type="var">None</span> | <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">mapr_f0</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> (<span class="id" type="var">mapr</span> <span class="id" type="var">m'</span>) =<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Some</span> <span class="id" type="var">d'</span> =&gt; <span class="id" type="var">f0</span> <span class="id" type="var">x</span> <span class="id" type="var">None</span> (<span class="id" type="var">Some</span> <span class="id" type="var">d'</span>) | <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">f0_compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span> <span class="id" type="var">o</span> <span class="id" type="var">o'</span>, <span class="id" type="var">X.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">x'</span> -&gt; <span class="id" type="var">f0</span> <span class="id" type="var">x</span> <span class="id" type="var">o</span> <span class="id" type="var">o'</span> = <span class="id" type="var">f0</span> <span class="id" type="var">x'</span> <span class="id" type="var">o</span> <span class="id" type="var">o'</span>.<br/>

<br/>
<span class="id" type="var">Notation </span><span class="id" type="var">map2_opt</span> := (<span class="id" type="var">map2_opt</span> <span class="id" type="var">f</span> <span class="id" type="var">mapl</span> <span class="id" type="var">mapr</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_opt_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">map2_opt</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_opt_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">bst</span> (<span class="id" type="var">map2_opt</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">map2_opt_bst</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">map2_aux</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">H</span> : <span class="id" type="var">In</span> ?<span class="id" type="var">x</span> <span class="id" type="var">_</span> \/ <span class="id" type="var">In</span> ?<span class="id" type="var">x</span> ?<span class="id" type="var">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">H'</span> : <span class="id" type="var">find</span> ?<span class="id" type="var">x</span> ?<span class="id" type="var">m</span> = <span class="id" type="var">find</span> ?<span class="id" type="var">x</span> ?<span class="id" type="var">m'</span>, <span class="id" type="var">B</span>:<span class="id" type="var">bst</span> ?<span class="id" type="var">m</span>, <span class="id" type="var">B'</span>:<span class="id" type="var">bst</span> ?<span class="id" type="var">m'</span> |- <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span>; [ <span class="id" type="var">intuition_in</span>; <span class="id" type="var">order</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;-(<span class="id" type="var">find_in_equiv</span> <span class="id" type="var">B</span> <span class="id" type="var">B'</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">auto</span> ]<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">nonify</span> <span class="id" type="var">t</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">find</span> ?<span class="id" type="var">y</span> (<span class="id" type="var">map2_opt</span> ?<span class="id" type="var">m</span> ?<span class="id" type="var">m'</span>)) =&gt;<br/>
&nbsp;<span class="id" type="tactic">replace</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">None</span> <span class="id" type="var">elt''</span>);<br/>
&nbsp;[ | <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">not_find_iff</span>; <span class="id" type="tactic">auto</span>; <span class="id" type="tactic">intro</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">map2_opt_2</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">y</span>); <span class="id" type="tactic">auto</span>; <span class="id" type="var">order</span> ]<br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_opt_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">map2_opt</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) = <span class="id" type="var">f0</span> <span class="id" type="var">y</span> (<span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>) (<span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Map2_opt</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Map2</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> <span class="id" type="var">elt''</span> : <span class="id" type="keyword">Type</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">f</span> : <span class="id" type="var">option</span> <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt'</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">elt''</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_bst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">bst</span> (<span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">y</span> (<span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) = <span class="id" type="var">f</span> (<span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span>) (<span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">y</span>, <span class="id" type="var">bst</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">bst</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Map2</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Proofs</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Raw</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab367"></a><h1 class="section">Encapsulation</h1>


<br/> <br/>
   Now, in order to really provide a functor implementing <span class="inlinecode"><span class="id" type="var">S</span></span>, we
   need to encapsulate everything into a type of balanced binary search trees. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">IntMake</span> (<span class="id" type="var">I</span>:<span class="id" type="var">Int</span>)(<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">E</span> := <span class="id" type="var">X</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">E</span> := <span class="id" type="var">X</span>.<br/>
&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">Raw</span> := <span class="id" type="var">Raw</span> <span class="id" type="var">I</span> <span class="id" type="var">X</span>.<br/>
&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">Raw.Proofs</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Record</span> <span class="id" type="var">bst</span> (<span class="id" type="var">elt</span>:<span class="id" type="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">Bst</span> {<span class="id" type="var">this</span> :&gt; <span class="id" type="var">Raw.tree</span> <span class="id" type="var">elt</span>; <span class="id" type="var">is_bst</span> : <span class="id" type="var">Raw.bst</span> <span class="id" type="var">this</span>}.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">t</span> := <span class="id" type="var">bst</span>.<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">key</span> := <span class="id" type="var">E.t</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Section</span> <span class="id" type="var">Elt</span>.<br/>
&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> <span class="id" type="var">elt''</span>: <span class="id" type="keyword">Type</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Types</span> <span class="id" type="var">m</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span>.<br/>
&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Types</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">key</span>.<br/>
&nbsp;<span class="id" type="keyword">Implicit</span> <span class="id" type="keyword">Types</span> <span class="id" type="var">e</span> : <span class="id" type="var">elt</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">empty</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span> := <span class="id" type="var">Bst</span> (<span class="id" type="var">empty_bst</span> <span class="id" type="var">elt</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">is_empty</span> <span class="id" type="var">m</span> : <span class="id" type="var">bool</span> := <span class="id" type="var">Raw.is_empty</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span> := <span class="id" type="var">Bst</span> (<span class="id" type="var">add_bst</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.(<span class="id" type="var">is_bst</span>)).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt</span> := <span class="id" type="var">Bst</span> (<span class="id" type="var">remove_bst</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.(<span class="id" type="var">is_bst</span>)).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <span class="id" type="var">bool</span> := <span class="id" type="var">Raw.mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <span class="id" type="var">option</span> <span class="id" type="var">elt</span> := <span class="id" type="var">Raw.find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt'</span> := <span class="id" type="var">Bst</span> (<span class="id" type="var">map_bst</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>.(<span class="id" type="var">is_bst</span>)).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">mapi</span> (<span class="id" type="var">f</span>:<span class="id" type="var">key</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt'</span>) <span class="id" type="var">m</span> : <span class="id" type="var">t</span> <span class="id" type="var">elt'</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">Bst</span> (<span class="id" type="var">mapi_bst</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>.(<span class="id" type="var">is_bst</span>)).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> (<span class="id" type="var">m'</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt'</span>) : <span class="id" type="var">t</span> <span class="id" type="var">elt''</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">Bst</span> (<span class="id" type="var">map2_bst</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>.(<span class="id" type="var">is_bst</span>) <span class="id" type="var">m'</span>.(<span class="id" type="var">is_bst</span>)).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">elements</span> <span class="id" type="var">m</span> : <span class="id" type="var">list</span> (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) := <span class="id" type="var">Raw.elements</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">cardinal</span> <span class="id" type="var">m</span> := <span class="id" type="var">Raw.cardinal</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">fold</span> (<span class="id" type="var">A</span>:<span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span>:<span class="id" type="var">key</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">A</span>-&gt;<span class="id" type="var">A</span>) <span class="id" type="var">m</span> <span class="id" type="var">i</span> := <span class="id" type="var">Raw.fold</span> (<span class="id" type="var">A</span>:=<span class="id" type="var">A</span>) <span class="id" type="var">f</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>) <span class="id" type="var">i</span>.<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> : <span class="id" type="var">bool</span> := <span class="id" type="var">Raw.equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>) <span class="id" type="var">m'</span>.(<span class="id" type="var">this</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> : <span class="id" type="keyword">Prop</span> := <span class="id" type="var">Raw.MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> : <span class="id" type="keyword">Prop</span> := <span class="id" type="var">Raw.In0</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">Empty</span> <span class="id" type="var">m</span> : <span class="id" type="keyword">Prop</span> := <span class="id" type="var">Empty</span> <span class="id" type="var">m</span>.(<span class="id" type="var">this</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_key</span> : (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; <span class="id" type="keyword">Prop</span> := @<span class="id" type="var">PX.eqk</span> <span class="id" type="var">elt</span>.<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_key_elt</span> : (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; <span class="id" type="keyword">Prop</span> := @<span class="id" type="var">PX.eqke</span> <span class="id" type="var">elt</span>.<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">lt_key</span> : (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; (<span class="id" type="var">key</span>*<span class="id" type="var">elt</span>) -&gt; <span class="id" type="keyword">Prop</span> := @<span class="id" type="var">PX.ltk</span> <span class="id" type="var">elt</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">MapsTo_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">empty_1</span> : <span class="id" type="var">Empty</span> <span class="id" type="var">empty</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_empty_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Empty</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">is_empty</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span>.<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_empty_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">is_empty</span> <span class="id" type="var">m</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">Empty</span> <span class="id" type="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>).<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, ~ <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e'</span> <span class="id" type="var">m</span>).<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, ~ <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">x</span> <span class="id" type="var">e'</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; ~ <span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, ~ <span class="id" type="var">E.eq</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>).<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">e</span>.<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>, <span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> = <span class="id" type="var">Some</span> <span class="id" type="var">e</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">i</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">key</span> -&gt; <span class="id" type="var">elt</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">fold</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">i</span> = <span class="id" type="var">fold_left</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">f</span> (<span class="id" type="var">fst</span> <span class="id" type="var">p</span>) (<span class="id" type="var">snd</span> <span class="id" type="var">p</span>) <span class="id" type="var">a</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>) <span class="id" type="var">i</span>.<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">InA</span> <span class="id" type="var">eq_key_elt</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">InA</span> <span class="id" type="var">eq_key_elt</span> (<span class="id" type="var">x</span>,<span class="id" type="var">e</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">sort</span> <span class="id" type="var">lt_key</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">elements_3w</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">NoDupA</span> <span class="id" type="var">eq_key</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">cardinal</span> <span class="id" type="var">m</span> = <span class="id" type="var">length</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">Equal</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span>, <span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m</span> = <span class="id" type="var">find</span> <span class="id" type="var">y</span> <span class="id" type="var">m'</span>.<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">Equiv</span> (<span class="id" type="var">eq_elt</span>:<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="keyword">Prop</span>) <span class="id" type="var">m</span> <span class="id" type="var">m'</span> :=<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span>, <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">k</span> <span class="id" type="var">m'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">k</span> <span class="id" type="var">e'</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">eq_elt</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>).<br/>
&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> := <span class="id" type="var">Equiv</span> (<span class="id" type="var">Cmp</span> <span class="id" type="var">cmp</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Equivb_Equivb</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> &lt;-&gt; <span class="id" type="var">Raw.Proofs.Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">cmp</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> = <span class="id" type="var">true</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equal_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> <span class="id" type="var">cmp</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">equal</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">End</span> <span class="id" type="var">Elt</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">e</span>:<span class="id" type="var">elt</span>)(<span class="id" type="var">f</span>:<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt'</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt; <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">e</span>) (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>
 
<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>:<span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">f</span>:<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt'</span>), <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">e</span>:<span class="id" type="var">elt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">f</span>:<span class="id" type="var">key</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt'</span>), <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> <span class="id" type="var">e</span> <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">y</span>, <span class="id" type="var">E.eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> /\ <span class="id" type="var">MapsTo</span> <span class="id" type="var">x</span> (<span class="id" type="var">f</span> <span class="id" type="var">y</span> <span class="id" type="var">e</span>) (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>).<br/>
 &nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">f</span>:<span class="id" type="var">key</span>-&gt;<span class="id" type="var">elt</span>-&gt;<span class="id" type="var">elt'</span>), <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> <span class="id" type="var">elt''</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">m'</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">f</span>:<span class="id" type="var">option</span> <span class="id" type="var">elt</span>-&gt;<span class="id" type="var">option</span> <span class="id" type="var">elt'</span>-&gt;<span class="id" type="var">option</span> <span class="id" type="var">elt''</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">x</span> (<span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) = <span class="id" type="var">f</span> (<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span>) (<span class="id" type="var">find</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map2_2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">elt</span> <span class="id" type="var">elt'</span> <span class="id" type="var">elt''</span>:<span class="id" type="keyword">Type</span>)(<span class="id" type="var">m</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt</span>)(<span class="id" type="var">m'</span>: <span class="id" type="var">t</span> <span class="id" type="var">elt'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">x</span>:<span class="id" type="var">key</span>)(<span class="id" type="var">f</span>:<span class="id" type="var">option</span> <span class="id" type="var">elt</span>-&gt;<span class="id" type="var">option</span> <span class="id" type="var">elt'</span>-&gt;<span class="id" type="var">option</span> <span class="id" type="var">elt''</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">map2</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">IntMake</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">IntMake_ord</span> (<span class="id" type="var">I</span>:<span class="id" type="var">Int</span>)(<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>)(<span class="id" type="var">D</span> : <span class="id" type="var">OrderedType</span>) &lt;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Sord</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">Data</span> := <span class="id" type="var">D</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">MapS.E</span> := <span class="id" type="var">X</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">Data</span> := <span class="id" type="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">MapS</span> := <span class="id" type="var">IntMake</span>(<span class="id" type="var">I</span>)(<span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">LO</span> := <span class="id" type="var">FMapList.Make_ord</span>(<span class="id" type="var">X</span>)(<span class="id" type="var">D</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">R</span> := <span class="id" type="var">Raw</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">P</span> := <span class="id" type="var">Raw.Proofs</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">t</span> := <span class="id" type="var">MapS.t</span> <span class="id" type="var">D.t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">cmp</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">D.compare</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
One step of comparison of elements 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">compare_more</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> (<span class="id" type="var">cont</span>:<span class="id" type="var">R.enumeration</span> <span class="id" type="var">D.t</span> -&gt; <span class="id" type="var">comparison</span>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">R.End</span> =&gt; <span class="id" type="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">R.More</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">X.compare</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">D.compare</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">EQ</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">cont</span> (<span class="id" type="var">R.cons</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Lt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">GT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Lt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">GT</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Gt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Comparison of left tree, middle element, then right tree 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">compare_cont</span> <span class="id" type="var">s1</span> (<span class="id" type="var">cont</span>:<span class="id" type="var">R.enumeration</span> <span class="id" type="var">D.t</span> -&gt; <span class="id" type="var">comparison</span>) <span class="id" type="var">e2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">R.Leaf</span> =&gt; <span class="id" type="var">cont</span> <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">R.Node</span> <span class="id" type="var">l1</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">r1</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">compare_cont</span> <span class="id" type="var">l1</span> (<span class="id" type="var">compare_more</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> (<span class="id" type="var">compare_cont</span> <span class="id" type="var">r1</span> <span class="id" type="var">cont</span>)) <span class="id" type="var">e2</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Initial continuation 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">compare_end</span> (<span class="id" type="var">e2</span>:<span class="id" type="var">R.enumeration</span> <span class="id" type="var">D.t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R.End</span> =&gt; <span class="id" type="var">Eq</span> | <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Lt</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The complete comparison 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">compare_pure</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">compare_cont</span> <span class="id" type="var">s1</span> <span class="id" type="var">compare_end</span> (<span class="id" type="var">R.cons</span> <span class="id" type="var">s2</span> (<span class="id" type="var">Raw.End</span> <span class="id" type="var">_</span>)).<br/>

<br/>
</div>

<div class="doc">
Correctness of this comparison 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">Cmp</span> <span class="id" type="var">c</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">c</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq</span> =&gt; <span class="id" type="var">LO.eq_list</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lt</span> =&gt; <span class="id" type="var">LO.lt_list</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Gt</span> =&gt; (<span class="id" type="keyword">fun</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> =&gt; <span class="id" type="var">LO.lt_list</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">c</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">X.eq</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> -&gt; <span class="id" type="var">D.eq</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> <span class="id" type="var">c</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">Cmp</span> <span class="id" type="var">c</span> ((<span class="id" type="var">x1</span>,<span class="id" type="var">d1</span>)::<span class="id" type="var">l1</span>) ((<span class="id" type="var">x2</span>,<span class="id" type="var">d2</span>)::<span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">cons_Cmp</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_end_Cmp</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e2</span>, <span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_end</span> <span class="id" type="var">e2</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">P.flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_more_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">cont</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">cont</span> (<span class="id" type="var">R.cons</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) <span class="id" type="var">l</span> (<span class="id" type="var">R.elements</span> <span class="id" type="var">r2</span> ++ <span class="id" type="var">P.flatten_e</span> <span class="id" type="var">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_more</span> <span class="id" type="var">x1</span> <span class="id" type="var">d1</span> <span class="id" type="var">cont</span> (<span class="id" type="var">R.More</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)) ((<span class="id" type="var">x1</span>,<span class="id" type="var">d1</span>)::<span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P.flatten_e</span> (<span class="id" type="var">R.More</span> <span class="id" type="var">x2</span> <span class="id" type="var">d2</span> <span class="id" type="var">r2</span> <span class="id" type="var">e2</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_cont_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">Cmp</span> (<span class="id" type="var">cont</span> <span class="id" type="var">e</span>) <span class="id" type="var">l</span> (<span class="id" type="var">P.flatten_e</span> <span class="id" type="var">e</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_cont</span> <span class="id" type="var">s1</span> <span class="id" type="var">cont</span> <span class="id" type="var">e2</span>) (<span class="id" type="var">R.elements</span> <span class="id" type="var">s1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">P.flatten_e</span> <span class="id" type="var">e2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">compare_Cmp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Cmp</span> (<span class="id" type="var">compare_pure</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">R.elements</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">R.elements</span> <span class="id" type="var">s2</span>).<br/>

<br/>
</div>

<div class="doc">
The dependent-style <span class="inlinecode"><span class="id" type="var">compare</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq</span> (<span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>) := <span class="id" type="var">LO.eq_list</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m1</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">lt</span> (<span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>) := <span class="id" type="var">LO.lt_list</span> (<span class="id" type="var">elements</span> <span class="id" type="var">m1</span>) (<span class="id" type="var">elements</span> <span class="id" type="var">m2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">compare</span> (<span class="id" type="var">s</span> <span class="id" type="var">s'</span>:<span class="id" type="var">t</span>) : <span class="id" type="var">Compare</span> <span class="id" type="var">lt</span> <span class="id" type="var">eq</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">selements</span> (<span class="id" type="var">m1</span> : <span class="id" type="var">t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">LO.MapS.Build_slist</span> (<span class="id" type="var">P.elements_sort</span> <span class="id" type="var">m1</span>.(<span class="id" type="var">is_bst</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">seq</span> (<span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>) := <span class="id" type="var">LO.eq</span> (<span class="id" type="var">selements</span> <span class="id" type="var">m1</span>) (<span class="id" type="var">selements</span> <span class="id" type="var">m2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Definition</span> <span class="id" type="var">slt</span> (<span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>) := <span class="id" type="var">LO.lt</span> (<span class="id" type="var">selements</span> <span class="id" type="var">m1</span>) (<span class="id" type="var">selements</span> <span class="id" type="var">m2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_seq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>, <span class="id" type="var">eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> &lt;-&gt; <span class="id" type="var">seq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_slt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>, <span class="id" type="var">lt</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> &lt;-&gt; <span class="id" type="var">slt</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_1</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">m</span> <span class="id" type="var">m'</span> : <span class="id" type="var">t</span>), <span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">eq</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>, <span class="id" type="var">eq</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span> -&gt; <span class="id" type="var">Equivb</span> <span class="id" type="var">cmp</span> <span class="id" type="var">m</span> <span class="id" type="var">m'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_refl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span> : <span class="id" type="var">t</span>, <span class="id" type="var">eq</span> <span class="id" type="var">m</span> <span class="id" type="var">m</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_sym</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>, <span class="id" type="var">eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">eq</span> <span class="id" type="var">m2</span> <span class="id" type="var">m1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_trans</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">m3</span> : <span class="id" type="var">t</span>, <span class="id" type="var">eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">eq</span> <span class="id" type="var">m2</span> <span class="id" type="var">m3</span> -&gt; <span class="id" type="var">eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_trans</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> <span class="id" type="var">m3</span> : <span class="id" type="var">t</span>, <span class="id" type="var">lt</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> -&gt; <span class="id" type="var">lt</span> <span class="id" type="var">m2</span> <span class="id" type="var">m3</span> -&gt; <span class="id" type="var">lt</span> <span class="id" type="var">m1</span> <span class="id" type="var">m3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lt_not_eq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> : <span class="id" type="var">t</span>, <span class="id" type="var">lt</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span> -&gt; ~ <span class="id" type="var">eq</span> <span class="id" type="var">m1</span> <span class="id" type="var">m2</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">IntMake_ord</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">E</span> := <span class="id" type="var">X</span><br/>
&nbsp;:=<span class="id" type="var">IntMake</span>(<span class="id" type="var">Z_as_Int</span>)(<span class="id" type="var">X</span>).<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make_ord</span> (<span class="id" type="var">X</span>: <span class="id" type="var">OrderedType</span>)(<span class="id" type="var">D</span>: <span class="id" type="var">OrderedType</span>)<br/>
&nbsp;&lt;: <span class="id" type="var">Sord</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">Data</span> := <span class="id" type="var">D</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">MapS.E</span> := <span class="id" type="var">X</span><br/>
&nbsp;:=<span class="id" type="var">IntMake_ord</span>(<span class="id" type="var">Z_as_Int</span>)(<span class="id" type="var">X</span>)(<span class="id" type="var">D</span>).<br/>

<br/>
</div>
<div id="sidebarWrapper">
<div id="sidebar">

<div class="block">
<h2 class="title">Navigation</h2>
<div class="content">

<ul class="menu">

<li class="leaf">Standard Library
  <ul class="menu">
  <li><a href="index.html">Table of contents</a></li>
  <li><a href="genindex.html">Index</a></li>
  </ul>
</li>

</ul>

</div>
</div>

</div>
</div>


</div>

<div id="footer">
<div id="nav-footer">
  <ul class="links-menu-footer">
    <li><a href="mailto:www-coq_@_lix.polytechnique.fr">webmaster</a></li>
    <li><a href="http://validator.w3.org/check?uri=referer">xhtml valid</a></li>
    <li><a href="http://jigsaw.w3.org/css-validator/check/referer">CSS valid</a></li>
  </ul>

</div>
</div>

</div>

</body>
</html>

