<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>MakeQueue (coq.AsyncTaskQueue.MakeQueue)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">coq</a> &#x00BB; <a href="../index.html">AsyncTaskQueue</a> &#x00BB; MakeQueue</nav><h1>Module <code>AsyncTaskQueue.MakeQueue</code></h1><p>Client-side functor. <code>MakeQueue T</code> creates a task queue for task <code>T</code></p></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-T/index.html">T</a> : <a href="../index.html#module-type-Task">Task</a></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec type" id="type-queue"><a href="#type-queue" class="anchor"></a><code><span class="keyword">type</span> queue</code></dt><dd><p><code>queue</code> is the abstract queue type.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : int <span>&#45;&gt;</span> <a href="../../CoqworkmgrApi/index.html#type-priority">CoqworkmgrApi.priority</a> <span>&#45;&gt;</span> <a href="index.html#type-queue">queue</a></code></dt><dd><p><code>create n pri</code> will initialize the queue with <code>n</code> workers having priority <code>pri</code>. If <code>n</code> is 0, the queue won't spawn any process, working in a lazy local manner. <code>not imposed by the this API</code></p></dd></dl><dl><dt class="spec value" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span class="keyword">val</span> destroy : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>destroy q</code> Deallocates <code>q</code>, cancelling all pending tasks.</p></dd></dl><dl><dt class="spec value" id="val-n_workers"><a href="#val-n_workers" class="anchor"></a><code><span class="keyword">val</span> n_workers : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>n_workers q</code> returns the number of workers of <code>q</code></p></dd></dl><dl><dt class="spec value" id="val-enqueue_task"><a href="#val-enqueue_task" class="anchor"></a><code><span class="keyword">val</span> enqueue_task : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> <a href="argument-1-T/index.html#type-task">T.task</a> <span>&#45;&gt;</span> <span>cancel_switch:<a href="../index.html#type-cancel_switch">cancel_switch</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>enqueue_task q t ~cancel_switch</code> schedules <code>t</code> for execution in <code>q</code>. <code>cancel_switch</code> can be flipped to true to cancel the task.</p></dd></dl><dl><dt class="spec value" id="val-join"><a href="#val-join" class="anchor"></a><code><span class="keyword">val</span> join : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>join q</code> blocks until the task queue is empty</p></dd></dl><dl><dt class="spec value" id="val-cancel_all"><a href="#val-cancel_all" class="anchor"></a><code><span class="keyword">val</span> cancel_all : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>cancel_all q</code> Cancels all tasks</p></dd></dl><dl><dt class="spec value" id="val-cancel_worker"><a href="#val-cancel_worker" class="anchor"></a><code><span class="keyword">val</span> cancel_worker : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> <a href="../../WorkerPool/index.html#type-worker_id">WorkerPool.worker_id</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>cancel_worker q wid</code> cancels a particular worker <code>wid</code></p></dd></dl><dl><dt class="spec value" id="val-set_order"><a href="#val-set_order" class="anchor"></a><code><span class="keyword">val</span> set_order : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> <span>(<a href="argument-1-T/index.html#type-task">T.task</a> <span>&#45;&gt;</span> <a href="argument-1-T/index.html#type-task">T.task</a> <span>&#45;&gt;</span> int)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_order q cmp</code> reorders <code>q</code> using ordering <code>cmp</code></p></dd></dl><dl><dt class="spec value" id="val-broadcast"><a href="#val-broadcast" class="anchor"></a><code><span class="keyword">val</span> broadcast : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>broadcast q</code></p><p>This is nasty. Workers can be picky, e.g. pick tasks only when they are &quot;on screen&quot;. Of course the screen is scrolled, and that changes the potential choice of workers to pick up a task or not.</p><p>This function wakes up the workers (the managers) that give a look (again) to the tasks in the queue.</p><p>The STM calls it when the perspective (as in PIDE) changes.</p><p>A problem here is that why task_match has access to the competence data in order to decide if the task is palatable to the worker or not... such data is local to the worker (manager). The perspective is global, so it does not quite fit this picture. This API to make all managers reconsider the tasks in the queue is the best I could came up with.</p><p>This API is crucial to Coqoon (or any other UI that invokes Stm.finish eagerly but wants the workers to &quot;focus&quot; on the visible part of the document).</p></dd></dl><dl><dt class="spec value" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><code><span class="keyword">val</span> snapshot : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> <span><a href="argument-1-T/index.html#type-task">T.task</a> list</span></code></dt><dd><p><code>snapshot q</code> Takes a snapshot (non destructive but waits until all workers are enqueued)</p></dd></dl><dl><dt class="spec value" id="val-clear"><a href="#val-clear" class="anchor"></a><code><span class="keyword">val</span> clear : <a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>clear q</code> Clears <code>q</code>, only if the worker prool is empty</p></dd></dl><dl><dt class="spec value" id="val-with_n_workers"><a href="#val-with_n_workers" class="anchor"></a><code><span class="keyword">val</span> with_n_workers : int <span>&#45;&gt;</span> <a href="../../CoqworkmgrApi/index.html#type-priority">CoqworkmgrApi.priority</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-queue">queue</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>with_n_workers n pri f</code> creates a queue, runs the function, destroys the queue. The user should call join</p></dd></dl></div></body></html>